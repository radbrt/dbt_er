2021-02-21 10:50:36.521491 (MainThread): Running with dbt=0.18.1
2021-02-21 10:50:36.867305 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.test.TestTask'>, data=False, debug=False, defer=None, exclude=None, fail_fast=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='test', schema=False, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='test', write_json=True)
2021-02-21 10:50:36.868182 (MainThread): Tracking: tracking
2021-02-21 10:50:36.873169 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e83ae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef85d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ef8d0a0>]}
2021-02-21 10:50:36.897612 (MainThread): Partial parsing not enabled
2021-02-21 10:50:36.899016 (MainThread): Parsing macros/etc.sql
2021-02-21 10:50:36.900802 (MainThread): Parsing macros/catalog.sql
2021-02-21 10:50:36.906868 (MainThread): Parsing macros/adapters.sql
2021-02-21 10:50:36.926061 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 10:50:36.929126 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 10:50:36.932426 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 10:50:36.942711 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 10:50:36.947110 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 10:50:36.959387 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 10:50:36.963217 (MainThread): Parsing macros/core.sql
2021-02-21 10:50:36.969777 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 10:50:36.978729 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 10:50:36.980753 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 10:50:36.997722 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 10:50:37.027439 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 10:50:37.048034 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 10:50:37.050042 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 10:50:37.056533 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 10:50:37.070087 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 10:50:37.076598 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 10:50:37.082534 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 10:50:37.087348 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 10:50:37.088426 (MainThread): Parsing macros/etc/query.sql
2021-02-21 10:50:37.089609 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 10:50:37.091448 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 10:50:37.100120 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 10:50:37.102142 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 10:50:37.103932 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 10:50:37.143801 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 10:50:37.145994 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 10:50:37.147839 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 10:50:37.149688 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 10:50:37.156890 (MainThread): Partial parsing not enabled
2021-02-21 10:50:37.191917 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:50:37.328416 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 10:50:37.328588 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 10:50:37.328803 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f224850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f247df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f250fd0>]}
2021-02-21 10:50:37.328959 (MainThread): Flushing usage events
2021-02-21 10:50:37.933695 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 10:50:37.933931 (MainThread): Encountered an error:
2021-02-21 10:50:37.934130 (MainThread): Compilation Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Model 'model.enhetsregisteret.wrk_foretak_010' (models/er/stg/wrk_foretak_010.sql) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:50:37.940666 (MainThread): Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 124, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 202, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 255, in run_from_args
    results = task.run()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 399, in run
    self._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 118, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 78, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 65, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 748, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 351, in load_all
    manifest = loader.create_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 327, in create_manifest
    self.process_manifest(manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 298, in process_manifest
    process_refs(manifest, project_name)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 644, in process_refs
    _process_refs_for_node(manifest, current_project, node)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 626, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 383, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/exceptions.py", line 538, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/exceptions.py", line 407, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Model 'model.enhetsregisteret.wrk_foretak_010' (models/er/stg/wrk_foretak_010.sql) depends on a node named 'wrk_foretak' which was not found

2021-02-21 10:54:27.573943 (MainThread): Running with dbt=0.18.1
2021-02-21 10:54:27.950809 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.test.TestTask'>, data=False, debug=False, defer=None, exclude=None, fail_fast=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='test', schema=False, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='test', write_json=True)
2021-02-21 10:54:27.951434 (MainThread): Tracking: tracking
2021-02-21 10:54:27.956844 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0b9a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0d3940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0d35e0>]}
2021-02-21 10:54:27.977842 (MainThread): Partial parsing not enabled
2021-02-21 10:54:27.978890 (MainThread): Parsing macros/etc.sql
2021-02-21 10:54:27.980382 (MainThread): Parsing macros/catalog.sql
2021-02-21 10:54:27.986674 (MainThread): Parsing macros/adapters.sql
2021-02-21 10:54:28.007943 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 10:54:28.010635 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 10:54:28.013309 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 10:54:28.022958 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 10:54:28.027195 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 10:54:28.039330 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 10:54:28.042073 (MainThread): Parsing macros/core.sql
2021-02-21 10:54:28.045528 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 10:54:28.054153 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 10:54:28.055805 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 10:54:28.071915 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 10:54:28.099454 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 10:54:28.119244 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 10:54:28.120975 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 10:54:28.127135 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 10:54:28.140727 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 10:54:28.147151 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 10:54:28.153296 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 10:54:28.158156 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 10:54:28.159032 (MainThread): Parsing macros/etc/query.sql
2021-02-21 10:54:28.160072 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 10:54:28.161905 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 10:54:28.170514 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 10:54:28.172433 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 10:54:28.174106 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 10:54:28.214477 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 10:54:28.216225 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 10:54:28.217647 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 10:54:28.219233 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 10:54:28.226437 (MainThread): Partial parsing not enabled
2021-02-21 10:54:28.259803 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:54:28.443646 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 10:54:28.443787 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 10:54:28.443980 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:54:28.444120 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:54:28.444241 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:54:28.444355 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:54:28.477148 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 10:54:28.516452 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 10:54:28.516949 (MainThread): WARNING: Nothing to do. Try checking your model configs and model specification args
2021-02-21 10:54:28.517097 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1bf820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2de610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2de580>]}
2021-02-21 10:54:28.517243 (MainThread): Flushing usage events
2021-02-21 10:54:29.014948 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 10:55:09.529588 (MainThread): Running with dbt=0.18.1
2021-02-21 10:55:09.872328 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 10:55:09.873019 (MainThread): Tracking: tracking
2021-02-21 10:55:09.877588 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b218fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b968dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b968a60>]}
2021-02-21 10:55:09.897294 (MainThread): Partial parsing not enabled
2021-02-21 10:55:09.898218 (MainThread): Parsing macros/etc.sql
2021-02-21 10:55:09.899723 (MainThread): Parsing macros/catalog.sql
2021-02-21 10:55:09.905340 (MainThread): Parsing macros/adapters.sql
2021-02-21 10:55:09.923065 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 10:55:09.925646 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 10:55:09.928398 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 10:55:09.937766 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 10:55:09.942006 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 10:55:09.954133 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 10:55:09.956858 (MainThread): Parsing macros/core.sql
2021-02-21 10:55:09.960269 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 10:55:09.968534 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 10:55:09.970168 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 10:55:09.987726 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 10:55:10.015677 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 10:55:10.035620 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 10:55:10.037467 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 10:55:10.043498 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 10:55:10.056693 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 10:55:10.063054 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 10:55:10.069016 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 10:55:10.073680 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 10:55:10.074555 (MainThread): Parsing macros/etc/query.sql
2021-02-21 10:55:10.075548 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 10:55:10.077074 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 10:55:10.085483 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 10:55:10.087336 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 10:55:10.088907 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 10:55:10.128914 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 10:55:10.130673 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 10:55:10.132106 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 10:55:10.133706 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 10:55:10.142132 (MainThread): Partial parsing not enabled
2021-02-21 10:55:10.176256 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:55:10.361890 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 10:55:10.362020 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 10:55:10.362187 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:55:10.362313 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:55:10.362417 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:55:10.362515 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:55:10.394606 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 10:55:10.431782 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 10:55:10.432296 (MainThread): 
2021-02-21 10:55:10.432530 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 10:55:10.433697 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 10:55:10.433811 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 10:55:11.221350 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 10:55:11.221672 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 10:55:11.296620 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 10:55:11.861462 (MainThread): 11:55:11 | Concurrency: 1 threads (target='dev')
2021-02-21 10:55:11.861716 (MainThread): 11:55:11 | 
2021-02-21 10:55:11.869457 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:55:11.871134 (Thread-1): 11:55:11 | 1 of 1 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 10:55:11.871490 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:55:11.871652 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:55:11.892203 (Thread-1): finished collecting timing info
2021-02-21 10:55:11.893082 (Thread-1): Compilation Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  'src' is undefined
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 5, in top-level template code
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 460, in call
    if not __self.is_safe_callable(__obj):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 360, in is_safe_callable
    getattr(obj, "unsafe_callable", False) or getattr(obj, "alters_data", False)
jinja2.exceptions.UndefinedError: 'src' is undefined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/compile.py", line 23, in compile
    return compiler.compile_node(self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/compilation.py", line 385, in _compile_node
    compiled_node.compiled_sql = jinja.get_rendered(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 501, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  'src' is undefined
2021-02-21 10:55:11.901007 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17c00ac8-3473-453b-afed-b93381f6b01e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc1ebe0>]}
2021-02-21 10:55:11.902367 (Thread-1): 11:55:11 | 1 of 1 ERROR creating view model enhetsregisteret.wrk_foretak_010.... [ERROR in 0.03s]
2021-02-21 10:55:11.902521 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:55:11.903496 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 10:55:11.903753 (MainThread): 11:55:11 | 
2021-02-21 10:55:11.903865 (MainThread): 11:55:11 | Finished running 1 view model in 1.47s.
2021-02-21 10:55:11.903962 (MainThread): Connection 'master' was properly closed.
2021-02-21 10:55:11.904033 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 10:55:11.907111 (MainThread): 
2021-02-21 10:55:11.907231 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 10:55:11.907332 (MainThread): 
2021-02-21 10:55:11.907429 (MainThread): Compilation Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
2021-02-21 10:55:11.907520 (MainThread):   'src' is undefined
2021-02-21 10:55:11.907610 (MainThread): 
Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
2021-02-21 10:55:11.907776 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc1e6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb01430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc48700>]}
2021-02-21 10:55:11.907933 (MainThread): Flushing usage events
2021-02-21 10:55:35.740073 (MainThread): Running with dbt=0.18.1
2021-02-21 10:55:36.087660 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.test.TestTask'>, data=False, debug=False, defer=None, exclude=None, fail_fast=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='test', schema=False, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='test', write_json=True)
2021-02-21 10:55:36.088335 (MainThread): Tracking: tracking
2021-02-21 10:55:36.092989 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c87dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043d3e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043d3b20>]}
2021-02-21 10:55:36.113695 (MainThread): Partial parsing not enabled
2021-02-21 10:55:36.114620 (MainThread): Parsing macros/etc.sql
2021-02-21 10:55:36.116193 (MainThread): Parsing macros/catalog.sql
2021-02-21 10:55:36.122193 (MainThread): Parsing macros/adapters.sql
2021-02-21 10:55:36.139777 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 10:55:36.142284 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 10:55:36.144956 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 10:55:36.154200 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 10:55:36.158395 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 10:55:36.170204 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 10:55:36.172967 (MainThread): Parsing macros/core.sql
2021-02-21 10:55:36.176419 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 10:55:36.184405 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 10:55:36.186001 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 10:55:36.201646 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 10:55:36.228528 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 10:55:36.247961 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 10:55:36.249709 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 10:55:36.255531 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 10:55:36.269189 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 10:55:36.276177 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 10:55:36.283457 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 10:55:36.288531 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 10:55:36.289625 (MainThread): Parsing macros/etc/query.sql
2021-02-21 10:55:36.290585 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 10:55:36.292141 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 10:55:36.300667 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 10:55:36.302550 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 10:55:36.304074 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 10:55:36.343242 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 10:55:36.344949 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 10:55:36.346333 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 10:55:36.347954 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 10:55:36.354912 (MainThread): Partial parsing not enabled
2021-02-21 10:55:36.387995 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:55:36.573655 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 10:55:36.573791 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 10:55:36.573991 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:55:36.574133 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:55:36.574250 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:55:36.574362 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:55:36.606577 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 10:55:36.644629 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 10:55:36.645211 (MainThread): WARNING: Nothing to do. Try checking your model configs and model specification args
2021-02-21 10:55:36.645359 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045c5f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045c54f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104644ca0>]}
2021-02-21 10:55:36.645505 (MainThread): Flushing usage events
2021-02-21 10:55:37.086007 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 10:55:39.856409 (MainThread): Running with dbt=0.18.1
2021-02-21 10:55:40.214048 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 10:55:40.214890 (MainThread): Tracking: tracking
2021-02-21 10:55:40.219830 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dcae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dd2520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dd21c0>]}
2021-02-21 10:55:40.241088 (MainThread): Partial parsing not enabled
2021-02-21 10:55:40.242017 (MainThread): Parsing macros/etc.sql
2021-02-21 10:55:40.243452 (MainThread): Parsing macros/catalog.sql
2021-02-21 10:55:40.249089 (MainThread): Parsing macros/adapters.sql
2021-02-21 10:55:40.266736 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 10:55:40.269271 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 10:55:40.271973 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 10:55:40.281149 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 10:55:40.285263 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 10:55:40.297418 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 10:55:40.300129 (MainThread): Parsing macros/core.sql
2021-02-21 10:55:40.303476 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 10:55:40.311718 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 10:55:40.313380 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 10:55:40.329730 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 10:55:40.356708 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 10:55:40.376179 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 10:55:40.378014 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 10:55:40.384206 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 10:55:40.397265 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 10:55:40.404042 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 10:55:40.410897 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 10:55:40.415627 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 10:55:40.416675 (MainThread): Parsing macros/etc/query.sql
2021-02-21 10:55:40.417820 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 10:55:40.419337 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 10:55:40.427603 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 10:55:40.429482 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 10:55:40.431155 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 10:55:40.471554 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 10:55:40.473320 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 10:55:40.474751 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 10:55:40.476408 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 10:55:40.483672 (MainThread): Partial parsing not enabled
2021-02-21 10:55:40.519493 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:55:40.707101 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 10:55:40.707253 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 10:55:40.707450 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:55:40.707588 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:55:40.707723 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:55:40.707831 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:55:40.742794 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 10:55:40.781547 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 10:55:40.782174 (MainThread): 
2021-02-21 10:55:40.782420 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 10:55:40.783563 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 10:55:40.783679 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 10:55:41.507185 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 10:55:41.507533 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 10:55:41.576904 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 10:55:42.093487 (MainThread): 11:55:42 | Concurrency: 1 threads (target='dev')
2021-02-21 10:55:42.093747 (MainThread): 11:55:42 | 
2021-02-21 10:55:42.097702 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:55:42.099137 (Thread-1): 11:55:42 | 1 of 1 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 10:55:42.099476 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:55:42.099639 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:55:42.119387 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 10:55:42.119989 (Thread-1): finished collecting timing info
2021-02-21 10:55:42.152379 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 10:55:42.153020 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 10:55:42.217427 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    antall_ansatte,
    naeringskode1.kode AS nkode1
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
)
SELECT * FROM foretak;


2021-02-21 10:55:44.230011 (Thread-1): Retry attempt 1 of 1 after error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/4b6ca15e-60ba-4c28-a3ac-f27ed0e63430?maxResults=0&location=US: Unrecognized name: antall_ansatte; Did you mean antallAnsatte? at [8:5]')
2021-02-21 10:55:45.886270 (Thread-1): finished collecting timing info
2021-02-21 10:55:45.887588 (Thread-1): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Unrecognized name: antall_ansatte; Did you mean antallAnsatte? at [8:5]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3103, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3083, in done
    self._query_results = self._client._get_query_results(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 1288, in _get_query_results
    resource = self._call_api(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 558, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/72d3bc78-3671-44ac-9e41-2801613d5b60?maxResults=0&location=US: Unrecognized name: antall_ansatte; Did you mean antallAnsatte? at [8:5]

(job ID: 72d3bc78-3671-44ac-9e41-2801613d5b60)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */
   2:
   3:
   4:  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
   5:  OPTIONS()
   6:  as WITH foretak AS (
   7:    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
   8:    antall_ansatte,
   9:    naeringskode1.kode AS nkode1
  10:    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  11:)
  12:SELECT * FROM foretak;
  13:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 22, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 107, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Unrecognized name: antall_ansatte; Did you mean antallAnsatte? at [8:5]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 10:55:45.904329 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0782cb1f-e655-495b-b60b-f3ec20020ce7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111938070>]}
2021-02-21 10:55:45.906280 (Thread-1): 11:55:45 | 1 of 1 ERROR creating view model enhetsregisteret.wrk_foretak_010.... [ERROR in 3.80s]
2021-02-21 10:55:45.906494 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:55:45.907930 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 10:55:45.908263 (MainThread): 11:55:45 | 
2021-02-21 10:55:45.908408 (MainThread): 11:55:45 | Finished running 1 view model in 5.13s.
2021-02-21 10:55:45.908528 (MainThread): Connection 'master' was properly closed.
2021-02-21 10:55:45.908617 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 10:55:45.913239 (MainThread): 
2021-02-21 10:55:45.913388 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 10:55:45.913511 (MainThread): 
2021-02-21 10:55:45.913631 (MainThread): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
2021-02-21 10:55:45.913739 (MainThread):   Unrecognized name: antall_ansatte; Did you mean antallAnsatte? at [8:5]
2021-02-21 10:55:45.913839 (MainThread):   compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 10:55:45.913945 (MainThread): 
Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
2021-02-21 10:55:45.914147 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11194cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120511f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f7ad30>]}
2021-02-21 10:55:45.914332 (MainThread): Flushing usage events
2021-02-21 10:56:31.811214 (MainThread): Running with dbt=0.18.1
2021-02-21 10:56:32.165361 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 10:56:32.166273 (MainThread): Tracking: tracking
2021-02-21 10:56:32.171015 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116d2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e24160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e24040>]}
2021-02-21 10:56:32.191568 (MainThread): Partial parsing not enabled
2021-02-21 10:56:32.192539 (MainThread): Parsing macros/etc.sql
2021-02-21 10:56:32.193946 (MainThread): Parsing macros/catalog.sql
2021-02-21 10:56:32.199815 (MainThread): Parsing macros/adapters.sql
2021-02-21 10:56:32.218142 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 10:56:32.220966 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 10:56:32.223827 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 10:56:32.233235 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 10:56:32.237468 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 10:56:32.249773 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 10:56:32.252522 (MainThread): Parsing macros/core.sql
2021-02-21 10:56:32.255975 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 10:56:32.264405 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 10:56:32.266252 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 10:56:32.283014 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 10:56:32.311211 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 10:56:32.330976 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 10:56:32.332938 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 10:56:32.338886 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 10:56:32.354121 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 10:56:32.360541 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 10:56:32.366709 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 10:56:32.371701 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 10:56:32.372587 (MainThread): Parsing macros/etc/query.sql
2021-02-21 10:56:32.373632 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 10:56:32.375350 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 10:56:32.383970 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 10:56:32.385910 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 10:56:32.387545 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 10:56:32.427536 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 10:56:32.429448 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 10:56:32.431000 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 10:56:32.432800 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 10:56:32.442012 (MainThread): Partial parsing not enabled
2021-02-21 10:56:32.476734 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:56:32.664492 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 10:56:32.664615 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 10:56:32.664810 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:56:32.664933 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 10:56:32.665037 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:56:32.665136 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 10:56:32.696959 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 10:56:32.734410 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 10:56:32.734948 (MainThread): 
2021-02-21 10:56:32.735185 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 10:56:32.736513 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 10:56:32.736635 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 10:56:33.310100 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 10:56:33.310292 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 10:56:33.379683 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 10:56:33.888266 (MainThread): 11:56:33 | Concurrency: 1 threads (target='dev')
2021-02-21 10:56:33.888523 (MainThread): 11:56:33 | 
2021-02-21 10:56:33.892072 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:56:33.893411 (Thread-1): 11:56:33 | 1 of 1 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 10:56:33.893724 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 10:56:33.893872 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:56:33.910809 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 10:56:33.911123 (Thread-1): finished collecting timing info
2021-02-21 10:56:33.939545 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 10:56:33.939927 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 10:56:34.002891 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
)
SELECT * FROM foretak;


2021-02-21 10:56:35.131658 (Thread-1): finished collecting timing info
2021-02-21 10:56:35.132485 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75a8a4dd-6604-4627-b493-65ddaa0ee719', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11210c250>]}
2021-02-21 10:56:35.133974 (Thread-1): 11:56:35 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_010........ [CREATE VIEW in 1.24s]
2021-02-21 10:56:35.134140 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 10:56:35.135433 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 10:56:35.135769 (MainThread): 11:56:35 | 
2021-02-21 10:56:35.135909 (MainThread): 11:56:35 | Finished running 1 view model in 2.40s.
2021-02-21 10:56:35.136026 (MainThread): Connection 'master' was properly closed.
2021-02-21 10:56:35.136113 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 10:56:35.140129 (MainThread): 
2021-02-21 10:56:35.140267 (MainThread): Completed successfully
2021-02-21 10:56:35.140386 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 10:56:35.140586 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fcb2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fcb160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fcb8e0>]}
2021-02-21 10:56:35.140765 (MainThread): Flushing usage events
2021-02-21 11:19:17.426147 (MainThread): Running with dbt=0.18.1
2021-02-21 11:19:17.959682 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:19:17.960480 (MainThread): Tracking: tracking
2021-02-21 11:19:17.968079 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6b20a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bdedd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bdf5070>]}
2021-02-21 11:19:17.989375 (MainThread): Partial parsing not enabled
2021-02-21 11:19:17.990928 (MainThread): Parsing macros/etc.sql
2021-02-21 11:19:17.992885 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:19:17.999267 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:19:18.017943 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:19:18.020669 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:19:18.023650 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:19:18.033477 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:19:18.037924 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:19:18.050161 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:19:18.053902 (MainThread): Parsing macros/core.sql
2021-02-21 11:19:18.058329 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:19:18.067491 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:19:18.069501 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:19:18.086617 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:19:18.114958 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:19:18.134946 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:19:18.137003 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:19:18.143642 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:19:18.157661 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:19:18.164426 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:19:18.170928 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:19:18.176035 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:19:18.177127 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:19:18.178323 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:19:18.180006 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:19:18.188837 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:19:18.190902 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:19:18.192790 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:19:18.233169 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:19:18.235420 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:19:18.237284 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:19:18.239089 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:19:18.247766 (MainThread): Partial parsing not enabled
2021-02-21 11:19:18.283343 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:19:18.301153 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:19:18.487739 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:19:18.487859 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:19:18.488063 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:19:18.488196 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:19:18.488304 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:19:18.488405 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:19:18.523694 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 11:19:18.562903 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:19:18.563451 (MainThread): 
2021-02-21 11:19:18.563691 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:19:18.565978 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:19:18.566102 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:19:19.365658 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:19:19.365929 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:19:19.435195 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:19:19.817776 (MainThread): 12:19:19 | Concurrency: 1 threads (target='dev')
2021-02-21 11:19:19.817985 (MainThread): 12:19:19 | 
2021-02-21 11:19:19.823250 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:19:19.824303 (Thread-1): 12:19:19 | 1 of 2 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 11:19:19.824594 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:19:19.824736 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:19:19.842242 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:19:19.842604 (Thread-1): finished collecting timing info
2021-02-21 11:19:19.874873 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:19:19.875370 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:19:19.938557 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
)
SELECT * FROM foretak;


2021-02-21 11:19:21.474326 (Thread-1): finished collecting timing info
2021-02-21 11:19:21.475230 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6421cc29-3e8c-41b9-a28f-d0541f6de37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c065fa0>]}
2021-02-21 11:19:21.476586 (Thread-1): 12:19:21 | 1 of 2 OK created view model enhetsregisteret.wrk_foretak_010........ [CREATE VIEW in 1.65s]
2021-02-21 11:19:21.476762 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:19:21.476948 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:19:21.478220 (Thread-1): 12:19:21 | 2 of 2 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 11:19:21.478540 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:19:21.478678 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:19:21.482180 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50393, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:19:21.482350 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50395, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:19:21.482492 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50394, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:19:21.482629 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50396, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:19:21.482767 (Thread-1): unclosed <socket.socket fd=18, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50397, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:19:21.482894 (Thread-1): unclosed <socket.socket fd=19, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50398, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:19:21.486874 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 11:19:21.487294 (Thread-1): finished collecting timing info
2021-02-21 11:19:21.491774 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 11:19:21.492143 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:19:21.565056 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT * FROM ref('wrk_foretak_010')
)
SELECT * FROM foretak;


2021-02-21 11:19:22.486020 (Thread-1): Retry attempt 1 of 1 after error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/9f36535e-6706-47aa-9bea-7bd680107007?maxResults=0&location=US: Table-valued function not found: ref at [7:19]')
2021-02-21 11:19:24.258232 (Thread-1): finished collecting timing info
2021-02-21 11:19:24.259415 (Thread-1): Database Error in model wrk_foretak_020 (models/er/stg/wrk_foretak_020.sql)
  Table-valued function not found: ref at [7:19]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_020.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3103, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3083, in done
    self._query_results = self._client._get_query_results(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 1288, in _get_query_results
    resource = self._call_api(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 558, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/59cb66a7-076d-4098-8111-669083481deb?maxResults=0&location=US: Table-valued function not found: ref at [7:19]

(job ID: 59cb66a7-076d-4098-8111-669083481deb)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */
   2:
   3:
   4:  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
   5:  OPTIONS()
   6:  as WITH foretak AS (
   7:    SELECT * FROM ref('wrk_foretak_010')
   8:)
   9:SELECT * FROM foretak;
  10:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 22, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 107, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model wrk_foretak_020 (models/er/stg/wrk_foretak_020.sql)
  Table-valued function not found: ref at [7:19]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_020.sql
2021-02-21 11:19:24.285267 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6421cc29-3e8c-41b9-a28f-d0541f6de37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c159310>]}
2021-02-21 11:19:24.287244 (Thread-1): 12:19:24 | 2 of 2 ERROR creating view model enhetsregisteret.wrk_foretak_020.... [ERROR in 2.81s]
2021-02-21 11:19:24.287448 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:19:24.289103 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:19:24.289468 (MainThread): 12:19:24 | 
2021-02-21 11:19:24.289607 (MainThread): 12:19:24 | Finished running 2 view models in 5.73s.
2021-02-21 11:19:24.289727 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:19:24.289815 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 11:19:24.296865 (MainThread): 
2021-02-21 11:19:24.297005 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 11:19:24.297120 (MainThread): 
2021-02-21 11:19:24.297242 (MainThread): Database Error in model wrk_foretak_020 (models/er/stg/wrk_foretak_020.sql)
2021-02-21 11:19:24.297338 (MainThread):   Table-valued function not found: ref at [7:19]
2021-02-21 11:19:24.297426 (MainThread):   compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_020.sql
2021-02-21 11:19:24.297596 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2021-02-21 11:19:24.297801 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bfd36d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bdddbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bddd1c0>]}
2021-02-21 11:19:24.297970 (MainThread): Flushing usage events
2021-02-21 11:20:16.208720 (MainThread): Running with dbt=0.18.1
2021-02-21 11:20:16.582553 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:20:16.583283 (MainThread): Tracking: tracking
2021-02-21 11:20:16.587914 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd2be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd48bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd48850>]}
2021-02-21 11:20:16.609626 (MainThread): Partial parsing not enabled
2021-02-21 11:20:16.610572 (MainThread): Parsing macros/etc.sql
2021-02-21 11:20:16.612016 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:20:16.617619 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:20:16.635847 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:20:16.638457 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:20:16.641221 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:20:16.650731 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:20:16.654895 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:20:16.666921 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:20:16.669611 (MainThread): Parsing macros/core.sql
2021-02-21 11:20:16.673094 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:20:16.681338 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:20:16.682987 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:20:16.699343 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:20:16.727538 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:20:16.749233 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:20:16.751000 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:20:16.759071 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:20:16.772537 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:20:16.779252 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:20:16.785138 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:20:16.790097 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:20:16.791082 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:20:16.792070 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:20:16.793603 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:20:16.801925 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:20:16.803762 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:20:16.805332 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:20:16.845201 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:20:16.846960 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:20:16.848393 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:20:16.849995 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:20:16.857076 (MainThread): Partial parsing not enabled
2021-02-21 11:20:16.890676 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:20:16.908376 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:20:16.923886 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:20:17.126722 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:20:17.126839 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:20:17.127039 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:20:17.127166 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:20:17.127275 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:20:17.127377 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:20:17.162035 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 11:20:17.204698 (MainThread): Found 2 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:20:17.205349 (MainThread): 
2021-02-21 11:20:17.205603 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:20:17.207824 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:20:17.207943 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:20:17.826532 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_snapshots".
2021-02-21 11:20:17.826861 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:20:17.899360 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:20:18.452593 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:20:18.452763 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:20:18.524987 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:20:18.953521 (MainThread): 12:20:18 | Concurrency: 1 threads (target='dev')
2021-02-21 11:20:18.953792 (MainThread): 12:20:18 | 
2021-02-21 11:20:18.957323 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:20:18.958491 (Thread-1): 12:20:18 | 1 of 2 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 11:20:18.958754 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:20:18.958897 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:20:18.967313 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50417, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:20:18.967463 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50418, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:20:18.967588 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50419, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:20:18.967700 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50420, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:20:18.967806 (Thread-1): unclosed <socket.socket fd=15, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50422, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:20:18.967916 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50421, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:20:18.973258 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:20:18.973595 (Thread-1): finished collecting timing info
2021-02-21 11:20:19.005413 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:20:19.006313 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:20:19.068870 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
)
SELECT * FROM foretak;


2021-02-21 11:20:20.054565 (Thread-1): finished collecting timing info
2021-02-21 11:20:20.055423 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '790cdb91-67bb-42d4-b7a8-ef7c45827ed9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dded520>]}
2021-02-21 11:20:20.056722 (Thread-1): 12:20:20 | 1 of 2 OK created view model enhetsregisteret.wrk_foretak_010........ [CREATE VIEW in 1.10s]
2021-02-21 11:20:20.056891 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:20:20.057537 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:20:20.058651 (Thread-1): 12:20:20 | 2 of 2 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 11:20:20.059065 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:20:20.059223 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:20:20.067736 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 11:20:20.068118 (Thread-1): finished collecting timing info
2021-02-21 11:20:20.072245 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 11:20:20.072562 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:20:20.144678 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT * FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 11:20:21.265384 (Thread-1): finished collecting timing info
2021-02-21 11:20:21.266299 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '790cdb91-67bb-42d4-b7a8-ef7c45827ed9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df331c0>]}
2021-02-21 11:20:21.267637 (Thread-1): 12:20:21 | 2 of 2 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.21s]
2021-02-21 11:20:21.267813 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:20:21.269225 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:20:21.269589 (MainThread): 12:20:21 | 
2021-02-21 11:20:21.269734 (MainThread): 12:20:21 | Finished running 2 view models in 4.06s.
2021-02-21 11:20:21.269860 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:20:21.269953 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 11:20:21.277336 (MainThread): 
2021-02-21 11:20:21.277484 (MainThread): Completed successfully
2021-02-21 11:20:21.277615 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-02-21 11:20:21.277835 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df3fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df69c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df69940>]}
2021-02-21 11:20:21.278027 (MainThread): Flushing usage events
2021-02-21 11:33:46.420411 (MainThread): Running with dbt=0.18.1
2021-02-21 11:33:46.932334 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:33:46.933632 (MainThread): Tracking: tracking
2021-02-21 11:33:46.941259 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108880e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fcaf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fcabe0>]}
2021-02-21 11:33:46.962580 (MainThread): Partial parsing not enabled
2021-02-21 11:33:46.964100 (MainThread): Parsing macros/etc.sql
2021-02-21 11:33:46.967193 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:33:46.973659 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:33:46.992328 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:33:46.995243 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:33:46.998280 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:33:47.008317 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:33:47.012917 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:33:47.025479 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:33:47.029421 (MainThread): Parsing macros/core.sql
2021-02-21 11:33:47.033650 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:33:47.044586 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:33:47.046492 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:33:47.063680 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:33:47.095200 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:33:47.115000 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:33:47.116927 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:33:47.122949 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:33:47.136607 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:33:47.143500 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:33:47.150105 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:33:47.155022 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:33:47.156026 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:33:47.157349 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:33:47.159166 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:33:47.168017 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:33:47.170000 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:33:47.171814 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:33:47.212706 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:33:47.215066 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:33:47.216867 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:33:47.218793 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:33:47.225993 (MainThread): Partial parsing not enabled
2021-02-21 11:33:47.261344 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.foretak_scd".
2021-02-21 11:33:47.267371 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10903b730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10916e370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109163970>]}
2021-02-21 11:33:47.267578 (MainThread): Flushing usage events
2021-02-21 11:33:47.885060 (MainThread): Connection 'model.enhetsregisteret.foretak_scd' was properly closed.
2021-02-21 11:33:47.885294 (MainThread): Encountered an error:
2021-02-21 11:33:47.885496 (MainThread): Compilation Error in model foretak_scd (models/er/dwh/foretak_scd.sql)
  Encountered unknown tag 'snapshot'.
    line 1
      {% snapshot foretak_scd %}
2021-02-21 11:33:47.893832 (MainThread): Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 1, in template
jinja2.exceptions.TemplateSyntaxError: Encountered unknown tag 'snapshot'.
  line 1
    {% snapshot foretak_scd %}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 124, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 202, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 255, in run_from_args
    results = task.run()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 399, in run
    self._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 118, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 78, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 65, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 748, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 349, in load_all
    loader.load(macro_manifest=macro_manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 204, in load
    self.parse_project(project, macro_manifest, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 177, in parse_project
    self.parse_with_cache(path, parser, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 133, in parse_with_cache
    parser.parse_file(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 429, in parse_file
    self.parse_node(file_block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 288, in render_with_context
    get_rendered(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 570, in get_rendered
    template = get_template(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in model foretak_scd (models/er/dwh/foretak_scd.sql)
  Encountered unknown tag 'snapshot'.
    line 1
      {% snapshot foretak_scd %}

2021-02-21 11:35:36.667830 (MainThread): Running with dbt=0.18.1
2021-02-21 11:35:37.137151 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 11:35:37.138054 (MainThread): Tracking: tracking
2021-02-21 11:35:37.143997 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac85700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acbadf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acbaa90>]}
2021-02-21 11:35:37.164208 (MainThread): Partial parsing not enabled
2021-02-21 11:35:37.165461 (MainThread): Parsing macros/etc.sql
2021-02-21 11:35:37.167549 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:35:37.173489 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:35:37.191777 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:35:37.194544 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:35:37.197552 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:35:37.208203 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:35:37.212731 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:35:37.227006 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:35:37.230309 (MainThread): Parsing macros/core.sql
2021-02-21 11:35:37.234231 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:35:37.243553 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:35:37.245427 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:35:37.261837 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:35:37.290236 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:35:37.310691 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:35:37.312666 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:35:37.319075 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:35:37.332959 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:35:37.339694 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:35:37.346045 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:35:37.350773 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:35:37.351792 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:35:37.352885 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:35:37.354672 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:35:37.363436 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:35:37.365598 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:35:37.367363 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:35:37.409162 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:35:37.411610 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:35:37.413858 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:35:37.415843 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:35:37.423455 (MainThread): Partial parsing not enabled
2021-02-21 11:35:37.459182 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:35:37.477791 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:35:37.494822 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:35:37.507281 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad2cd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae85a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae8f730>]}
2021-02-21 11:35:37.507447 (MainThread): Flushing usage events
2021-02-21 11:35:38.055014 (MainThread): Connection 'snapshot.enhetsregisteret.foretak_snapshot' was properly closed.
2021-02-21 11:35:38.055259 (MainThread): Encountered an error:
2021-02-21 11:35:38.055465 (MainThread): Compilation Error in snapshot foretak_snapshot (snapshots/dwh/foretak.sql)
  at path []: 'target_schema' is a required property
2021-02-21 11:35:38.066763 (MainThread): jsonschema.exceptions.ValidationError: 'target_schema' is a required property

Failed validating 'required' in schema[0]:
    {'additionalProperties': True,
     'description': 'TimestampSnapshotConfig(*args, **kwds)',
     'properties': {'alias': {'oneOf': [{'type': 'string'},
                                        {'type': 'null'}]},
                    'column_types': {'default': {}, 'type': 'object'},
                    'database': {'oneOf': [{'type': 'string'},
                                           {'type': 'null'}]},
                    'enabled': {'default': True, 'type': 'boolean'},
                    'full_refresh': {'oneOf': [{'type': 'boolean'},
                                               {'type': 'null'}]},
                    'materialized': {'default': 'snapshot',
                                     'type': 'string'},
                    'persist_docs': {'default': {}, 'type': 'object'},
                    'post-hook': {'default': [],
                                  'items': {'$ref': '#/definitions/Hook'},
                                  'type': 'array'},
                    'pre-hook': {'default': [],
                                 'items': {'$ref': '#/definitions/Hook'},
                                 'type': 'array'},
                    'quoting': {'default': {}, 'type': 'object'},
                    'schema': {'oneOf': [{'type': 'string'},
                                         {'type': 'null'}]},
                    'strategy': {'enum': ['timestamp'], 'type': 'string'},
                    'tags': {'default': [],
                             'oneOf': [{'items': {'type': 'string'},
                                        'type': 'array'},
                                       {'type': 'string'}]},
                    'target_database': {'oneOf': [{'type': 'string'},
                                                  {'type': 'null'}]},
                    'target_schema': {'type': 'string'},
                    'unique_key': {'type': 'string'},
                    'updated_at': {'type': 'string'},
                    'vars': {'default': {}, 'type': 'object'}},
     'required': ['unique_key', 'target_schema', 'strategy', 'updated_at'],
     'type': 'object'}

On instance:
    {'column_types': {},
     'enabled': True,
     'materialized': 'snapshot',
     'persist_docs': {},
     'post-hook': [],
     'pre-hook': [],
     'quoting': {},
     'strategy': 'timestamp',
     'tags': [],
     'unique_key': 'orgnr',
     'updated_at': 'valid_date',
     'vars': {}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 378, in render_update
    self.update_parsed_node(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 316, in update_parsed_node
    config_dict = config.build_config_dict()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/context/context_config.py", line 195, in build_config_dict
    return self._cfg_source.calculate_node_config(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/context/context_config.py", line 174, in calculate_node_config
    return result.finalize_and_validate()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/contracts/graph/model_config.py", line 511, in finalize_and_validate
    return SnapshotWrapper.from_dict({'config': data}).config
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/hologram/__init__.py", line 618, in from_dict
    cls.validate(data)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/contracts/graph/model_config.py", line 467, in validate
    raise ValidationError.create_from(error) from error
hologram.ValidationError: 'target_schema' is a required property

Failed validating 'required' in schema[0]:
    {'additionalProperties': True,
     'description': 'TimestampSnapshotConfig(*args, **kwds)',
     'properties': {'alias': {'oneOf': [{'type': 'string'},
                                        {'type': 'null'}]},
                    'column_types': {'default': {}, 'type': 'object'},
                    'database': {'oneOf': [{'type': 'string'},
                                           {'type': 'null'}]},
                    'enabled': {'default': True, 'type': 'boolean'},
                    'full_refresh': {'oneOf': [{'type': 'boolean'},
                                               {'type': 'null'}]},
                    'materialized': {'default': 'snapshot',
                                     'type': 'string'},
                    'persist_docs': {'default': {}, 'type': 'object'},
                    'post-hook': {'default': [],
                                  'items': {'$ref': '#/definitions/Hook'},
                                  'type': 'array'},
                    'pre-hook': {'default': [],
                                 'items': {'$ref': '#/definitions/Hook'},
                                 'type': 'array'},
                    'quoting': {'default': {}, 'type': 'object'},
                    'schema': {'oneOf': [{'type': 'string'},
                                         {'type': 'null'}]},
                    'strategy': {'enum': ['timestamp'], 'type': 'string'},
                    'tags': {'default': [],
                             'oneOf': [{'items': {'type': 'string'},
                                        'type': 'array'},
                                       {'type': 'string'}]},
                    'target_database': {'oneOf': [{'type': 'string'},
                                                  {'type': 'null'}]},
                    'target_schema': {'type': 'string'},
                    'unique_key': {'type': 'string'},
                    'updated_at': {'type': 'string'},
                    'vars': {'default': {}, 'type': 'object'}},
     'required': ['unique_key', 'target_schema', 'strategy', 'updated_at'],
     'type': 'object'}

On instance:
    {'column_types': {},
     'enabled': True,
     'materialized': 'snapshot',
     'persist_docs': {},
     'post-hook': [],
     'pre-hook': [],
     'quoting': {},
     'strategy': 'timestamp',
     'tags': [],
     'unique_key': 'orgnr',
     'updated_at': 'valid_date',
     'vars': {}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 124, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 202, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 255, in run_from_args
    results = task.run()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 399, in run
    self._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 118, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 78, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 65, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 748, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 349, in load_all
    loader.load(macro_manifest=macro_manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 204, in load
    self.parse_project(project, macro_manifest, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 177, in parse_project
    self.parse_with_cache(path, parser, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 133, in parse_with_cache
    parser.parse_file(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/snapshots.py", line 82, in parse_file
    self.parse_node(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 382, in render_update
    raise CompilationException(msg, node=node) from exc
dbt.exceptions.CompilationException: Compilation Error in snapshot foretak_snapshot (snapshots/dwh/foretak.sql)
  at path []: 'target_schema' is a required property

2021-02-21 11:39:15.428514 (MainThread): Running with dbt=0.18.1
2021-02-21 11:39:15.920409 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:39:15.921597 (MainThread): Tracking: tracking
2021-02-21 11:39:15.927293 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b5fe20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062b21c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062b20a0>]}
2021-02-21 11:39:15.949172 (MainThread): Partial parsing not enabled
2021-02-21 11:39:15.950461 (MainThread): Parsing macros/etc.sql
2021-02-21 11:39:15.954082 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:39:15.960235 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:39:15.979024 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:39:15.981871 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:39:15.985126 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:39:15.996740 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:39:16.001832 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:39:16.014419 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:39:16.017578 (MainThread): Parsing macros/core.sql
2021-02-21 11:39:16.021534 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:39:16.030612 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:39:16.032793 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:39:16.050704 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:39:16.079095 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:39:16.100758 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:39:16.102699 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:39:16.108998 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:39:16.122665 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:39:16.129742 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:39:16.136101 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:39:16.141432 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:39:16.142525 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:39:16.143826 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:39:16.145926 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:39:16.155564 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:39:16.158069 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:39:16.160284 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:39:16.201306 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:39:16.203685 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:39:16.205553 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:39:16.207380 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:39:16.214724 (MainThread): Partial parsing not enabled
2021-02-21 11:39:16.250360 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:39:16.268831 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:39:16.285263 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:39:16.500277 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:39:16.500394 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:39:16.500597 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:39:16.500734 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:39:16.500845 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:39:16.500949 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:39:16.537821 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 11:39:16.582113 (MainThread): Found 2 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:39:16.582763 (MainThread): 
2021-02-21 11:39:16.583015 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:39:16.585414 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:39:16.585528 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:39:17.291403 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:39:17.291700 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:39:17.371712 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:39:21.357052 (MainThread): 12:39:21 | Concurrency: 1 threads (target='dev')
2021-02-21 11:39:21.357266 (MainThread): 12:39:21 | 
2021-02-21 11:39:21.362606 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:39:21.363790 (Thread-1): 12:39:21 | 1 of 2 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 11:39:21.364072 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:39:21.364217 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:39:21.377457 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:39:21.377861 (Thread-1): finished collecting timing info
2021-02-21 11:39:21.378595 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50958, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:39:21.378743 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50959, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:39:21.378864 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50960, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:39:21.378972 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50961, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:39:21.407932 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:39:21.408338 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:39:21.473842 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
)
SELECT * FROM foretak;


2021-02-21 11:39:23.822929 (Thread-1): finished collecting timing info
2021-02-21 11:39:23.823780 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf4d1076-4cce-4513-b4e0-ba6af4f81c4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106599700>]}
2021-02-21 11:39:23.825291 (Thread-1): 12:39:23 | 1 of 2 OK created view model enhetsregisteret.wrk_foretak_010........ [CREATE VIEW in 2.46s]
2021-02-21 11:39:23.825460 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:39:23.827258 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:39:23.828634 (Thread-1): 12:39:23 | 2 of 2 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 11:39:23.828979 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:39:23.829128 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:39:23.837646 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 11:39:23.838065 (Thread-1): finished collecting timing info
2021-02-21 11:39:23.842259 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 11:39:23.842606 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:39:23.913978 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 11:39:25.287739 (Thread-1): finished collecting timing info
2021-02-21 11:39:25.288607 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf4d1076-4cce-4513-b4e0-ba6af4f81c4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10657dbe0>]}
2021-02-21 11:39:25.289902 (Thread-1): 12:39:25 | 2 of 2 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.46s]
2021-02-21 11:39:25.290072 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:39:25.291460 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:39:25.291802 (MainThread): 12:39:25 | 
2021-02-21 11:39:25.291946 (MainThread): 12:39:25 | Finished running 2 view models in 8.71s.
2021-02-21 11:39:25.292063 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:39:25.292149 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 11:39:25.298963 (MainThread): 
2021-02-21 11:39:25.299090 (MainThread): Completed successfully
2021-02-21 11:39:25.299198 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-02-21 11:39:25.299388 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066a9220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065af6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065afeb0>]}
2021-02-21 11:39:25.299553 (MainThread): Flushing usage events
2021-02-21 11:40:04.688954 (MainThread): Running with dbt=0.18.1
2021-02-21 11:40:05.134627 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 11:40:05.135610 (MainThread): Tracking: tracking
2021-02-21 11:40:05.141593 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d012df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d761160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d761040>]}
2021-02-21 11:40:05.163328 (MainThread): Partial parsing not enabled
2021-02-21 11:40:05.164979 (MainThread): Parsing macros/etc.sql
2021-02-21 11:40:05.166922 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:40:05.172818 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:40:05.191052 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:40:05.194023 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:40:05.197121 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:40:05.206725 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:40:05.211088 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:40:05.223587 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:40:05.226714 (MainThread): Parsing macros/core.sql
2021-02-21 11:40:05.230553 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:40:05.239490 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:40:05.241329 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:40:05.257849 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:40:05.288403 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:40:05.308136 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:40:05.310049 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:40:05.315975 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:40:05.329138 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:40:05.335614 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:40:05.341782 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:40:05.346691 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:40:05.347730 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:40:05.348865 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:40:05.350590 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:40:05.358946 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:40:05.360972 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:40:05.362781 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:40:05.402671 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:40:05.404839 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:40:05.406698 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:40:05.408470 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:40:05.417348 (MainThread): Partial parsing not enabled
2021-02-21 11:40:05.451637 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:40:05.469253 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:40:05.484866 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:40:05.693058 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:40:05.693180 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:40:05.693391 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:40:05.693524 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:40:05.693637 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:40:05.693744 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:40:05.729105 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 11:40:05.770932 (MainThread): Found 2 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:40:05.771572 (MainThread): 
2021-02-21 11:40:05.771826 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:40:05.773378 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:40:05.773497 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:40:06.443555 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:40:06.443842 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:40:06.510985 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:40:07.048791 (MainThread): 12:40:07 | Concurrency: 1 threads (target='dev')
2021-02-21 11:40:07.049045 (MainThread): 12:40:07 | 
2021-02-21 11:40:07.054756 (Thread-1): Began running node snapshot.enhetsregisteret.foretak_snapshot
2021-02-21 11:40:07.056135 (Thread-1): 12:40:07 | 1 of 1 START snapshot enhetsregisteret.foretak_snapshot.............. [RUN]
2021-02-21 11:40:07.056456 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:40:07.056617 (Thread-1): Compiling snapshot.enhetsregisteret.foretak_snapshot
2021-02-21 11:40:07.071195 (Thread-1): finished collecting timing info
2021-02-21 11:40:07.071924 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50982, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:40:07.072076 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50981, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:40:07.072202 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50983, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:40:07.072313 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 50984, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:40:07.094665 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:40:07.159414 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:40:07.577115 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak_snapshot"
2021-02-21 11:40:07.577689 (Thread-1): On snapshot.enhetsregisteret.foretak_snapshot: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak_snapshot"} */

      

  create or replace table `radjobads`.`enhetsregisteret`.`foretak_snapshot`
  
  
  OPTIONS()
  as (
    

    select *,
        to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id,
        updated_at as dbt_updated_at,
        updated_at as dbt_valid_from,
        nullif(updated_at, updated_at) as dbt_valid_to
    from (
        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`

    ) sbq


  );
  
2021-02-21 11:40:18.551670 (Thread-1): finished collecting timing info
2021-02-21 11:40:18.552547 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2258c8d1-6ee6-49aa-b1b6-87ee642190df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8e2b20>]}
2021-02-21 11:40:18.554099 (Thread-1): 12:40:18 | 1 of 1 OK snapshotted enhetsregisteret.foretak_snapshot.............. [CREATE TABLE (1.0m rows, 56.4 MB processed) in 11.50s]
2021-02-21 11:40:18.554289 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak_snapshot
2021-02-21 11:40:18.555616 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:40:18.555933 (MainThread): 12:40:18 | 
2021-02-21 11:40:18.556072 (MainThread): 12:40:18 | Finished running 1 snapshot in 12.78s.
2021-02-21 11:40:18.556190 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:40:18.556278 (MainThread): Connection 'snapshot.enhetsregisteret.foretak_snapshot' was properly closed.
2021-02-21 11:40:18.560321 (MainThread): 
2021-02-21 11:40:18.560472 (MainThread): Completed successfully
2021-02-21 11:40:18.560602 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 11:40:18.560814 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da1a460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d920be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d920eb0>]}
2021-02-21 11:40:18.561002 (MainThread): Flushing usage events
2021-02-21 11:52:16.923199 (MainThread): Running with dbt=0.18.1
2021-02-21 11:52:17.458601 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:52:17.459441 (MainThread): Tracking: tracking
2021-02-21 11:52:17.466167 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e89c7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8a9910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8a95b0>]}
2021-02-21 11:52:17.490032 (MainThread): Partial parsing not enabled
2021-02-21 11:52:17.491379 (MainThread): Parsing macros/etc.sql
2021-02-21 11:52:17.493079 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:52:17.499022 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:52:17.517405 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:52:17.520305 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:52:17.523528 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:52:17.533355 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:52:17.537911 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:52:17.552938 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:52:17.556514 (MainThread): Parsing macros/core.sql
2021-02-21 11:52:17.561102 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:52:17.570283 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:52:17.572359 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:52:17.589865 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:52:17.618549 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:52:17.639087 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:52:17.641000 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:52:17.647342 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:52:17.661211 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:52:17.669147 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:52:17.676277 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:52:17.681382 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:52:17.682569 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:52:17.683827 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:52:17.685666 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:52:17.695028 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:52:17.697194 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:52:17.698995 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:52:17.740966 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:52:17.743316 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:52:17.745198 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:52:17.747244 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:52:17.755079 (MainThread): Partial parsing not enabled
2021-02-21 11:52:17.792339 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:52:17.814979 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:52:17.826743 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:52:17.843870 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:52:18.060264 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:52:18.060381 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:52:18.060585 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:52:18.060719 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:52:18.060830 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:52:18.060937 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:52:18.096759 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 11:52:18.145676 (MainThread): Found 3 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:52:18.146376 (MainThread): 
2021-02-21 11:52:18.146674 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:52:18.150531 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:52:18.150653 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:52:19.075974 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:52:19.076241 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:52:19.145783 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:52:19.628173 (MainThread): 12:52:19 | Concurrency: 1 threads (target='dev')
2021-02-21 11:52:19.628434 (MainThread): 12:52:19 | 
2021-02-21 11:52:19.635366 (Thread-1): Began running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:52:19.636785 (Thread-1): 12:52:19 | 1 of 3 START table model enhetsregisteret.wrk_max_load_date.......... [RUN]
2021-02-21 11:52:19.637159 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:52:19.637328 (Thread-1): Compiling model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:52:19.641321 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51254, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:52:19.641526 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51255, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:52:19.641685 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51260, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:52:19.641836 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51258, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:52:19.653617 (Thread-1): finished collecting timing info
2021-02-21 11:52:19.654076 (Thread-1): Compilation Error in model wrk_max_load_date (models/er/stg/wrk_max_load_date.sql)
  'src' is undefined
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 5, in top-level template code
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 460, in call
    if not __self.is_safe_callable(__obj):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 360, in is_safe_callable
    getattr(obj, "unsafe_callable", False) or getattr(obj, "alters_data", False)
jinja2.exceptions.UndefinedError: 'src' is undefined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/compile.py", line 23, in compile
    return compiler.compile_node(self.node, manifest, {})
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/compilation.py", line 385, in _compile_node
    compiled_node.compiled_sql = jinja.get_rendered(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 501, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in model wrk_max_load_date (models/er/stg/wrk_max_load_date.sql)
  'src' is undefined
2021-02-21 11:52:19.663689 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8929f38-fdef-43ee-9c8f-ab11706b6ab5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea63220>]}
2021-02-21 11:52:19.665084 (Thread-1): 12:52:19 | 1 of 3 ERROR creating table model enhetsregisteret.wrk_max_load_date. [ERROR in 0.03s]
2021-02-21 11:52:19.665242 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:52:19.665830 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:52:19.666060 (Thread-1): 12:52:19 | 2 of 3 SKIP relation enhetsregisteret.wrk_foretak_010................ [SKIP]
2021-02-21 11:52:19.666210 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:52:19.666514 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:52:19.666689 (Thread-1): 12:52:19 | 3 of 3 SKIP relation enhetsregisteret.wrk_foretak_020................ [SKIP]
2021-02-21 11:52:19.666824 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:52:19.667710 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:52:19.668027 (MainThread): 12:52:19 | 
2021-02-21 11:52:19.668153 (MainThread): 12:52:19 | Finished running 1 table model, 2 view models in 1.52s.
2021-02-21 11:52:19.668261 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:52:19.668342 (MainThread): Connection 'model.enhetsregisteret.wrk_max_load_date' was properly closed.
2021-02-21 11:52:19.676447 (MainThread): 
2021-02-21 11:52:19.676569 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 11:52:19.676672 (MainThread): 
2021-02-21 11:52:19.676770 (MainThread): Compilation Error in model wrk_max_load_date (models/er/stg/wrk_max_load_date.sql)
2021-02-21 11:52:19.676860 (MainThread):   'src' is undefined
2021-02-21 11:52:19.676952 (MainThread): 
Done. PASS=0 WARN=0 ERROR=1 SKIP=2 TOTAL=3
2021-02-21 11:52:19.677117 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea74c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea4e280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea4e880>]}
2021-02-21 11:52:19.677277 (MainThread): Flushing usage events
2021-02-21 11:52:38.898279 (MainThread): Running with dbt=0.18.1
2021-02-21 11:52:39.372396 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:52:39.373544 (MainThread): Tracking: tracking
2021-02-21 11:52:39.379130 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f0ee80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10565ae80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10565ab20>]}
2021-02-21 11:52:39.402029 (MainThread): Partial parsing not enabled
2021-02-21 11:52:39.403276 (MainThread): Parsing macros/etc.sql
2021-02-21 11:52:39.405051 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:52:39.411741 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:52:39.430790 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:52:39.433918 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:52:39.437324 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:52:39.448579 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:52:39.453385 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:52:39.465905 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:52:39.469323 (MainThread): Parsing macros/core.sql
2021-02-21 11:52:39.473337 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:52:39.482319 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:52:39.484202 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:52:39.500984 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:52:39.528852 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:52:39.548997 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:52:39.550995 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:52:39.557347 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:52:39.570887 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:52:39.577753 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:52:39.584184 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:52:39.589253 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:52:39.590338 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:52:39.591529 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:52:39.593658 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:52:39.602389 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:52:39.604548 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:52:39.606453 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:52:39.650786 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:52:39.652934 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:52:39.654602 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:52:39.656503 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:52:39.664082 (MainThread): Partial parsing not enabled
2021-02-21 11:52:39.698445 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:52:39.717680 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:52:39.728724 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:52:39.745065 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:52:39.958412 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:52:39.958533 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:52:39.958741 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:52:39.958873 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:52:39.958988 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:52:39.959096 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:52:39.994649 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 11:52:40.040664 (MainThread): Found 3 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:52:40.041364 (MainThread): 
2021-02-21 11:52:40.041710 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:52:40.045009 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:52:40.045124 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:52:40.730234 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:52:40.730540 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:52:40.804587 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:52:41.323220 (MainThread): 12:52:41 | Concurrency: 1 threads (target='dev')
2021-02-21 11:52:41.323464 (MainThread): 12:52:41 | 
2021-02-21 11:52:41.329496 (Thread-1): Began running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:52:41.330952 (Thread-1): 12:52:41 | 1 of 3 START table model enhetsregisteret.wrk_max_load_date.......... [RUN]
2021-02-21 11:52:41.331332 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:52:41.331502 (Thread-1): Compiling model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:52:41.335434 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51268, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:52:41.335622 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51269, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:52:41.335775 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51271, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:52:41.335916 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51270, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:52:41.348550 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 11:52:41.348914 (Thread-1): finished collecting timing info
2021-02-21 11:52:41.390424 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 11:52:41.390848 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:52:41.454947 (Thread-1): On model.enhetsregisteret.wrk_max_load_date: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_max_load_date"} */


  create or replace table `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  
  
  OPTIONS()
  as (
    

SELECT MAX(valid_date) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  );
    
2021-02-21 11:52:43.557140 (Thread-1): finished collecting timing info
2021-02-21 11:52:43.557910 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c30ab4f-4cd8-4579-aadf-42e042dc4e9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056c11c0>]}
2021-02-21 11:52:43.558995 (Thread-1): 12:52:43 | 1 of 3 OK created table model enhetsregisteret.wrk_max_load_date..... [CREATE TABLE (1.0 rows, 11.6 MB processed) in 2.23s]
2021-02-21 11:52:43.559145 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:52:43.559748 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:52:43.560683 (Thread-1): 12:52:43 | 2 of 3 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 11:52:43.561025 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:52:43.561160 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:52:43.569739 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:52:43.570087 (Thread-1): finished collecting timing info
2021-02-21 11:52:43.588397 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:52:43.588705 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:52:43.654431 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
    WHERE valid_date = (
        SELECT current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
    )
)
SELECT * FROM foretak;


2021-02-21 11:52:44.445349 (Thread-1): Retry attempt 1 of 1 after error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/37fb9877-c9eb-496e-8bad-32dcfb0ce771?maxResults=0&location=US: No matching signature for operator = for argument types: STRING, DATE. Supported signature: ANY = ANY at [13:11]')
2021-02-21 11:52:46.104588 (Thread-1): finished collecting timing info
2021-02-21 11:52:46.105758 (Thread-1): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  No matching signature for operator = for argument types: STRING, DATE. Supported signature: ANY = ANY at [13:11]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3103, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3083, in done
    self._query_results = self._client._get_query_results(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 1288, in _get_query_results
    resource = self._call_api(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 558, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/cdfd247a-844d-48c5-afb8-4242b8222e9e?maxResults=0&location=US: No matching signature for operator = for argument types: STRING, DATE. Supported signature: ANY = ANY at [13:11]

(job ID: cdfd247a-844d-48c5-afb8-4242b8222e9e)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */
   2:
   3:
   4:  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
   5:  OPTIONS()
   6:  as WITH foretak AS (
   7:    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
   8:    navn,
   9:    antallAnsatte AS antall_ansatte,
  10:    naeringskode1.kode AS nkode1,
  11:    CAST(valid_date AS DATE) AS valid_date
  12:    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  13:    WHERE valid_date = (
  14:        SELECT current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  15:    )
  16:)
  17:SELECT * FROM foretak;
  18:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 22, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 107, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  No matching signature for operator = for argument types: STRING, DATE. Supported signature: ANY = ANY at [13:11]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 11:52:46.119125 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c30ab4f-4cd8-4579-aadf-42e042dc4e9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057adca0>]}
2021-02-21 11:52:46.120647 (Thread-1): 12:52:46 | 2 of 3 ERROR creating view model enhetsregisteret.wrk_foretak_010.... [ERROR in 2.56s]
2021-02-21 11:52:46.120814 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:52:46.121591 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:52:46.121807 (Thread-1): 12:52:46 | 3 of 3 SKIP relation enhetsregisteret.wrk_foretak_020................ [SKIP]
2021-02-21 11:52:46.121938 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:52:46.122943 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:52:46.123283 (MainThread): 12:52:46 | 
2021-02-21 11:52:46.123398 (MainThread): 12:52:46 | Finished running 1 table model, 2 view models in 6.08s.
2021-02-21 11:52:46.123501 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:52:46.123575 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 11:52:46.131798 (MainThread): 
2021-02-21 11:52:46.131922 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 11:52:46.132025 (MainThread): 
2021-02-21 11:52:46.132122 (MainThread): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
2021-02-21 11:52:46.132212 (MainThread):   No matching signature for operator = for argument types: STRING, DATE. Supported signature: ANY = ANY at [13:11]
2021-02-21 11:52:46.132295 (MainThread):   compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 11:52:46.132386 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
2021-02-21 11:52:46.132560 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058c4250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105902fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105902310>]}
2021-02-21 11:52:46.132721 (MainThread): Flushing usage events
2021-02-21 11:53:06.769180 (MainThread): Running with dbt=0.18.1
2021-02-21 11:53:07.238156 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:53:07.238994 (MainThread): Tracking: tracking
2021-02-21 11:53:07.244696 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11136dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11137d6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11137d370>]}
2021-02-21 11:53:07.266740 (MainThread): Partial parsing not enabled
2021-02-21 11:53:07.267970 (MainThread): Parsing macros/etc.sql
2021-02-21 11:53:07.269663 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:53:07.275938 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:53:07.295044 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:53:07.298026 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:53:07.301039 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:53:07.310678 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:53:07.315354 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:53:07.327957 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:53:07.331231 (MainThread): Parsing macros/core.sql
2021-02-21 11:53:07.335712 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:53:07.345806 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:53:07.347847 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:53:07.364397 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:53:07.394864 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:53:07.415913 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:53:07.418242 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:53:07.425324 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:53:07.439639 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:53:07.446398 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:53:07.452841 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:53:07.457868 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:53:07.458939 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:53:07.460145 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:53:07.461935 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:53:07.470505 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:53:07.472708 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:53:07.474581 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:53:07.516193 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:53:07.518659 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:53:07.520512 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:53:07.522294 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:53:07.529516 (MainThread): Partial parsing not enabled
2021-02-21 11:53:07.564024 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:53:07.582398 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:53:07.595343 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:53:07.614479 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:53:07.822805 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:53:07.822923 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:53:07.823130 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:53:07.823265 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:53:07.823378 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:53:07.823485 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:53:07.859640 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 11:53:07.908142 (MainThread): Found 3 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:53:07.908947 (MainThread): 
2021-02-21 11:53:07.909186 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:53:07.912305 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:53:07.912418 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:53:08.607961 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:53:08.608270 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:53:08.680765 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:53:09.055391 (MainThread): 12:53:09 | Concurrency: 1 threads (target='dev')
2021-02-21 11:53:09.055628 (MainThread): 12:53:09 | 
2021-02-21 11:53:09.061672 (Thread-1): Began running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:53:09.062987 (Thread-1): 12:53:09 | 1 of 3 START table model enhetsregisteret.wrk_max_load_date.......... [RUN]
2021-02-21 11:53:09.063344 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:53:09.063510 (Thread-1): Compiling model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:53:09.073946 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51287, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:53:09.074111 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51288, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:53:09.074244 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51290, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:53:09.074369 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51289, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:53:09.079491 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 11:53:09.079857 (Thread-1): finished collecting timing info
2021-02-21 11:53:09.102464 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:53:09.170509 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:53:09.775069 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 11:53:09.775605 (Thread-1): On model.enhetsregisteret.wrk_max_load_date: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_max_load_date"} */


  create or replace table `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  
  
  OPTIONS()
  as (
    

SELECT MAX(valid_date) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  );
    
2021-02-21 11:53:12.055600 (Thread-1): finished collecting timing info
2021-02-21 11:53:12.056362 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986e83ae-a716-47c8-b70c-e1a2d01d4520', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115aa2e0>]}
2021-02-21 11:53:12.057468 (Thread-1): 12:53:12 | 1 of 3 OK created table model enhetsregisteret.wrk_max_load_date..... [CREATE TABLE (1.0 rows, 11.6 MB processed) in 2.99s]
2021-02-21 11:53:12.057612 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:53:12.058183 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:53:12.059126 (Thread-1): 12:53:12 | 2 of 3 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 11:53:12.059475 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:53:12.059597 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:53:12.068091 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:53:12.068427 (Thread-1): finished collecting timing info
2021-02-21 11:53:12.086696 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:53:12.087466 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:53:12.156718 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
    WHERE valid_date IN (
        SELECT current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
    )
)
SELECT * FROM foretak;


2021-02-21 11:53:14.294159 (Thread-1): Retry attempt 1 of 1 after error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/e66d9c50-33c4-4a9d-a2ad-ac665ec4fe94?maxResults=0&location=US: Cannot execute IN subquery with uncomparable types STRING and DATE at [13:11]')
2021-02-21 11:53:15.796940 (Thread-1): finished collecting timing info
2021-02-21 11:53:15.798109 (Thread-1): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Cannot execute IN subquery with uncomparable types STRING and DATE at [13:11]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3103, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3083, in done
    self._query_results = self._client._get_query_results(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 1288, in _get_query_results
    resource = self._call_api(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 558, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/6897fa5c-925d-4ebb-aae2-e2cc95abb141?maxResults=0&location=US: Cannot execute IN subquery with uncomparable types STRING and DATE at [13:11]

(job ID: 6897fa5c-925d-4ebb-aae2-e2cc95abb141)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */
   2:
   3:
   4:  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
   5:  OPTIONS()
   6:  as WITH foretak AS (
   7:    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
   8:    navn,
   9:    antallAnsatte AS antall_ansatte,
  10:    naeringskode1.kode AS nkode1,
  11:    CAST(valid_date AS DATE) AS valid_date
  12:    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  13:    WHERE valid_date IN (
  14:        SELECT current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  15:    )
  16:)
  17:SELECT * FROM foretak;
  18:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 22, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 107, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Cannot execute IN subquery with uncomparable types STRING and DATE at [13:11]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 11:53:15.816879 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986e83ae-a716-47c8-b70c-e1a2d01d4520', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114f8f70>]}
2021-02-21 11:53:15.818668 (Thread-1): 12:53:15 | 2 of 3 ERROR creating view model enhetsregisteret.wrk_foretak_010.... [ERROR in 3.76s]
2021-02-21 11:53:15.818837 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:53:15.819633 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:53:15.819802 (Thread-1): 12:53:15 | 3 of 3 SKIP relation enhetsregisteret.wrk_foretak_020................ [SKIP]
2021-02-21 11:53:15.820014 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:53:15.821032 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:53:15.821379 (MainThread): 12:53:15 | 
2021-02-21 11:53:15.821511 (MainThread): 12:53:15 | Finished running 1 table model, 2 view models in 7.91s.
2021-02-21 11:53:15.821619 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:53:15.821699 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 11:53:15.830170 (MainThread): 
2021-02-21 11:53:15.830291 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 11:53:15.830390 (MainThread): 
2021-02-21 11:53:15.830487 (MainThread): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
2021-02-21 11:53:15.830576 (MainThread):   Cannot execute IN subquery with uncomparable types STRING and DATE at [13:11]
2021-02-21 11:53:15.830653 (MainThread):   compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 11:53:15.830741 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
2021-02-21 11:53:15.830914 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111630e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111643880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111643b80>]}
2021-02-21 11:53:15.831071 (MainThread): Flushing usage events
2021-02-21 11:54:56.814594 (MainThread): Running with dbt=0.18.1
2021-02-21 11:54:57.367672 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:54:57.368496 (MainThread): Tracking: tracking
2021-02-21 11:54:57.374000 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109859e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098604f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109860190>]}
2021-02-21 11:54:57.396122 (MainThread): Partial parsing not enabled
2021-02-21 11:54:57.397435 (MainThread): Parsing macros/etc.sql
2021-02-21 11:54:57.399634 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:54:57.405457 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:54:57.423561 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:54:57.426299 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:54:57.429177 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:54:57.438858 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:54:57.443190 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:54:57.455229 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:54:57.459323 (MainThread): Parsing macros/core.sql
2021-02-21 11:54:57.463892 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:54:57.473852 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:54:57.475861 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:54:57.492573 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:54:57.520002 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:54:57.539610 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:54:57.541565 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:54:57.547639 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:54:57.562699 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:54:57.569778 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:54:57.576368 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:54:57.581148 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:54:57.582235 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:54:57.583492 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:54:57.585318 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:54:57.594375 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:54:57.596454 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:54:57.598457 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:54:57.638663 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:54:57.640857 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:54:57.642536 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:54:57.644394 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:54:57.651600 (MainThread): Partial parsing not enabled
2021-02-21 11:54:57.685794 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:54:57.703681 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:54:57.714795 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:54:57.730414 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:54:57.938981 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:54:57.939102 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:54:57.939324 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:54:57.939461 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:54:57.939584 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:54:57.939700 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:54:57.976521 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 11:54:58.021290 (MainThread): Found 3 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:54:58.021987 (MainThread): 
2021-02-21 11:54:58.022233 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:54:58.025456 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:54:58.025571 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:54:58.705482 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:54:58.705784 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:54:58.783779 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:54:59.178650 (MainThread): 12:54:59 | Concurrency: 1 threads (target='dev')
2021-02-21 11:54:59.178879 (MainThread): 12:54:59 | 
2021-02-21 11:54:59.185633 (Thread-1): Began running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:54:59.186999 (Thread-1): 12:54:59 | 1 of 3 START table model enhetsregisteret.wrk_max_load_date.......... [RUN]
2021-02-21 11:54:59.187389 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:54:59.187564 (Thread-1): Compiling model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:54:59.198439 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51336, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:54:59.198621 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51337, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:54:59.198766 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51339, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:54:59.198904 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51338, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:54:59.204431 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 11:54:59.204790 (Thread-1): finished collecting timing info
2021-02-21 11:54:59.227515 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:54:59.296044 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:54:59.800778 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 11:54:59.801248 (Thread-1): On model.enhetsregisteret.wrk_max_load_date: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_max_load_date"} */


  create or replace table `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  
  
  OPTIONS()
  as (
    

SELECT MAX(valid_date) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  );
    
2021-02-21 11:55:01.501138 (Thread-1): finished collecting timing info
2021-02-21 11:55:01.501999 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f983711-0b22-4b51-8e4c-f8afd651fc3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a15670>]}
2021-02-21 11:55:01.503345 (Thread-1): 12:55:01 | 1 of 3 OK created table model enhetsregisteret.wrk_max_load_date..... [CREATE TABLE (1.0 rows, 11.6 MB processed) in 2.31s]
2021-02-21 11:55:01.503522 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:55:01.504096 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:55:01.505247 (Thread-1): 12:55:01 | 2 of 3 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 11:55:01.505695 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:55:01.505859 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:55:01.516423 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:55:01.516854 (Thread-1): finished collecting timing info
2021-02-21 11:55:01.536995 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:55:01.537331 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:55:01.607506 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
), 
max_date AS (
        SELECT CAST(current_date AS DATE) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
    )
)
SELECT * FROM foretak
WHERE valid_date IN(
    SELECT current_date FROM max_date
);


2021-02-21 11:55:02.047989 (Thread-1): Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected "(" or "," or keyword SELECT but got ")" at [17:1]')
2021-02-21 11:55:03.338929 (Thread-1): finished collecting timing info
2021-02-21 11:55:03.339886 (Thread-1): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Syntax error: Expected "(" or "," or keyword SELECT but got ")" at [17:1]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Expected "(" or "," or keyword SELECT but got ")" at [17:1]

(job ID: fea70422-630c-4b9d-ab4d-ae10a05b5d08)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */
   2:
   3:
   4:  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
   5:  OPTIONS()
   6:  as WITH foretak AS (
   7:    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
   8:    navn,
   9:    antallAnsatte AS antall_ansatte,
  10:    naeringskode1.kode AS nkode1,
  11:    CAST(valid_date AS DATE) AS valid_date
  12:    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  13:), 
  14:max_date AS (
  15:        SELECT CAST(current_date AS DATE) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  16:    )
  17:)
  18:SELECT * FROM foretak
  19:WHERE valid_date IN(
  20:    SELECT current_date FROM max_date
  21:);
  22:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 22, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 107, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Syntax error: Expected "(" or "," or keyword SELECT but got ")" at [17:1]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 11:55:03.349416 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f983711-0b22-4b51-8e4c-f8afd651fc3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109112160>]}
2021-02-21 11:55:03.351067 (Thread-1): 12:55:03 | 2 of 3 ERROR creating view model enhetsregisteret.wrk_foretak_010.... [ERROR in 1.84s]
2021-02-21 11:55:03.351249 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:55:03.352104 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:55:03.352403 (Thread-1): 12:55:03 | 3 of 3 SKIP relation enhetsregisteret.wrk_foretak_020................ [SKIP]
2021-02-21 11:55:03.352546 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:55:03.353698 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:55:03.354071 (MainThread): 12:55:03 | 
2021-02-21 11:55:03.354210 (MainThread): 12:55:03 | Finished running 1 table model, 2 view models in 5.33s.
2021-02-21 11:55:03.354331 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:55:03.354418 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 11:55:03.364257 (MainThread): 
2021-02-21 11:55:03.364416 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 11:55:03.364532 (MainThread): 
2021-02-21 11:55:03.364642 (MainThread): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
2021-02-21 11:55:03.364743 (MainThread):   Syntax error: Expected "(" or "," or keyword SELECT but got ")" at [17:1]
2021-02-21 11:55:03.364836 (MainThread):   compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 11:55:03.364937 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
2021-02-21 11:55:03.365135 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bce040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099ebfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099ebc40>]}
2021-02-21 11:55:03.365314 (MainThread): Flushing usage events
2021-02-21 11:55:27.885130 (MainThread): Running with dbt=0.18.1
2021-02-21 11:55:28.239790 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 11:55:28.240470 (MainThread): Tracking: tracking
2021-02-21 11:55:28.244970 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6edfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e70ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e70e9d0>]}
2021-02-21 11:55:28.270155 (MainThread): Partial parsing not enabled
2021-02-21 11:55:28.271605 (MainThread): Parsing macros/etc.sql
2021-02-21 11:55:28.273309 (MainThread): Parsing macros/catalog.sql
2021-02-21 11:55:28.300002 (MainThread): Parsing macros/adapters.sql
2021-02-21 11:55:28.318839 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 11:55:28.323158 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 11:55:28.326899 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 11:55:28.338474 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 11:55:28.343634 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 11:55:28.357850 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 11:55:28.360864 (MainThread): Parsing macros/core.sql
2021-02-21 11:55:28.364486 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 11:55:28.373453 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 11:55:28.375266 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 11:55:28.391368 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 11:55:28.418554 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 11:55:28.438895 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 11:55:28.440918 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 11:55:28.447330 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 11:55:28.460678 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 11:55:28.467567 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 11:55:28.474145 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 11:55:28.479041 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 11:55:28.480180 (MainThread): Parsing macros/etc/query.sql
2021-02-21 11:55:28.481463 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 11:55:28.483275 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 11:55:28.492094 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 11:55:28.494072 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 11:55:28.495824 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 11:55:28.535923 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 11:55:28.538061 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 11:55:28.539727 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 11:55:28.541577 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 11:55:28.549171 (MainThread): Partial parsing not enabled
2021-02-21 11:55:28.583005 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:55:28.601890 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:55:28.614316 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:55:28.632846 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 11:55:28.844152 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 11:55:28.844275 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 11:55:28.844488 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:55:28.844622 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 11:55:28.844735 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:55:28.844841 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 11:55:28.880585 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 11:55:28.926538 (MainThread): Found 3 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 11:55:28.927366 (MainThread): 
2021-02-21 11:55:28.927611 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:55:28.931071 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 11:55:28.931184 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 11:55:29.546245 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 11:55:29.546580 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 11:55:29.620428 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:55:30.017463 (MainThread): 12:55:30 | Concurrency: 1 threads (target='dev')
2021-02-21 11:55:30.017700 (MainThread): 12:55:30 | 
2021-02-21 11:55:30.023343 (Thread-1): Began running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:55:30.024678 (Thread-1): 12:55:30 | 1 of 3 START table model enhetsregisteret.wrk_max_load_date.......... [RUN]
2021-02-21 11:55:30.025032 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 11:55:30.025199 (Thread-1): Compiling model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:55:30.027648 (Thread-1): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51355, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:55:30.027845 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51356, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:55:30.027997 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51358, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-21 11:55:30.028141 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:545:42ad:7d7e:9949', 51357, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 11:55:30.041455 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 11:55:30.041801 (Thread-1): finished collecting timing info
2021-02-21 11:55:30.064429 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:55:30.131913 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 11:55:30.709706 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 11:55:30.710162 (Thread-1): On model.enhetsregisteret.wrk_max_load_date: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_max_load_date"} */


  create or replace table `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  
  
  OPTIONS()
  as (
    

SELECT MAX(valid_date) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  );
    
2021-02-21 11:55:32.594213 (Thread-1): finished collecting timing info
2021-02-21 11:55:32.595079 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5044c3f3-b9d9-45a1-9385-28f1725557d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e76f670>]}
2021-02-21 11:55:32.596354 (Thread-1): 12:55:32 | 1 of 3 OK created table model enhetsregisteret.wrk_max_load_date..... [CREATE TABLE (1.0 rows, 11.6 MB processed) in 2.57s]
2021-02-21 11:55:32.596524 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 11:55:32.597222 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:55:32.598423 (Thread-1): 12:55:32 | 2 of 3 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 11:55:32.598714 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 11:55:32.598850 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:55:32.607947 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:55:32.608279 (Thread-1): finished collecting timing info
2021-02-21 11:55:32.627745 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 11:55:32.628077 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:55:32.697582 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
), 
max_date AS (
        SELECT CAST(current_date AS DATE) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
)
SELECT * FROM foretak
WHERE valid_date IN(
    SELECT current_date FROM max_date
);


2021-02-21 11:55:35.256317 (Thread-1): finished collecting timing info
2021-02-21 11:55:35.257267 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5044c3f3-b9d9-45a1-9385-28f1725557d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7bdbb0>]}
2021-02-21 11:55:35.258633 (Thread-1): 12:55:35 | 2 of 3 OK created view model enhetsregisteret.wrk_foretak_010........ [CREATE VIEW in 2.66s]
2021-02-21 11:55:35.258817 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 11:55:35.259530 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:55:35.260777 (Thread-1): 12:55:35 | 3 of 3 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 11:55:35.261098 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 11:55:35.261250 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:55:35.270301 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 11:55:35.270707 (Thread-1): finished collecting timing info
2021-02-21 11:55:35.275285 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 11:55:35.275637 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 11:55:35.348443 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 11:55:36.696592 (Thread-1): finished collecting timing info
2021-02-21 11:55:36.697430 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5044c3f3-b9d9-45a1-9385-28f1725557d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e7bd7f0>]}
2021-02-21 11:55:36.698674 (Thread-1): 12:55:36 | 3 of 3 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.44s]
2021-02-21 11:55:36.698850 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 11:55:36.700001 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 11:55:36.700305 (MainThread): 12:55:36 | 
2021-02-21 11:55:36.700423 (MainThread): 12:55:36 | Finished running 1 table model, 2 view models in 7.77s.
2021-02-21 11:55:36.700526 (MainThread): Connection 'master' was properly closed.
2021-02-21 11:55:36.700604 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 11:55:36.709274 (MainThread): 
2021-02-21 11:55:36.709398 (MainThread): Completed successfully
2021-02-21 11:55:36.709503 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2021-02-21 11:55:36.709686 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e97acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8f6bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8f6ac0>]}
2021-02-21 11:55:36.709846 (MainThread): Flushing usage events
2021-02-21 14:18:24.541203 (MainThread): Running with dbt=0.18.1
2021-02-21 14:18:25.113880 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_max_virk_load_date'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 14:18:25.114903 (MainThread): Tracking: tracking
2021-02-21 14:18:25.123313 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097a9a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097c4910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097c45b0>]}
2021-02-21 14:18:25.148420 (MainThread): Partial parsing not enabled
2021-02-21 14:18:25.149762 (MainThread): Parsing macros/etc.sql
2021-02-21 14:18:25.151613 (MainThread): Parsing macros/catalog.sql
2021-02-21 14:18:25.159477 (MainThread): Parsing macros/adapters.sql
2021-02-21 14:18:25.178344 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 14:18:25.181226 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 14:18:25.184106 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 14:18:25.193942 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 14:18:25.198362 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 14:18:25.210615 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 14:18:25.214589 (MainThread): Parsing macros/core.sql
2021-02-21 14:18:25.218792 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 14:18:25.227961 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 14:18:25.229996 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 14:18:25.248320 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 14:18:25.277057 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 14:18:25.296993 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 14:18:25.298965 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 14:18:25.305091 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 14:18:25.318401 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 14:18:25.325083 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 14:18:25.331223 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 14:18:25.336218 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 14:18:25.337298 (MainThread): Parsing macros/etc/query.sql
2021-02-21 14:18:25.338504 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 14:18:25.340187 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 14:18:25.348999 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 14:18:25.351053 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 14:18:25.352953 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 14:18:25.393346 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 14:18:25.395763 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 14:18:25.397683 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 14:18:25.399499 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 14:18:25.406756 (MainThread): Partial parsing not enabled
2021-02-21 14:18:25.440817 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 14:18:25.458014 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 14:18:25.469088 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 14:18:25.479359 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 14:18:25.490375 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 14:18:25.506175 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak_snapshot".
2021-02-21 14:18:25.721063 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 14:18:25.721183 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 14:18:25.721402 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:18:25.721532 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:18:25.721643 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:18:25.721747 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:18:25.760233 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 14:18:25.812683 (MainThread): Found 5 models, 0 tests, 1 snapshot, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 14:18:25.813408 (MainThread): 
2021-02-21 14:18:25.813682 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:18:25.814866 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 14:18:25.814984 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 14:18:29.757638 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 14:18:29.757949 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 14:18:29.831517 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:18:32.312237 (MainThread): 15:18:32 | Concurrency: 1 threads (target='dev')
2021-02-21 14:18:32.312468 (MainThread): 15:18:32 | 
2021-02-21 14:18:32.316466 (MainThread): unclosed <socket.socket fd=10, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 52807, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-21 14:18:32.316710 (MainThread): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 52810, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 14:18:32.319736 (Thread-1): Began running node model.enhetsregisteret.wrk_max_virk_load_date
2021-02-21 14:18:32.321118 (Thread-1): 15:18:32 | 1 of 1 START table model enhetsregisteret.wrk_max_virk_load_date..... [RUN]
2021-02-21 14:18:32.321492 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 14:18:32.321830 (Thread-1): Compiling model.enhetsregisteret.wrk_max_virk_load_date
2021-02-21 14:18:32.337667 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_max_virk_load_date"
2021-02-21 14:18:32.338060 (Thread-1): finished collecting timing info
2021-02-21 14:18:32.379937 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_max_virk_load_date"
2021-02-21 14:18:32.380379 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:18:32.447218 (Thread-1): On model.enhetsregisteret.wrk_max_virk_load_date: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_max_virk_load_date"} */


  create or replace table `radjobads`.`enhetsregisteret`.`wrk_max_virk_load_date`
  
  
  OPTIONS()
  as (
    

SELECT MAX(valid_date) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_virksomheter`
  );
    
2021-02-21 14:18:37.961290 (Thread-1): finished collecting timing info
2021-02-21 14:18:37.962176 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0fceb24e-ffd2-458b-b921-0021082fa4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a5ee80>]}
2021-02-21 14:18:37.963709 (Thread-1): 15:18:37 | 1 of 1 OK created table model enhetsregisteret.wrk_max_virk_load_date [CREATE TABLE (1.0 rows, 8.1 MB processed) in 5.64s]
2021-02-21 14:18:37.963881 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_virk_load_date
2021-02-21 14:18:37.965141 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:18:37.965483 (MainThread): 15:18:37 | 
2021-02-21 14:18:37.965627 (MainThread): 15:18:37 | Finished running 1 table model in 12.15s.
2021-02-21 14:18:37.965749 (MainThread): Connection 'master' was properly closed.
2021-02-21 14:18:37.965845 (MainThread): Connection 'model.enhetsregisteret.wrk_max_virk_load_date' was properly closed.
2021-02-21 14:18:37.971266 (MainThread): 
2021-02-21 14:18:37.971411 (MainThread): Completed successfully
2021-02-21 14:18:37.971531 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 14:18:37.971733 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099de220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a5e4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a5e0a0>]}
2021-02-21 14:18:37.971924 (MainThread): Flushing usage events
2021-02-21 14:24:47.275202 (MainThread): Running with dbt=0.18.1
2021-02-21 14:24:47.620950 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 14:24:47.621520 (MainThread): Tracking: tracking
2021-02-21 14:24:47.626219 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103306f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a40e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a40ac0>]}
2021-02-21 14:24:47.648624 (MainThread): Partial parsing not enabled
2021-02-21 14:24:47.649572 (MainThread): Parsing macros/etc.sql
2021-02-21 14:24:47.650980 (MainThread): Parsing macros/catalog.sql
2021-02-21 14:24:47.656776 (MainThread): Parsing macros/adapters.sql
2021-02-21 14:24:47.674821 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 14:24:47.677389 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 14:24:47.681923 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 14:24:47.692566 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 14:24:47.696761 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 14:24:47.708963 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 14:24:47.711642 (MainThread): Parsing macros/core.sql
2021-02-21 14:24:47.715000 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 14:24:47.723253 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 14:24:47.724881 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 14:24:47.742100 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 14:24:47.769426 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 14:24:47.789251 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 14:24:47.790965 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 14:24:47.797320 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 14:24:47.810443 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 14:24:47.816754 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 14:24:47.822775 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 14:24:47.827462 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 14:24:47.828344 (MainThread): Parsing macros/etc/query.sql
2021-02-21 14:24:47.829323 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 14:24:47.830848 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 14:24:47.839631 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 14:24:47.841506 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 14:24:47.843105 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 14:24:47.883274 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 14:24:47.885056 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 14:24:47.886594 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 14:24:47.888205 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 14:24:47.895508 (MainThread): Partial parsing not enabled
2021-02-21 14:24:47.929815 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 14:24:47.948192 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 14:24:47.957366 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 14:24:47.966484 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 14:24:47.975546 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 14:24:47.984067 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 14:24:47.998878 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 14:24:48.031329 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 14:24:48.218713 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 14:24:48.218828 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 14:24:48.219048 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:24:48.219179 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:24:48.219288 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:24:48.219391 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:24:48.255247 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 14:24:48.309946 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 14:24:48.310749 (MainThread): 
2021-02-21 14:24:48.310993 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:24:48.313168 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 14:24:48.313283 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 14:24:59.009200 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 14:24:59.009472 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 14:24:59.077848 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:25:00.659106 (MainThread): 15:25:00 | Concurrency: 1 threads (target='dev')
2021-02-21 14:25:00.659342 (MainThread): 15:25:00 | 
2021-02-21 14:25:00.662823 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 14:25:00.664291 (Thread-1): 15:25:00 | 1 of 2 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 14:25:00.664638 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 14:25:00.664811 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 14:25:00.680945 (Thread-1): finished collecting timing info
2021-02-21 14:25:00.704173 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:25:00.772489 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:25:04.710747 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 14:25:04.713537 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      

  create or replace table `radjobads`.`enhetsregisteret`.`foretak`
  
  
  OPTIONS()
  as (
    

    select *,
        to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id,
        updated_at as dbt_updated_at,
        updated_at as dbt_valid_from,
        nullif(updated_at, updated_at) as dbt_valid_to
    from (
        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`

    ) sbq


  );
  
2021-02-21 14:25:07.015887 (Thread-1): finished collecting timing info
2021-02-21 14:25:07.016795 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c4d3898-bfb0-4993-8357-947a868c5e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a151c0>]}
2021-02-21 14:25:07.018346 (Thread-1): 15:25:07 | 1 of 2 OK snapshotted enhetsregisteret.foretak....................... [CREATE TABLE (0.0 rows, 0.0 Bytes processed) in 6.35s]
2021-02-21 14:25:07.018524 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 14:25:07.018708 (Thread-1): Began running node snapshot.enhetsregisteret.virksomheter
2021-02-21 14:25:07.019830 (Thread-1): 15:25:07 | 2 of 2 START snapshot enhetsregisteret.virksomheter.................. [RUN]
2021-02-21 14:25:07.020202 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 14:25:07.020367 (Thread-1): Compiling snapshot.enhetsregisteret.virksomheter
2021-02-21 14:25:07.031006 (Thread-1): finished collecting timing info
2021-02-21 14:25:07.032201 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53018, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:07.032381 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53019, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 14:25:07.032528 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53023), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:07.032667 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53021), raddr=('142.250.74.106', 443)>
2021-02-21 14:25:07.032812 (Thread-1): unclosed <socket.socket fd=20, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53025), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:07.032942 (Thread-1): unclosed <socket.socket fd=19, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53024, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:07.035831 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:25:07.109199 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:25:07.696651 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.virksomheter"
2021-02-21 14:25:07.697270 (Thread-1): On snapshot.enhetsregisteret.virksomheter: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */

      

  create or replace table `radjobads`.`enhetsregisteret`.`virksomheter`
  
  
  OPTIONS()
  as (
    

    select *,
        to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id,
        updated_at as dbt_updated_at,
        updated_at as dbt_valid_from,
        nullif(updated_at, updated_at) as dbt_valid_to
    from (
        



select * from `radjobads`.`enhetsregisteret`.`wrk_virksomheter_020`

    ) sbq


  );
  
2021-02-21 14:25:07.969611 (Thread-1): Unhandled error while running:
/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */

      

  create or replace table `radjobads`.`enhetsregisteret`.`virksomheter`
  
  
  OPTIONS()
  as (
    

    select *,
        to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id,
        updated_at as dbt_updated_at,
        updated_at as dbt_valid_from,
        nullif(updated_at, updated_at) as dbt_valid_to
    from (
        



select * from `radjobads`.`enhetsregisteret`.`wrk_virksomheter_020`

    ) sbq


  );
  
2021-02-21 14:25:07.969836 (Thread-1): 404 Not found: Table radjobads:enhetsregisteret.wrk_virksomheter_020 was not found in location US

(job ID: 19c21ffd-6fa1-4b85-bfa7-221d4601159f)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */
   2:
   3:      
   4:
   5:  create or replace table `radjobads`.`enhetsregisteret`.`virksomheter`
   6:  
   7:  
   8:  OPTIONS()
   9:  as (
  10:    
  11:
  12:    select *,
  13:        to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id,
  14:        updated_at as dbt_updated_at,
  15:        updated_at as dbt_valid_from,
  16:        nullif(updated_at, updated_at) as dbt_valid_to
  17:    from (
  18:        
  19:
  20:
  21:
  22:select * from `radjobads`.`enhetsregisteret`.`wrk_virksomheter_020`
  23:
  24:    ) sbq
  25:
  26:
  27:  );
  28:  
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
2021-02-21 14:25:07.970204 (Thread-1): finished collecting timing info
2021-02-21 14:25:07.970907 (Thread-1): Runtime Error in snapshot virksomheter (snapshots/dwh/virksomheter.sql)
  404 Not found: Table radjobads:enhetsregisteret.wrk_virksomheter_020 was not found in location US
  
  (job ID: 19c21ffd-6fa1-4b85-bfa7-221d4601159f)
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.NotFound: 404 Not found: Table radjobads:enhetsregisteret.wrk_virksomheter_020 was not found in location US

(job ID: 19c21ffd-6fa1-4b85-bfa7-221d4601159f)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */
   2:
   3:      
   4:
   5:  create or replace table `radjobads`.`enhetsregisteret`.`virksomheter`
   6:  
   7:  
   8:  OPTIONS()
   9:  as (
  10:    
  11:
  12:    select *,
  13:        to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id,
  14:        updated_at as dbt_updated_at,
  15:        updated_at as dbt_valid_from,
  16:        nullif(updated_at, updated_at) as dbt_valid_to
  17:    from (
  18:        
  19:
  20:
  21:
  22:select * from `radjobads`.`enhetsregisteret`.`wrk_virksomheter_020`
  23:
  24:    ) sbq
  25:
  26:
  27:  );
  28:  
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 155, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 134, in exception_handler
    raise RuntimeException(exc_message)
dbt.exceptions.RuntimeException: Runtime Error in snapshot virksomheter (snapshots/dwh/virksomheter.sql)
  404 Not found: Table radjobads:enhetsregisteret.wrk_virksomheter_020 was not found in location US
  
  (job ID: 19c21ffd-6fa1-4b85-bfa7-221d4601159f)
2021-02-21 14:25:07.985249 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c4d3898-bfb0-4993-8357-947a868c5e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103bf7c40>]}
2021-02-21 14:25:07.987180 (Thread-1): 15:25:07 | 2 of 2 ERROR snapshotting enhetsregisteret.virksomheter.............. [ERROR in 0.97s]
2021-02-21 14:25:07.987393 (Thread-1): Finished running node snapshot.enhetsregisteret.virksomheter
2021-02-21 14:25:07.988930 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:25:07.989255 (MainThread): 15:25:07 | 
2021-02-21 14:25:07.989392 (MainThread): 15:25:07 | Finished running 2 snapshots in 19.68s.
2021-02-21 14:25:07.989504 (MainThread): Connection 'master' was properly closed.
2021-02-21 14:25:07.989586 (MainThread): Connection 'snapshot.enhetsregisteret.virksomheter' was properly closed.
2021-02-21 14:25:07.996379 (MainThread): 
2021-02-21 14:25:07.996523 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 14:25:07.996630 (MainThread): 
2021-02-21 14:25:07.996733 (MainThread): Runtime Error in snapshot virksomheter (snapshots/dwh/virksomheter.sql)
2021-02-21 14:25:07.996829 (MainThread):   404 Not found: Table radjobads:enhetsregisteret.wrk_virksomheter_020 was not found in location US
2021-02-21 14:25:07.996915 (MainThread):   
2021-02-21 14:25:07.996998 (MainThread):   (job ID: 19c21ffd-6fa1-4b85-bfa7-221d4601159f)
2021-02-21 14:25:07.997088 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2021-02-21 14:25:07.997270 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ab99d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103af0e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103af0cd0>]}
2021-02-21 14:25:07.997431 (MainThread): Flushing usage events
2021-02-21 14:25:24.415699 (MainThread): Running with dbt=0.18.1
2021-02-21 14:25:24.759691 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 14:25:24.760406 (MainThread): Tracking: tracking
2021-02-21 14:25:24.765232 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d17d820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d18c940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d18c5e0>]}
2021-02-21 14:25:24.786776 (MainThread): Partial parsing not enabled
2021-02-21 14:25:24.787739 (MainThread): Parsing macros/etc.sql
2021-02-21 14:25:24.789284 (MainThread): Parsing macros/catalog.sql
2021-02-21 14:25:24.794930 (MainThread): Parsing macros/adapters.sql
2021-02-21 14:25:24.813024 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 14:25:24.815634 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 14:25:24.818369 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 14:25:24.827603 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 14:25:24.831732 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 14:25:24.843655 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 14:25:24.846374 (MainThread): Parsing macros/core.sql
2021-02-21 14:25:24.849749 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 14:25:24.858556 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 14:25:24.860486 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 14:25:24.877094 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 14:25:24.904485 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 14:25:24.924044 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 14:25:24.925774 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 14:25:24.931684 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 14:25:24.945008 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 14:25:24.951597 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 14:25:24.958297 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 14:25:24.964096 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 14:25:24.965011 (MainThread): Parsing macros/etc/query.sql
2021-02-21 14:25:24.966023 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 14:25:24.967595 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 14:25:24.976925 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 14:25:24.978898 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 14:25:24.980480 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 14:25:25.020348 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 14:25:25.022101 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 14:25:25.023524 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 14:25:25.025110 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 14:25:25.032234 (MainThread): Partial parsing not enabled
2021-02-21 14:25:25.065612 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 14:25:25.083860 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 14:25:25.092897 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 14:25:25.102173 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 14:25:25.111171 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 14:25:25.119305 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 14:25:25.133772 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 14:25:25.165121 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 14:25:25.347392 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 14:25:25.347508 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 14:25:25.347732 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:25:25.347861 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:25:25.347972 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:25:25.348076 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:25:25.384320 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 14:25:25.443643 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 14:25:25.445058 (MainThread): 
2021-02-21 14:25:25.445366 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:25:25.454521 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 14:25:25.454686 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 14:25:28.920244 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 14:25:28.920506 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 14:25:28.988377 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:25:29.508967 (MainThread): 15:25:29 | Concurrency: 1 threads (target='dev')
2021-02-21 14:25:29.509159 (MainThread): 15:25:29 | 
2021-02-21 14:25:29.512124 (Thread-1): Began running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 14:25:29.513127 (Thread-1): 15:25:29 | 1 of 6 START table model enhetsregisteret.wrk_max_load_date.......... [RUN]
2021-02-21 14:25:29.513392 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 14:25:29.513531 (Thread-1): Compiling model.enhetsregisteret.wrk_max_load_date
2021-02-21 14:25:29.526865 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 14:25:29.527247 (Thread-1): finished collecting timing info
2021-02-21 14:25:29.547225 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:25:29.612071 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:25:30.153590 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 14:25:30.154088 (Thread-1): On model.enhetsregisteret.wrk_max_load_date: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_max_load_date"} */


  create or replace table `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  
  
  OPTIONS()
  as (
    

SELECT MAX(valid_date) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  );
    
2021-02-21 14:25:32.146554 (Thread-1): finished collecting timing info
2021-02-21 14:25:32.147418 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed6a4b81-d9e7-4368-9635-a2e84411df3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d40a7f0>]}
2021-02-21 14:25:32.148738 (Thread-1): 15:25:32 | 1 of 6 OK created table model enhetsregisteret.wrk_max_load_date..... [CREATE TABLE (1.0 rows, 0.0 Bytes processed) in 2.63s]
2021-02-21 14:25:32.148912 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 14:25:32.149095 (Thread-1): Began running node model.enhetsregisteret.wrk_max_virk_load_date
2021-02-21 14:25:32.150221 (Thread-1): 15:25:32 | 2 of 6 START table model enhetsregisteret.wrk_max_virk_load_date..... [RUN]
2021-02-21 14:25:32.150527 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 14:25:32.150679 (Thread-1): Compiling model.enhetsregisteret.wrk_max_virk_load_date
2021-02-21 14:25:32.160220 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_max_virk_load_date"
2021-02-21 14:25:32.160625 (Thread-1): finished collecting timing info
2021-02-21 14:25:32.165275 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53038, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:32.165438 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53039), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:32.165565 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53042), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:32.165688 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53041, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:32.165819 (Thread-1): unclosed <socket.socket fd=20, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53045), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:32.165948 (Thread-1): unclosed <socket.socket fd=19, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53044, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:32.166250 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:25:32.239200 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:25:33.990450 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_max_virk_load_date"
2021-02-21 14:25:33.991342 (Thread-1): On model.enhetsregisteret.wrk_max_virk_load_date: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_max_virk_load_date"} */


  create or replace table `radjobads`.`enhetsregisteret`.`wrk_max_virk_load_date`
  
  
  OPTIONS()
  as (
    

SELECT MAX(valid_date) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_virksomheter`
  );
    
2021-02-21 14:25:35.798563 (Thread-1): finished collecting timing info
2021-02-21 14:25:35.799585 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed6a4b81-d9e7-4368-9635-a2e84411df3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1bb070>]}
2021-02-21 14:25:35.801077 (Thread-1): 15:25:35 | 2 of 6 OK created table model enhetsregisteret.wrk_max_virk_load_date [CREATE TABLE (1.0 rows, 8.1 MB processed) in 3.65s]
2021-02-21 14:25:35.801265 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_virk_load_date
2021-02-21 14:25:35.801454 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 14:25:35.802643 (Thread-1): 15:25:35 | 3 of 6 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 14:25:35.802964 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 14:25:35.803124 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 14:25:35.814415 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 14:25:35.814867 (Thread-1): finished collecting timing info
2021-02-21 14:25:35.836462 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 14:25:35.836952 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:25:35.908126 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
), 
max_date AS (
        SELECT CAST(current_date AS DATE) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
)
SELECT * FROM foretak
WHERE valid_date IN(
    SELECT current_date FROM max_date
);


2021-02-21 14:25:37.330608 (Thread-1): finished collecting timing info
2021-02-21 14:25:37.331508 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed6a4b81-d9e7-4368-9635-a2e84411df3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4d9e20>]}
2021-02-21 14:25:37.332827 (Thread-1): 15:25:37 | 3 of 6 OK created view model enhetsregisteret.wrk_foretak_010........ [CREATE VIEW in 1.53s]
2021-02-21 14:25:37.333006 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 14:25:37.333190 (Thread-1): Began running node model.enhetsregisteret.wrk_virksomheter_010
2021-02-21 14:25:37.334305 (Thread-1): 15:25:37 | 4 of 6 START view model enhetsregisteret.wrk_virksomheter_010........ [RUN]
2021-02-21 14:25:37.334840 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 14:25:37.335013 (Thread-1): Compiling model.enhetsregisteret.wrk_virksomheter_010
2021-02-21 14:25:37.345736 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_virksomheter_010"
2021-02-21 14:25:37.346167 (Thread-1): finished collecting timing info
2021-02-21 14:25:37.350612 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_virksomheter_010"
2021-02-21 14:25:37.350972 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:25:37.422528 (Thread-1): On model.enhetsregisteret.wrk_virksomheter_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_virksomheter_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_virksomheter_010`
  OPTIONS()
  as WITH virksomheter AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_virksomheter`
), 
max_date AS (
        SELECT CAST(current_date AS DATE) AS current_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_virk_load_date`
)
SELECT * FROM virksomheter
WHERE valid_date IN(
    SELECT current_date FROM max_date
);


2021-02-21 14:25:39.018561 (Thread-1): finished collecting timing info
2021-02-21 14:25:39.019489 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed6a4b81-d9e7-4368-9635-a2e84411df3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1bb490>]}
2021-02-21 14:25:39.020850 (Thread-1): 15:25:39 | 4 of 6 OK created view model enhetsregisteret.wrk_virksomheter_010... [CREATE VIEW in 1.68s]
2021-02-21 14:25:39.021032 (Thread-1): Finished running node model.enhetsregisteret.wrk_virksomheter_010
2021-02-21 14:25:39.021231 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 14:25:39.022380 (Thread-1): 15:25:39 | 5 of 6 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 14:25:39.022703 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 14:25:39.022863 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 14:25:39.032386 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 14:25:39.033678 (Thread-1): finished collecting timing info
2021-02-21 14:25:39.038910 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 14:25:39.039366 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:25:39.112841 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 14:25:40.215051 (Thread-1): finished collecting timing info
2021-02-21 14:25:40.215909 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed6a4b81-d9e7-4368-9635-a2e84411df3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d36fb80>]}
2021-02-21 14:25:40.217381 (Thread-1): 15:25:40 | 5 of 6 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.19s]
2021-02-21 14:25:40.217553 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 14:25:40.217735 (Thread-1): Began running node model.enhetsregisteret.wrk_virksomheter_020
2021-02-21 14:25:40.218733 (Thread-1): 15:25:40 | 6 of 6 START view model enhetsregisteret.wrk_virksomheter_020........ [RUN]
2021-02-21 14:25:40.218991 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 14:25:40.219120 (Thread-1): Compiling model.enhetsregisteret.wrk_virksomheter_020
2021-02-21 14:25:40.226838 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_virksomheter_020"
2021-02-21 14:25:40.227179 (Thread-1): finished collecting timing info
2021-02-21 14:25:40.231543 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53048), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:40.231689 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53047, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:40.231826 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53049, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:40.231951 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53050), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:40.232071 (Thread-1): unclosed <socket.socket fd=20, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53053), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:40.232184 (Thread-1): unclosed <socket.socket fd=19, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53052, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:40.232307 (Thread-1): unclosed <socket.socket fd=22, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53055), raddr=('216.58.207.234', 443)>
2021-02-21 14:25:40.232418 (Thread-1): unclosed <socket.socket fd=21, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53054, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:25:40.232864 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_virksomheter_020"
2021-02-21 14:25:40.233200 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:25:40.302619 (Thread-1): On model.enhetsregisteret.wrk_virksomheter_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_virksomheter_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_virksomheter_020`
  OPTIONS()
  as WITH virksomheter AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_virksomheter_010`
)
SELECT * FROM virksomheter;


2021-02-21 14:25:41.703184 (Thread-1): finished collecting timing info
2021-02-21 14:25:41.704098 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed6a4b81-d9e7-4368-9635-a2e84411df3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d28b850>]}
2021-02-21 14:25:41.705435 (Thread-1): 15:25:41 | 6 of 6 OK created view model enhetsregisteret.wrk_virksomheter_020... [CREATE VIEW in 1.48s]
2021-02-21 14:25:41.705617 (Thread-1): Finished running node model.enhetsregisteret.wrk_virksomheter_020
2021-02-21 14:25:41.707026 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:25:41.707437 (MainThread): 15:25:41 | 
2021-02-21 14:25:41.707591 (MainThread): 15:25:41 | Finished running 2 table models, 4 view models in 16.26s.
2021-02-21 14:25:41.707720 (MainThread): Connection 'master' was properly closed.
2021-02-21 14:25:41.707820 (MainThread): Connection 'model.enhetsregisteret.wrk_virksomheter_020' was properly closed.
2021-02-21 14:25:41.727081 (MainThread): 
2021-02-21 14:25:41.727213 (MainThread): Completed successfully
2021-02-21 14:25:41.727331 (MainThread): 
Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
2021-02-21 14:25:41.727522 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d245430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d143bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1a4a90>]}
2021-02-21 14:25:41.727690 (MainThread): Flushing usage events
2021-02-21 14:25:53.609200 (MainThread): Running with dbt=0.18.1
2021-02-21 14:25:53.950221 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 14:25:53.950916 (MainThread): Tracking: tracking
2021-02-21 14:25:53.955839 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cf5ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d015b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d01250>]}
2021-02-21 14:25:53.975133 (MainThread): Partial parsing not enabled
2021-02-21 14:25:53.976043 (MainThread): Parsing macros/etc.sql
2021-02-21 14:25:53.977518 (MainThread): Parsing macros/catalog.sql
2021-02-21 14:25:53.983116 (MainThread): Parsing macros/adapters.sql
2021-02-21 14:25:54.000982 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 14:25:54.003521 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 14:25:54.006135 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 14:25:54.015387 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 14:25:54.019537 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 14:25:54.032527 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 14:25:54.035174 (MainThread): Parsing macros/core.sql
2021-02-21 14:25:54.038531 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 14:25:54.046690 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 14:25:54.048302 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 14:25:54.064310 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 14:25:54.091779 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 14:25:54.111241 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 14:25:54.112963 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 14:25:54.118809 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 14:25:54.131766 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 14:25:54.138455 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 14:25:54.144453 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 14:25:54.149094 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 14:25:54.149973 (MainThread): Parsing macros/etc/query.sql
2021-02-21 14:25:54.150964 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 14:25:54.152556 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 14:25:54.160875 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 14:25:54.162772 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 14:25:54.164348 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 14:25:54.206800 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 14:25:54.208575 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 14:25:54.210018 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 14:25:54.211680 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 14:25:54.220330 (MainThread): Partial parsing not enabled
2021-02-21 14:25:54.253795 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 14:25:54.271746 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 14:25:54.281470 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 14:25:54.291029 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 14:25:54.300734 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 14:25:54.309060 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 14:25:54.323677 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 14:25:54.357541 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 14:25:54.540637 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 14:25:54.540756 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 14:25:54.540985 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:25:54.541114 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:25:54.541225 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:25:54.541330 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:25:54.577408 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 14:25:54.631451 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 14:25:54.632362 (MainThread): 
2021-02-21 14:25:54.632650 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:25:54.634766 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 14:25:54.634878 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 14:25:59.110064 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 14:25:59.110335 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 14:25:59.180809 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:25:59.889547 (MainThread): 15:25:59 | Concurrency: 1 threads (target='dev')
2021-02-21 14:25:59.889773 (MainThread): 15:25:59 | 
2021-02-21 14:25:59.893407 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 14:25:59.894573 (Thread-1): 15:25:59 | 1 of 2 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 14:25:59.894888 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 14:25:59.895046 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 14:25:59.909534 (Thread-1): finished collecting timing info
2021-02-21 14:25:59.932530 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:26:00.004442 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:26:00.463453 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:26:00.699798 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 14:26:02.940551 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:26:03.173042 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:26:03.404408 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 14:26:03.404652 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:26:04.079758 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:26:04.420122 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 14:26:04.420701 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 14:26:07.037665 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 14:26:08.262617 (Thread-1): finished collecting timing info
2021-02-21 14:26:08.263639 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0671e7b5-2857-44dc-b3c5-8d9f150aebe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f5c6d0>]}
2021-02-21 14:26:08.265313 (Thread-1): 15:26:08 | 1 of 2 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 8.37s]
2021-02-21 14:26:08.265504 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 14:26:08.265687 (Thread-1): Began running node snapshot.enhetsregisteret.virksomheter
2021-02-21 14:26:08.266975 (Thread-1): 15:26:08 | 2 of 2 START snapshot enhetsregisteret.virksomheter.................. [RUN]
2021-02-21 14:26:08.267292 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 14:26:08.267456 (Thread-1): Compiling snapshot.enhetsregisteret.virksomheter
2021-02-21 14:26:08.271647 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53071), raddr=('216.58.207.234', 443)>
2021-02-21 14:26:08.271820 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53070, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:26:08.271977 (Thread-1): unclosed <socket.socket fd=20, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('10.0.0.3', 53073), raddr=('216.58.207.234', 443)>
2021-02-21 14:26:08.272114 (Thread-1): unclosed <socket.socket fd=19, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53072, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:26:08.278884 (Thread-1): finished collecting timing info
2021-02-21 14:26:08.281820 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:26:08.353891 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:26:13.660357 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.virksomheter"
2021-02-21 14:26:13.660950 (Thread-1): On snapshot.enhetsregisteret.virksomheter: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */

      

  create or replace table `radjobads`.`enhetsregisteret`.`virksomheter`
  
  
  OPTIONS()
  as (
    

    select *,
        to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id,
        updated_at as dbt_updated_at,
        updated_at as dbt_valid_from,
        nullif(updated_at, updated_at) as dbt_valid_to
    from (
        



select * from `radjobads`.`enhetsregisteret`.`wrk_virksomheter_020`

    ) sbq


  );
  
2021-02-21 14:26:16.767796 (Thread-1): finished collecting timing info
2021-02-21 14:26:16.768819 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0671e7b5-2857-44dc-b3c5-8d9f150aebe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d272b0>]}
2021-02-21 14:26:16.770397 (Thread-1): 15:26:16 | 2 of 2 OK snapshotted enhetsregisteret.virksomheter.................. [CREATE TABLE (0.0 rows, 40.0 MB processed) in 8.50s]
2021-02-21 14:26:16.770581 (Thread-1): Finished running node snapshot.enhetsregisteret.virksomheter
2021-02-21 14:26:16.771868 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:26:16.772224 (MainThread): 15:26:16 | 
2021-02-21 14:26:16.772369 (MainThread): 15:26:16 | Finished running 2 snapshots in 22.14s.
2021-02-21 14:26:16.772492 (MainThread): Connection 'master' was properly closed.
2021-02-21 14:26:16.772583 (MainThread): Connection 'snapshot.enhetsregisteret.virksomheter' was properly closed.
2021-02-21 14:26:16.779846 (MainThread): 
2021-02-21 14:26:16.779998 (MainThread): Completed successfully
2021-02-21 14:26:16.780129 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-02-21 14:26:16.780340 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d7bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e9da60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e9d1f0>]}
2021-02-21 14:26:16.780537 (MainThread): Flushing usage events
2021-02-21 14:57:57.638388 (MainThread): Running with dbt=0.18.1
2021-02-21 14:57:58.189657 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['virksomheter'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 14:57:58.191102 (MainThread): Tracking: tracking
2021-02-21 14:57:58.201224 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c0ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c29bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c29850>]}
2021-02-21 14:57:58.225664 (MainThread): Partial parsing not enabled
2021-02-21 14:57:58.227217 (MainThread): Parsing macros/etc.sql
2021-02-21 14:57:58.229084 (MainThread): Parsing macros/catalog.sql
2021-02-21 14:57:58.235082 (MainThread): Parsing macros/adapters.sql
2021-02-21 14:57:58.253288 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 14:57:58.256382 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 14:57:58.259634 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 14:57:58.269240 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 14:57:58.273728 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 14:57:58.287682 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 14:57:58.291541 (MainThread): Parsing macros/core.sql
2021-02-21 14:57:58.295343 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 14:57:58.304072 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 14:57:58.305976 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 14:57:58.324852 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 14:57:58.353274 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 14:57:58.375829 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 14:57:58.377767 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 14:57:58.383907 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 14:57:58.397470 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 14:57:58.404357 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 14:57:58.410503 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 14:57:58.415797 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 14:57:58.416986 (MainThread): Parsing macros/etc/query.sql
2021-02-21 14:57:58.418295 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 14:57:58.420157 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 14:57:58.428713 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 14:57:58.430763 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 14:57:58.432635 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 14:57:58.472850 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 14:57:58.475223 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 14:57:58.476967 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 14:57:58.478880 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 14:57:58.486408 (MainThread): Partial parsing not enabled
2021-02-21 14:57:58.523690 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 14:57:58.543608 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 14:57:58.554601 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 14:57:58.565078 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 14:57:58.576043 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 14:57:58.585740 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 14:57:58.601087 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 14:57:58.633861 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 14:57:58.832267 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 14:57:58.832386 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 14:57:58.832617 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:57:58.832748 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 14:57:58.832861 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:57:58.832968 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 14:57:58.870382 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 14:57:58.927534 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 14:57:58.928442 (MainThread): 
2021-02-21 14:57:58.928736 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:57:58.930027 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 14:57:58.930155 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 14:58:01.455146 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 14:58:01.455448 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 14:58:01.528174 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:58:04.897834 (MainThread): 15:58:04 | Concurrency: 1 threads (target='dev')
2021-02-21 14:58:04.898035 (MainThread): 15:58:04 | 
2021-02-21 14:58:04.903962 (Thread-1): Began running node snapshot.enhetsregisteret.virksomheter
2021-02-21 14:58:04.905070 (Thread-1): 15:58:04 | 1 of 1 START snapshot enhetsregisteret.virksomheter.................. [RUN]
2021-02-21 14:58:04.905371 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 14:58:04.905511 (Thread-1): Compiling snapshot.enhetsregisteret.virksomheter
2021-02-21 14:58:04.919691 (Thread-1): finished collecting timing info
2021-02-21 14:58:04.942717 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 14:58:05.010516 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:58:05.572620 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:58:05.843126 (Thread-1): On snapshot.enhetsregisteret.virksomheter: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`virksomheter__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_virksomheter_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`virksomheter`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 14:58:08.551503 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:58:08.804516 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:58:09.046318 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`virksomheter`".
2021-02-21 14:58:09.046533 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:58:09.747682 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 14:58:09.988913 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.virksomheter"
2021-02-21 14:58:09.991007 (Thread-1): On snapshot.enhetsregisteret.virksomheter: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */

      merge into `radjobads`.`enhetsregisteret`.`virksomheter` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`virksomheter__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 14:58:12.106169 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53847, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:58:12.106378 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53848, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 14:58:12.106523 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53853, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 14:58:12.106659 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 53852, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 14:58:12.113733 (Thread-1): On snapshot.enhetsregisteret.virksomheter: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */
drop table if exists `radjobads`.`enhetsregisteret`.`virksomheter__dbt_tmp`
2021-02-21 14:58:12.986989 (Thread-1): finished collecting timing info
2021-02-21 14:58:12.987975 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffcac036-ceeb-4de9-9062-040a9eae4245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c298b0>]}
2021-02-21 14:58:12.989660 (Thread-1): 15:58:12 | 1 of 1 OK snapshotted enhetsregisteret.virksomheter.................. [MERGE (0.0 rows, 0.0 Bytes processed) in 8.08s]
2021-02-21 14:58:12.989833 (Thread-1): Finished running node snapshot.enhetsregisteret.virksomheter
2021-02-21 14:58:12.991981 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 14:58:12.992395 (MainThread): 15:58:12 | 
2021-02-21 14:58:12.992547 (MainThread): 15:58:12 | Finished running 1 snapshot in 14.06s.
2021-02-21 14:58:12.992671 (MainThread): Connection 'master' was properly closed.
2021-02-21 14:58:12.992761 (MainThread): Connection 'snapshot.enhetsregisteret.virksomheter' was properly closed.
2021-02-21 14:58:12.997042 (MainThread): 
2021-02-21 14:58:12.997201 (MainThread): Completed successfully
2021-02-21 14:58:12.997330 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 14:58:12.997552 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ca7790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ce7d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ce73a0>]}
2021-02-21 14:58:12.997753 (MainThread): Flushing usage events
2021-02-21 15:00:18.168126 (MainThread): Running with dbt=0.18.1
2021-02-21 15:00:18.677504 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 15:00:18.678514 (MainThread): Tracking: tracking
2021-02-21 15:00:18.685058 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110900f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109075e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109072b0>]}
2021-02-21 15:00:18.709611 (MainThread): Partial parsing not enabled
2021-02-21 15:00:18.710853 (MainThread): Parsing macros/etc.sql
2021-02-21 15:00:18.712589 (MainThread): Parsing macros/catalog.sql
2021-02-21 15:00:18.718424 (MainThread): Parsing macros/adapters.sql
2021-02-21 15:00:18.737031 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 15:00:18.739858 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 15:00:18.742919 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 15:00:18.753144 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 15:00:18.758239 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 15:00:18.772220 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 15:00:18.775521 (MainThread): Parsing macros/core.sql
2021-02-21 15:00:18.779624 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 15:00:18.789892 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 15:00:18.792072 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 15:00:18.809377 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 15:00:18.843755 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 15:00:18.864099 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 15:00:18.866019 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 15:00:18.872320 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 15:00:18.886087 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 15:00:18.893401 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 15:00:18.899646 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 15:00:18.904887 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 15:00:18.906055 (MainThread): Parsing macros/etc/query.sql
2021-02-21 15:00:18.907431 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 15:00:18.909444 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 15:00:18.918916 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 15:00:18.920997 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 15:00:18.922755 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 15:00:18.964403 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 15:00:18.968988 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 15:00:18.971993 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 15:00:18.974494 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 15:00:18.983529 (MainThread): Partial parsing not enabled
2021-02-21 15:00:19.020628 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 15:00:19.041340 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 15:00:19.051583 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 15:00:19.061551 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 15:00:19.071784 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:00:19.080996 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 15:00:19.096745 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:00:19.130311 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 15:00:19.321353 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 15:00:19.321475 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 15:00:19.321712 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:00:19.321834 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:00:19.321937 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:00:19.322036 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:00:19.359009 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 15:00:19.416903 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 15:00:19.418143 (MainThread): 
2021-02-21 15:00:19.418439 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:00:19.419827 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 15:00:19.419951 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 15:00:20.644721 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 15:00:20.645022 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 15:00:21.197209 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:00:21.744157 (MainThread): 16:00:21 | Concurrency: 1 threads (target='dev')
2021-02-21 15:00:21.744336 (MainThread): 16:00:21 | 
2021-02-21 15:00:21.750030 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:00:21.751157 (Thread-1): 16:00:21 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 15:00:21.751467 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:00:21.751605 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:00:21.764513 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 15:00:21.765765 (Thread-1): finished collecting timing info
2021-02-21 15:00:21.795335 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 15:00:21.796105 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 15:00:22.323607 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 15:00:25.192047 (Thread-1): finished collecting timing info
2021-02-21 15:00:25.192893 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c7dc4a9-59da-4c11-923d-ffdd6a259779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a8fd30>]}
2021-02-21 15:00:25.194205 (Thread-1): 16:00:25 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 3.44s]
2021-02-21 15:00:25.194361 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:00:25.196650 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:00:25.197044 (MainThread): 16:00:25 | 
2021-02-21 15:00:25.199397 (MainThread): 16:00:25 | Finished running 1 view model in 5.78s.
2021-02-21 15:00:25.199716 (MainThread): Connection 'master' was properly closed.
2021-02-21 15:00:25.199851 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 15:00:25.204114 (MainThread): 
2021-02-21 15:00:25.204363 (MainThread): Completed successfully
2021-02-21 15:00:25.204556 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 15:00:25.204845 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11099d9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110991a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110991940>]}
2021-02-21 15:00:25.205049 (MainThread): Flushing usage events
2021-02-21 15:00:27.373472 (MainThread): Running with dbt=0.18.1
2021-02-21 15:00:27.734216 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 15:00:27.735113 (MainThread): Tracking: tracking
2021-02-21 15:00:27.740444 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f000e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f00b550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f00b220>]}
2021-02-21 15:00:27.764169 (MainThread): Partial parsing not enabled
2021-02-21 15:00:27.765100 (MainThread): Parsing macros/etc.sql
2021-02-21 15:00:27.766518 (MainThread): Parsing macros/catalog.sql
2021-02-21 15:00:27.772955 (MainThread): Parsing macros/adapters.sql
2021-02-21 15:00:27.791866 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 15:00:27.794482 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 15:00:27.797153 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 15:00:27.807067 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 15:00:27.811531 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 15:00:27.824355 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 15:00:27.827452 (MainThread): Parsing macros/core.sql
2021-02-21 15:00:27.830937 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 15:00:27.841006 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 15:00:27.842744 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 15:00:27.858732 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 15:00:27.887975 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 15:00:27.908826 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 15:00:27.910599 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 15:00:27.916956 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 15:00:27.930786 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 15:00:27.937360 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 15:00:27.943686 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 15:00:27.948609 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 15:00:27.949527 (MainThread): Parsing macros/etc/query.sql
2021-02-21 15:00:27.950533 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 15:00:27.952038 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 15:00:27.960579 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 15:00:27.963202 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 15:00:27.964751 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 15:00:28.006214 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 15:00:28.007955 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 15:00:28.009429 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 15:00:28.011109 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 15:00:28.019531 (MainThread): Partial parsing not enabled
2021-02-21 15:00:28.056087 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 15:00:28.075458 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 15:00:28.086062 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 15:00:28.095668 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 15:00:28.105122 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:00:28.113596 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 15:00:28.128230 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:00:28.160289 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 15:00:28.345096 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 15:00:28.345216 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 15:00:28.345442 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:00:28.345652 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:00:28.345825 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:00:28.345992 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:00:28.383288 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 15:00:28.439263 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 15:00:28.440040 (MainThread): 
2021-02-21 15:00:28.440341 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:00:28.441483 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 15:00:28.441599 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 15:00:29.561356 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 15:00:29.561623 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 15:00:30.070406 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:00:31.416716 (MainThread): 16:00:31 | Concurrency: 1 threads (target='dev')
2021-02-21 15:00:31.417007 (MainThread): 16:00:31 | 
2021-02-21 15:00:31.421489 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 15:00:31.422595 (Thread-1): 16:00:31 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 15:00:31.422977 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:00:31.423116 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 15:00:31.437316 (Thread-1): finished collecting timing info
2021-02-21 15:00:31.458858 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 15:00:32.023613 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:00:32.623047 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:00:32.908696 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 15:00:35.488870 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:00:35.763294 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:00:36.011676 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 15:00:36.011901 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:00:36.676101 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:00:36.901809 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 15:00:36.902352 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 15:00:39.627190 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 15:00:42.613593 (Thread-1): finished collecting timing info
2021-02-21 15:00:42.614626 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f9c7a46-2215-419a-82e5-dd205bcc3b85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0c9820>]}
2021-02-21 15:00:42.616330 (Thread-1): 16:00:42 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 11.19s]
2021-02-21 15:00:42.616655 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 15:00:42.617976 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:00:42.618317 (MainThread): 16:00:42 | 
2021-02-21 15:00:42.618541 (MainThread): 16:00:42 | Finished running 1 snapshot in 14.18s.
2021-02-21 15:00:42.618741 (MainThread): Connection 'master' was properly closed.
2021-02-21 15:00:42.618842 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 15:00:42.622934 (MainThread): 
2021-02-21 15:00:42.623158 (MainThread): Completed successfully
2021-02-21 15:00:42.623361 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 15:00:42.623658 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f24a700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f216d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f216100>]}
2021-02-21 15:00:42.623862 (MainThread): Flushing usage events
2021-02-21 15:01:12.399831 (MainThread): Running with dbt=0.18.1
2021-02-21 15:01:12.911102 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 15:01:12.913398 (MainThread): Tracking: tracking
2021-02-21 15:01:12.919287 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060b0af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067f8280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067f8160>]}
2021-02-21 15:01:12.944857 (MainThread): Partial parsing not enabled
2021-02-21 15:01:12.946201 (MainThread): Parsing macros/etc.sql
2021-02-21 15:01:12.948139 (MainThread): Parsing macros/catalog.sql
2021-02-21 15:01:12.954644 (MainThread): Parsing macros/adapters.sql
2021-02-21 15:01:12.973061 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 15:01:12.976051 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 15:01:12.979243 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 15:01:12.989202 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 15:01:12.993559 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 15:01:13.008081 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 15:01:13.014169 (MainThread): Parsing macros/core.sql
2021-02-21 15:01:13.020927 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 15:01:13.031922 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 15:01:13.034078 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 15:01:13.053379 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 15:01:13.081871 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 15:01:13.101815 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 15:01:13.104058 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 15:01:13.110305 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 15:01:13.123905 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 15:01:13.130767 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 15:01:13.137006 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 15:01:13.143457 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 15:01:13.144692 (MainThread): Parsing macros/etc/query.sql
2021-02-21 15:01:13.146506 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 15:01:13.148449 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 15:01:13.157598 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 15:01:13.159865 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 15:01:13.161679 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 15:01:13.204607 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 15:01:13.206832 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 15:01:13.208640 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 15:01:13.210491 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 15:01:13.218237 (MainThread): Partial parsing not enabled
2021-02-21 15:01:13.254816 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 15:01:13.275251 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 15:01:13.285909 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 15:01:13.296991 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 15:01:13.307241 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:01:13.318516 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 15:01:13.338986 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:01:13.373845 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 15:01:13.568964 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 15:01:13.569085 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 15:01:13.569319 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:01:13.569444 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:01:13.569552 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:01:13.569656 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:01:13.607246 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 15:01:13.664988 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 15:01:13.665704 (MainThread): 
2021-02-21 15:01:13.665942 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:01:13.667268 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 15:01:13.667447 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 15:01:22.277843 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 15:01:22.278106 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 15:01:22.835313 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:01:23.264009 (MainThread): 16:01:23 | Concurrency: 1 threads (target='dev')
2021-02-21 15:01:23.264218 (MainThread): 16:01:23 | 
2021-02-21 15:01:23.271729 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:01:23.272938 (Thread-1): 16:01:23 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 15:01:23.273431 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:01:23.273592 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:01:23.286753 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 15:01:23.287089 (Thread-1): finished collecting timing info
2021-02-21 15:01:23.318350 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 15:01:23.318690 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 15:01:23.846371 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 15:01:25.212651 (Thread-1): finished collecting timing info
2021-02-21 15:01:25.213382 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8595853c-0bed-4489-9337-409947e482c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106893fd0>]}
2021-02-21 15:01:25.214476 (Thread-1): 16:01:25 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.94s]
2021-02-21 15:01:25.214731 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:01:25.215895 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:01:25.216185 (MainThread): 16:01:25 | 
2021-02-21 15:01:25.216371 (MainThread): 16:01:25 | Finished running 1 view model in 11.55s.
2021-02-21 15:01:25.216537 (MainThread): Connection 'master' was properly closed.
2021-02-21 15:01:25.216619 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 15:01:25.220026 (MainThread): 
2021-02-21 15:01:25.220217 (MainThread): Completed successfully
2021-02-21 15:01:25.220387 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 15:01:25.220635 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069b4d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10680cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10680ca30>]}
2021-02-21 15:01:25.220801 (MainThread): Flushing usage events
2021-02-21 15:01:27.221066 (MainThread): Running with dbt=0.18.1
2021-02-21 15:01:27.673427 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 15:01:27.674095 (MainThread): Tracking: tracking
2021-02-21 15:01:27.681229 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110292af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109f5dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109fc130>]}
2021-02-21 15:01:27.703600 (MainThread): Partial parsing not enabled
2021-02-21 15:01:27.704850 (MainThread): Parsing macros/etc.sql
2021-02-21 15:01:27.706716 (MainThread): Parsing macros/catalog.sql
2021-02-21 15:01:27.713215 (MainThread): Parsing macros/adapters.sql
2021-02-21 15:01:27.736672 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 15:01:27.740731 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 15:01:27.744196 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 15:01:27.755543 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 15:01:27.760124 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 15:01:27.773057 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 15:01:27.776566 (MainThread): Parsing macros/core.sql
2021-02-21 15:01:27.780657 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 15:01:27.791163 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 15:01:27.794169 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 15:01:27.813808 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 15:01:27.842707 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 15:01:27.863008 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 15:01:27.865155 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 15:01:27.871973 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 15:01:27.885957 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 15:01:27.892822 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 15:01:27.899162 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 15:01:27.904623 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 15:01:27.905693 (MainThread): Parsing macros/etc/query.sql
2021-02-21 15:01:27.906865 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 15:01:27.909025 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 15:01:27.918678 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 15:01:27.921136 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 15:01:27.922880 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 15:01:27.966823 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 15:01:27.968928 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 15:01:27.970711 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 15:01:27.972558 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 15:01:27.981316 (MainThread): Partial parsing not enabled
2021-02-21 15:01:28.017345 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 15:01:28.036793 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 15:01:28.047927 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 15:01:28.057782 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 15:01:28.067202 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:01:28.076799 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 15:01:28.092092 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:01:28.124986 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 15:01:28.324578 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 15:01:28.324711 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 15:01:28.324975 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:01:28.325204 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:01:28.325382 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:01:28.325552 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:01:28.363827 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 15:01:28.420210 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 15:01:28.421065 (MainThread): 
2021-02-21 15:01:28.421384 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:01:28.422547 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 15:01:28.422792 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 15:01:29.507606 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 15:01:29.507868 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 15:01:30.064581 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:01:30.619790 (MainThread): 16:01:30 | Concurrency: 1 threads (target='dev')
2021-02-21 15:01:30.620100 (MainThread): 16:01:30 | 
2021-02-21 15:01:30.626443 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 15:01:30.627695 (Thread-1): 16:01:30 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 15:01:30.628079 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:01:30.628214 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 15:01:30.642537 (Thread-1): finished collecting timing info
2021-02-21 15:01:30.664967 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 15:01:31.183761 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:01:31.702369 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:01:31.964484 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 15:01:34.771211 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:01:34.998188 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:01:35.207610 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 15:01:35.207806 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:01:35.858218 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:01:36.083542 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 15:01:36.084067 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 15:01:38.131766 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 15:01:38.873364 (Thread-1): finished collecting timing info
2021-02-21 15:01:38.874116 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a65d73a-cfa2-4743-9a77-bf9f69ed84cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ad3d00>]}
2021-02-21 15:01:38.875408 (Thread-1): 16:01:38 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 8.25s]
2021-02-21 15:01:38.875682 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 15:01:38.876751 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:01:38.877031 (MainThread): 16:01:38 | 
2021-02-21 15:01:38.877219 (MainThread): 16:01:38 | Finished running 1 snapshot in 10.46s.
2021-02-21 15:01:38.877384 (MainThread): Connection 'master' was properly closed.
2021-02-21 15:01:38.877465 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 15:01:38.881015 (MainThread): 
2021-02-21 15:01:38.881216 (MainThread): Completed successfully
2021-02-21 15:01:38.881386 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 15:01:38.881642 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a66e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c24670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a80970>]}
2021-02-21 15:01:38.881819 (MainThread): Flushing usage events
2021-02-21 15:04:51.487570 (MainThread): Running with dbt=0.18.1
2021-02-21 15:04:51.997758 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 15:04:51.998780 (MainThread): Tracking: tracking
2021-02-21 15:04:52.004985 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108156760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108174c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108174910>]}
2021-02-21 15:04:52.027228 (MainThread): Partial parsing not enabled
2021-02-21 15:04:52.029037 (MainThread): Parsing macros/etc.sql
2021-02-21 15:04:52.031011 (MainThread): Parsing macros/catalog.sql
2021-02-21 15:04:52.037369 (MainThread): Parsing macros/adapters.sql
2021-02-21 15:04:52.056385 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 15:04:52.059297 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 15:04:52.062165 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 15:04:52.072310 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 15:04:52.076713 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 15:04:52.089084 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 15:04:52.093118 (MainThread): Parsing macros/core.sql
2021-02-21 15:04:52.097391 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 15:04:52.106269 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 15:04:52.108075 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 15:04:52.124537 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 15:04:52.156610 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 15:04:52.178671 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 15:04:52.180978 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 15:04:52.187595 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 15:04:52.201610 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 15:04:52.209017 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 15:04:52.215192 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 15:04:52.220506 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 15:04:52.221589 (MainThread): Parsing macros/etc/query.sql
2021-02-21 15:04:52.222945 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 15:04:52.224786 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 15:04:52.233997 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 15:04:52.236189 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 15:04:52.238069 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 15:04:52.280516 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 15:04:52.282718 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 15:04:52.284607 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 15:04:52.286883 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 15:04:52.295318 (MainThread): Partial parsing not enabled
2021-02-21 15:04:52.332942 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 15:04:52.355877 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 15:04:52.369540 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 15:04:52.381208 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 15:04:52.391776 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:04:52.401512 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 15:04:52.418648 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:04:52.451963 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 15:04:52.648786 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 15:04:52.648904 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 15:04:52.649132 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:04:52.649258 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:04:52.649367 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:04:52.649471 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:04:52.686397 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 15:04:52.741577 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 15:04:52.742313 (MainThread): 
2021-02-21 15:04:52.742561 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:04:52.743698 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 15:04:52.743812 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 15:04:54.878798 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 15:04:54.879032 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 15:04:55.415042 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:04:55.977773 (MainThread): 16:04:55 | Concurrency: 1 threads (target='dev')
2021-02-21 15:04:55.977993 (MainThread): 16:04:55 | 
2021-02-21 15:04:55.984225 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:04:55.985579 (Thread-1): 16:04:55 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 15:04:55.985940 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:04:55.986154 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:04:56.000992 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 15:04:56.001359 (Thread-1): finished collecting timing info
2021-02-21 15:04:56.033323 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 15:04:56.033678 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 15:04:56.540601 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 15:04:57.958982 (Thread-1): finished collecting timing info
2021-02-21 15:04:57.959877 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '288f1be2-b1f7-4237-b8a4-b9e516fbc94f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10821a310>]}
2021-02-21 15:04:57.961234 (Thread-1): 16:04:57 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.97s]
2021-02-21 15:04:57.961401 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:04:57.963887 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:04:57.964294 (MainThread): 16:04:57 | 
2021-02-21 15:04:57.964434 (MainThread): 16:04:57 | Finished running 1 view model in 5.22s.
2021-02-21 15:04:57.964550 (MainThread): Connection 'master' was properly closed.
2021-02-21 15:04:57.964636 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 15:04:57.968795 (MainThread): 
2021-02-21 15:04:57.968943 (MainThread): Completed successfully
2021-02-21 15:04:57.969068 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 15:04:57.969294 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081f05e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083918b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108391940>]}
2021-02-21 15:04:57.969499 (MainThread): Flushing usage events
2021-02-21 15:04:59.727841 (MainThread): Running with dbt=0.18.1
2021-02-21 15:05:00.082684 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 15:05:00.083525 (MainThread): Tracking: tracking
2021-02-21 15:05:00.088613 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111adffa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111af0670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111af0340>]}
2021-02-21 15:05:00.109504 (MainThread): Partial parsing not enabled
2021-02-21 15:05:00.110448 (MainThread): Parsing macros/etc.sql
2021-02-21 15:05:00.111926 (MainThread): Parsing macros/catalog.sql
2021-02-21 15:05:00.117574 (MainThread): Parsing macros/adapters.sql
2021-02-21 15:05:00.135625 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 15:05:00.138219 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 15:05:00.140939 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 15:05:00.151891 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 15:05:00.156027 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 15:05:00.168159 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 15:05:00.170922 (MainThread): Parsing macros/core.sql
2021-02-21 15:05:00.174587 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 15:05:00.182963 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 15:05:00.184651 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 15:05:00.201579 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 15:05:00.231502 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 15:05:00.252165 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 15:05:00.253924 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 15:05:00.260254 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 15:05:00.273766 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 15:05:00.280415 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 15:05:00.286840 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 15:05:00.291718 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 15:05:00.292618 (MainThread): Parsing macros/etc/query.sql
2021-02-21 15:05:00.293808 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 15:05:00.295472 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 15:05:00.304017 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 15:05:00.305891 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 15:05:00.307510 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 15:05:00.349032 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 15:05:00.350784 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 15:05:00.352363 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 15:05:00.354076 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 15:05:00.361641 (MainThread): Partial parsing not enabled
2021-02-21 15:05:00.397530 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 15:05:00.415977 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 15:05:00.426104 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 15:05:00.435418 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 15:05:00.445939 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:05:00.454540 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 15:05:00.469572 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:05:00.502721 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 15:05:00.694578 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 15:05:00.694717 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 15:05:00.694970 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:05:00.695094 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:05:00.695201 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:05:00.695304 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:05:00.734895 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 15:05:00.791329 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 15:05:00.792054 (MainThread): 
2021-02-21 15:05:00.792299 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:05:00.793586 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 15:05:00.793703 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 15:05:01.847614 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 15:05:01.847960 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 15:05:02.407290 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:05:02.816362 (MainThread): 16:05:02 | Concurrency: 1 threads (target='dev')
2021-02-21 15:05:02.816575 (MainThread): 16:05:02 | 
2021-02-21 15:05:02.822550 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 15:05:02.823839 (Thread-1): 16:05:02 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 15:05:02.824178 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:05:02.824333 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 15:05:02.839212 (Thread-1): finished collecting timing info
2021-02-21 15:05:02.862465 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 15:05:03.366205 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:05:03.885898 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:05:04.184006 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 15:05:08.109238 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:05:08.340209 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:05:08.565330 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 15:05:08.565557 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:05:09.427923 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:05:09.700696 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 15:05:09.702371 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 15:05:11.851019 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 15:05:12.604862 (Thread-1): finished collecting timing info
2021-02-21 15:05:12.605887 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ca007e0-83bc-4ae4-82b7-c813eec2ea29', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b90790>]}
2021-02-21 15:05:12.607462 (Thread-1): 16:05:12 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.78s]
2021-02-21 15:05:12.607628 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 15:05:12.608885 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:05:12.609222 (MainThread): 16:05:12 | 
2021-02-21 15:05:12.609364 (MainThread): 16:05:12 | Finished running 1 snapshot in 11.82s.
2021-02-21 15:05:12.609497 (MainThread): Connection 'master' was properly closed.
2021-02-21 15:05:12.609586 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 15:05:12.613652 (MainThread): 
2021-02-21 15:05:12.613801 (MainThread): Completed successfully
2021-02-21 15:05:12.613927 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 15:05:12.614143 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d2f730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cad370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cad6d0>]}
2021-02-21 15:05:12.614337 (MainThread): Flushing usage events
2021-02-21 15:36:17.845896 (MainThread): Running with dbt=0.18.1
2021-02-21 15:36:18.346069 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 15:36:18.347361 (MainThread): Tracking: tracking
2021-02-21 15:36:18.356769 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110da2790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dc6c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dc6940>]}
2021-02-21 15:36:18.383218 (MainThread): Partial parsing not enabled
2021-02-21 15:36:18.385230 (MainThread): Parsing macros/etc.sql
2021-02-21 15:36:18.387167 (MainThread): Parsing macros/catalog.sql
2021-02-21 15:36:18.394461 (MainThread): Parsing macros/adapters.sql
2021-02-21 15:36:18.415629 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 15:36:18.418805 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 15:36:18.421715 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 15:36:18.432366 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 15:36:18.436932 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 15:36:18.450406 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 15:36:18.453987 (MainThread): Parsing macros/core.sql
2021-02-21 15:36:18.457919 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 15:36:18.467937 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 15:36:18.469782 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 15:36:18.489312 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 15:36:18.521977 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 15:36:18.545175 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 15:36:18.547197 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 15:36:18.554381 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 15:36:18.569880 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 15:36:18.577215 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 15:36:18.583883 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 15:36:18.588867 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 15:36:18.589901 (MainThread): Parsing macros/etc/query.sql
2021-02-21 15:36:18.591089 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 15:36:18.592781 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 15:36:18.602193 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 15:36:18.604295 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 15:36:18.606033 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 15:36:18.665209 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 15:36:18.667252 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 15:36:18.668789 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 15:36:18.670543 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 15:36:18.680293 (MainThread): Partial parsing not enabled
2021-02-21 15:36:18.738296 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 15:36:18.769346 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 15:36:18.788190 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 15:36:18.800424 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 15:36:18.812750 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:36:18.823898 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 15:36:18.842889 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:36:18.881093 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 15:36:19.087356 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 15:36:19.087478 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 15:36:19.087707 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:36:19.087830 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:36:19.087935 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:36:19.088036 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:36:19.124753 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 15:36:19.187454 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 15:36:19.188629 (MainThread): 
2021-02-21 15:36:19.188941 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:36:19.190401 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 15:36:19.190609 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 15:36:47.379814 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 15:36:47.380104 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 15:36:47.885987 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:36:49.875469 (MainThread): 16:36:49 | Concurrency: 1 threads (target='dev')
2021-02-21 15:36:49.875650 (MainThread): 16:36:49 | 
2021-02-21 15:36:49.881284 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:36:49.882384 (Thread-1): 16:36:49 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 15:36:49.882683 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:36:49.882817 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:36:49.895460 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 15:36:49.896243 (Thread-1): finished collecting timing info
2021-02-21 15:36:49.926586 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 15:36:49.926932 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 15:36:50.415736 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 15:36:51.860017 (Thread-1): finished collecting timing info
2021-02-21 15:36:51.860875 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8683649d-cc5e-4633-af37-0aabe0650d92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dd9f40>]}
2021-02-21 15:36:51.862175 (Thread-1): 16:36:51 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.98s]
2021-02-21 15:36:51.862334 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 15:36:51.863602 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:36:51.863944 (MainThread): 16:36:51 | 
2021-02-21 15:36:51.864082 (MainThread): 16:36:51 | Finished running 1 view model in 32.68s.
2021-02-21 15:36:51.864201 (MainThread): Connection 'master' was properly closed.
2021-02-21 15:36:51.864291 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 15:36:51.868359 (MainThread): 
2021-02-21 15:36:51.868519 (MainThread): Completed successfully
2021-02-21 15:36:51.868640 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 15:36:51.868842 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e33f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ff8700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ff81f0>]}
2021-02-21 15:36:51.869032 (MainThread): Flushing usage events
2021-02-21 15:36:53.306539 (MainThread): Running with dbt=0.18.1
2021-02-21 15:36:53.661807 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 15:36:53.662591 (MainThread): Tracking: tracking
2021-02-21 15:36:53.667645 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c96fa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0a9df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0a9ac0>]}
2021-02-21 15:36:53.688779 (MainThread): Partial parsing not enabled
2021-02-21 15:36:53.689766 (MainThread): Parsing macros/etc.sql
2021-02-21 15:36:53.692461 (MainThread): Parsing macros/catalog.sql
2021-02-21 15:36:53.698444 (MainThread): Parsing macros/adapters.sql
2021-02-21 15:36:53.717387 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 15:36:53.720066 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 15:36:53.722818 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 15:36:53.732648 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 15:36:53.737004 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 15:36:53.749156 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 15:36:53.752080 (MainThread): Parsing macros/core.sql
2021-02-21 15:36:53.755504 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 15:36:53.763958 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 15:36:53.767380 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 15:36:53.784969 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 15:36:53.812771 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 15:36:53.833752 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 15:36:53.835510 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 15:36:53.841524 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 15:36:53.855204 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 15:36:53.861720 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 15:36:53.868041 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 15:36:53.872839 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 15:36:53.873723 (MainThread): Parsing macros/etc/query.sql
2021-02-21 15:36:53.874702 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 15:36:53.876528 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 15:36:53.885478 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 15:36:53.887312 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 15:36:53.888885 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 15:36:53.930445 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 15:36:53.932333 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 15:36:53.933990 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 15:36:53.935612 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 15:36:53.942663 (MainThread): Partial parsing not enabled
2021-02-21 15:36:53.977548 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 15:36:53.996280 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 15:36:54.007045 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 15:36:54.016225 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 15:36:54.025499 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 15:36:54.035124 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 15:36:54.050488 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:36:54.083480 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 15:36:54.275352 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 15:36:54.275472 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 15:36:54.275702 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:36:54.275828 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 15:36:54.275933 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:36:54.276036 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 15:36:54.312678 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 15:36:54.370060 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 15:36:54.371010 (MainThread): 
2021-02-21 15:36:54.371321 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:36:54.372612 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 15:36:54.372833 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 15:36:56.135376 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 15:36:56.135659 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 15:36:56.637337 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:36:57.355094 (MainThread): 16:36:57 | Concurrency: 1 threads (target='dev')
2021-02-21 15:36:57.355290 (MainThread): 16:36:57 | 
2021-02-21 15:36:57.358509 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 15:36:57.359497 (Thread-1): 16:36:57 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 15:36:57.359757 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 15:36:57.359890 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 15:36:57.373877 (Thread-1): finished collecting timing info
2021-02-21 15:36:57.396465 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 15:36:57.890177 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:36:59.556354 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:36:59.833250 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 15:37:03.189423 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:37:03.435356 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:37:03.665786 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 15:37:03.666019 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:37:04.320497 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 15:37:04.554315 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 15:37:04.556183 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 15:37:06.659766 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 15:37:07.449792 (Thread-1): finished collecting timing info
2021-02-21 15:37:07.450838 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9d0a010-942f-4fcd-9e57-c7c5baf093b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2afb50>]}
2021-02-21 15:37:07.452388 (Thread-1): 16:37:07 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 10.09s]
2021-02-21 15:37:07.452562 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 15:37:07.453874 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 15:37:07.454217 (MainThread): 16:37:07 | 
2021-02-21 15:37:07.454358 (MainThread): 16:37:07 | Finished running 1 snapshot in 13.08s.
2021-02-21 15:37:07.454482 (MainThread): Connection 'master' was properly closed.
2021-02-21 15:37:07.454574 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 15:37:07.458756 (MainThread): 
2021-02-21 15:37:07.458921 (MainThread): Completed successfully
2021-02-21 15:37:07.459052 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 15:37:07.459274 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d14b970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d31c2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d31c5e0>]}
2021-02-21 15:37:07.459467 (MainThread): Flushing usage events
2021-02-21 16:06:37.357718 (MainThread): Running with dbt=0.18.1
2021-02-21 16:06:37.869393 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 16:06:37.870374 (MainThread): Tracking: tracking
2021-02-21 16:06:37.878861 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104505f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10450d610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10450d2e0>]}
2021-02-21 16:06:37.902511 (MainThread): Partial parsing not enabled
2021-02-21 16:06:37.904478 (MainThread): Parsing macros/etc.sql
2021-02-21 16:06:37.906246 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:06:37.913115 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:06:37.933060 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:06:37.935831 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:06:37.938805 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:06:37.948636 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:06:37.954498 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:06:37.970147 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:06:37.975685 (MainThread): Parsing macros/core.sql
2021-02-21 16:06:37.982067 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:06:37.992762 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:06:37.996225 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:06:38.017416 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:06:38.045614 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:06:38.066499 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:06:38.068517 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:06:38.075493 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:06:38.089780 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:06:38.096533 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:06:38.102895 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:06:38.107783 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:06:38.108866 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:06:38.110021 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:06:38.111814 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:06:38.120684 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:06:38.122692 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:06:38.124482 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:06:38.170814 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:06:38.173163 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:06:38.174986 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:06:38.177026 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:06:38.185508 (MainThread): Partial parsing not enabled
2021-02-21 16:06:38.226190 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:06:38.248123 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:06:38.259527 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:06:38.270238 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:06:38.280217 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:06:38.291848 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:06:38.309767 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:06:38.347976 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:06:38.573173 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:06:38.573293 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:06:38.573523 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:06:38.573647 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:06:38.573752 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:06:38.573856 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:06:38.610178 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 16:06:38.667242 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:06:38.668039 (MainThread): 
2021-02-21 16:06:38.668305 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:06:38.669600 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:06:38.669748 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:06:40.207682 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:06:40.207952 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:06:40.774171 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:06:41.311176 (MainThread): 17:06:41 | Concurrency: 1 threads (target='dev')
2021-02-21 16:06:41.311365 (MainThread): 17:06:41 | 
2021-02-21 16:06:41.316517 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:06:41.317537 (Thread-1): 17:06:41 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 16:06:41.317797 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:06:41.317926 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:06:41.330553 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:06:41.332225 (Thread-1): finished collecting timing info
2021-02-21 16:06:41.362768 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:06:41.363811 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:06:41.979368 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 16:06:43.261975 (Thread-1): finished collecting timing info
2021-02-21 16:06:43.264474 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9d0e835-e81b-497f-964c-00194fe5e46a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045975e0>]}
2021-02-21 16:06:43.265589 (Thread-1): 17:06:43 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.95s]
2021-02-21 16:06:43.265741 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:06:43.267171 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:06:43.267458 (MainThread): 17:06:43 | 
2021-02-21 16:06:43.267577 (MainThread): 17:06:43 | Finished running 1 view model in 4.60s.
2021-02-21 16:06:43.267678 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:06:43.267754 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 16:06:43.271195 (MainThread): 
2021-02-21 16:06:43.271324 (MainThread): Completed successfully
2021-02-21 16:06:43.271432 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:06:43.271616 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10458f610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10452b730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046d2d00>]}
2021-02-21 16:06:43.271787 (MainThread): Flushing usage events
2021-02-21 16:06:45.134525 (MainThread): Running with dbt=0.18.1
2021-02-21 16:06:45.599564 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 16:06:45.600375 (MainThread): Tracking: tracking
2021-02-21 16:06:45.607267 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3bddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3c9490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3c9160>]}
2021-02-21 16:06:45.630396 (MainThread): Partial parsing not enabled
2021-02-21 16:06:45.632316 (MainThread): Parsing macros/etc.sql
2021-02-21 16:06:45.634336 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:06:45.640947 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:06:45.659620 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:06:45.662359 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:06:45.665276 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:06:45.675365 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:06:45.679943 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:06:45.692520 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:06:45.695777 (MainThread): Parsing macros/core.sql
2021-02-21 16:06:45.699596 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:06:45.708754 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:06:45.710539 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:06:45.727541 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:06:45.755154 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:06:45.776528 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:06:45.778463 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:06:45.784592 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:06:45.798324 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:06:45.805106 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:06:45.811638 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:06:45.816594 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:06:45.817682 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:06:45.818903 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:06:45.820655 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:06:45.829737 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:06:45.832136 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:06:45.833961 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:06:45.878062 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:06:45.880491 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:06:45.882081 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:06:45.883834 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:06:45.894478 (MainThread): Partial parsing not enabled
2021-02-21 16:06:45.932599 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:06:45.955586 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:06:45.966670 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:06:45.976803 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:06:45.987576 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:06:45.998859 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:06:46.016668 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:06:46.050262 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:06:46.244409 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:06:46.244540 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:06:46.244777 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:06:46.244910 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:06:46.245023 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:06:46.245130 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:06:46.283040 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 16:06:46.346557 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:06:46.347376 (MainThread): 
2021-02-21 16:06:46.347634 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:06:46.348812 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:06:46.348931 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:06:47.464321 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:06:47.464791 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:06:47.977938 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:06:48.566334 (MainThread): 17:06:48 | Concurrency: 1 threads (target='dev')
2021-02-21 16:06:48.566557 (MainThread): 17:06:48 | 
2021-02-21 16:06:48.573002 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 16:06:48.574107 (Thread-1): 17:06:48 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 16:06:48.574458 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:06:48.574759 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 16:06:48.592233 (Thread-1): finished collecting timing info
2021-02-21 16:06:48.616891 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:06:49.174804 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:06:49.841113 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:06:50.093567 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 16:06:53.212787 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:06:53.437782 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:06:53.662358 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 16:06:53.662572 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:06:54.349538 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:06:54.583042 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 16:06:54.584044 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 16:06:57.029336 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 54737, 0, 0), raddr=('2a00:1450:400f:80a::200a', 443, 0, 0)>
2021-02-21 16:06:57.029559 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 54738, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 16:06:57.029710 (Thread-1): unclosed <socket.socket fd=15, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 54740, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 16:06:57.029847 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 54739, 0, 0), raddr=('2a00:1450:400f:80a::200a', 443, 0, 0)>
2021-02-21 16:06:57.036824 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 16:06:57.907447 (Thread-1): finished collecting timing info
2021-02-21 16:06:57.908567 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5f62840-de3f-4b5a-9b08-973531f10c9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3c9be0>]}
2021-02-21 16:06:57.910404 (Thread-1): 17:06:57 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.33s]
2021-02-21 16:06:57.910586 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 16:06:57.911939 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:06:57.912264 (MainThread): 17:06:57 | 
2021-02-21 16:06:57.912403 (MainThread): 17:06:57 | Finished running 1 snapshot in 11.56s.
2021-02-21 16:06:57.912528 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:06:57.912617 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 16:06:57.916591 (MainThread): 
2021-02-21 16:06:57.916773 (MainThread): Completed successfully
2021-02-21 16:06:57.916880 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:06:57.917237 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b62b850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b62b8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b62b1c0>]}
2021-02-21 16:06:57.917414 (MainThread): Flushing usage events
2021-02-21 16:08:32.835150 (MainThread): Running with dbt=0.18.1
2021-02-21 16:08:33.340773 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 16:08:33.342545 (MainThread): Tracking: tracking
2021-02-21 16:08:33.351431 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133c91f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133eec70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133ee940>]}
2021-02-21 16:08:33.377620 (MainThread): Partial parsing not enabled
2021-02-21 16:08:33.379030 (MainThread): Parsing macros/etc.sql
2021-02-21 16:08:33.381065 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:08:33.389411 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:08:33.408808 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:08:33.411870 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:08:33.414821 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:08:33.425155 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:08:33.430134 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:08:33.444400 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:08:33.448255 (MainThread): Parsing macros/core.sql
2021-02-21 16:08:33.451979 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:08:33.461316 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:08:33.463155 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:08:33.481040 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:08:33.515709 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:08:33.537761 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:08:33.539916 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:08:33.546296 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:08:33.561149 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:08:33.570355 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:08:33.578123 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:08:33.583661 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:08:33.584846 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:08:33.586244 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:08:33.588052 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:08:33.597000 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:08:33.599389 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:08:33.601728 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:08:33.647361 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:08:33.649505 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:08:33.651133 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:08:33.652942 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:08:33.661188 (MainThread): Partial parsing not enabled
2021-02-21 16:08:33.698757 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:08:33.721447 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:08:33.736324 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:08:33.748251 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:08:33.759353 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:08:33.769272 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:08:33.792968 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:08:33.828611 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:08:34.033562 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:08:34.033692 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:08:34.033933 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:08:34.034063 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:08:34.034174 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:08:34.034284 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:08:34.072821 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 16:08:34.135028 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:08:34.135787 (MainThread): 
2021-02-21 16:08:34.136035 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:08:34.137273 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:08:34.137391 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:08:35.708482 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:08:35.708753 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:08:36.255242 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:08:36.660529 (MainThread): 17:08:36 | Concurrency: 1 threads (target='dev')
2021-02-21 16:08:36.660709 (MainThread): 17:08:36 | 
2021-02-21 16:08:36.665860 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:08:36.667042 (Thread-1): 17:08:36 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 16:08:36.667349 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:08:36.667503 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:08:36.680634 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:08:36.682045 (Thread-1): finished collecting timing info
2021-02-21 16:08:36.714358 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:08:36.714787 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:08:37.265650 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 16:08:38.566445 (Thread-1): finished collecting timing info
2021-02-21 16:08:38.567646 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2c3e45c-1406-493b-a475-74ed3e789dd1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134adcd0>]}
2021-02-21 16:08:38.569099 (Thread-1): 17:08:38 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.90s]
2021-02-21 16:08:38.569325 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:08:38.570927 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:08:38.571264 (MainThread): 17:08:38 | 
2021-02-21 16:08:38.571421 (MainThread): 17:08:38 | Finished running 1 view model in 4.44s.
2021-02-21 16:08:38.571538 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:08:38.571625 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 16:08:38.575582 (MainThread): 
2021-02-21 16:08:38.575715 (MainThread): Completed successfully
2021-02-21 16:08:38.575825 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:08:38.576016 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113599220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113621820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113621d60>]}
2021-02-21 16:08:38.576190 (MainThread): Flushing usage events
2021-02-21 16:08:40.363987 (MainThread): Running with dbt=0.18.1
2021-02-21 16:08:40.843680 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 16:08:40.844494 (MainThread): Tracking: tracking
2021-02-21 16:08:40.850564 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f3dbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10767adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10767aa90>]}
2021-02-21 16:08:40.872999 (MainThread): Partial parsing not enabled
2021-02-21 16:08:40.874472 (MainThread): Parsing macros/etc.sql
2021-02-21 16:08:40.876577 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:08:40.882717 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:08:40.903085 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:08:40.907884 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:08:40.912472 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:08:40.924518 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:08:40.929731 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:08:40.942947 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:08:40.946271 (MainThread): Parsing macros/core.sql
2021-02-21 16:08:40.950499 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:08:40.959504 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:08:40.961367 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:08:40.978718 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:08:41.008437 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:08:41.028912 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:08:41.031081 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:08:41.038001 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:08:41.051968 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:08:41.060078 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:08:41.066771 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:08:41.071806 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:08:41.072990 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:08:41.074269 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:08:41.076058 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:08:41.084743 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:08:41.086755 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:08:41.088873 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:08:41.134467 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:08:41.137102 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:08:41.139158 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:08:41.141299 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:08:41.149777 (MainThread): Partial parsing not enabled
2021-02-21 16:08:41.187096 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:08:41.205972 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:08:41.218318 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:08:41.230878 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:08:41.242736 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:08:41.253196 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:08:41.268884 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:08:41.303183 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:08:41.504708 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:08:41.504830 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:08:41.505060 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:08:41.505183 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:08:41.505294 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:08:41.505464 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:08:41.544333 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 16:08:41.603845 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:08:41.604654 (MainThread): 
2021-02-21 16:08:41.604932 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:08:41.606314 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:08:41.606460 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:08:42.845734 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:08:42.846007 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:08:43.387979 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:08:43.799467 (MainThread): 17:08:43 | Concurrency: 1 threads (target='dev')
2021-02-21 16:08:43.800452 (MainThread): 17:08:43 | 
2021-02-21 16:08:43.804920 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 16:08:43.805961 (Thread-1): 17:08:43 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 16:08:43.808226 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:08:43.808369 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 16:08:43.822937 (Thread-1): finished collecting timing info
2021-02-21 16:08:43.844727 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:08:44.411710 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:08:44.844721 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:08:45.101237 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 16:08:48.101284 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:08:48.341478 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:08:48.595913 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 16:08:48.596159 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:08:49.326782 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:08:49.558100 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 16:08:49.559562 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 16:08:51.593735 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 16:08:52.472949 (Thread-1): finished collecting timing info
2021-02-21 16:08:52.473795 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '368d4061-8b02-4282-bdbd-2fa056f2d662', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785cf10>]}
2021-02-21 16:08:52.475245 (Thread-1): 17:08:52 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 8.67s]
2021-02-21 16:08:52.475403 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 16:08:52.476672 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:08:52.476991 (MainThread): 17:08:52 | 
2021-02-21 16:08:52.477126 (MainThread): 17:08:52 | Finished running 1 snapshot in 10.87s.
2021-02-21 16:08:52.477248 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:08:52.477322 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 16:08:52.482001 (MainThread): 
2021-02-21 16:08:52.482202 (MainThread): Completed successfully
2021-02-21 16:08:52.482342 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:08:52.482587 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076e6340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078e9670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078e9d00>]}
2021-02-21 16:08:52.482802 (MainThread): Flushing usage events
2021-02-21 16:10:11.878747 (MainThread): Running with dbt=0.18.1
2021-02-21 16:10:12.418307 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 16:10:12.419919 (MainThread): Tracking: tracking
2021-02-21 16:10:12.428545 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a27db50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9c1f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9c1c40>]}
2021-02-21 16:10:12.453719 (MainThread): Partial parsing not enabled
2021-02-21 16:10:12.455782 (MainThread): Parsing macros/etc.sql
2021-02-21 16:10:12.457933 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:10:12.464877 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:10:12.487465 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:10:12.490298 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:10:12.493645 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:10:12.506691 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:10:12.511669 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:10:12.526926 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:10:12.531234 (MainThread): Parsing macros/core.sql
2021-02-21 16:10:12.536019 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:10:12.546068 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:10:12.548295 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:10:12.567724 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:10:12.596587 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:10:12.620408 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:10:12.622634 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:10:12.629497 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:10:12.645371 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:10:12.652429 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:10:12.659099 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:10:12.664770 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:10:12.666095 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:10:12.667577 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:10:12.669444 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:10:12.678738 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:10:12.681015 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:10:12.682931 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:10:12.726276 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:10:12.728419 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:10:12.730257 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:10:12.732260 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:10:12.739796 (MainThread): Partial parsing not enabled
2021-02-21 16:10:12.779020 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:10:12.800453 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:10:12.812439 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:10:12.824362 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:10:12.835091 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:10:12.845770 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:10:12.865075 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:10:12.900004 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:10:13.107376 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:10:13.107503 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:10:13.107738 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:10:13.107863 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:10:13.107973 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:10:13.108078 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:10:13.145788 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 16:10:13.210864 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:10:13.211797 (MainThread): 
2021-02-21 16:10:13.212104 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:10:13.213552 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:10:13.213698 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:10:14.725088 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:10:14.725374 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:10:15.249868 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:10:15.850751 (MainThread): 17:10:15 | Concurrency: 1 threads (target='dev')
2021-02-21 16:10:15.850922 (MainThread): 17:10:15 | 
2021-02-21 16:10:15.855814 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:10:15.856904 (Thread-1): 17:10:15 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 16:10:15.857189 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:10:15.857324 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:10:15.870652 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:10:15.871584 (Thread-1): finished collecting timing info
2021-02-21 16:10:15.902829 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:10:15.903193 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:10:16.433339 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 16:10:17.707955 (Thread-1): finished collecting timing info
2021-02-21 16:10:17.709524 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f311e25-f6bf-4dea-9000-268a6bfd88f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa4fe50>]}
2021-02-21 16:10:17.710743 (Thread-1): 17:10:17 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.85s]
2021-02-21 16:10:17.710882 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:10:17.713031 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:10:17.713356 (MainThread): 17:10:17 | 
2021-02-21 16:10:17.713472 (MainThread): 17:10:17 | Finished running 1 view model in 4.50s.
2021-02-21 16:10:17.713574 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:10:17.713649 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 16:10:17.717661 (MainThread): 
2021-02-21 16:10:17.717843 (MainThread): Completed successfully
2021-02-21 16:10:17.718000 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:10:17.718269 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9ec460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a99d610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a99d250>]}
2021-02-21 16:10:17.718520 (MainThread): Flushing usage events
2021-02-21 16:10:19.515144 (MainThread): Running with dbt=0.18.1
2021-02-21 16:10:19.981117 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 16:10:19.981819 (MainThread): Tracking: tracking
2021-02-21 16:10:19.988096 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b27d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b43c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b438e0>]}
2021-02-21 16:10:20.016217 (MainThread): Partial parsing not enabled
2021-02-21 16:10:20.017831 (MainThread): Parsing macros/etc.sql
2021-02-21 16:10:20.020054 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:10:20.028550 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:10:20.052538 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:10:20.055930 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:10:20.059293 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:10:20.071979 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:10:20.077543 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:10:20.092830 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:10:20.096982 (MainThread): Parsing macros/core.sql
2021-02-21 16:10:20.101375 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:10:20.113733 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:10:20.116004 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:10:20.138224 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:10:20.171712 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:10:20.194596 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:10:20.197099 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:10:20.203719 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:10:20.219008 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:10:20.226469 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:10:20.234393 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:10:20.239586 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:10:20.240816 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:10:20.242212 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:10:20.244184 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:10:20.254212 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:10:20.256629 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:10:20.258694 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:10:20.304678 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:10:20.307260 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:10:20.309200 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:10:20.311280 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:10:20.319719 (MainThread): Partial parsing not enabled
2021-02-21 16:10:20.357991 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:10:20.381211 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:10:20.393146 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:10:20.404162 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:10:20.415671 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:10:20.425841 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:10:20.444905 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:10:20.480055 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:10:20.677752 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:10:20.677875 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:10:20.678106 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:10:20.678226 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:10:20.678329 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:10:20.678429 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:10:20.715513 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 16:10:20.772919 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:10:20.773647 (MainThread): 
2021-02-21 16:10:20.773894 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:10:20.775242 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:10:20.775360 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:10:21.999202 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:10:21.999472 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:10:22.536183 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:10:23.118995 (MainThread): 17:10:23 | Concurrency: 1 threads (target='dev')
2021-02-21 16:10:23.119181 (MainThread): 17:10:23 | 
2021-02-21 16:10:23.124274 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 16:10:23.125296 (Thread-1): 17:10:23 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 16:10:23.125581 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:10:23.125728 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 16:10:23.139705 (Thread-1): finished collecting timing info
2021-02-21 16:10:23.162156 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:10:23.693636 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:10:24.258050 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:10:24.571854 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 16:10:27.430678 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:10:27.627653 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:10:27.857322 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 16:10:27.857838 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:10:28.535654 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:10:28.755601 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 16:10:28.757891 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 16:10:30.810025 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 16:10:31.605002 (Thread-1): finished collecting timing info
2021-02-21 16:10:31.605843 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15cbedf9-12ba-4782-b531-d3061d7eeed3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bb7250>]}
2021-02-21 16:10:31.607295 (Thread-1): 17:10:31 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 8.48s]
2021-02-21 16:10:31.607454 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 16:10:31.608614 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:10:31.608907 (MainThread): 17:10:31 | 
2021-02-21 16:10:31.609025 (MainThread): 17:10:31 | Finished running 1 snapshot in 10.84s.
2021-02-21 16:10:31.609126 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:10:31.609202 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 16:10:31.612924 (MainThread): 
2021-02-21 16:10:31.613053 (MainThread): Completed successfully
2021-02-21 16:10:31.613163 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:10:31.613353 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bbb4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d38640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d38be0>]}
2021-02-21 16:10:31.613527 (MainThread): Flushing usage events
2021-02-21 16:11:46.488428 (MainThread): Running with dbt=0.18.1
2021-02-21 16:11:47.013763 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 16:11:47.015672 (MainThread): Tracking: tracking
2021-02-21 16:11:47.022813 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9f4340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da05700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da053d0>]}
2021-02-21 16:11:47.047173 (MainThread): Partial parsing not enabled
2021-02-21 16:11:47.049600 (MainThread): Parsing macros/etc.sql
2021-02-21 16:11:47.051528 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:11:47.058177 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:11:47.080157 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:11:47.083454 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:11:47.086393 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:11:47.096286 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:11:47.101448 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:11:47.115462 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:11:47.119572 (MainThread): Parsing macros/core.sql
2021-02-21 16:11:47.124106 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:11:47.134399 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:11:47.136531 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:11:47.153286 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:11:47.183137 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:11:47.204568 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:11:47.206838 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:11:47.214581 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:11:47.230416 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:11:47.237325 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:11:47.243822 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:11:47.248668 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:11:47.249913 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:11:47.251215 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:11:47.252976 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:11:47.262641 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:11:47.264709 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:11:47.266887 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:11:47.312993 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:11:47.315652 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:11:47.317514 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:11:47.319307 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:11:47.327627 (MainThread): Partial parsing not enabled
2021-02-21 16:11:47.365996 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:11:47.387479 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:11:47.398988 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:11:47.410371 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:11:47.421444 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:11:47.431794 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:11:47.450639 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:11:47.489375 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:11:47.699656 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:11:47.699783 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:11:47.700019 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:11:47.700145 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:11:47.700256 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:11:47.700370 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:11:47.739186 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 16:11:47.800628 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:11:47.801417 (MainThread): 
2021-02-21 16:11:47.801674 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:11:47.803176 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:11:47.803296 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:11:49.346103 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:11:49.346365 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:11:49.904855 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:11:50.463852 (MainThread): 17:11:50 | Concurrency: 1 threads (target='dev')
2021-02-21 16:11:50.464041 (MainThread): 17:11:50 | 
2021-02-21 16:11:50.468673 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:11:50.469733 (Thread-1): 17:11:50 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 16:11:50.470016 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:11:50.470158 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:11:50.482845 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:11:50.484952 (Thread-1): finished collecting timing info
2021-02-21 16:11:50.518128 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:11:50.518570 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:11:51.069395 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 16:11:52.496000 (Thread-1): finished collecting timing info
2021-02-21 16:11:52.497411 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8574f02-48df-4a5f-bdea-1e40b3e88787', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d575970>]}
2021-02-21 16:11:52.498645 (Thread-1): 17:11:52 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 2.03s]
2021-02-21 16:11:52.498792 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:11:52.500734 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:11:52.501080 (MainThread): 17:11:52 | 
2021-02-21 16:11:52.501198 (MainThread): 17:11:52 | Finished running 1 view model in 4.70s.
2021-02-21 16:11:52.501295 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:11:52.501369 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 16:11:52.505190 (MainThread): 
2021-02-21 16:11:52.505323 (MainThread): Completed successfully
2021-02-21 16:11:52.505433 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:11:52.505634 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dcd26d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da310d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da31550>]}
2021-02-21 16:11:52.505816 (MainThread): Flushing usage events
2021-02-21 16:11:54.368875 (MainThread): Running with dbt=0.18.1
2021-02-21 16:11:54.825950 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 16:11:54.826770 (MainThread): Tracking: tracking
2021-02-21 16:11:54.832751 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105672f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10568ec40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10568e910>]}
2021-02-21 16:11:54.852953 (MainThread): Partial parsing not enabled
2021-02-21 16:11:54.854970 (MainThread): Parsing macros/etc.sql
2021-02-21 16:11:54.858102 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:11:54.864501 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:11:54.885226 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:11:54.888178 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:11:54.891486 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:11:54.901850 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:11:54.906362 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:11:54.919702 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:11:54.923003 (MainThread): Parsing macros/core.sql
2021-02-21 16:11:54.926899 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:11:54.935878 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:11:54.937844 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:11:54.956131 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:11:54.985076 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:11:55.005591 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:11:55.007665 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:11:55.013755 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:11:55.029002 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:11:55.036020 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:11:55.042191 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:11:55.047330 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:11:55.048478 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:11:55.049646 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:11:55.051545 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:11:55.060206 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:11:55.062577 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:11:55.064518 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:11:55.106851 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:11:55.109031 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:11:55.110898 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:11:55.112659 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:11:55.121099 (MainThread): Partial parsing not enabled
2021-02-21 16:11:55.160944 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:11:55.182244 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:11:55.194145 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:11:55.205037 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:11:55.215108 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:11:55.224502 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:11:55.239822 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:11:55.275065 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:11:55.473299 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:11:55.473421 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:11:55.473661 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:11:55.473784 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:11:55.473894 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:11:55.473998 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:11:55.514619 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 16:11:55.573603 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:11:55.574436 (MainThread): 
2021-02-21 16:11:55.574705 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:11:55.576248 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:11:55.576375 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:11:56.849853 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:11:56.850128 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:11:57.372829 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:11:57.907359 (MainThread): 17:11:57 | Concurrency: 1 threads (target='dev')
2021-02-21 16:11:57.907896 (MainThread): 17:11:57 | 
2021-02-21 16:11:57.912507 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 16:11:57.913511 (Thread-1): 17:11:57 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 16:11:57.913766 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:11:57.913900 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 16:11:57.927961 (Thread-1): finished collecting timing info
2021-02-21 16:11:57.950708 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:11:58.482628 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:11:59.020057 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:11:59.398660 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 16:12:02.257356 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:12:02.481386 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:12:02.849491 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 16:12:02.849685 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:12:03.561528 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:12:03.785819 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 16:12:03.788141 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 16:12:06.248420 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 16:12:07.050200 (Thread-1): finished collecting timing info
2021-02-21 16:12:07.051199 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9192459-ca90-4614-85b8-e719ae2aa965', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105725f40>]}
2021-02-21 16:12:07.052812 (Thread-1): 17:12:07 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.14s]
2021-02-21 16:12:07.052971 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 16:12:07.054219 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:12:07.054549 (MainThread): 17:12:07 | 
2021-02-21 16:12:07.054687 (MainThread): 17:12:07 | Finished running 1 snapshot in 11.48s.
2021-02-21 16:12:07.054807 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:12:07.054896 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 16:12:07.058615 (MainThread): 
2021-02-21 16:12:07.058750 (MainThread): Completed successfully
2021-02-21 16:12:07.058861 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:12:07.059061 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058477c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105814d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058149d0>]}
2021-02-21 16:12:07.059237 (MainThread): Flushing usage events
2021-02-21 16:13:24.470915 (MainThread): Running with dbt=0.18.1
2021-02-21 16:13:25.014321 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 16:13:25.019009 (MainThread): Tracking: tracking
2021-02-21 16:13:25.028369 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ebffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ecb6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ecb3a0>]}
2021-02-21 16:13:25.052375 (MainThread): Partial parsing not enabled
2021-02-21 16:13:25.054826 (MainThread): Parsing macros/etc.sql
2021-02-21 16:13:25.057066 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:13:25.063423 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:13:25.081653 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:13:25.084467 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:13:25.087461 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:13:25.097438 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:13:25.102733 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:13:25.117547 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:13:25.122663 (MainThread): Parsing macros/core.sql
2021-02-21 16:13:25.127823 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:13:25.137866 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:13:25.140074 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:13:25.158305 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:13:25.186142 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:13:25.206333 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:13:25.208317 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:13:25.214539 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:13:25.228132 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:13:25.237970 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:13:25.245909 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:13:25.251734 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:13:25.252992 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:13:25.254448 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:13:25.256534 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:13:25.266526 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:13:25.268790 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:13:25.270669 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:13:25.314807 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:13:25.317162 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:13:25.319151 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:13:25.321196 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:13:25.329271 (MainThread): Partial parsing not enabled
2021-02-21 16:13:25.366121 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:13:25.386626 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:13:25.396961 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:13:25.407217 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:13:25.418215 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:13:25.428800 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:13:25.447504 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:13:25.482911 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:13:25.682983 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:13:25.683103 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:13:25.683335 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:13:25.683460 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:13:25.683568 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:13:25.683672 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:13:25.721634 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 16:13:25.784407 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:13:25.785372 (MainThread): 
2021-02-21 16:13:25.785690 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:13:25.787120 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:13:25.787263 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:13:29.260398 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:13:29.260636 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:13:29.769050 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:13:30.313463 (MainThread): 17:13:30 | Concurrency: 1 threads (target='dev')
2021-02-21 16:13:30.313653 (MainThread): 17:13:30 | 
2021-02-21 16:13:30.318646 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:13:30.319669 (Thread-1): 17:13:30 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 16:13:30.319934 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:13:30.320074 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:13:30.333261 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:13:30.334083 (Thread-1): finished collecting timing info
2021-02-21 16:13:30.365705 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:13:30.366077 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:13:30.880047 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 16:13:32.471580 (Thread-1): finished collecting timing info
2021-02-21 16:13:32.472331 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9ad718a-0167-4d8a-8cfc-a103765a75fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ee6a60>]}
2021-02-21 16:13:32.473419 (Thread-1): 17:13:32 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 2.15s]
2021-02-21 16:13:32.473553 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:13:32.474687 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:13:32.474960 (MainThread): 17:13:32 | 
2021-02-21 16:13:32.475073 (MainThread): 17:13:32 | Finished running 1 view model in 6.69s.
2021-02-21 16:13:32.475169 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:13:32.475242 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 16:13:32.478579 (MainThread): 
2021-02-21 16:13:32.478702 (MainThread): Completed successfully
2021-02-21 16:13:32.478804 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:13:32.478988 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ecb850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113130eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113130640>]}
2021-02-21 16:13:32.479149 (MainThread): Flushing usage events
2021-02-21 16:13:33.977181 (MainThread): Running with dbt=0.18.1
2021-02-21 16:13:34.331367 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 16:13:34.331954 (MainThread): Tracking: tracking
2021-02-21 16:13:34.337376 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109567b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ca3fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ca3c70>]}
2021-02-21 16:13:34.362512 (MainThread): Partial parsing not enabled
2021-02-21 16:13:34.363592 (MainThread): Parsing macros/etc.sql
2021-02-21 16:13:34.365154 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:13:34.371077 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:13:34.391029 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:13:34.393650 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:13:34.396402 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:13:34.406086 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:13:34.410712 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:13:34.422758 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:13:34.425529 (MainThread): Parsing macros/core.sql
2021-02-21 16:13:34.429469 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:13:34.437932 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:13:34.439561 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:13:34.456594 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:13:34.485375 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:13:34.505281 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:13:34.507175 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:13:34.513515 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:13:34.527054 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:13:34.533696 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:13:34.539718 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:13:34.544524 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:13:34.545425 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:13:34.546688 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:13:34.548252 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:13:34.556653 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:13:34.558608 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:13:34.560215 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:13:34.601610 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:13:34.603399 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:13:34.604841 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:13:34.606554 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:13:34.614030 (MainThread): Partial parsing not enabled
2021-02-21 16:13:34.648486 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:13:34.667742 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:13:34.677519 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:13:34.686717 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:13:34.695755 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:13:34.704719 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:13:34.719561 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:13:34.751882 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:13:34.944723 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:13:34.944837 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:13:34.945064 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:13:34.945190 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:13:34.945297 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:13:34.945401 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:13:34.982676 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 16:13:35.039835 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:13:35.040703 (MainThread): 
2021-02-21 16:13:35.040987 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:13:35.042360 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:13:35.042589 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:13:38.515064 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:13:38.515329 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:13:39.074299 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:13:39.850924 (MainThread): 17:13:39 | Concurrency: 1 threads (target='dev')
2021-02-21 16:13:39.851140 (MainThread): 17:13:39 | 
2021-02-21 16:13:39.854980 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 16:13:39.856185 (Thread-1): 17:13:39 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 16:13:39.856500 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:13:39.856663 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 16:13:39.872029 (Thread-1): finished collecting timing info
2021-02-21 16:13:39.895454 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:13:40.402627 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:13:40.972638 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:13:41.218469 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 16:13:44.185059 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:13:44.408417 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:13:44.640475 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 16:13:44.640654 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:13:45.288272 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:13:45.531520 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 16:13:45.534453 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 16:13:47.905488 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 16:13:49.106614 (Thread-1): finished collecting timing info
2021-02-21 16:13:49.107651 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '803c2429-0bae-4ce3-a22b-51e9980ec048', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d49100>]}
2021-02-21 16:13:49.109345 (Thread-1): 17:13:49 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.25s]
2021-02-21 16:13:49.109525 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 16:13:49.110919 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:13:49.111261 (MainThread): 17:13:49 | 
2021-02-21 16:13:49.111401 (MainThread): 17:13:49 | Finished running 1 snapshot in 14.07s.
2021-02-21 16:13:49.111521 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:13:49.111611 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 16:13:49.115778 (MainThread): 
2021-02-21 16:13:49.115933 (MainThread): Completed successfully
2021-02-21 16:13:49.116068 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:13:49.116299 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e7abe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e686a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e688b0>]}
2021-02-21 16:13:49.116505 (MainThread): Flushing usage events
2021-02-21 16:51:24.308097 (MainThread): Running with dbt=0.18.1
2021-02-21 16:51:24.844891 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 16:51:24.846080 (MainThread): Tracking: tracking
2021-02-21 16:51:24.855083 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a3d8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a4ca00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a4c6a0>]}
2021-02-21 16:51:24.880998 (MainThread): Partial parsing not enabled
2021-02-21 16:51:24.882774 (MainThread): Parsing macros/etc.sql
2021-02-21 16:51:24.884657 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:51:24.891168 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:51:24.909378 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:51:24.912426 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:51:24.915720 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:51:24.926145 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:51:24.931491 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:51:24.945608 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:51:24.949955 (MainThread): Parsing macros/core.sql
2021-02-21 16:51:24.954830 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:51:24.964708 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:51:24.966709 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:51:24.985828 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:51:25.016264 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:51:25.037796 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:51:25.039754 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:51:25.045928 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:51:25.059144 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:51:25.065790 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:51:25.073874 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:51:25.078878 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:51:25.080031 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:51:25.081289 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:51:25.083085 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:51:25.091911 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:51:25.094014 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:51:25.095914 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:51:25.138014 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:51:25.140132 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:51:25.141857 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:51:25.143709 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:51:25.151094 (MainThread): Partial parsing not enabled
2021-02-21 16:51:25.188076 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:51:25.209899 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:51:25.221025 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:51:25.232343 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:51:25.243545 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:51:25.252561 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:51:25.269414 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:51:25.302946 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:51:25.497194 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:51:25.497314 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:51:25.497548 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:51:25.497682 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:51:25.497803 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:51:25.497918 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:51:25.535652 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 16:51:25.594875 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:51:25.595671 (MainThread): 
2021-02-21 16:51:25.595935 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:51:25.597354 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:51:25.597485 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:51:27.288833 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:51:27.289228 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:51:27.739366 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:51:28.168654 (MainThread): 17:51:28 | Concurrency: 1 threads (target='dev')
2021-02-21 16:51:28.168868 (MainThread): 17:51:28 | 
2021-02-21 16:51:28.175712 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:51:28.177016 (Thread-1): 17:51:28 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 16:51:28.177379 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:51:28.177535 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:51:28.191032 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:51:28.192040 (Thread-1): finished collecting timing info
2021-02-21 16:51:28.224908 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:51:28.225834 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:51:28.663719 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 16:51:29.703225 (Thread-1): finished collecting timing info
2021-02-21 16:51:29.703951 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bee4835-3829-4f18-ad24-bf6332fb3be6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cb8d00>]}
2021-02-21 16:51:29.705041 (Thread-1): 17:51:29 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.53s]
2021-02-21 16:51:29.705186 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:51:29.706342 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:51:29.706635 (MainThread): 17:51:29 | 
2021-02-21 16:51:29.706749 (MainThread): 17:51:29 | Finished running 1 view model in 4.11s.
2021-02-21 16:51:29.706848 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:51:29.706921 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 16:51:29.710407 (MainThread): 
2021-02-21 16:51:29.710537 (MainThread): Completed successfully
2021-02-21 16:51:29.710644 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:51:29.710833 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110aeda60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c19a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c19a30>]}
2021-02-21 16:51:29.711006 (MainThread): Flushing usage events
2021-02-21 16:51:31.143663 (MainThread): Running with dbt=0.18.1
2021-02-21 16:51:31.496031 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 16:51:31.496576 (MainThread): Tracking: tracking
2021-02-21 16:51:31.502753 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f11c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f37d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f379a0>]}
2021-02-21 16:51:31.526272 (MainThread): Partial parsing not enabled
2021-02-21 16:51:31.527292 (MainThread): Parsing macros/etc.sql
2021-02-21 16:51:31.528781 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:51:31.535247 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:51:31.553807 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:51:31.556375 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:51:31.559185 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:51:31.571123 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:51:31.575741 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:51:31.588139 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:51:31.590942 (MainThread): Parsing macros/core.sql
2021-02-21 16:51:31.594407 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:51:31.602961 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:51:31.604629 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:51:31.621337 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:51:31.649571 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:51:31.669659 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:51:31.671453 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:51:31.677899 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:51:31.692095 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:51:31.698562 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:51:31.704427 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:51:31.709218 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:51:31.710092 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:51:31.711070 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:51:31.712586 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:51:31.721204 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:51:31.723044 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:51:31.724651 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:51:31.765542 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:51:31.767428 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:51:31.768968 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:51:31.770590 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:51:31.778233 (MainThread): Partial parsing not enabled
2021-02-21 16:51:31.813361 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:51:31.831900 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:51:31.841856 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:51:31.850984 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:51:31.859991 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:51:31.868652 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:51:31.883897 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:51:31.916559 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:51:32.108304 (MainThread): WARNING: Found documentation for resource "wrk_foretak" which was not found or is disabled
2021-02-21 16:51:32.108424 (MainThread): WARNING: Found documentation for resource "wrk_virksomheter" which was not found or is disabled
2021-02-21 16:51:32.108660 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:51:32.108792 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_foretak_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_foretak' which was not found
2021-02-21 16:51:32.108907 (MainThread): [WARNING]: Test 'test.enhetsregisteret.unique_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:51:32.109015 (MainThread): [WARNING]: Test 'test.enhetsregisteret.not_null_wrk_virksomheter_organisasjonsnummer' (models/er/stg/stg_foretak.yml) depends on a node named 'wrk_virksomheter' which was not found
2021-02-21 16:51:32.147186 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 16:51:32.204983 (MainThread): Found 6 models, 0 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:51:32.205711 (MainThread): 
2021-02-21 16:51:32.205954 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:51:32.207229 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:51:32.207343 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:51:33.194415 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:51:33.194687 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:51:33.615192 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:51:34.696637 (MainThread): 17:51:34 | Concurrency: 1 threads (target='dev')
2021-02-21 16:51:34.696854 (MainThread): 17:51:34 | 
2021-02-21 16:51:34.700392 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 16:51:34.701572 (Thread-1): 17:51:34 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 16:51:34.701885 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:51:34.702041 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 16:51:34.716570 (Thread-1): finished collecting timing info
2021-02-21 16:51:34.739814 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:51:35.160347 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:51:35.700304 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:51:35.954528 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 16:51:38.943219 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:51:39.158846 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:51:39.398896 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 16:51:39.399120 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:51:40.091253 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:51:40.308054 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 16:51:40.308697 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 16:51:43.198091 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 16:51:43.895277 (Thread-1): finished collecting timing info
2021-02-21 16:51:43.896298 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6749558-ed05-493d-9c99-f457ab1429ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121afac0>]}
2021-02-21 16:51:43.897979 (Thread-1): 17:51:43 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.19s]
2021-02-21 16:51:43.898161 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 16:51:43.899427 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:51:43.899773 (MainThread): 17:51:43 | 
2021-02-21 16:51:43.899917 (MainThread): 17:51:43 | Finished running 1 snapshot in 11.69s.
2021-02-21 16:51:43.900041 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:51:43.900133 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 16:51:43.904286 (MainThread): 
2021-02-21 16:51:43.904455 (MainThread): Completed successfully
2021-02-21 16:51:43.904587 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:51:43.904806 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112210b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121670d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121679a0>]}
2021-02-21 16:51:43.904998 (MainThread): Flushing usage events
2021-02-21 16:58:07.270350 (MainThread): Running with dbt=0.18.1
2021-02-21 16:58:07.795072 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 16:58:07.796365 (MainThread): Tracking: tracking
2021-02-21 16:58:07.803334 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e831910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e840850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8404f0>]}
2021-02-21 16:58:07.828476 (MainThread): Partial parsing not enabled
2021-02-21 16:58:07.830270 (MainThread): Parsing macros/etc.sql
2021-02-21 16:58:07.834230 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:58:07.840527 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:58:07.859898 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:58:07.862972 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:58:07.865917 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:58:07.875717 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:58:07.880209 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:58:07.893104 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:58:07.897873 (MainThread): Parsing macros/core.sql
2021-02-21 16:58:07.902777 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:58:07.912068 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:58:07.913958 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:58:07.931193 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:58:07.961185 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:58:07.982094 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:58:07.984294 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:58:07.990792 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:58:08.005449 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:58:08.012287 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:58:08.018927 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:58:08.023914 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:58:08.025002 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:58:08.026234 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:58:08.028079 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:58:08.037166 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:58:08.039230 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:58:08.041114 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:58:08.082347 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:58:08.085025 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:58:08.086868 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:58:08.088746 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:58:08.097374 (MainThread): Partial parsing not enabled
2021-02-21 16:58:08.134327 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:58:08.155787 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:58:08.167550 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:58:08.179185 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:58:08.190625 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:58:08.201316 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:58:08.220889 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:58:08.257257 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:58:08.500981 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 16:58:08.562173 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:58:08.563121 (MainThread): 
2021-02-21 16:58:08.563403 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:58:08.564610 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:58:08.564727 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:58:09.785761 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:58:09.786081 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:58:10.225939 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:58:11.106039 (MainThread): 17:58:11 | Concurrency: 1 threads (target='dev')
2021-02-21 16:58:11.106243 (MainThread): 17:58:11 | 
2021-02-21 16:58:11.111194 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:58:11.112234 (Thread-1): 17:58:11 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 16:58:11.112501 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:58:11.112638 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:58:11.125888 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:58:11.126927 (Thread-1): finished collecting timing info
2021-02-21 16:58:11.158486 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 16:58:11.158869 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:58:11.585236 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 16:58:13.086952 (Thread-1): finished collecting timing info
2021-02-21 16:58:13.087833 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a0b73de-4683-4fd2-b13b-d6db6060bc0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8c9af0>]}
2021-02-21 16:58:13.089165 (Thread-1): 17:58:13 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.98s]
2021-02-21 16:58:13.089342 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 16:58:13.090663 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:58:13.091004 (MainThread): 17:58:13 | 
2021-02-21 16:58:13.091146 (MainThread): 17:58:13 | Finished running 1 view model in 4.53s.
2021-02-21 16:58:13.091266 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:58:13.091352 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 16:58:13.095447 (MainThread): 
2021-02-21 16:58:13.095598 (MainThread): Completed successfully
2021-02-21 16:58:13.095727 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:58:13.095953 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e89f070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e9f2790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e9f2a00>]}
2021-02-21 16:58:13.096152 (MainThread): Flushing usage events
2021-02-21 16:58:14.464322 (MainThread): Running with dbt=0.18.1
2021-02-21 16:58:14.825302 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 16:58:14.825859 (MainThread): Tracking: tracking
2021-02-21 16:58:14.830582 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb3dee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110289f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110289c10>]}
2021-02-21 16:58:14.851998 (MainThread): Partial parsing not enabled
2021-02-21 16:58:14.852945 (MainThread): Parsing macros/etc.sql
2021-02-21 16:58:14.854349 (MainThread): Parsing macros/catalog.sql
2021-02-21 16:58:14.860018 (MainThread): Parsing macros/adapters.sql
2021-02-21 16:58:14.880661 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 16:58:14.883209 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 16:58:14.885914 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 16:58:14.895769 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 16:58:14.899829 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 16:58:14.911684 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 16:58:14.914341 (MainThread): Parsing macros/core.sql
2021-02-21 16:58:14.918187 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 16:58:14.926374 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 16:58:14.928228 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 16:58:14.944153 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 16:58:14.971625 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 16:58:14.991181 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 16:58:14.992929 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 16:58:14.998739 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 16:58:15.011737 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 16:58:15.018982 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 16:58:15.024921 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 16:58:15.029623 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 16:58:15.030515 (MainThread): Parsing macros/etc/query.sql
2021-02-21 16:58:15.031510 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 16:58:15.033043 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 16:58:15.041586 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 16:58:15.043388 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 16:58:15.044947 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 16:58:15.085201 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 16:58:15.087113 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 16:58:15.088520 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 16:58:15.090086 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 16:58:15.097282 (MainThread): Partial parsing not enabled
2021-02-21 16:58:15.131431 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 16:58:15.149856 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 16:58:15.159891 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 16:58:15.169069 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 16:58:15.178505 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 16:58:15.186897 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 16:58:15.204638 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:58:15.237661 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 16:58:15.464077 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 16:58:15.519762 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 16:58:15.520662 (MainThread): 
2021-02-21 16:58:15.520910 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:58:15.522062 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 16:58:15.522176 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 16:58:16.436130 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 16:58:16.436406 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 16:58:16.900980 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:58:17.401901 (MainThread): 17:58:17 | Concurrency: 1 threads (target='dev')
2021-02-21 16:58:17.402096 (MainThread): 17:58:17 | 
2021-02-21 16:58:17.406939 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 16:58:17.408045 (Thread-1): 17:58:17 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 16:58:17.408342 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 16:58:17.408479 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 16:58:17.422763 (Thread-1): finished collecting timing info
2021-02-21 16:58:17.446046 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 16:58:17.866208 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:58:18.369158 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:58:18.709913 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 16:58:21.596729 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:58:21.831970 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:58:22.070494 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 16:58:22.070803 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:58:22.735281 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 16:58:22.955100 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 16:58:22.956133 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 16:58:25.087948 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 16:58:25.840786 (Thread-1): finished collecting timing info
2021-02-21 16:58:25.841810 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f05424-2e55-46f3-b826-eca0e373db8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102f8e20>]}
2021-02-21 16:58:25.843544 (Thread-1): 17:58:25 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 8.43s]
2021-02-21 16:58:25.843735 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 16:58:25.845081 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 16:58:25.845472 (MainThread): 17:58:25 | 
2021-02-21 16:58:25.845623 (MainThread): 17:58:25 | Finished running 1 snapshot in 10.32s.
2021-02-21 16:58:25.845749 (MainThread): Connection 'master' was properly closed.
2021-02-21 16:58:25.845842 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 16:58:25.850116 (MainThread): 
2021-02-21 16:58:25.850275 (MainThread): Completed successfully
2021-02-21 16:58:25.850418 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 16:58:25.850651 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11048b550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110437370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110437730>]}
2021-02-21 16:58:25.850853 (MainThread): Flushing usage events
2021-02-21 17:00:53.045452 (MainThread): Running with dbt=0.18.1
2021-02-21 17:00:53.578213 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 17:00:53.579374 (MainThread): Tracking: tracking
2021-02-21 17:00:53.587458 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cecff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6203a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6200a0>]}
2021-02-21 17:00:53.613733 (MainThread): Partial parsing not enabled
2021-02-21 17:00:53.615257 (MainThread): Parsing macros/etc.sql
2021-02-21 17:00:53.617110 (MainThread): Parsing macros/catalog.sql
2021-02-21 17:00:53.623382 (MainThread): Parsing macros/adapters.sql
2021-02-21 17:00:53.643029 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 17:00:53.645999 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 17:00:53.649011 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 17:00:53.658742 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 17:00:53.663293 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 17:00:53.676043 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 17:00:53.679717 (MainThread): Parsing macros/core.sql
2021-02-21 17:00:53.684181 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 17:00:53.694023 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 17:00:53.695921 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 17:00:53.712203 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 17:00:53.740019 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 17:00:53.761842 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 17:00:53.763984 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 17:00:53.770283 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 17:00:53.783997 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 17:00:53.790703 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 17:00:53.797474 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 17:00:53.803292 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 17:00:53.804522 (MainThread): Parsing macros/etc/query.sql
2021-02-21 17:00:53.805949 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 17:00:53.808060 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 17:00:53.817693 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 17:00:53.819779 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 17:00:53.821540 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 17:00:53.864333 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 17:00:53.867050 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 17:00:53.869360 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 17:00:53.871679 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 17:00:53.880357 (MainThread): Partial parsing not enabled
2021-02-21 17:00:53.916517 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 17:00:53.936682 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 17:00:53.947372 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 17:00:53.957096 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 17:00:53.966529 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:00:53.976081 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 17:00:53.992436 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:00:54.028821 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 17:00:54.265611 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 17:00:54.321876 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 17:00:54.322724 (MainThread): 
2021-02-21 17:00:54.323026 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:00:54.324267 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 17:00:54.324429 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 17:00:55.468709 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 17:00:55.469022 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 17:00:55.896409 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:00:56.404726 (MainThread): 18:00:56 | Concurrency: 1 threads (target='dev')
2021-02-21 17:00:56.404950 (MainThread): 18:00:56 | 
2021-02-21 17:00:56.411188 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:00:56.412508 (Thread-1): 18:00:56 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 17:00:56.412863 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:00:56.413026 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:00:56.427544 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 17:00:56.427883 (Thread-1): finished collecting timing info
2021-02-21 17:00:56.460373 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 17:00:56.460843 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 17:00:56.888071 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 17:00:57.859060 (Thread-1): finished collecting timing info
2021-02-21 17:00:57.859953 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9707b5f-26e9-43e4-8612-8b12a45cd206', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7dec40>]}
2021-02-21 17:00:57.861318 (Thread-1): 18:00:57 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.45s]
2021-02-21 17:00:57.861491 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:00:57.862808 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:00:57.863156 (MainThread): 18:00:57 | 
2021-02-21 17:00:57.863296 (MainThread): 18:00:57 | Finished running 1 view model in 3.54s.
2021-02-21 17:00:57.863415 (MainThread): Connection 'master' was properly closed.
2021-02-21 17:00:57.863504 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 17:00:57.867592 (MainThread): 
2021-02-21 17:00:57.867749 (MainThread): Completed successfully
2021-02-21 17:00:57.867878 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 17:00:57.868096 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d6d7b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d63cbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d63cca0>]}
2021-02-21 17:00:57.868289 (MainThread): Flushing usage events
2021-02-21 17:00:59.281652 (MainThread): Running with dbt=0.18.1
2021-02-21 17:00:59.637100 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 17:00:59.637749 (MainThread): Tracking: tracking
2021-02-21 17:00:59.642370 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d08edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7df310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7df040>]}
2021-02-21 17:00:59.662858 (MainThread): Partial parsing not enabled
2021-02-21 17:00:59.663803 (MainThread): Parsing macros/etc.sql
2021-02-21 17:00:59.665258 (MainThread): Parsing macros/catalog.sql
2021-02-21 17:00:59.671281 (MainThread): Parsing macros/adapters.sql
2021-02-21 17:00:59.689479 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 17:00:59.692192 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 17:00:59.694791 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 17:00:59.704392 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 17:00:59.708515 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 17:00:59.722931 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 17:00:59.725642 (MainThread): Parsing macros/core.sql
2021-02-21 17:00:59.728992 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 17:00:59.738287 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 17:00:59.739965 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 17:00:59.755853 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 17:00:59.785834 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 17:00:59.805851 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 17:00:59.807686 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 17:00:59.813809 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 17:00:59.827253 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 17:00:59.833960 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 17:00:59.839979 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 17:00:59.845136 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 17:00:59.846157 (MainThread): Parsing macros/etc/query.sql
2021-02-21 17:00:59.847172 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 17:00:59.848774 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 17:00:59.857174 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 17:00:59.859027 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 17:00:59.860610 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 17:00:59.901078 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 17:00:59.902844 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 17:00:59.904324 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 17:00:59.905927 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 17:00:59.913607 (MainThread): Partial parsing not enabled
2021-02-21 17:00:59.948299 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 17:00:59.966741 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 17:00:59.976418 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 17:00:59.985736 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 17:00:59.994937 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:01:00.003770 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 17:01:00.019214 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:01:00.052453 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 17:01:00.277789 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 17:01:00.334147 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 17:01:00.335210 (MainThread): 
2021-02-21 17:01:00.335464 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:01:00.336621 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 17:01:00.336738 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 17:01:01.187761 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 17:01:01.188059 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 17:01:01.629143 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:01:02.046109 (MainThread): 18:01:02 | Concurrency: 1 threads (target='dev')
2021-02-21 17:01:02.046341 (MainThread): 18:01:02 | 
2021-02-21 17:01:02.050018 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 17:01:02.051189 (Thread-1): 18:01:02 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 17:01:02.051512 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:01:02.051676 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 17:01:02.066557 (Thread-1): finished collecting timing info
2021-02-21 17:01:02.089905 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 17:01:02.513916 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:01:02.953849 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:01:03.196113 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 17:01:06.245972 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:01:06.471852 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:01:06.716757 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 17:01:06.716986 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:01:07.453035 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:01:07.696997 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 17:01:07.697535 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 17:01:09.940942 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 17:01:10.725442 (Thread-1): finished collecting timing info
2021-02-21 17:01:10.726387 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ecbbdd7a-c93b-4789-a4e3-c3524971db1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7f5fa0>]}
2021-02-21 17:01:10.727858 (Thread-1): 18:01:10 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 8.67s]
2021-02-21 17:01:10.728029 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 17:01:10.729230 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:01:10.729551 (MainThread): 18:01:10 | 
2021-02-21 17:01:10.729684 (MainThread): 18:01:10 | Finished running 1 snapshot in 10.39s.
2021-02-21 17:01:10.729798 (MainThread): Connection 'master' was properly closed.
2021-02-21 17:01:10.729883 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 17:01:10.733353 (MainThread): 
2021-02-21 17:01:10.733478 (MainThread): Completed successfully
2021-02-21 17:01:10.733585 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 17:01:10.733773 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d80f8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9ea670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9ea340>]}
2021-02-21 17:01:10.733932 (MainThread): Flushing usage events
2021-02-21 17:20:13.997583 (MainThread): Running with dbt=0.18.1
2021-02-21 17:20:14.522146 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 17:20:14.523101 (MainThread): Tracking: tracking
2021-02-21 17:20:14.531158 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059abeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059b2580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059b2220>]}
2021-02-21 17:20:14.556777 (MainThread): Partial parsing not enabled
2021-02-21 17:20:14.558257 (MainThread): Parsing macros/etc.sql
2021-02-21 17:20:14.559948 (MainThread): Parsing macros/catalog.sql
2021-02-21 17:20:14.566225 (MainThread): Parsing macros/adapters.sql
2021-02-21 17:20:14.585250 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 17:20:14.588153 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 17:20:14.591302 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 17:20:14.600871 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 17:20:14.605228 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 17:20:14.617987 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 17:20:14.621051 (MainThread): Parsing macros/core.sql
2021-02-21 17:20:14.625664 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 17:20:14.636093 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 17:20:14.638271 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 17:20:14.655323 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 17:20:14.683978 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 17:20:14.704454 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 17:20:14.708453 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 17:20:14.717500 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 17:20:14.732971 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 17:20:14.739900 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 17:20:14.746239 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 17:20:14.751642 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 17:20:14.752836 (MainThread): Parsing macros/etc/query.sql
2021-02-21 17:20:14.754090 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 17:20:14.755969 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 17:20:14.764685 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 17:20:14.767017 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 17:20:14.769032 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 17:20:14.811026 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 17:20:14.813369 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 17:20:14.815550 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 17:20:14.817414 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 17:20:14.825653 (MainThread): Partial parsing not enabled
2021-02-21 17:20:14.862665 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 17:20:14.885697 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 17:20:14.895816 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 17:20:14.906432 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 17:20:14.916607 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:20:14.926105 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 17:20:14.941967 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:20:14.977449 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 17:20:15.204180 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 17:20:15.260456 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 17:20:15.261449 (MainThread): 
2021-02-21 17:20:15.261744 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:20:15.263139 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 17:20:15.263270 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 17:20:16.621105 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 17:20:16.621330 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 17:20:17.037160 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:20:17.466206 (MainThread): 18:20:17 | Concurrency: 1 threads (target='dev')
2021-02-21 17:20:17.466416 (MainThread): 18:20:17 | 
2021-02-21 17:20:17.472229 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:20:17.473341 (Thread-1): 18:20:17 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 17:20:17.473650 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:20:17.473792 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:20:17.486849 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 17:20:17.487208 (Thread-1): finished collecting timing info
2021-02-21 17:20:17.518901 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 17:20:17.519329 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 17:20:17.942336 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 17:20:19.284808 (Thread-1): finished collecting timing info
2021-02-21 17:20:19.285678 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4597b61-0d9d-4a7a-ac10-8319e4d7d72d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ceaca0>]}
2021-02-21 17:20:19.286988 (Thread-1): 18:20:19 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.81s]
2021-02-21 17:20:19.287163 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:20:19.288511 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:20:19.288865 (MainThread): 18:20:19 | 
2021-02-21 17:20:19.289007 (MainThread): 18:20:19 | Finished running 1 view model in 4.03s.
2021-02-21 17:20:19.289129 (MainThread): Connection 'master' was properly closed.
2021-02-21 17:20:19.289218 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 17:20:19.293311 (MainThread): 
2021-02-21 17:20:19.293462 (MainThread): Completed successfully
2021-02-21 17:20:19.293589 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 17:20:19.293800 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b96130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a14220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a14760>]}
2021-02-21 17:20:19.293991 (MainThread): Flushing usage events
2021-02-21 17:20:20.669020 (MainThread): Running with dbt=0.18.1
2021-02-21 17:20:21.020907 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 17:20:21.021530 (MainThread): Tracking: tracking
2021-02-21 17:20:21.026249 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10483ae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048444f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104844190>]}
2021-02-21 17:20:21.048016 (MainThread): Partial parsing not enabled
2021-02-21 17:20:21.049056 (MainThread): Parsing macros/etc.sql
2021-02-21 17:20:21.050479 (MainThread): Parsing macros/catalog.sql
2021-02-21 17:20:21.056377 (MainThread): Parsing macros/adapters.sql
2021-02-21 17:20:21.074625 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 17:20:21.077198 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 17:20:21.079953 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 17:20:21.089530 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 17:20:21.093759 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 17:20:21.106054 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 17:20:21.108922 (MainThread): Parsing macros/core.sql
2021-02-21 17:20:21.112300 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 17:20:21.120610 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 17:20:21.122385 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 17:20:21.138763 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 17:20:21.166412 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 17:20:21.186341 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 17:20:21.188097 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 17:20:21.193980 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 17:20:21.206891 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 17:20:21.213807 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 17:20:21.219702 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 17:20:21.224275 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 17:20:21.225265 (MainThread): Parsing macros/etc/query.sql
2021-02-21 17:20:21.226345 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 17:20:21.227836 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 17:20:21.236162 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 17:20:21.238066 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 17:20:21.239640 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 17:20:21.280072 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 17:20:21.281889 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 17:20:21.283314 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 17:20:21.285004 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 17:20:21.292519 (MainThread): Partial parsing not enabled
2021-02-21 17:20:21.326552 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 17:20:21.345331 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 17:20:21.355630 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 17:20:21.365302 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 17:20:21.374653 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:20:21.382827 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 17:20:21.397866 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:20:21.429733 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 17:20:21.659898 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 17:20:21.716401 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 17:20:21.717469 (MainThread): 
2021-02-21 17:20:21.717720 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:20:21.719006 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 17:20:21.719126 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 17:20:22.592246 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 17:20:22.592528 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 17:20:23.010973 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:20:23.614027 (MainThread): 18:20:23 | Concurrency: 1 threads (target='dev')
2021-02-21 17:20:23.614220 (MainThread): 18:20:23 | 
2021-02-21 17:20:23.617257 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 17:20:23.618261 (Thread-1): 18:20:23 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 17:20:23.618529 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:20:23.618670 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 17:20:23.632792 (Thread-1): finished collecting timing info
2021-02-21 17:20:23.655885 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 17:20:24.070108 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:20:24.676752 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:20:24.950046 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 17:20:28.686201 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:20:28.930716 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:20:29.181120 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 17:20:29.181333 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:20:29.812126 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:20:30.054541 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 17:20:30.055111 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 17:20:32.711367 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 17:20:33.495065 (Thread-1): finished collecting timing info
2021-02-21 17:20:33.496086 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c44508ed-8c06-4a1a-9e5e-b19427096c54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048da4c0>]}
2021-02-21 17:20:33.497757 (Thread-1): 18:20:33 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.88s]
2021-02-21 17:20:33.497945 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 17:20:33.499253 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:20:33.499596 (MainThread): 18:20:33 | 
2021-02-21 17:20:33.499742 (MainThread): 18:20:33 | Finished running 1 snapshot in 11.78s.
2021-02-21 17:20:33.499869 (MainThread): Connection 'master' was properly closed.
2021-02-21 17:20:33.499963 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 17:20:33.504068 (MainThread): 
2021-02-21 17:20:33.504221 (MainThread): Completed successfully
2021-02-21 17:20:33.504358 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 17:20:33.504582 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a1fa00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a4fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a4f730>]}
2021-02-21 17:20:33.504775 (MainThread): Flushing usage events
2021-02-21 17:22:34.779076 (MainThread): Running with dbt=0.18.1
2021-02-21 17:22:35.237022 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 17:22:35.237922 (MainThread): Tracking: tracking
2021-02-21 17:22:35.243724 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b08cdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0964c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b096160>]}
2021-02-21 17:22:35.265216 (MainThread): Partial parsing not enabled
2021-02-21 17:22:35.266820 (MainThread): Parsing macros/etc.sql
2021-02-21 17:22:35.269016 (MainThread): Parsing macros/catalog.sql
2021-02-21 17:22:35.275039 (MainThread): Parsing macros/adapters.sql
2021-02-21 17:22:35.293173 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 17:22:35.296006 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 17:22:35.298859 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 17:22:35.308738 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 17:22:35.313273 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 17:22:35.326093 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 17:22:35.329765 (MainThread): Parsing macros/core.sql
2021-02-21 17:22:35.334328 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 17:22:35.344453 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 17:22:35.346642 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 17:22:35.364462 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 17:22:35.392345 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 17:22:35.413924 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 17:22:35.415971 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 17:22:35.422652 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 17:22:35.437118 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 17:22:35.443720 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 17:22:35.451040 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 17:22:35.456716 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 17:22:35.457871 (MainThread): Parsing macros/etc/query.sql
2021-02-21 17:22:35.459148 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 17:22:35.461027 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 17:22:35.469701 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 17:22:35.471727 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 17:22:35.473539 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 17:22:35.513608 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 17:22:35.516100 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 17:22:35.517931 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 17:22:35.519845 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 17:22:35.527674 (MainThread): Partial parsing not enabled
2021-02-21 17:22:35.563674 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 17:22:35.583653 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 17:22:35.595158 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 17:22:35.605769 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 17:22:35.615550 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:22:35.625141 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 17:22:35.641795 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:22:35.676344 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 17:22:35.907820 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 17:22:35.963230 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 17:22:35.964178 (MainThread): 
2021-02-21 17:22:35.964508 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:22:35.965855 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 17:22:35.966072 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 17:22:37.224755 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 17:22:37.225031 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 17:22:37.649680 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:22:38.307794 (MainThread): 18:22:38 | Concurrency: 1 threads (target='dev')
2021-02-21 17:22:38.308017 (MainThread): 18:22:38 | 
2021-02-21 17:22:38.314210 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:22:38.315527 (Thread-1): 18:22:38 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 17:22:38.315894 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:22:38.316062 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:22:38.330560 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 17:22:38.330915 (Thread-1): finished collecting timing info
2021-02-21 17:22:38.363483 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 17:22:38.363921 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 17:22:38.784330 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 17:22:41.056597 (Thread-1): finished collecting timing info
2021-02-21 17:22:41.057333 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a424d7f2-0f19-4530-844e-7373b6f58adf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0ef700>]}
2021-02-21 17:22:41.058418 (Thread-1): 18:22:41 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 2.74s]
2021-02-21 17:22:41.058555 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 17:22:41.059667 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:22:41.059948 (MainThread): 18:22:41 | 
2021-02-21 17:22:41.060062 (MainThread): 18:22:41 | Finished running 1 view model in 5.10s.
2021-02-21 17:22:41.060159 (MainThread): Connection 'master' was properly closed.
2021-02-21 17:22:41.060232 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 17:22:41.063555 (MainThread): 
2021-02-21 17:22:41.063673 (MainThread): Completed successfully
2021-02-21 17:22:41.063775 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 17:22:41.063952 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0b1a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2d3190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b21a4c0>]}
2021-02-21 17:22:41.064105 (MainThread): Flushing usage events
2021-02-21 17:22:42.405115 (MainThread): Running with dbt=0.18.1
2021-02-21 17:22:42.754057 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 17:22:42.754937 (MainThread): Tracking: tracking
2021-02-21 17:22:42.760185 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ded850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e029a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e02640>]}
2021-02-21 17:22:42.785837 (MainThread): Partial parsing not enabled
2021-02-21 17:22:42.786897 (MainThread): Parsing macros/etc.sql
2021-02-21 17:22:42.788461 (MainThread): Parsing macros/catalog.sql
2021-02-21 17:22:42.794234 (MainThread): Parsing macros/adapters.sql
2021-02-21 17:22:42.812712 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 17:22:42.815376 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 17:22:42.818354 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 17:22:42.828326 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 17:22:42.832716 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 17:22:42.845522 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 17:22:42.848419 (MainThread): Parsing macros/core.sql
2021-02-21 17:22:42.852023 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 17:22:42.861043 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 17:22:42.862749 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 17:22:42.879206 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 17:22:42.906636 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 17:22:42.926740 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 17:22:42.928443 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 17:22:42.934458 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 17:22:42.947794 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 17:22:42.954451 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 17:22:42.960484 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 17:22:42.965557 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 17:22:42.966544 (MainThread): Parsing macros/etc/query.sql
2021-02-21 17:22:42.967532 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 17:22:42.969053 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 17:22:42.977646 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 17:22:42.979490 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 17:22:42.981071 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 17:22:43.022432 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 17:22:43.024466 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 17:22:43.026041 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 17:22:43.027637 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 17:22:43.035038 (MainThread): Partial parsing not enabled
2021-02-21 17:22:43.070709 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 17:22:43.089501 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 17:22:43.098566 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 17:22:43.108165 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 17:22:43.117562 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 17:22:43.125998 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 17:22:43.141435 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:22:43.174542 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 17:22:43.403464 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 17:22:43.460428 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 17:22:43.461264 (MainThread): 
2021-02-21 17:22:43.461509 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:22:43.462661 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 17:22:43.462777 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 17:22:45.608819 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 17:22:45.609119 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 17:22:46.027118 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:22:46.539519 (MainThread): 18:22:46 | Concurrency: 1 threads (target='dev')
2021-02-21 17:22:46.539740 (MainThread): 18:22:46 | 
2021-02-21 17:22:46.543340 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 17:22:46.544560 (Thread-1): 18:22:46 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 17:22:46.544878 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 17:22:46.545048 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 17:22:46.560498 (Thread-1): finished collecting timing info
2021-02-21 17:22:46.584049 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 17:22:47.013093 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:22:47.563787 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:22:47.832573 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 17:22:50.852492 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:22:51.244075 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:22:51.480046 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 17:22:51.480253 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:22:52.941957 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 17:22:53.238632 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 17:22:53.239154 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 17:22:55.750786 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 56339, 0, 0), raddr=('2a00:1450:400f:806::200a', 443, 0, 0)>
2021-02-21 17:22:55.751017 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 56341, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 17:22:55.751174 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 56343, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 17:22:55.751320 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 56342, 0, 0), raddr=('2a00:1450:400f:806::200a', 443, 0, 0)>
2021-02-21 17:22:55.759198 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 17:22:56.716255 (Thread-1): finished collecting timing info
2021-02-21 17:22:56.717340 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'effc3d7d-0d3d-478e-a4f4-6649ef7f307e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ec1d00>]}
2021-02-21 17:22:56.719027 (Thread-1): 18:22:56 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 10.17s]
2021-02-21 17:22:56.719208 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 17:22:56.720404 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 17:22:56.720755 (MainThread): 18:22:56 | 
2021-02-21 17:22:56.720935 (MainThread): 18:22:56 | Finished running 1 snapshot in 13.26s.
2021-02-21 17:22:56.721090 (MainThread): Connection 'master' was properly closed.
2021-02-21 17:22:56.721188 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 17:22:56.725362 (MainThread): 
2021-02-21 17:22:56.725514 (MainThread): Completed successfully
2021-02-21 17:22:56.725643 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 17:22:56.725859 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e6f820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fff220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e299a0>]}
2021-02-21 17:22:56.726052 (MainThread): Flushing usage events
2021-02-21 20:37:13.293993 (MainThread): Running with dbt=0.18.1
2021-02-21 20:37:13.827713 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 20:37:13.828872 (MainThread): Tracking: tracking
2021-02-21 20:37:13.837745 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038f7fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104046cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104046fd0>]}
2021-02-21 20:37:13.863273 (MainThread): Partial parsing not enabled
2021-02-21 20:37:13.865302 (MainThread): Parsing macros/etc.sql
2021-02-21 20:37:13.867302 (MainThread): Parsing macros/catalog.sql
2021-02-21 20:37:13.874110 (MainThread): Parsing macros/adapters.sql
2021-02-21 20:37:13.893712 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 20:37:13.896779 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 20:37:13.899844 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 20:37:13.911100 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 20:37:13.916122 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 20:37:13.928797 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 20:37:13.932804 (MainThread): Parsing macros/core.sql
2021-02-21 20:37:13.936779 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 20:37:13.945490 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 20:37:13.947732 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 20:37:13.967448 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 20:37:13.995887 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 20:37:14.016568 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 20:37:14.018635 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 20:37:14.024987 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 20:37:14.041400 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 20:37:14.049340 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 20:37:14.056003 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 20:37:14.061692 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 20:37:14.062952 (MainThread): Parsing macros/etc/query.sql
2021-02-21 20:37:14.064656 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 20:37:14.066445 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 20:37:14.076564 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 20:37:14.079666 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 20:37:14.081677 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 20:37:14.124621 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 20:37:14.129154 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 20:37:14.132274 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 20:37:14.134829 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 20:37:14.143892 (MainThread): Partial parsing not enabled
2021-02-21 20:37:14.183268 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 20:37:14.206436 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 20:37:14.218897 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 20:37:14.231419 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 20:37:14.243997 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:37:14.255450 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 20:37:14.274222 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:37:14.311349 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 20:37:14.547703 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 20:37:14.607379 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 20:37:14.608361 (MainThread): 
2021-02-21 20:37:14.608649 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:37:14.610006 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 20:37:14.610237 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 20:37:16.978229 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 20:37:16.978498 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 20:37:17.404738 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:37:17.934128 (MainThread): 21:37:17 | Concurrency: 1 threads (target='dev')
2021-02-21 20:37:17.934452 (MainThread): 21:37:17 | 
2021-02-21 20:37:17.939612 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:37:17.940828 (Thread-1): 21:37:17 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 20:37:17.941145 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:37:17.941302 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:37:17.954839 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 20:37:17.956306 (Thread-1): finished collecting timing info
2021-02-21 20:37:17.988288 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 20:37:17.989538 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 20:37:18.415768 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 20:37:19.671208 (Thread-1): finished collecting timing info
2021-02-21 20:37:19.671958 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89de6afc-f3b6-465c-a349-48e7eb8cd62a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038f7f40>]}
2021-02-21 20:37:19.673056 (Thread-1): 21:37:19 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.73s]
2021-02-21 20:37:19.673208 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:37:19.675210 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:37:19.675559 (MainThread): 21:37:19 | 
2021-02-21 20:37:19.675681 (MainThread): 21:37:19 | Finished running 1 view model in 5.07s.
2021-02-21 20:37:19.675779 (MainThread): Connection 'master' was properly closed.
2021-02-21 20:37:19.675851 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 20:37:19.679924 (MainThread): 
2021-02-21 20:37:19.680067 (MainThread): Completed successfully
2021-02-21 20:37:19.680180 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 20:37:19.680378 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042150a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040717f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104071790>]}
2021-02-21 20:37:19.680572 (MainThread): Flushing usage events
2021-02-21 20:37:21.331175 (MainThread): Running with dbt=0.18.1
2021-02-21 20:37:21.684108 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 20:37:21.684649 (MainThread): Tracking: tracking
2021-02-21 20:37:21.690021 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e9adf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045ed2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045ed040>]}
2021-02-21 20:37:21.710815 (MainThread): Partial parsing not enabled
2021-02-21 20:37:21.711825 (MainThread): Parsing macros/etc.sql
2021-02-21 20:37:21.713217 (MainThread): Parsing macros/catalog.sql
2021-02-21 20:37:21.720346 (MainThread): Parsing macros/adapters.sql
2021-02-21 20:37:21.741321 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 20:37:21.743899 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 20:37:21.746595 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 20:37:21.756224 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 20:37:21.760288 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 20:37:21.773321 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 20:37:21.776086 (MainThread): Parsing macros/core.sql
2021-02-21 20:37:21.779535 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 20:37:21.787939 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 20:37:21.789599 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 20:37:21.805888 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 20:37:21.834764 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 20:37:21.854615 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 20:37:21.856493 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 20:37:21.862697 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 20:37:21.876355 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 20:37:21.883607 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 20:37:21.889686 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 20:37:21.894464 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 20:37:21.895343 (MainThread): Parsing macros/etc/query.sql
2021-02-21 20:37:21.896330 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 20:37:21.898061 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 20:37:21.906257 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 20:37:21.908077 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 20:37:21.909639 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 20:37:21.950411 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 20:37:21.952181 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 20:37:21.953610 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 20:37:21.955201 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 20:37:21.962522 (MainThread): Partial parsing not enabled
2021-02-21 20:37:21.998327 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 20:37:22.017664 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 20:37:22.028783 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 20:37:22.038464 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 20:37:22.047779 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:37:22.056537 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 20:37:22.072854 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:37:22.104828 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 20:37:22.331230 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 20:37:22.389477 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 20:37:22.390387 (MainThread): 
2021-02-21 20:37:22.390649 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:37:22.391791 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 20:37:22.391908 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 20:37:23.364297 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 20:37:23.364585 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 20:37:23.795140 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:37:24.615432 (MainThread): 21:37:24 | Concurrency: 1 threads (target='dev')
2021-02-21 20:37:24.615651 (MainThread): 21:37:24 | 
2021-02-21 20:37:24.619267 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 20:37:24.620537 (Thread-1): 21:37:24 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 20:37:24.620869 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:37:24.621033 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 20:37:24.637232 (Thread-1): finished collecting timing info
2021-02-21 20:37:24.660643 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 20:37:25.093931 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:37:26.695560 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:37:26.973259 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 20:37:29.945073 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:37:30.180498 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:37:30.411396 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 20:37:30.411567 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:37:31.081292 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:37:31.299487 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 20:37:31.300135 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 20:37:33.685266 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 59831, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-21 20:37:33.685480 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 59832, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 20:37:33.685628 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 59834, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 20:37:33.685769 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 59833, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-21 20:37:33.692662 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 20:37:34.455180 (Thread-1): finished collecting timing info
2021-02-21 20:37:34.456194 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a432c2ff-bf60-4b3b-86e6-2d21c31433ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046875b0>]}
2021-02-21 20:37:34.457873 (Thread-1): 21:37:34 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.84s]
2021-02-21 20:37:34.458052 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 20:37:34.459343 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:37:34.459671 (MainThread): 21:37:34 | 
2021-02-21 20:37:34.459808 (MainThread): 21:37:34 | Finished running 1 snapshot in 12.07s.
2021-02-21 20:37:34.459923 (MainThread): Connection 'master' was properly closed.
2021-02-21 20:37:34.460010 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 20:37:34.464063 (MainThread): 
2021-02-21 20:37:34.464210 (MainThread): Completed successfully
2021-02-21 20:37:34.464333 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 20:37:34.464543 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10476d1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10476d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10476d5b0>]}
2021-02-21 20:37:34.464732 (MainThread): Flushing usage events
2021-02-21 20:52:38.366408 (MainThread): Running with dbt=0.18.1
2021-02-21 20:52:38.902771 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 20:52:38.904138 (MainThread): Tracking: tracking
2021-02-21 20:52:38.912531 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad77dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad82490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad82130>]}
2021-02-21 20:52:38.937361 (MainThread): Partial parsing not enabled
2021-02-21 20:52:38.939243 (MainThread): Parsing macros/etc.sql
2021-02-21 20:52:38.941090 (MainThread): Parsing macros/catalog.sql
2021-02-21 20:52:38.947598 (MainThread): Parsing macros/adapters.sql
2021-02-21 20:52:38.968354 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 20:52:38.971947 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 20:52:38.974886 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 20:52:38.987824 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 20:52:38.993692 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 20:52:39.006499 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 20:52:39.010938 (MainThread): Parsing macros/core.sql
2021-02-21 20:52:39.015753 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 20:52:39.025784 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 20:52:39.027760 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 20:52:39.044703 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 20:52:39.073121 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 20:52:39.093320 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 20:52:39.095390 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 20:52:39.101561 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 20:52:39.114835 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 20:52:39.121915 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 20:52:39.128304 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 20:52:39.133322 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 20:52:39.134408 (MainThread): Parsing macros/etc/query.sql
2021-02-21 20:52:39.135739 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 20:52:39.137815 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 20:52:39.146936 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 20:52:39.149094 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 20:52:39.150982 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 20:52:39.191663 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 20:52:39.193957 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 20:52:39.195715 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 20:52:39.197715 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 20:52:39.205895 (MainThread): Partial parsing not enabled
2021-02-21 20:52:39.245523 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 20:52:39.266010 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 20:52:39.277598 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 20:52:39.288036 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 20:52:39.299057 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:52:39.309605 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 20:52:39.328830 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:52:39.364108 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 20:52:39.608341 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 20:52:39.666081 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 20:52:39.667063 (MainThread): 
2021-02-21 20:52:39.667375 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:52:39.669074 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 20:52:39.669209 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 20:52:41.482697 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 20:52:41.482932 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 20:52:41.934532 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:52:42.458012 (MainThread): 21:52:42 | Concurrency: 1 threads (target='dev')
2021-02-21 20:52:42.458204 (MainThread): 21:52:42 | 
2021-02-21 20:52:42.463994 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:52:42.465083 (Thread-1): 21:52:42 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 20:52:42.465379 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:52:42.465524 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:52:42.478546 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 20:52:42.479392 (Thread-1): finished collecting timing info
2021-02-21 20:52:42.512157 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 20:52:42.512591 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 20:52:42.948289 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 20:52:44.137483 (Thread-1): finished collecting timing info
2021-02-21 20:52:44.138333 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abea3194-29c9-4b7f-a0f0-e38090e97918', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af1b0d0>]}
2021-02-21 20:52:44.139560 (Thread-1): 21:52:44 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.67s]
2021-02-21 20:52:44.139731 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:52:44.141003 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:52:44.141316 (MainThread): 21:52:44 | 
2021-02-21 20:52:44.141439 (MainThread): 21:52:44 | Finished running 1 view model in 4.47s.
2021-02-21 20:52:44.141547 (MainThread): Connection 'master' was properly closed.
2021-02-21 20:52:44.141627 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 20:52:44.146603 (MainThread): 
2021-02-21 20:52:44.146785 (MainThread): Completed successfully
2021-02-21 20:52:44.146907 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 20:52:44.147129 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af2a490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af2a520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afd50a0>]}
2021-02-21 20:52:44.147356 (MainThread): Flushing usage events
2021-02-21 20:52:45.591773 (MainThread): Running with dbt=0.18.1
2021-02-21 20:52:45.957361 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 20:52:45.957983 (MainThread): Tracking: tracking
2021-02-21 20:52:45.963286 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ef2df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109645250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109645130>]}
2021-02-21 20:52:45.984948 (MainThread): Partial parsing not enabled
2021-02-21 20:52:45.985887 (MainThread): Parsing macros/etc.sql
2021-02-21 20:52:45.987439 (MainThread): Parsing macros/catalog.sql
2021-02-21 20:52:45.993367 (MainThread): Parsing macros/adapters.sql
2021-02-21 20:52:46.011758 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 20:52:46.014449 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 20:52:46.017312 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 20:52:46.027861 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 20:52:46.033195 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 20:52:46.046629 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 20:52:46.049507 (MainThread): Parsing macros/core.sql
2021-02-21 20:52:46.053157 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 20:52:46.061761 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 20:52:46.063543 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 20:52:46.080684 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 20:52:46.109129 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 20:52:46.129957 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 20:52:46.131688 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 20:52:46.137969 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 20:52:46.151498 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 20:52:46.158397 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 20:52:46.164705 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 20:52:46.169961 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 20:52:46.170849 (MainThread): Parsing macros/etc/query.sql
2021-02-21 20:52:46.172076 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 20:52:46.173726 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 20:52:46.182124 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 20:52:46.183991 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 20:52:46.185853 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 20:52:46.228479 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 20:52:46.230312 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 20:52:46.231785 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 20:52:46.233447 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 20:52:46.241301 (MainThread): Partial parsing not enabled
2021-02-21 20:52:46.277213 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 20:52:46.297256 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 20:52:46.307105 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 20:52:46.317034 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 20:52:46.326756 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:52:46.335230 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 20:52:46.350655 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:52:46.384514 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 20:52:46.615447 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 20:52:46.672869 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 20:52:46.673713 (MainThread): 
2021-02-21 20:52:46.673963 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:52:46.675312 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 20:52:46.675439 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 20:52:47.699205 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 20:52:47.699477 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 20:52:48.131621 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:52:48.649099 (MainThread): 21:52:48 | Concurrency: 1 threads (target='dev')
2021-02-21 20:52:48.649293 (MainThread): 21:52:48 | 
2021-02-21 20:52:48.652405 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 20:52:48.653424 (Thread-1): 21:52:48 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 20:52:48.653698 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:52:48.653836 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 20:52:48.668253 (Thread-1): finished collecting timing info
2021-02-21 20:52:48.691946 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 20:52:49.116049 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:52:49.562971 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:52:49.834844 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 20:52:52.694901 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:52:52.941182 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:52:53.194063 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 20:52:53.194284 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:52:53.866115 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:52:54.111096 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 20:52:54.112100 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 20:52:56.109012 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60127, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 20:52:56.109227 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60128, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 20:52:56.109375 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60130, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 20:52:56.109515 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60129, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-21 20:52:56.117574 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 20:52:56.889395 (Thread-1): finished collecting timing info
2021-02-21 20:52:56.890407 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51e0e02c-b82b-493e-ad0c-1c64e36b8b18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096c9e80>]}
2021-02-21 20:52:56.892099 (Thread-1): 21:52:56 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 8.24s]
2021-02-21 20:52:56.892274 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 20:52:56.893554 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:52:56.893901 (MainThread): 21:52:56 | 
2021-02-21 20:52:56.894049 (MainThread): 21:52:56 | Finished running 1 snapshot in 10.22s.
2021-02-21 20:52:56.894216 (MainThread): Connection 'master' was properly closed.
2021-02-21 20:52:56.894356 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 20:52:56.898577 (MainThread): 
2021-02-21 20:52:56.898734 (MainThread): Completed successfully
2021-02-21 20:52:56.898867 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 20:52:56.899084 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109891160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109707d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109707610>]}
2021-02-21 20:52:56.899281 (MainThread): Flushing usage events
2021-02-21 20:56:42.110324 (MainThread): Running with dbt=0.18.1
2021-02-21 20:56:42.613665 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 20:56:42.614899 (MainThread): Tracking: tracking
2021-02-21 20:56:42.641666 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088dcdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10902e1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10902e0d0>]}
2021-02-21 20:56:42.666632 (MainThread): Partial parsing not enabled
2021-02-21 20:56:42.668190 (MainThread): Parsing macros/etc.sql
2021-02-21 20:56:42.670354 (MainThread): Parsing macros/catalog.sql
2021-02-21 20:56:42.677364 (MainThread): Parsing macros/adapters.sql
2021-02-21 20:56:42.698989 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 20:56:42.702424 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 20:56:42.705890 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 20:56:42.717751 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 20:56:42.722547 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 20:56:42.736312 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 20:56:42.740389 (MainThread): Parsing macros/core.sql
2021-02-21 20:56:42.744509 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 20:56:42.754290 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 20:56:42.756215 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 20:56:42.773641 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 20:56:42.802509 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 20:56:42.824514 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 20:56:42.826509 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 20:56:42.832793 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 20:56:42.848489 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 20:56:42.855333 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 20:56:42.861765 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 20:56:42.867003 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 20:56:42.868141 (MainThread): Parsing macros/etc/query.sql
2021-02-21 20:56:42.869396 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 20:56:42.871366 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 20:56:42.881332 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 20:56:42.883509 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 20:56:42.885311 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 20:56:42.934012 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 20:56:42.936189 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 20:56:42.938045 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 20:56:42.939909 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 20:56:42.949834 (MainThread): Partial parsing not enabled
2021-02-21 20:56:42.988959 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 20:56:43.009706 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 20:56:43.021200 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 20:56:43.031842 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 20:56:43.041671 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:56:43.051034 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 20:56:43.067254 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:56:43.105510 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 20:56:43.353315 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 20:56:43.411342 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 20:56:43.412265 (MainThread): 
2021-02-21 20:56:43.412530 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:56:43.414051 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 20:56:43.414178 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 20:56:44.650822 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 20:56:44.651104 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 20:56:45.086160 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:56:45.481131 (MainThread): 21:56:45 | Concurrency: 1 threads (target='dev')
2021-02-21 20:56:45.481363 (MainThread): 21:56:45 | 
2021-02-21 20:56:45.486765 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:56:45.488007 (Thread-1): 21:56:45 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 20:56:45.488332 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:56:45.488496 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:56:45.503478 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 20:56:45.503893 (Thread-1): finished collecting timing info
2021-02-21 20:56:45.536576 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 20:56:45.537019 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 20:56:45.978467 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 20:56:47.103651 (Thread-1): finished collecting timing info
2021-02-21 20:56:47.104552 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba332ef8-c492-40f0-ab45-20f1a9962307', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c0c10>]}
2021-02-21 20:56:47.105923 (Thread-1): 21:56:47 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.62s]
2021-02-21 20:56:47.106102 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:56:47.107479 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:56:47.107833 (MainThread): 21:56:47 | 
2021-02-21 20:56:47.107975 (MainThread): 21:56:47 | Finished running 1 view model in 3.70s.
2021-02-21 20:56:47.108097 (MainThread): Connection 'master' was properly closed.
2021-02-21 20:56:47.108186 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 20:56:47.112392 (MainThread): 
2021-02-21 20:56:47.112545 (MainThread): Completed successfully
2021-02-21 20:56:47.112678 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 20:56:47.112887 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090e5670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109049f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109049790>]}
2021-02-21 20:56:47.113080 (MainThread): Flushing usage events
2021-02-21 20:56:48.760996 (MainThread): Running with dbt=0.18.1
2021-02-21 20:56:49.205332 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 20:56:49.206016 (MainThread): Tracking: tracking
2021-02-21 20:56:49.212432 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f7edf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d1190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d1070>]}
2021-02-21 20:56:49.238440 (MainThread): Partial parsing not enabled
2021-02-21 20:56:49.240174 (MainThread): Parsing macros/etc.sql
2021-02-21 20:56:49.242774 (MainThread): Parsing macros/catalog.sql
2021-02-21 20:56:49.249214 (MainThread): Parsing macros/adapters.sql
2021-02-21 20:56:49.269569 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 20:56:49.272985 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 20:56:49.276135 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 20:56:49.286683 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 20:56:49.291325 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 20:56:49.304675 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 20:56:49.308087 (MainThread): Parsing macros/core.sql
2021-02-21 20:56:49.312417 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 20:56:49.321998 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 20:56:49.324011 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 20:56:49.340742 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 20:56:49.369398 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 20:56:49.391430 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 20:56:49.393521 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 20:56:49.399833 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 20:56:49.413486 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 20:56:49.420861 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 20:56:49.427075 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 20:56:49.432215 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 20:56:49.433285 (MainThread): Parsing macros/etc/query.sql
2021-02-21 20:56:49.434708 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 20:56:49.436535 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 20:56:49.445863 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 20:56:49.447982 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 20:56:49.449822 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 20:56:49.491758 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 20:56:49.494099 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 20:56:49.495958 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 20:56:49.497637 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 20:56:49.504890 (MainThread): Partial parsing not enabled
2021-02-21 20:56:49.545175 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 20:56:49.567627 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 20:56:49.579379 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 20:56:49.590778 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 20:56:49.601224 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:56:49.611080 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 20:56:49.628331 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:56:49.666795 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 20:56:49.911597 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 20:56:49.970751 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 20:56:49.971650 (MainThread): 
2021-02-21 20:56:49.971920 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:56:49.973128 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 20:56:49.973347 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 20:56:50.883855 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 20:56:50.884140 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 20:56:51.321185 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:56:51.851353 (MainThread): 21:56:51 | Concurrency: 1 threads (target='dev')
2021-02-21 20:56:51.851555 (MainThread): 21:56:51 | 
2021-02-21 20:56:51.855779 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 20:56:51.856832 (Thread-1): 21:56:51 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 20:56:51.857119 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:56:51.857256 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 20:56:51.871860 (Thread-1): finished collecting timing info
2021-02-21 20:56:51.894974 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 20:56:52.360123 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:56:54.119687 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:56:54.363516 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 20:56:57.109682 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:56:57.327246 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:56:57.550988 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 20:56:57.551185 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:56:58.250848 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:56:58.473086 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 20:56:58.473613 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 20:57:00.820313 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60256, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-21 20:57:00.820547 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60257, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 20:57:00.820706 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60259, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 20:57:00.820855 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60258, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-21 20:57:00.828972 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 20:57:01.588739 (Thread-1): finished collecting timing info
2021-02-21 20:57:01.589689 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d26bc2c-9c36-4930-9f2a-29ef4595e9cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068aacd0>]}
2021-02-21 20:57:01.591235 (Thread-1): 21:57:01 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.73s]
2021-02-21 20:57:01.591414 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 20:57:01.592697 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:57:01.593039 (MainThread): 21:57:01 | 
2021-02-21 20:57:01.593185 (MainThread): 21:57:01 | Finished running 1 snapshot in 11.62s.
2021-02-21 20:57:01.593308 (MainThread): Connection 'master' was properly closed.
2021-02-21 20:57:01.593399 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 20:57:01.597508 (MainThread): 
2021-02-21 20:57:01.597658 (MainThread): Completed successfully
2021-02-21 20:57:01.597788 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 20:57:01.598006 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff71f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10691c1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10691c520>]}
2021-02-21 20:57:01.598197 (MainThread): Flushing usage events
2021-02-21 20:58:45.426504 (MainThread): Running with dbt=0.18.1
2021-02-21 20:58:45.963412 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 20:58:45.964726 (MainThread): Tracking: tracking
2021-02-21 20:58:45.971758 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4b3940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4d0a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4d0730>]}
2021-02-21 20:58:45.996217 (MainThread): Partial parsing not enabled
2021-02-21 20:58:45.998168 (MainThread): Parsing macros/etc.sql
2021-02-21 20:58:45.999973 (MainThread): Parsing macros/catalog.sql
2021-02-21 20:58:46.006911 (MainThread): Parsing macros/adapters.sql
2021-02-21 20:58:46.032540 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 20:58:46.036245 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 20:58:46.039770 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 20:58:46.052932 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 20:58:46.058312 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 20:58:46.073425 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 20:58:46.077716 (MainThread): Parsing macros/core.sql
2021-02-21 20:58:46.082182 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 20:58:46.091998 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 20:58:46.093931 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 20:58:46.111675 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 20:58:46.143120 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 20:58:46.164541 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 20:58:46.166856 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 20:58:46.174101 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 20:58:46.189989 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 20:58:46.196944 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 20:58:46.206142 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 20:58:46.212396 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 20:58:46.213675 (MainThread): Parsing macros/etc/query.sql
2021-02-21 20:58:46.215260 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 20:58:46.217329 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 20:58:46.227506 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 20:58:46.229845 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 20:58:46.231911 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 20:58:46.274042 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 20:58:46.276664 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 20:58:46.278553 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 20:58:46.280489 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 20:58:46.287888 (MainThread): Partial parsing not enabled
2021-02-21 20:58:46.326082 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 20:58:46.346352 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 20:58:46.358810 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 20:58:46.370991 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 20:58:46.383178 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:58:46.394538 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 20:58:46.413790 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:58:46.449497 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 20:58:46.681375 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 20:58:46.739374 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 20:58:46.740584 (MainThread): 
2021-02-21 20:58:46.740839 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:58:46.741994 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 20:58:46.742111 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 20:58:48.339210 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 20:58:48.339491 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 20:58:48.772964 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:58:49.377320 (MainThread): 21:58:49 | Concurrency: 1 threads (target='dev')
2021-02-21 20:58:49.377545 (MainThread): 21:58:49 | 
2021-02-21 20:58:49.383703 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:58:49.385040 (Thread-1): 21:58:49 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 20:58:49.385399 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:58:49.385560 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:58:49.399922 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 20:58:49.400330 (Thread-1): finished collecting timing info
2021-02-21 20:58:49.432337 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 20:58:49.432781 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 20:58:49.864487 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 20:58:51.225896 (Thread-1): finished collecting timing info
2021-02-21 20:58:51.226622 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0cb8443-5398-495d-8440-8d59c1f71782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c68b040>]}
2021-02-21 20:58:51.227704 (Thread-1): 21:58:51 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.84s]
2021-02-21 20:58:51.227849 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 20:58:51.228952 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:58:51.229236 (MainThread): 21:58:51 | 
2021-02-21 20:58:51.229354 (MainThread): 21:58:51 | Finished running 1 view model in 4.49s.
2021-02-21 20:58:51.229452 (MainThread): Connection 'master' was properly closed.
2021-02-21 20:58:51.229526 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 20:58:51.232955 (MainThread): 
2021-02-21 20:58:51.233129 (MainThread): Completed successfully
2021-02-21 20:58:51.233269 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 20:58:51.233460 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c655670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c527370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6a7970>]}
2021-02-21 20:58:51.233631 (MainThread): Flushing usage events
2021-02-21 20:58:52.669733 (MainThread): Running with dbt=0.18.1
2021-02-21 20:58:53.031837 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 20:58:53.032544 (MainThread): Tracking: tracking
2021-02-21 20:58:53.038023 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f64ee80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fd99d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fda2130>]}
2021-02-21 20:58:53.062329 (MainThread): Partial parsing not enabled
2021-02-21 20:58:53.063503 (MainThread): Parsing macros/etc.sql
2021-02-21 20:58:53.065541 (MainThread): Parsing macros/catalog.sql
2021-02-21 20:58:53.071752 (MainThread): Parsing macros/adapters.sql
2021-02-21 20:58:53.091550 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 20:58:53.094815 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 20:58:53.097654 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 20:58:53.109396 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 20:58:53.113754 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 20:58:53.126632 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 20:58:53.129418 (MainThread): Parsing macros/core.sql
2021-02-21 20:58:53.133478 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 20:58:53.142585 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 20:58:53.144391 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 20:58:53.161552 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 20:58:53.190465 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 20:58:53.212139 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 20:58:53.213965 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 20:58:53.220128 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 20:58:53.233740 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 20:58:53.241114 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 20:58:53.248017 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 20:58:53.253212 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 20:58:53.254143 (MainThread): Parsing macros/etc/query.sql
2021-02-21 20:58:53.255154 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 20:58:53.256715 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 20:58:53.265628 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 20:58:53.267786 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 20:58:53.269393 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 20:58:53.313055 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 20:58:53.315335 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 20:58:53.316900 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 20:58:53.318547 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 20:58:53.326229 (MainThread): Partial parsing not enabled
2021-02-21 20:58:53.364895 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 20:58:53.386636 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 20:58:53.397472 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 20:58:53.407233 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 20:58:53.416782 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 20:58:53.425442 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 20:58:53.440933 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:58:53.474421 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 20:58:53.712846 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 20:58:53.772380 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 20:58:53.773406 (MainThread): 
2021-02-21 20:58:53.773674 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:58:53.774994 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 20:58:53.775123 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 20:58:54.672959 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 20:58:54.673245 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 20:58:55.137532 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:58:56.138899 (MainThread): 21:58:56 | Concurrency: 1 threads (target='dev')
2021-02-21 20:58:56.139092 (MainThread): 21:58:56 | 
2021-02-21 20:58:56.142019 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 20:58:56.143041 (Thread-1): 21:58:56 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 20:58:56.143298 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 20:58:56.143433 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 20:58:56.156549 (Thread-1): finished collecting timing info
2021-02-21 20:58:56.177456 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 20:58:56.622984 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:58:57.135885 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:58:57.402389 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 20:59:00.736734 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:59:00.949092 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:59:01.187913 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 20:59:01.188104 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:59:01.801133 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 20:59:02.041382 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 20:59:02.041929 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 20:59:04.408918 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60302, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-21 20:59:04.409474 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60303, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 20:59:04.409638 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60305, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-21 20:59:04.409778 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60304, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-21 20:59:04.417020 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 20:59:05.677537 (Thread-1): finished collecting timing info
2021-02-21 20:59:05.678530 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '884b4b83-dadc-4f42-9bd4-5acdb96f2510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff46e20>]}
2021-02-21 20:59:05.680197 (Thread-1): 21:59:05 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 9.53s]
2021-02-21 20:59:05.680380 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 20:59:05.681699 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 20:59:05.682089 (MainThread): 21:59:05 | 
2021-02-21 20:59:05.682246 (MainThread): 21:59:05 | Finished running 1 snapshot in 11.91s.
2021-02-21 20:59:05.682374 (MainThread): Connection 'master' was properly closed.
2021-02-21 20:59:05.682473 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 20:59:05.686674 (MainThread): 
2021-02-21 20:59:05.686837 (MainThread): Completed successfully
2021-02-21 20:59:05.686973 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 20:59:05.687208 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fdbb220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe3bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe3bd00>]}
2021-02-21 20:59:05.687427 (MainThread): Flushing usage events
2021-02-21 21:05:14.248584 (MainThread): Running with dbt=0.18.1
2021-02-21 21:05:14.709923 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 21:05:14.710979 (MainThread): Tracking: tracking
2021-02-21 21:05:14.723675 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10550ac40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c54eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c54b50>]}
2021-02-21 21:05:14.748006 (MainThread): Partial parsing not enabled
2021-02-21 21:05:14.750216 (MainThread): Parsing macros/etc.sql
2021-02-21 21:05:14.753157 (MainThread): Parsing macros/catalog.sql
2021-02-21 21:05:14.759591 (MainThread): Parsing macros/adapters.sql
2021-02-21 21:05:14.779618 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 21:05:14.782556 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 21:05:14.785742 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 21:05:14.796745 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 21:05:14.801157 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 21:05:14.814464 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 21:05:14.817628 (MainThread): Parsing macros/core.sql
2021-02-21 21:05:14.821505 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 21:05:14.830720 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 21:05:14.832977 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 21:05:14.850994 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 21:05:14.884643 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 21:05:14.905357 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 21:05:14.907398 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 21:05:14.913851 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 21:05:14.927271 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 21:05:14.934175 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 21:05:14.940261 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 21:05:14.945671 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 21:05:14.946726 (MainThread): Parsing macros/etc/query.sql
2021-02-21 21:05:14.947853 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 21:05:14.949523 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 21:05:14.958595 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 21:05:14.960594 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 21:05:14.962516 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 21:05:15.003480 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 21:05:15.005555 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 21:05:15.007406 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 21:05:15.009146 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 21:05:15.016534 (MainThread): Partial parsing not enabled
2021-02-21 21:05:15.055423 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 21:05:15.077878 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:05:15.090920 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 21:05:15.101722 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 21:05:15.111316 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 21:05:15.120261 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 21:05:15.135573 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:05:15.179216 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 21:05:15.418395 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 21:05:15.473914 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 21:05:15.474735 (MainThread): 
2021-02-21 21:05:15.474981 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:05:15.476214 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 21:05:15.476330 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 21:05:16.140976 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 21:05:16.141279 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 21:05:16.221322 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:05:17.715883 (MainThread): 22:05:17 | Concurrency: 1 threads (target='dev')
2021-02-21 21:05:17.716100 (MainThread): 22:05:17 | 
2021-02-21 21:05:17.721224 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 21:05:17.722401 (Thread-1): 22:05:17 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 21:05:17.722705 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:05:17.722876 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 21:05:17.737642 (Thread-1): finished collecting timing info
2021-02-21 21:05:17.760931 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 21:05:17.837352 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:05:18.457963 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:05:18.739050 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 21:05:22.258722 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:05:22.471651 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:05:22.718599 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 21:05:22.718833 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:05:23.372570 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:05:23.587158 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 21:05:23.587765 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 21:05:25.890158 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 21:05:26.649930 (Thread-1): finished collecting timing info
2021-02-21 21:05:26.650924 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'adff670e-aa72-4afd-84e3-22c6a9083bc8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cf65e0>]}
2021-02-21 21:05:26.652610 (Thread-1): 22:05:26 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (0.0 rows, 0.0 Bytes processed) in 8.93s]
2021-02-21 21:05:26.652827 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 21:05:26.654066 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:05:26.654402 (MainThread): 22:05:26 | 
2021-02-21 21:05:26.654544 (MainThread): 22:05:26 | Finished running 1 snapshot in 11.18s.
2021-02-21 21:05:26.654665 (MainThread): Connection 'master' was properly closed.
2021-02-21 21:05:26.654753 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 21:05:26.658950 (MainThread): 
2021-02-21 21:05:26.659104 (MainThread): Completed successfully
2021-02-21 21:05:26.659237 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 21:05:26.659462 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e6ec70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e02e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e02d30>]}
2021-02-21 21:05:26.659656 (MainThread): Flushing usage events
2021-02-21 21:06:05.983459 (MainThread): Running with dbt=0.18.1
2021-02-21 21:06:06.459261 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 21:06:06.460075 (MainThread): Tracking: tracking
2021-02-21 21:06:06.465935 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bb57c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc1910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc15b0>]}
2021-02-21 21:06:06.489587 (MainThread): Partial parsing not enabled
2021-02-21 21:06:06.490948 (MainThread): Parsing macros/etc.sql
2021-02-21 21:06:06.492738 (MainThread): Parsing macros/catalog.sql
2021-02-21 21:06:06.499055 (MainThread): Parsing macros/adapters.sql
2021-02-21 21:06:06.517526 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 21:06:06.520883 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 21:06:06.524383 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 21:06:06.535511 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 21:06:06.539938 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 21:06:06.552592 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 21:06:06.555847 (MainThread): Parsing macros/core.sql
2021-02-21 21:06:06.560477 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 21:06:06.569656 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 21:06:06.571774 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 21:06:06.589956 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 21:06:06.624628 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 21:06:06.645349 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 21:06:06.647459 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 21:06:06.653689 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 21:06:06.666918 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 21:06:06.674409 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 21:06:06.681793 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 21:06:06.687321 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 21:06:06.688382 (MainThread): Parsing macros/etc/query.sql
2021-02-21 21:06:06.689628 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 21:06:06.691417 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 21:06:06.700217 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 21:06:06.702345 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 21:06:06.704272 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 21:06:06.745137 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 21:06:06.747556 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 21:06:06.749657 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 21:06:06.751487 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 21:06:06.760209 (MainThread): Partial parsing not enabled
2021-02-21 21:06:06.795901 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 21:06:06.815757 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:06:06.826014 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 21:06:06.836132 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 21:06:06.845594 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 21:06:06.857080 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 21:06:06.872965 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:06:06.908657 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 21:06:07.148648 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 21:06:07.206018 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 21:06:07.206849 (MainThread): 
2021-02-21 21:06:07.207095 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:06:07.208295 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 21:06:07.208411 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 21:06:07.855577 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 21:06:07.855910 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 21:06:07.931115 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:06:08.324457 (MainThread): 22:06:08 | Concurrency: 1 threads (target='dev')
2021-02-21 21:06:08.324671 (MainThread): 22:06:08 | 
2021-02-21 21:06:08.330251 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 21:06:08.331537 (Thread-1): 22:06:08 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-21 21:06:08.331888 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 21:06:08.332046 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-21 21:06:08.345830 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 21:06:08.346195 (Thread-1): finished collecting timing info
2021-02-21 21:06:08.378500 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-21 21:06:08.378938 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 21:06:08.452336 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-21 21:06:10.048161 (Thread-1): finished collecting timing info
2021-02-21 21:06:10.049036 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f9e4000-dbeb-4deb-8f4a-9542e46b639e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d94e80>]}
2021-02-21 21:06:10.050374 (Thread-1): 22:06:10 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.72s]
2021-02-21 21:06:10.050551 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-21 21:06:10.051904 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:06:10.052250 (MainThread): 22:06:10 | 
2021-02-21 21:06:10.052391 (MainThread): 22:06:10 | Finished running 1 view model in 2.85s.
2021-02-21 21:06:10.052510 (MainThread): Connection 'master' was properly closed.
2021-02-21 21:06:10.052598 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-21 21:06:10.056697 (MainThread): 
2021-02-21 21:06:10.056849 (MainThread): Completed successfully
2021-02-21 21:06:10.056979 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 21:06:10.057216 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c14cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c1f760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c1fd30>]}
2021-02-21 21:06:10.057409 (MainThread): Flushing usage events
2021-02-21 21:19:08.220371 (MainThread): Running with dbt=0.18.1
2021-02-21 21:19:08.744953 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_010'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 21:19:08.745920 (MainThread): Tracking: tracking
2021-02-21 21:19:08.754206 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ffef10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080085e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108008280>]}
2021-02-21 21:19:08.779152 (MainThread): Partial parsing not enabled
2021-02-21 21:19:08.780435 (MainThread): Parsing macros/etc.sql
2021-02-21 21:19:08.782169 (MainThread): Parsing macros/catalog.sql
2021-02-21 21:19:08.788490 (MainThread): Parsing macros/adapters.sql
2021-02-21 21:19:08.807683 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 21:19:08.810765 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 21:19:08.813871 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 21:19:08.823748 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 21:19:08.828217 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 21:19:08.840783 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 21:19:08.844957 (MainThread): Parsing macros/core.sql
2021-02-21 21:19:08.849230 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 21:19:08.858071 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 21:19:08.860129 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 21:19:08.876705 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 21:19:08.906123 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 21:19:08.926963 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 21:19:08.928941 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 21:19:08.935013 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 21:19:08.948781 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 21:19:08.955737 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 21:19:08.962288 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 21:19:08.967239 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 21:19:08.968326 (MainThread): Parsing macros/etc/query.sql
2021-02-21 21:19:08.969534 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 21:19:08.971352 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 21:19:08.979840 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 21:19:08.981869 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 21:19:08.983764 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 21:19:09.026430 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 21:19:09.028682 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 21:19:09.030341 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 21:19:09.032116 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 21:19:09.039708 (MainThread): Partial parsing not enabled
2021-02-21 21:19:09.076053 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 21:19:09.095941 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:19:09.108820 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 21:19:09.119812 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 21:19:09.129975 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 21:19:09.139242 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 21:19:09.157401 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:19:09.191928 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 21:19:09.430774 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 21:19:09.487489 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 21:19:09.488390 (MainThread): 
2021-02-21 21:19:09.488657 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:19:09.489927 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 21:19:09.490128 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 21:19:10.211321 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 21:19:10.211598 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 21:19:10.284067 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:19:10.873178 (MainThread): 22:19:10 | Concurrency: 1 threads (target='dev')
2021-02-21 21:19:10.873404 (MainThread): 22:19:10 | 
2021-02-21 21:19:10.879579 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 21:19:10.880845 (Thread-1): 22:19:10 | 1 of 1 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 21:19:10.881188 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:19:10.881343 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 21:19:10.899422 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 21:19:10.899800 (Thread-1): finished collecting timing info
2021-02-21 21:19:10.931673 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 21:19:10.932112 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 21:19:11.000659 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
), 
max_date AS (
        SELECT CAST(max_valid_date AS DATE) AS max_valid_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
)
SELECT * FROM foretak
WHERE valid_date IN(
    SELECT max_valid_date FROM max_date
);


2021-02-21 21:19:12.415193 (Thread-1): Retry attempt 1 of 1 after error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/813c9a37-17f9-4b1d-b385-4c0b1e3fcc27?maxResults=0&location=US: Unrecognized name: max_valid_date at [15:21]')
2021-02-21 21:19:14.046482 (Thread-1): finished collecting timing info
2021-02-21 21:19:14.047697 (Thread-1): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Unrecognized name: max_valid_date at [15:21]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 122, in result
    self._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3103, in _blocking_poll
    super(QueryJob, self)._blocking_poll(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 101, in _blocking_poll
    retry_(self._done_or_raise)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 80, in _done_or_raise
    if not self.done():
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3083, in done
    self._query_results = self._client._get_query_results(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 1288, in _get_query_results
    resource = self._call_api(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/client.py", line 558, in _call_api
    return call()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 281, in retry_wrapped_func
    return retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/_http.py", line 423, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 GET https://bigquery.googleapis.com/bigquery/v2/projects/radjobads/queries/ee51b1fa-a932-4303-a9d3-947da9989de5?maxResults=0&location=US: Unrecognized name: max_valid_date at [15:21]

(job ID: ee51b1fa-a932-4303-a9d3-947da9989de5)

                                                                 -----Query Job SQL Follows-----                                                                 

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */
   2:
   3:
   4:  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
   5:  OPTIONS()
   6:  as WITH foretak AS (
   7:    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
   8:    navn,
   9:    antallAnsatte AS antall_ansatte,
  10:    naeringskode1.kode AS nkode1,
  11:    CAST(valid_date AS DATE) AS valid_date
  12:    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  13:), 
  14:max_date AS (
  15:        SELECT CAST(max_valid_date AS DATE) AS max_valid_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  16:)
  17:SELECT * FROM foretak
  18:WHERE valid_date IN(
  19:    SELECT max_valid_date FROM max_date
  20:);
  21:
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 22, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 65, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 107, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
  Unrecognized name: max_valid_date at [15:21]
  compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 21:19:14.062440 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ead7307-32af-4c72-8621-22ec4607501a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081f1e50>]}
2021-02-21 21:19:14.064386 (Thread-1): 22:19:14 | 1 of 1 ERROR creating view model enhetsregisteret.wrk_foretak_010.... [ERROR in 3.18s]
2021-02-21 21:19:14.064597 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 21:19:14.065982 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:19:14.066332 (MainThread): 22:19:14 | 
2021-02-21 21:19:14.066473 (MainThread): 22:19:14 | Finished running 1 view model in 4.58s.
2021-02-21 21:19:14.066594 (MainThread): Connection 'master' was properly closed.
2021-02-21 21:19:14.066681 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 21:19:14.071211 (MainThread): 
2021-02-21 21:19:14.071342 (MainThread): Completed with 1 error and 0 warnings:
2021-02-21 21:19:14.071450 (MainThread): 
2021-02-21 21:19:14.071553 (MainThread): Database Error in model wrk_foretak_010 (models/er/stg/wrk_foretak_010.sql)
2021-02-21 21:19:14.071646 (MainThread):   Unrecognized name: max_valid_date at [15:21]
2021-02-21 21:19:14.071731 (MainThread):   compiled SQL at target/run/enhetsregisteret/models/er/stg/wrk_foretak_010.sql
2021-02-21 21:19:14.071823 (MainThread): 
Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
2021-02-21 21:19:14.072004 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c2040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081a4640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081a4d60>]}
2021-02-21 21:19:14.072171 (MainThread): Flushing usage events
2021-02-21 21:20:44.533506 (MainThread): Running with dbt=0.18.1
2021-02-21 21:20:44.882535 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_max_load_date'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 21:20:44.883315 (MainThread): Tracking: tracking
2021-02-21 21:20:44.887926 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d720430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de5fcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de5ffd0>]}
2021-02-21 21:20:44.910417 (MainThread): Partial parsing not enabled
2021-02-21 21:20:44.911550 (MainThread): Parsing macros/etc.sql
2021-02-21 21:20:44.912957 (MainThread): Parsing macros/catalog.sql
2021-02-21 21:20:44.919154 (MainThread): Parsing macros/adapters.sql
2021-02-21 21:20:44.938064 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 21:20:44.940758 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 21:20:44.943881 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 21:20:44.953340 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 21:20:44.957815 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 21:20:44.970463 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 21:20:44.973336 (MainThread): Parsing macros/core.sql
2021-02-21 21:20:44.976866 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 21:20:44.985726 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 21:20:44.987426 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 21:20:45.003844 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 21:20:45.031237 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 21:20:45.051164 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 21:20:45.052870 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 21:20:45.059013 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 21:20:45.071939 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 21:20:45.078674 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 21:20:45.085080 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 21:20:45.089952 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 21:20:45.091026 (MainThread): Parsing macros/etc/query.sql
2021-02-21 21:20:45.092126 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 21:20:45.093689 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 21:20:45.102137 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 21:20:45.103982 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 21:20:45.105561 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 21:20:45.147202 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 21:20:45.148971 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 21:20:45.150409 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 21:20:45.152114 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 21:20:45.159484 (MainThread): Partial parsing not enabled
2021-02-21 21:20:45.194017 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 21:20:45.212748 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:20:45.222066 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 21:20:45.233698 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 21:20:45.243684 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 21:20:45.252402 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 21:20:45.267656 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:20:45.300630 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 21:20:45.525908 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 21:20:45.582471 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 21:20:45.583292 (MainThread): 
2021-02-21 21:20:45.583535 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:20:45.584761 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 21:20:45.584878 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 21:20:46.103338 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 21:20:46.103603 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 21:20:46.168987 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:20:46.729216 (MainThread): 22:20:46 | Concurrency: 1 threads (target='dev')
2021-02-21 21:20:46.729405 (MainThread): 22:20:46 | 
2021-02-21 21:20:46.732468 (Thread-1): Began running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 21:20:46.733482 (Thread-1): 22:20:46 | 1 of 1 START table model enhetsregisteret.wrk_max_load_date.......... [RUN]
2021-02-21 21:20:46.733754 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 21:20:46.733895 (Thread-1): Compiling model.enhetsregisteret.wrk_max_load_date
2021-02-21 21:20:46.747588 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 21:20:46.748963 (Thread-1): finished collecting timing info
2021-02-21 21:20:46.771154 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 21:20:46.840184 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:20:47.265317 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_max_load_date"
2021-02-21 21:20:47.265822 (Thread-1): On model.enhetsregisteret.wrk_max_load_date: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_max_load_date"} */


  create or replace table `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
  
  
  OPTIONS()
  as (
    

SELECT MAX(valid_date) AS max_valid_date FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
  );
    
2021-02-21 21:20:49.324808 (Thread-1): finished collecting timing info
2021-02-21 21:20:49.325659 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '142b0062-6ca0-4c64-9132-2ea1d38b16b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e023730>]}
2021-02-21 21:20:49.326744 (Thread-1): 22:20:49 | 1 of 1 OK created table model enhetsregisteret.wrk_max_load_date..... [CREATE TABLE (1.0 rows, 104.7 MB processed) in 2.59s]
2021-02-21 21:20:49.326887 (Thread-1): Finished running node model.enhetsregisteret.wrk_max_load_date
2021-02-21 21:20:49.327996 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:20:49.328272 (MainThread): 22:20:49 | 
2021-02-21 21:20:49.328390 (MainThread): 22:20:49 | Finished running 1 table model in 3.74s.
2021-02-21 21:20:49.328490 (MainThread): Connection 'master' was properly closed.
2021-02-21 21:20:49.328564 (MainThread): Connection 'model.enhetsregisteret.wrk_max_load_date' was properly closed.
2021-02-21 21:20:49.332015 (MainThread): 
2021-02-21 21:20:49.332137 (MainThread): Completed successfully
2021-02-21 21:20:49.332240 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 21:20:49.332412 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df1cb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df1cac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10df1c820>]}
2021-02-21 21:20:49.332568 (MainThread): Flushing usage events
2021-02-21 21:22:02.965867 (MainThread): Running with dbt=0.18.1
2021-02-21 21:22:03.323025 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_010'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-21 21:22:03.323955 (MainThread): Tracking: tracking
2021-02-21 21:22:03.329454 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a93e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121e6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121e6040>]}
2021-02-21 21:22:03.351514 (MainThread): Partial parsing not enabled
2021-02-21 21:22:03.352605 (MainThread): Parsing macros/etc.sql
2021-02-21 21:22:03.354203 (MainThread): Parsing macros/catalog.sql
2021-02-21 21:22:03.360006 (MainThread): Parsing macros/adapters.sql
2021-02-21 21:22:03.379177 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 21:22:03.382259 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 21:22:03.385350 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 21:22:03.395351 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 21:22:03.399940 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 21:22:03.412951 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 21:22:03.416067 (MainThread): Parsing macros/core.sql
2021-02-21 21:22:03.420003 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 21:22:03.428818 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 21:22:03.430876 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 21:22:03.447854 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 21:22:03.475107 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 21:22:03.497470 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 21:22:03.499536 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 21:22:03.505571 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 21:22:03.518923 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 21:22:03.525782 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 21:22:03.532158 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 21:22:03.537644 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 21:22:03.538853 (MainThread): Parsing macros/etc/query.sql
2021-02-21 21:22:03.540091 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 21:22:03.542002 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 21:22:03.551192 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 21:22:03.553291 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 21:22:03.554966 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 21:22:03.597074 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 21:22:03.599007 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 21:22:03.600813 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 21:22:03.602642 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 21:22:03.612170 (MainThread): Partial parsing not enabled
2021-02-21 21:22:03.652577 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 21:22:03.674006 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:22:03.684422 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 21:22:03.694387 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 21:22:03.704614 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 21:22:03.713296 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 21:22:03.730677 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:22:03.765938 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 21:22:04.004920 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-21 21:22:04.062899 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 21:22:04.063762 (MainThread): 
2021-02-21 21:22:04.064018 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:22:04.065652 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 21:22:04.065777 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 21:22:04.933344 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 21:22:04.933640 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 21:22:05.009278 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:22:05.396114 (MainThread): 22:22:05 | Concurrency: 1 threads (target='dev')
2021-02-21 21:22:05.396341 (MainThread): 22:22:05 | 
2021-02-21 21:22:05.402093 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 21:22:05.403387 (Thread-1): 22:22:05 | 1 of 1 START view model enhetsregisteret.wrk_foretak_010............. [RUN]
2021-02-21 21:22:05.403735 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:22:05.403904 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_010
2021-02-21 21:22:05.422925 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 21:22:05.423263 (Thread-1): finished collecting timing info
2021-02-21 21:22:05.455119 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_010"
2021-02-21 21:22:05.455544 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 21:22:05.527436 (Thread-1): On model.enhetsregisteret.wrk_foretak_010: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_010"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
  OPTIONS()
  as WITH foretak AS (
    SELECT CAST(organisasjonsnummer AS STRING) AS orgnr,
    navn,
    antallAnsatte AS antall_ansatte,
    naeringskode1.kode AS nkode1,
    CAST(valid_date AS DATE) AS valid_date
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak`
), 
max_date AS (
        SELECT CAST(max_valid_date AS DATE) AS max_valid_date FROM `radjobads`.`enhetsregisteret`.`wrk_max_load_date`
)
SELECT * FROM foretak
WHERE valid_date IN(
    SELECT max_valid_date FROM max_date
);


2021-02-21 21:22:06.525884 (Thread-1): finished collecting timing info
2021-02-21 21:22:06.526773 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '784e37ef-6932-4894-b484-55e74b2fdeec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112389df0>]}
2021-02-21 21:22:06.528327 (Thread-1): 22:22:06 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_010........ [CREATE VIEW in 1.12s]
2021-02-21 21:22:06.528502 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_010
2021-02-21 21:22:06.529862 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:22:06.530221 (MainThread): 22:22:06 | 
2021-02-21 21:22:06.530366 (MainThread): 22:22:06 | Finished running 1 view model in 2.47s.
2021-02-21 21:22:06.530486 (MainThread): Connection 'master' was properly closed.
2021-02-21 21:22:06.530576 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_010' was properly closed.
2021-02-21 21:22:06.534774 (MainThread): 
2021-02-21 21:22:06.534926 (MainThread): Completed successfully
2021-02-21 21:22:06.535129 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 21:22:06.535370 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112257910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122d0790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122d06d0>]}
2021-02-21 21:22:06.535579 (MainThread): Flushing usage events
2021-02-21 21:22:34.545690 (MainThread): Running with dbt=0.18.1
2021-02-21 21:22:34.908486 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 21:22:34.909467 (MainThread): Tracking: tracking
2021-02-21 21:22:34.915275 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fd6e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a71fd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7280a0>]}
2021-02-21 21:22:34.938392 (MainThread): Partial parsing not enabled
2021-02-21 21:22:34.939666 (MainThread): Parsing macros/etc.sql
2021-02-21 21:22:34.941518 (MainThread): Parsing macros/catalog.sql
2021-02-21 21:22:34.948124 (MainThread): Parsing macros/adapters.sql
2021-02-21 21:22:34.966534 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 21:22:34.969423 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 21:22:34.972376 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 21:22:34.982835 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 21:22:34.987302 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 21:22:35.000685 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 21:22:35.004225 (MainThread): Parsing macros/core.sql
2021-02-21 21:22:35.008501 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 21:22:35.018911 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 21:22:35.021049 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 21:22:35.039065 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 21:22:35.067867 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 21:22:35.088780 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 21:22:35.090722 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 21:22:35.097352 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 21:22:35.112900 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 21:22:35.119725 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 21:22:35.126201 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 21:22:35.131307 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 21:22:35.132377 (MainThread): Parsing macros/etc/query.sql
2021-02-21 21:22:35.133542 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 21:22:35.135260 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 21:22:35.145137 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 21:22:35.147436 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 21:22:35.149571 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 21:22:35.192182 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 21:22:35.194794 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 21:22:35.196528 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 21:22:35.198472 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 21:22:35.206012 (MainThread): Partial parsing not enabled
2021-02-21 21:22:35.246857 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 21:22:35.268048 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:22:35.277837 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 21:22:35.287799 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 21:22:35.298190 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 21:22:35.307941 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 21:22:35.323545 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:22:35.358474 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 21:22:35.598694 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 21:22:35.654521 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 21:22:35.655452 (MainThread): 
2021-02-21 21:22:35.655704 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:22:35.656873 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 21:22:35.656990 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 21:22:36.168836 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 21:22:36.169189 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 21:22:36.259407 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:22:36.829022 (MainThread): 22:22:36 | Concurrency: 1 threads (target='dev')
2021-02-21 21:22:36.829259 (MainThread): 22:22:36 | 
2021-02-21 21:22:36.836108 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 21:22:36.837432 (Thread-1): 22:22:36 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 21:22:36.837791 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:22:36.837956 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 21:22:36.853701 (Thread-1): finished collecting timing info
2021-02-21 21:22:36.878743 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 21:22:36.954690 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:22:37.399860 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:22:37.660021 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 21:22:53.771010 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:22:53.990900 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:22:54.223918 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 21:22:54.224119 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:22:55.158472 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:22:55.395398 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 21:22:55.395990 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 21:23:10.509553 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60971, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-21 21:23:10.509822 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60972, 0, 0), raddr=('2a00:1450:400f:808::200a', 443, 0, 0)>
2021-02-21 21:23:10.510014 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60981, 0, 0), raddr=('2a00:1450:400f:808::200a', 443, 0, 0)>
2021-02-21 21:23:10.510189 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 60974, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-21 21:23:10.522081 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 21:23:11.317381 (Thread-1): finished collecting timing info
2021-02-21 21:23:11.318396 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '46e8d389-516f-4968-b776-8fa153324baf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7b96a0>]}
2021-02-21 21:23:11.320065 (Thread-1): 22:23:11 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (1.0m rows, 111.6 MB processed) in 34.48s]
2021-02-21 21:23:11.320248 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 21:23:11.321497 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:23:11.321821 (MainThread): 22:23:11 | 
2021-02-21 21:23:11.321961 (MainThread): 22:23:11 | Finished running 1 snapshot in 35.67s.
2021-02-21 21:23:11.322080 (MainThread): Connection 'master' was properly closed.
2021-02-21 21:23:11.322167 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 21:23:11.326200 (MainThread): 
2021-02-21 21:23:11.326349 (MainThread): Completed successfully
2021-02-21 21:23:11.326477 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 21:23:11.326696 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a700430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7469a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7461c0>]}
2021-02-21 21:23:11.326886 (MainThread): Flushing usage events
2021-02-21 21:26:07.149624 (MainThread): Running with dbt=0.18.1
2021-02-21 21:26:07.505712 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-21 21:26:07.506352 (MainThread): Tracking: tracking
2021-02-21 21:26:07.510954 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e959a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107eb1af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107eb1790>]}
2021-02-21 21:26:07.531140 (MainThread): Partial parsing not enabled
2021-02-21 21:26:07.532068 (MainThread): Parsing macros/etc.sql
2021-02-21 21:26:07.535269 (MainThread): Parsing macros/catalog.sql
2021-02-21 21:26:07.542264 (MainThread): Parsing macros/adapters.sql
2021-02-21 21:26:07.561463 (MainThread): Parsing macros/materializations/seed.sql
2021-02-21 21:26:07.564030 (MainThread): Parsing macros/materializations/view.sql
2021-02-21 21:26:07.566929 (MainThread): Parsing macros/materializations/table.sql
2021-02-21 21:26:07.576695 (MainThread): Parsing macros/materializations/copy.sql
2021-02-21 21:26:07.581330 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-21 21:26:07.593940 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-21 21:26:07.597057 (MainThread): Parsing macros/core.sql
2021-02-21 21:26:07.600805 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-21 21:26:07.609308 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-21 21:26:07.611040 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-21 21:26:07.627822 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-21 21:26:07.655405 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-21 21:26:07.675567 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-21 21:26:07.677401 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-21 21:26:07.683607 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-21 21:26:07.697734 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-21 21:26:07.704164 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-21 21:26:07.710078 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-21 21:26:07.715093 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-21 21:26:07.715962 (MainThread): Parsing macros/etc/query.sql
2021-02-21 21:26:07.716945 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-21 21:26:07.718530 (MainThread): Parsing macros/etc/datetime.sql
2021-02-21 21:26:07.726773 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-21 21:26:07.728660 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-21 21:26:07.730217 (MainThread): Parsing macros/adapters/common.sql
2021-02-21 21:26:07.771810 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-21 21:26:07.773772 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-21 21:26:07.775388 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-21 21:26:07.777266 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-21 21:26:07.784683 (MainThread): Partial parsing not enabled
2021-02-21 21:26:07.821231 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-21 21:26:07.841855 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-21 21:26:07.851863 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-21 21:26:07.860980 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-21 21:26:07.870216 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-21 21:26:07.878471 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-21 21:26:07.893899 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:26:07.927614 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-21 21:26:08.157458 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-21 21:26:08.214514 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-21 21:26:08.215518 (MainThread): 
2021-02-21 21:26:08.215758 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:26:08.216896 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-21 21:26:08.217006 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-21 21:26:08.850842 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-21 21:26:08.851148 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-21 21:26:08.926893 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:26:09.441021 (MainThread): 22:26:09 | Concurrency: 1 threads (target='dev')
2021-02-21 21:26:09.441240 (MainThread): 22:26:09 | 
2021-02-21 21:26:09.444796 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-21 21:26:09.446015 (Thread-1): 22:26:09 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-21 21:26:09.446349 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-21 21:26:09.446508 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-21 21:26:09.462110 (Thread-1): finished collecting timing info
2021-02-21 21:26:09.485818 (Thread-1): Opening a new connection, currently in state closed
2021-02-21 21:26:09.555930 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:26:10.003564 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:26:10.258996 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-21 21:26:32.366383 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:26:32.606929 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:26:32.833528 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-21 21:26:32.833759 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:26:33.565937 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-21 21:26:33.778238 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-21 21:26:33.778849 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-21 21:27:05.827724 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 61091, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-21 21:27:05.827982 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 61092, 0, 0), raddr=('2a00:1450:400f:808::200a', 443, 0, 0)>
2021-02-21 21:27:05.828167 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 61094, 0, 0), raddr=('2a00:1450:400f:808::200a', 443, 0, 0)>
2021-02-21 21:27:05.828338 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:80fb:b402:4b4c:ddbc', 61093, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-21 21:27:05.839312 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-21 21:27:06.552566 (Thread-1): finished collecting timing info
2021-02-21 21:27:06.553551 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '696f2c79-7c36-444e-aa9d-7007ac7720ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10807d970>]}
2021-02-21 21:27:06.555066 (Thread-1): 22:27:06 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (2.0m rows, 334.7 MB processed) in 57.11s]
2021-02-21 21:27:06.555237 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-21 21:27:06.556533 (MainThread): Acquiring new bigquery connection "master".
2021-02-21 21:27:06.556858 (MainThread): 22:27:06 | 
2021-02-21 21:27:06.556991 (MainThread): 22:27:06 | Finished running 1 snapshot in 58.34s.
2021-02-21 21:27:06.557109 (MainThread): Connection 'master' was properly closed.
2021-02-21 21:27:06.557195 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-21 21:27:06.560783 (MainThread): 
2021-02-21 21:27:06.560909 (MainThread): Completed successfully
2021-02-21 21:27:06.561016 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-21 21:27:06.561195 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f2ba30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fa04c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e7c1c0>]}
2021-02-21 21:27:06.561358 (MainThread): Flushing usage events
2021-02-22 08:54:58.040630 (MainThread): Running with dbt=0.18.1
2021-02-22 08:54:58.633192 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 08:54:58.634240 (MainThread): Tracking: tracking
2021-02-22 08:54:58.644089 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e319d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e4fb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e4f7c0>]}
2021-02-22 08:54:58.669107 (MainThread): Partial parsing not enabled
2021-02-22 08:54:58.670536 (MainThread): Parsing macros/etc.sql
2021-02-22 08:54:58.672523 (MainThread): Parsing macros/catalog.sql
2021-02-22 08:54:58.679833 (MainThread): Parsing macros/adapters.sql
2021-02-22 08:54:58.701953 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 08:54:58.705285 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 08:54:58.708724 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 08:54:58.719965 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 08:54:58.725289 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 08:54:58.738263 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 08:54:58.741793 (MainThread): Parsing macros/core.sql
2021-02-22 08:54:58.746015 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 08:54:58.756004 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 08:54:58.758342 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 08:54:58.778967 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 08:54:58.809148 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 08:54:58.829670 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 08:54:58.831733 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 08:54:58.838119 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 08:54:58.853750 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 08:54:58.860641 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 08:54:58.866863 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 08:54:58.871653 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 08:54:58.872718 (MainThread): Parsing macros/etc/query.sql
2021-02-22 08:54:58.873922 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 08:54:58.875719 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 08:54:58.884267 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 08:54:58.886285 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 08:54:58.888070 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 08:54:58.928812 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 08:54:58.931444 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 08:54:58.933469 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 08:54:58.935505 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 08:54:58.943073 (MainThread): Partial parsing not enabled
2021-02-22 08:54:58.977586 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 08:54:58.996367 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 08:54:59.006856 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 08:54:59.017392 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 08:54:59.027321 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 08:54:59.036555 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 08:54:59.052203 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 08:54:59.055730 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ebd6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120571f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112057ca0>]}
2021-02-22 08:54:59.055902 (MainThread): Flushing usage events
2021-02-22 08:54:59.600366 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-22 08:54:59.600613 (MainThread): Encountered an error:
2021-02-22 08:54:59.600820 (MainThread): Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 10
      invalidate_hard_deletes=True
2021-02-22 08:54:59.611782 (MainThread): Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 10, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got 'invalidate_hard_deletes'
  line 10
    invalidate_hard_deletes=True

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 124, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 202, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 255, in run_from_args
    results = task.run()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 399, in run
    self._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 118, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 78, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 65, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 748, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 349, in load_all
    loader.load(macro_manifest=macro_manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 204, in load
    self.parse_project(project, macro_manifest, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 177, in parse_project
    self.parse_with_cache(path, parser, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 133, in parse_with_cache
    parser.parse_file(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/snapshots.py", line 82, in parse_file
    self.parse_node(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 288, in render_with_context
    get_rendered(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 570, in get_rendered
    template = get_template(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 10
      invalidate_hard_deletes=True

2021-02-22 08:56:18.851065 (MainThread): Running with dbt=0.18.1
2021-02-22 08:56:19.354125 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 08:56:19.355146 (MainThread): Tracking: tracking
2021-02-22 08:56:19.362119 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad3b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad59b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad597c0>]}
2021-02-22 08:56:19.387383 (MainThread): Partial parsing not enabled
2021-02-22 08:56:19.388606 (MainThread): Parsing macros/etc.sql
2021-02-22 08:56:19.390452 (MainThread): Parsing macros/catalog.sql
2021-02-22 08:56:19.396319 (MainThread): Parsing macros/adapters.sql
2021-02-22 08:56:19.414736 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 08:56:19.417519 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 08:56:19.420644 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 08:56:19.430296 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 08:56:19.434689 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 08:56:19.447112 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 08:56:19.450240 (MainThread): Parsing macros/core.sql
2021-02-22 08:56:19.454676 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 08:56:19.463387 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 08:56:19.465191 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 08:56:19.481975 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 08:56:19.509646 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 08:56:19.530636 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 08:56:19.532538 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 08:56:19.538869 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 08:56:19.557318 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 08:56:19.566121 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 08:56:19.573466 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 08:56:19.579195 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 08:56:19.580290 (MainThread): Parsing macros/etc/query.sql
2021-02-22 08:56:19.581615 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 08:56:19.583597 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 08:56:19.593021 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 08:56:19.595427 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 08:56:19.597491 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 08:56:19.639836 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 08:56:19.642386 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 08:56:19.644195 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 08:56:19.645968 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 08:56:19.656798 (MainThread): Partial parsing not enabled
2021-02-22 08:56:19.694135 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 08:56:19.713880 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 08:56:19.724328 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 08:56:19.734835 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 08:56:19.744980 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 08:56:19.754461 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 08:56:19.770460 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 08:56:19.774322 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adcc6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af61190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af61ca0>]}
2021-02-22 08:56:19.774540 (MainThread): Flushing usage events
2021-02-22 08:56:20.306599 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-22 08:56:20.306869 (MainThread): Encountered an error:
2021-02-22 08:56:20.307134 (MainThread): Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 10
      invalidate_hard_deletes=True
2021-02-22 08:56:20.323920 (MainThread): Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 10, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got 'invalidate_hard_deletes'
  line 10
    invalidate_hard_deletes=True

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 124, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 202, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 255, in run_from_args
    results = task.run()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 399, in run
    self._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 118, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 78, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 65, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 748, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 349, in load_all
    loader.load(macro_manifest=macro_manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 204, in load
    self.parse_project(project, macro_manifest, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 177, in parse_project
    self.parse_with_cache(path, parser, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 133, in parse_with_cache
    parser.parse_file(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/snapshots.py", line 82, in parse_file
    self.parse_node(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 288, in render_with_context
    get_rendered(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 570, in get_rendered
    template = get_template(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 10
      invalidate_hard_deletes=True

2021-02-22 11:17:55.359653 (MainThread): Running with dbt=0.18.1
2021-02-22 11:17:55.883778 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 11:17:55.885136 (MainThread): Tracking: tracking
2021-02-22 11:17:55.895090 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091aaf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091d1c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091d18b0>]}
2021-02-22 11:17:55.920077 (MainThread): Partial parsing not enabled
2021-02-22 11:17:55.922194 (MainThread): Parsing macros/etc.sql
2021-02-22 11:17:55.924264 (MainThread): Parsing macros/catalog.sql
2021-02-22 11:17:55.931287 (MainThread): Parsing macros/adapters.sql
2021-02-22 11:17:55.951264 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 11:17:55.954120 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 11:17:55.957180 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 11:17:55.967199 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 11:17:55.972036 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 11:17:55.986667 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 11:17:55.991100 (MainThread): Parsing macros/core.sql
2021-02-22 11:17:55.995778 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 11:17:56.006003 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 11:17:56.008117 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 11:17:56.027000 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 11:17:56.061289 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 11:17:56.085677 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 11:17:56.089083 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 11:17:56.096389 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 11:17:56.112297 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 11:17:56.120645 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 11:17:56.127908 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 11:17:56.133716 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 11:17:56.134983 (MainThread): Parsing macros/etc/query.sql
2021-02-22 11:17:56.136397 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 11:17:56.138487 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 11:17:56.148212 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 11:17:56.150295 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 11:17:56.152163 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 11:17:56.194215 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 11:17:56.198154 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 11:17:56.200159 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 11:17:56.202319 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 11:17:56.212587 (MainThread): Partial parsing not enabled
2021-02-22 11:17:56.251512 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 11:17:56.272951 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 11:17:56.284400 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 11:17:56.296805 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 11:17:56.309257 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 11:17:56.321076 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 11:17:56.340412 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 11:17:56.344476 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092257c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093d7280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093d7d60>]}
2021-02-22 11:17:56.344678 (MainThread): Flushing usage events
2021-02-22 11:17:56.886727 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-22 11:17:56.886941 (MainThread): Encountered an error:
2021-02-22 11:17:56.887123 (MainThread): Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 10
      invalidate_hard_deletes=True
2021-02-22 11:17:56.895878 (MainThread): Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 10, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got 'invalidate_hard_deletes'
  line 10
    invalidate_hard_deletes=True

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 124, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 202, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 255, in run_from_args
    results = task.run()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 399, in run
    self._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 118, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 78, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 65, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 748, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 349, in load_all
    loader.load(macro_manifest=macro_manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 204, in load
    self.parse_project(project, macro_manifest, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 177, in parse_project
    self.parse_with_cache(path, parser, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 133, in parse_with_cache
    parser.parse_file(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/snapshots.py", line 82, in parse_file
    self.parse_node(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 288, in render_with_context
    get_rendered(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 570, in get_rendered
    template = get_template(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 10
      invalidate_hard_deletes=True

2021-02-22 11:19:23.469172 (MainThread): Running with dbt=0.18.1
2021-02-22 11:19:23.974591 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 11:19:23.975932 (MainThread): Tracking: tracking
2021-02-22 11:19:23.984632 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11198ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120de400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120de0a0>]}
2021-02-22 11:19:24.013317 (MainThread): Partial parsing not enabled
2021-02-22 11:19:24.014801 (MainThread): Parsing macros/etc.sql
2021-02-22 11:19:24.016928 (MainThread): Parsing macros/catalog.sql
2021-02-22 11:19:24.024391 (MainThread): Parsing macros/adapters.sql
2021-02-22 11:19:24.046492 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 11:19:24.049828 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 11:19:24.053203 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 11:19:24.064501 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 11:19:24.069338 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 11:19:24.083290 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 11:19:24.087114 (MainThread): Parsing macros/core.sql
2021-02-22 11:19:24.091543 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 11:19:24.101111 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 11:19:24.103725 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 11:19:24.124701 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 11:19:24.155719 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 11:19:24.176503 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 11:19:24.178569 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 11:19:24.185480 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 11:19:24.199756 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 11:19:24.207147 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 11:19:24.215461 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 11:19:24.221706 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 11:19:24.222999 (MainThread): Parsing macros/etc/query.sql
2021-02-22 11:19:24.224368 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 11:19:24.226666 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 11:19:24.237879 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 11:19:24.240424 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 11:19:24.242710 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 11:19:24.291213 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 11:19:24.293982 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 11:19:24.296019 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 11:19:24.298143 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 11:19:24.306868 (MainThread): Partial parsing not enabled
2021-02-22 11:19:24.347518 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 11:19:24.370608 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 11:19:24.382572 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 11:19:24.394282 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 11:19:24.405932 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 11:19:24.417530 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 11:19:24.436836 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 11:19:24.441145 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112153ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122daa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122ea550>]}
2021-02-22 11:19:24.441374 (MainThread): Flushing usage events
2021-02-22 11:19:24.968969 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-22 11:19:24.969209 (MainThread): Encountered an error:
2021-02-22 11:19:24.969411 (MainThread): Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 10
      invalidate_hard_deletes=True
2021-02-22 11:19:24.979035 (MainThread): Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 10, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got 'invalidate_hard_deletes'
  line 10
    invalidate_hard_deletes=True

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 124, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 202, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 255, in run_from_args
    results = task.run()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 399, in run
    self._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 118, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 78, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 65, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 748, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 349, in load_all
    loader.load(macro_manifest=macro_manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 204, in load
    self.parse_project(project, macro_manifest, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 177, in parse_project
    self.parse_with_cache(path, parser, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 133, in parse_with_cache
    parser.parse_file(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/snapshots.py", line 82, in parse_file
    self.parse_node(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 288, in render_with_context
    get_rendered(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 570, in get_rendered
    template = get_template(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 10
      invalidate_hard_deletes=True

2021-02-22 11:24:05.790847 (MainThread): Running with dbt=0.18.1
2021-02-22 11:24:06.318022 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 11:24:06.319001 (MainThread): Tracking: tracking
2021-02-22 11:24:06.325540 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10add8670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ade8b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ade87f0>]}
2021-02-22 11:24:06.351415 (MainThread): Partial parsing not enabled
2021-02-22 11:24:06.352808 (MainThread): Parsing macros/etc.sql
2021-02-22 11:24:06.354721 (MainThread): Parsing macros/catalog.sql
2021-02-22 11:24:06.360956 (MainThread): Parsing macros/adapters.sql
2021-02-22 11:24:06.379155 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 11:24:06.382044 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 11:24:06.384875 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 11:24:06.394931 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 11:24:06.401427 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 11:24:06.415984 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 11:24:06.419575 (MainThread): Parsing macros/core.sql
2021-02-22 11:24:06.423952 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 11:24:06.432911 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 11:24:06.434751 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 11:24:06.450586 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 11:24:06.478562 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 11:24:06.500373 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 11:24:06.502463 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 11:24:06.508491 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 11:24:06.522569 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 11:24:06.530052 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 11:24:06.536605 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 11:24:06.541387 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 11:24:06.542428 (MainThread): Parsing macros/etc/query.sql
2021-02-22 11:24:06.543598 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 11:24:06.545344 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 11:24:06.554425 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 11:24:06.556565 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 11:24:06.558553 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 11:24:06.600078 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 11:24:06.602616 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 11:24:06.604642 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 11:24:06.606726 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 11:24:06.614563 (MainThread): Partial parsing not enabled
2021-02-22 11:24:06.649375 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 11:24:06.668352 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 11:24:06.679052 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 11:24:06.688858 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 11:24:06.699066 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 11:24:06.707930 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 11:24:06.723579 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 11:24:06.757207 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-22 11:24:07.012921 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-22 11:24:07.070619 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-22 11:24:07.071659 (MainThread): 
2021-02-22 11:24:07.071978 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 11:24:07.073391 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-22 11:24:07.073569 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-22 11:24:08.613111 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-22 11:24:08.613392 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-22 11:24:09.035734 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-22 11:24:09.628681 (MainThread): 12:24:09 | Concurrency: 1 threads (target='dev')
2021-02-22 11:24:09.628915 (MainThread): 12:24:09 | 
2021-02-22 11:24:09.635983 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 11:24:09.637329 (Thread-1): 12:24:09 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-22 11:24:09.637700 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 11:24:09.637874 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-22 11:24:09.652919 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 11:24:09.654694 (Thread-1): finished collecting timing info
2021-02-22 11:24:09.687233 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 11:24:09.687636 (Thread-1): Opening a new connection, currently in state closed
2021-02-22 11:24:10.099590 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-22 11:24:11.350398 (Thread-1): finished collecting timing info
2021-02-22 11:24:11.351196 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '205ee31e-8949-41ce-a098-0706634dfdbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae67280>]}
2021-02-22 11:24:11.352338 (Thread-1): 12:24:11 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.71s]
2021-02-22 11:24:11.352488 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 11:24:11.353627 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 11:24:11.353909 (MainThread): 12:24:11 | 
2021-02-22 11:24:11.354023 (MainThread): 12:24:11 | Finished running 1 view model in 4.28s.
2021-02-22 11:24:11.354123 (MainThread): Connection 'master' was properly closed.
2021-02-22 11:24:11.354197 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-22 11:24:11.358421 (MainThread): 
2021-02-22 11:24:11.358555 (MainThread): Completed successfully
2021-02-22 11:24:11.358665 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-22 11:24:11.358854 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10897a070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af7b8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af93070>]}
2021-02-22 11:24:11.359020 (MainThread): Flushing usage events
2021-02-22 11:25:49.461040 (MainThread): Running with dbt=0.18.1
2021-02-22 11:25:49.974943 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 11:25:49.975959 (MainThread): Tracking: tracking
2021-02-22 11:25:49.982187 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb9cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2d8d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2d8a30>]}
2021-02-22 11:25:50.005885 (MainThread): Partial parsing not enabled
2021-02-22 11:25:50.007153 (MainThread): Parsing macros/etc.sql
2021-02-22 11:25:50.008841 (MainThread): Parsing macros/catalog.sql
2021-02-22 11:25:50.015295 (MainThread): Parsing macros/adapters.sql
2021-02-22 11:25:50.033448 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 11:25:50.036212 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 11:25:50.039250 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 11:25:50.050662 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 11:25:50.055592 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 11:25:50.067930 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 11:25:50.071195 (MainThread): Parsing macros/core.sql
2021-02-22 11:25:50.075342 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 11:25:50.084136 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 11:25:50.086010 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 11:25:50.103930 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 11:25:50.132611 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 11:25:50.152634 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 11:25:50.155331 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 11:25:50.164381 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 11:25:50.180196 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 11:25:50.187465 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 11:25:50.194442 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 11:25:50.199515 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 11:25:50.200639 (MainThread): Parsing macros/etc/query.sql
2021-02-22 11:25:50.201880 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 11:25:50.203797 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 11:25:50.212688 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 11:25:50.214684 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 11:25:50.216482 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 11:25:50.256640 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 11:25:50.258841 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 11:25:50.260628 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 11:25:50.262523 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 11:25:50.271123 (MainThread): Partial parsing not enabled
2021-02-22 11:25:50.305556 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 11:25:50.324787 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 11:25:50.334822 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 11:25:50.344750 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 11:25:50.355771 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 11:25:50.365854 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 11:25:50.381592 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 11:25:50.414925 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-22 11:25:50.660922 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-22 11:25:50.717213 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-22 11:25:50.718045 (MainThread): 
2021-02-22 11:25:50.718286 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 11:25:50.719423 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-22 11:25:50.719535 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-22 11:25:51.956672 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-22 11:25:51.956978 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-22 11:25:52.370943 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-22 11:25:53.054899 (MainThread): 12:25:53 | Concurrency: 1 threads (target='dev')
2021-02-22 11:25:53.055121 (MainThread): 12:25:53 | 
2021-02-22 11:25:53.061423 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 11:25:53.062830 (Thread-1): 12:25:53 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-22 11:25:53.063191 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 11:25:53.063369 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-22 11:25:53.077433 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 11:25:53.077785 (Thread-1): finished collecting timing info
2021-02-22 11:25:53.109446 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 11:25:53.109799 (Thread-1): Opening a new connection, currently in state closed
2021-02-22 11:25:53.522511 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-22 11:25:54.812059 (Thread-1): finished collecting timing info
2021-02-22 11:25:54.812905 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c7ec523-9c18-494f-bc72-98413c755ca0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109279d30>]}
2021-02-22 11:25:54.814186 (Thread-1): 12:25:54 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.75s]
2021-02-22 11:25:54.814357 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 11:25:54.815671 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 11:25:54.816010 (MainThread): 12:25:54 | 
2021-02-22 11:25:54.816150 (MainThread): 12:25:54 | Finished running 1 view model in 4.10s.
2021-02-22 11:25:54.816267 (MainThread): Connection 'master' was properly closed.
2021-02-22 11:25:54.816356 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-22 11:25:54.820476 (MainThread): 
2021-02-22 11:25:54.820625 (MainThread): Completed successfully
2021-02-22 11:25:54.820754 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-22 11:25:54.820965 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4ba4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c393670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c393280>]}
2021-02-22 11:25:54.821171 (MainThread): Flushing usage events
2021-02-22 13:09:37.994881 (MainThread): Running with dbt=0.18.1
2021-02-22 13:09:38.546562 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 13:09:38.548249 (MainThread): Tracking: tracking
2021-02-22 13:09:38.560005 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cf8f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094492e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109449040>]}
2021-02-22 13:09:38.588553 (MainThread): Partial parsing not enabled
2021-02-22 13:09:38.590596 (MainThread): Parsing macros/etc.sql
2021-02-22 13:09:38.592655 (MainThread): Parsing macros/catalog.sql
2021-02-22 13:09:38.599495 (MainThread): Parsing macros/adapters.sql
2021-02-22 13:09:38.619040 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 13:09:38.622083 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 13:09:38.625289 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 13:09:38.636660 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 13:09:38.641825 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 13:09:38.654439 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 13:09:38.658786 (MainThread): Parsing macros/core.sql
2021-02-22 13:09:38.662760 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 13:09:38.671251 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 13:09:38.673622 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 13:09:38.690628 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 13:09:38.718351 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 13:09:38.739348 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 13:09:38.741634 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 13:09:38.748210 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 13:09:38.762791 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 13:09:38.769395 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 13:09:38.775892 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 13:09:38.781672 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 13:09:38.782860 (MainThread): Parsing macros/etc/query.sql
2021-02-22 13:09:38.784235 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 13:09:38.786247 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 13:09:38.795514 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 13:09:38.797525 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 13:09:38.799411 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 13:09:38.840586 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 13:09:38.842979 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 13:09:38.844796 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 13:09:38.846620 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 13:09:38.854099 (MainThread): Partial parsing not enabled
2021-02-22 13:09:38.897566 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 13:09:38.920155 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 13:09:38.934376 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 13:09:38.948901 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 13:09:38.963642 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 13:09:38.975838 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 13:09:38.995337 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 13:09:39.035419 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-22 13:09:39.287178 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-22 13:09:39.349779 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-22 13:09:39.351015 (MainThread): 
2021-02-22 13:09:39.351480 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 13:09:39.353406 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-22 13:09:39.353743 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-22 13:09:40.681469 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-22 13:09:40.681677 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-22 13:09:41.114595 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-22 13:09:41.647241 (MainThread): 14:09:41 | Concurrency: 1 threads (target='dev')
2021-02-22 13:09:41.647480 (MainThread): 14:09:41 | 
2021-02-22 13:09:41.653717 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:09:41.655054 (Thread-1): 14:09:41 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-22 13:09:41.655421 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 13:09:41.655590 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:09:41.670095 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 13:09:41.672065 (Thread-1): finished collecting timing info
2021-02-22 13:09:41.706025 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 13:09:41.707375 (Thread-1): Opening a new connection, currently in state closed
2021-02-22 13:09:42.160180 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-22 13:09:43.532671 (Thread-1): finished collecting timing info
2021-02-22 13:09:43.533497 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ab2fe3e-f95a-4087-ac5f-29494defda8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109612ac0>]}
2021-02-22 13:09:43.534754 (Thread-1): 14:09:43 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.88s]
2021-02-22 13:09:43.534913 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:09:43.537286 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 13:09:43.537658 (MainThread): 14:09:43 | 
2021-02-22 13:09:43.537793 (MainThread): 14:09:43 | Finished running 1 view model in 4.19s.
2021-02-22 13:09:43.537905 (MainThread): Connection 'master' was properly closed.
2021-02-22 13:09:43.537989 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-22 13:09:43.541990 (MainThread): 
2021-02-22 13:09:43.542134 (MainThread): Completed successfully
2021-02-22 13:09:43.542250 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-22 13:09:43.542450 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10945e580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d581c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d58fa0>]}
2021-02-22 13:09:43.542630 (MainThread): Flushing usage events
2021-02-22 13:11:05.656574 (MainThread): Running with dbt=0.18.1
2021-02-22 13:11:06.162463 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 13:11:06.163788 (MainThread): Tracking: tracking
2021-02-22 13:11:06.170156 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084e5e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c2fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c2fa30>]}
2021-02-22 13:11:06.194481 (MainThread): Partial parsing not enabled
2021-02-22 13:11:06.195735 (MainThread): Parsing macros/etc.sql
2021-02-22 13:11:06.197560 (MainThread): Parsing macros/catalog.sql
2021-02-22 13:11:06.203688 (MainThread): Parsing macros/adapters.sql
2021-02-22 13:11:06.223136 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 13:11:06.228377 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 13:11:06.231894 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 13:11:06.243687 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 13:11:06.249248 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 13:11:06.264056 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 13:11:06.267755 (MainThread): Parsing macros/core.sql
2021-02-22 13:11:06.272301 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 13:11:06.282675 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 13:11:06.285723 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 13:11:06.305720 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 13:11:06.335252 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 13:11:06.357492 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 13:11:06.359802 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 13:11:06.366285 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 13:11:06.380113 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 13:11:06.387993 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 13:11:06.395498 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 13:11:06.400996 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 13:11:06.402283 (MainThread): Parsing macros/etc/query.sql
2021-02-22 13:11:06.403697 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 13:11:06.405819 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 13:11:06.415963 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 13:11:06.418094 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 13:11:06.419932 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 13:11:06.462940 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 13:11:06.465240 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 13:11:06.467386 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 13:11:06.469491 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 13:11:06.479746 (MainThread): Partial parsing not enabled
2021-02-22 13:11:06.517365 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 13:11:06.539505 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 13:11:06.552864 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 13:11:06.564498 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 13:11:06.575629 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 13:11:06.586327 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 13:11:06.602849 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 13:11:06.638542 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-22 13:11:06.885726 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-22 13:11:06.943093 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-22 13:11:06.943986 (MainThread): 
2021-02-22 13:11:06.944304 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 13:11:06.945476 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-22 13:11:06.945591 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-22 13:11:08.161133 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-22 13:11:08.161414 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-22 13:11:08.600403 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-22 13:11:09.073883 (MainThread): 14:11:09 | Concurrency: 1 threads (target='dev')
2021-02-22 13:11:09.074103 (MainThread): 14:11:09 | 
2021-02-22 13:11:09.079345 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:11:09.080527 (Thread-1): 14:11:09 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-22 13:11:09.080840 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 13:11:09.081021 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:11:09.094865 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 13:11:09.095228 (Thread-1): finished collecting timing info
2021-02-22 13:11:09.127867 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 13:11:09.128290 (Thread-1): Opening a new connection, currently in state closed
2021-02-22 13:11:09.577380 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-22 13:11:11.028852 (Thread-1): finished collecting timing info
2021-02-22 13:11:11.029736 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a8614bc-e365-4f11-bd38-1efc6ccac634', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cb5f70>]}
2021-02-22 13:11:11.031075 (Thread-1): 14:11:11 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.95s]
2021-02-22 13:11:11.031254 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:11:11.032671 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 13:11:11.033021 (MainThread): 14:11:11 | 
2021-02-22 13:11:11.033166 (MainThread): 14:11:11 | Finished running 1 view model in 4.09s.
2021-02-22 13:11:11.033291 (MainThread): Connection 'master' was properly closed.
2021-02-22 13:11:11.033385 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-22 13:11:11.037604 (MainThread): 
2021-02-22 13:11:11.037757 (MainThread): Completed successfully
2021-02-22 13:11:11.037891 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-22 13:11:11.038110 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e2dd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084f91c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084f94c0>]}
2021-02-22 13:11:11.038308 (MainThread): Flushing usage events
2021-02-22 13:12:43.763408 (MainThread): Running with dbt=0.18.1
2021-02-22 13:12:44.294612 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 13:12:44.295921 (MainThread): Tracking: tracking
2021-02-22 13:12:44.303521 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110266e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110286b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110286820>]}
2021-02-22 13:12:44.329781 (MainThread): Partial parsing not enabled
2021-02-22 13:12:44.331225 (MainThread): Parsing macros/etc.sql
2021-02-22 13:12:44.333252 (MainThread): Parsing macros/catalog.sql
2021-02-22 13:12:44.339835 (MainThread): Parsing macros/adapters.sql
2021-02-22 13:12:44.358939 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 13:12:44.362341 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 13:12:44.365330 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 13:12:44.374930 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 13:12:44.379693 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 13:12:44.392566 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 13:12:44.396411 (MainThread): Parsing macros/core.sql
2021-02-22 13:12:44.400929 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 13:12:44.410835 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 13:12:44.413096 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 13:12:44.430367 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 13:12:44.460711 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 13:12:44.481161 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 13:12:44.483472 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 13:12:44.490411 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 13:12:44.504448 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 13:12:44.511986 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 13:12:44.518221 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 13:12:44.523145 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 13:12:44.524399 (MainThread): Parsing macros/etc/query.sql
2021-02-22 13:12:44.525831 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 13:12:44.528024 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 13:12:44.537724 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 13:12:44.539983 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 13:12:44.541828 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 13:12:44.582972 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 13:12:44.587552 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 13:12:44.590558 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 13:12:44.593082 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 13:12:44.602325 (MainThread): Partial parsing not enabled
2021-02-22 13:12:44.639046 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 13:12:44.659363 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 13:12:44.670087 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 13:12:44.680674 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 13:12:44.690764 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 13:12:44.701202 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 13:12:44.720536 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 13:12:44.758401 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-22 13:12:45.008506 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-22 13:12:45.066471 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-22 13:12:45.067319 (MainThread): 
2021-02-22 13:12:45.067562 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 13:12:45.068711 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-22 13:12:45.068884 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-22 13:12:47.121038 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-22 13:12:47.121351 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-22 13:12:47.565986 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-22 13:12:48.117932 (MainThread): 14:12:48 | Concurrency: 1 threads (target='dev')
2021-02-22 13:12:48.118147 (MainThread): 14:12:48 | 
2021-02-22 13:12:48.122642 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:12:48.123756 (Thread-1): 14:12:48 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-22 13:12:48.124064 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 13:12:48.124202 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:12:48.137503 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 13:12:48.137920 (Thread-1): finished collecting timing info
2021-02-22 13:12:48.172590 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 13:12:48.173024 (Thread-1): Opening a new connection, currently in state closed
2021-02-22 13:12:48.667005 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-22 13:12:50.077890 (Thread-1): finished collecting timing info
2021-02-22 13:12:50.078815 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0967e522-195d-4f94-b91c-d968e11f373b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb7f0d0>]}
2021-02-22 13:12:50.080111 (Thread-1): 14:12:50 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.95s]
2021-02-22 13:12:50.080277 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:12:50.082679 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 13:12:50.083076 (MainThread): 14:12:50 | 
2021-02-22 13:12:50.083226 (MainThread): 14:12:50 | Finished running 1 view model in 5.02s.
2021-02-22 13:12:50.083349 (MainThread): Connection 'master' was properly closed.
2021-02-22 13:12:50.083441 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-22 13:12:50.087599 (MainThread): 
2021-02-22 13:12:50.087756 (MainThread): Completed successfully
2021-02-22 13:12:50.087886 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-22 13:12:50.088113 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110336f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102d3250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe01130>]}
2021-02-22 13:12:50.088310 (MainThread): Flushing usage events
2021-02-22 13:14:13.935120 (MainThread): Running with dbt=0.18.1
2021-02-22 13:14:14.468388 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-22 13:14:14.469332 (MainThread): Tracking: tracking
2021-02-22 13:14:14.475799 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104838dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f8c220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f8c100>]}
2021-02-22 13:14:14.499400 (MainThread): Partial parsing not enabled
2021-02-22 13:14:14.500679 (MainThread): Parsing macros/etc.sql
2021-02-22 13:14:14.502481 (MainThread): Parsing macros/catalog.sql
2021-02-22 13:14:14.508742 (MainThread): Parsing macros/adapters.sql
2021-02-22 13:14:14.528124 (MainThread): Parsing macros/materializations/seed.sql
2021-02-22 13:14:14.531366 (MainThread): Parsing macros/materializations/view.sql
2021-02-22 13:14:14.534584 (MainThread): Parsing macros/materializations/table.sql
2021-02-22 13:14:14.544690 (MainThread): Parsing macros/materializations/copy.sql
2021-02-22 13:14:14.549618 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-22 13:14:14.564240 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-22 13:14:14.567567 (MainThread): Parsing macros/core.sql
2021-02-22 13:14:14.571954 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-22 13:14:14.580806 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-22 13:14:14.582799 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-22 13:14:14.600695 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-22 13:14:14.628957 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-22 13:14:14.649634 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-22 13:14:14.651551 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-22 13:14:14.657560 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-22 13:14:14.671998 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-22 13:14:14.679004 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-22 13:14:14.686136 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-22 13:14:14.692845 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-22 13:14:14.694032 (MainThread): Parsing macros/etc/query.sql
2021-02-22 13:14:14.695225 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-22 13:14:14.697462 (MainThread): Parsing macros/etc/datetime.sql
2021-02-22 13:14:14.706487 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-22 13:14:14.708724 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-22 13:14:14.710660 (MainThread): Parsing macros/adapters/common.sql
2021-02-22 13:14:14.752263 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-22 13:14:14.754631 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-22 13:14:14.756729 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-22 13:14:14.758797 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-22 13:14:14.767380 (MainThread): Partial parsing not enabled
2021-02-22 13:14:14.804836 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-22 13:14:14.825859 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-22 13:14:14.836342 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-22 13:14:14.847193 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-22 13:14:14.857915 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 13:14:14.867096 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-22 13:14:14.884273 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-22 13:14:14.922275 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-22 13:14:15.180311 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-22 13:14:15.238600 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-22 13:14:15.239581 (MainThread): 
2021-02-22 13:14:15.239968 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 13:14:15.241216 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-22 13:14:15.241334 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-22 13:14:16.490161 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-22 13:14:16.490437 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-22 13:14:16.941755 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-22 13:14:17.455657 (MainThread): 14:14:17 | Concurrency: 1 threads (target='dev')
2021-02-22 13:14:17.455859 (MainThread): 14:14:17 | 
2021-02-22 13:14:17.461195 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:14:17.462432 (Thread-1): 14:14:17 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-22 13:14:17.462769 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-22 13:14:17.462908 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:14:17.476080 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 13:14:17.476501 (Thread-1): finished collecting timing info
2021-02-22 13:14:17.508881 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-22 13:14:17.509320 (Thread-1): Opening a new connection, currently in state closed
2021-02-22 13:14:17.950405 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-22 13:14:19.060106 (Thread-1): finished collecting timing info
2021-02-22 13:14:19.061011 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '828d48ea-7e5d-4a25-aa04-b4901717f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104846c40>]}
2021-02-22 13:14:19.062372 (Thread-1): 14:14:19 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.60s]
2021-02-22 13:14:19.062638 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-22 13:14:19.064551 (MainThread): Acquiring new bigquery connection "master".
2021-02-22 13:14:19.065085 (MainThread): 14:14:19 | 
2021-02-22 13:14:19.065254 (MainThread): 14:14:19 | Finished running 1 view model in 3.83s.
2021-02-22 13:14:19.065384 (MainThread): Connection 'master' was properly closed.
2021-02-22 13:14:19.065479 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-22 13:14:19.070274 (MainThread): 
2021-02-22 13:14:19.070469 (MainThread): Completed successfully
2021-02-22 13:14:19.070604 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-22 13:14:19.070841 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f648e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105159460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051590a0>]}
2021-02-22 13:14:19.071062 (MainThread): Flushing usage events
2021-02-25 15:45:07.167445 (MainThread): Running with dbt=0.18.1
2021-02-25 15:45:07.728164 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-25 15:45:07.729321 (MainThread): Tracking: tracking
2021-02-25 15:45:07.739549 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f4f8e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f51dd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f51d9a0>]}
2021-02-25 15:45:07.765702 (MainThread): Partial parsing not enabled
2021-02-25 15:45:07.767199 (MainThread): Parsing macros/etc.sql
2021-02-25 15:45:07.769170 (MainThread): Parsing macros/catalog.sql
2021-02-25 15:45:07.775965 (MainThread): Parsing macros/adapters.sql
2021-02-25 15:45:07.794954 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 15:45:07.797924 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 15:45:07.801120 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 15:45:07.812198 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 15:45:07.816750 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 15:45:07.830008 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 15:45:07.834114 (MainThread): Parsing macros/core.sql
2021-02-25 15:45:07.838174 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 15:45:07.847489 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 15:45:07.849470 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 15:45:07.866863 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 15:45:07.901566 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 15:45:07.921844 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 15:45:07.926050 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 15:45:07.934926 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 15:45:07.950488 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 15:45:07.957237 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 15:45:07.963375 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 15:45:07.968484 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 15:45:07.969590 (MainThread): Parsing macros/etc/query.sql
2021-02-25 15:45:07.970821 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 15:45:07.972606 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 15:45:07.982651 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 15:45:07.984967 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 15:45:07.986839 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 15:45:08.029122 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 15:45:08.031406 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 15:45:08.033212 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 15:45:08.035024 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 15:45:08.042249 (MainThread): Partial parsing not enabled
2021-02-25 15:45:08.080449 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 15:45:08.101901 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 15:45:08.117768 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 15:45:08.130898 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 15:45:08.142496 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 15:45:08.152845 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 15:45:08.170242 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 15:45:08.207749 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 15:45:08.449568 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-25 15:45:08.507780 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 15:45:08.508721 (MainThread): 
2021-02-25 15:45:08.508978 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 15:45:08.510362 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 15:45:08.510483 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 15:45:09.846106 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 15:45:09.846399 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 15:45:10.351039 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:45:10.946876 (MainThread): 16:45:10 | Concurrency: 1 threads (target='dev')
2021-02-25 15:45:10.947098 (MainThread): 16:45:10 | 
2021-02-25 15:45:10.953959 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-25 15:45:10.955260 (Thread-1): 16:45:10 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-25 15:45:10.955609 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 15:45:10.955775 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-25 15:45:10.969650 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-25 15:45:10.971334 (Thread-1): finished collecting timing info
2021-02-25 15:45:11.004772 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-25 15:45:11.005225 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 15:45:11.491375 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-25 15:45:12.595933 (Thread-1): finished collecting timing info
2021-02-25 15:45:12.596848 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab389716-8bb9-4c83-aadc-2d45e0d1a339', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f0999d0>]}
2021-02-25 15:45:12.598271 (Thread-1): 16:45:12 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.64s]
2021-02-25 15:45:12.598475 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-25 15:45:12.599880 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 15:45:12.600228 (MainThread): 16:45:12 | 
2021-02-25 15:45:12.600372 (MainThread): 16:45:12 | Finished running 1 view model in 4.09s.
2021-02-25 15:45:12.600496 (MainThread): Connection 'master' was properly closed.
2021-02-25 15:45:12.600588 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-25 15:45:12.604710 (MainThread): 
2021-02-25 15:45:12.604867 (MainThread): Completed successfully
2021-02-25 15:45:12.605015 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 15:45:12.605234 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f7204c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f5d8df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f5d8b50>]}
2021-02-25 15:45:12.605430 (MainThread): Flushing usage events
2021-02-25 15:46:12.494052 (MainThread): Running with dbt=0.18.1
2021-02-25 15:46:13.001296 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-25 15:46:13.002627 (MainThread): Tracking: tracking
2021-02-25 15:46:13.009513 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dcdac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108516eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108516b50>]}
2021-02-25 15:46:13.034043 (MainThread): Partial parsing not enabled
2021-02-25 15:46:13.035483 (MainThread): Parsing macros/etc.sql
2021-02-25 15:46:13.037461 (MainThread): Parsing macros/catalog.sql
2021-02-25 15:46:13.044487 (MainThread): Parsing macros/adapters.sql
2021-02-25 15:46:13.065105 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 15:46:13.068158 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 15:46:13.071184 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 15:46:13.080830 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 15:46:13.086026 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 15:46:13.100100 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 15:46:13.103514 (MainThread): Parsing macros/core.sql
2021-02-25 15:46:13.108221 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 15:46:13.118679 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 15:46:13.120883 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 15:46:13.138891 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 15:46:13.168303 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 15:46:13.189216 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 15:46:13.192143 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 15:46:13.200261 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 15:46:13.216639 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 15:46:13.224842 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 15:46:13.232416 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 15:46:13.238766 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 15:46:13.240067 (MainThread): Parsing macros/etc/query.sql
2021-02-25 15:46:13.241460 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 15:46:13.243403 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 15:46:13.253623 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 15:46:13.256003 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 15:46:13.258106 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 15:46:13.303040 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 15:46:13.307691 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 15:46:13.310677 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 15:46:13.313171 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 15:46:13.322207 (MainThread): Partial parsing not enabled
2021-02-25 15:46:13.359621 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 15:46:13.379625 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 15:46:13.389865 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 15:46:13.400476 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 15:46:13.409950 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 15:46:13.419386 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 15:46:13.435463 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 15:46:13.469019 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 15:46:13.712626 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-25 15:46:13.772169 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 15:46:13.772999 (MainThread): 
2021-02-25 15:46:13.773244 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 15:46:13.774474 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 15:46:13.774597 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 15:46:15.166059 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 15:46:15.166383 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 15:46:15.651613 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:46:16.228126 (MainThread): 16:46:16 | Concurrency: 1 threads (target='dev')
2021-02-25 15:46:16.228325 (MainThread): 16:46:16 | 
2021-02-25 15:46:16.232820 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-25 15:46:16.233813 (Thread-1): 16:46:16 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-25 15:46:16.234107 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 15:46:16.234252 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-25 15:46:16.247166 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-25 15:46:16.248163 (Thread-1): finished collecting timing info
2021-02-25 15:46:16.280915 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-25 15:46:16.281350 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 15:46:16.760659 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-25 15:46:17.963932 (Thread-1): finished collecting timing info
2021-02-25 15:46:17.964799 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb4b13a6-b5e0-456c-9e0a-818ff73cdfb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085afd60>]}
2021-02-25 15:46:17.966137 (Thread-1): 16:46:17 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.73s]
2021-02-25 15:46:17.966307 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-25 15:46:17.967634 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 15:46:17.967969 (MainThread): 16:46:17 | 
2021-02-25 15:46:17.968111 (MainThread): 16:46:17 | Finished running 1 view model in 4.19s.
2021-02-25 15:46:17.968233 (MainThread): Connection 'master' was properly closed.
2021-02-25 15:46:17.968322 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-25 15:46:17.972472 (MainThread): 
2021-02-25 15:46:17.972617 (MainThread): Completed successfully
2021-02-25 15:46:17.972744 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 15:46:17.972948 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086c1fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084d8610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084d8490>]}
2021-02-25 15:46:17.973135 (MainThread): Flushing usage events
2021-02-25 15:50:26.691286 (MainThread): Running with dbt=0.18.1
2021-02-25 15:50:27.210054 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-25 15:50:27.211170 (MainThread): Tracking: tracking
2021-02-25 15:50:27.217729 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112318dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a69310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a69040>]}
2021-02-25 15:50:27.240975 (MainThread): Partial parsing not enabled
2021-02-25 15:50:27.242346 (MainThread): Parsing macros/etc.sql
2021-02-25 15:50:27.244276 (MainThread): Parsing macros/catalog.sql
2021-02-25 15:50:27.250505 (MainThread): Parsing macros/adapters.sql
2021-02-25 15:50:27.268614 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 15:50:27.271416 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 15:50:27.274400 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 15:50:27.284358 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 15:50:27.289246 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 15:50:27.301664 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 15:50:27.304761 (MainThread): Parsing macros/core.sql
2021-02-25 15:50:27.308730 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 15:50:27.318146 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 15:50:27.319988 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 15:50:27.337327 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 15:50:27.371948 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 15:50:27.391965 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 15:50:27.393997 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 15:50:27.400277 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 15:50:27.413770 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 15:50:27.422877 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 15:50:27.430597 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 15:50:27.436510 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 15:50:27.437715 (MainThread): Parsing macros/etc/query.sql
2021-02-25 15:50:27.439061 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 15:50:27.441121 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 15:50:27.450886 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 15:50:27.452974 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 15:50:27.454721 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 15:50:27.495269 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 15:50:27.498822 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 15:50:27.501255 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 15:50:27.503944 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 15:50:27.515387 (MainThread): Partial parsing not enabled
2021-02-25 15:50:27.552647 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 15:50:27.572653 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 15:50:27.584825 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 15:50:27.595619 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 15:50:27.607077 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 15:50:27.618479 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 15:50:27.635590 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 15:50:27.669997 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 15:50:27.908539 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-25 15:50:27.964476 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 15:50:27.965553 (MainThread): 
2021-02-25 15:50:27.965793 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 15:50:27.968191 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 15:50:27.968344 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 15:50:29.404074 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 15:50:29.404389 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 15:50:29.870565 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:50:30.441703 (MainThread): 16:50:30 | Concurrency: 1 threads (target='dev')
2021-02-25 15:50:30.441935 (MainThread): 16:50:30 | 
2021-02-25 15:50:30.448376 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-25 15:50:30.449729 (Thread-1): 16:50:30 | 1 of 2 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-25 15:50:30.450095 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 15:50:30.450266 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-25 15:50:30.467355 (Thread-1): finished collecting timing info
2021-02-25 15:50:30.490737 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 15:50:30.938541 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:50:31.522152 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-25 15:50:33.487300 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:50:33.745029 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 15:50:31.882977+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 15:50:31.882977+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-25 15:50:31.882977+00:00"), TIMESTAMP("2021-02-25 15:50:31.882977+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-25 15:50:31.882977+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 15:50:31.882977+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 15:50:31.882977+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-25 15:50:31.882977+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-25 15:50:42.645539 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:50:42.866563 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:50:43.095918 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-25 15:50:43.096121 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:50:43.828171 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:50:44.055303 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-25 15:50:44.058622 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-25 15:51:04.948050 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 54941, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-25 15:51:04.948268 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 54940, 0, 0), raddr=('2a00:1450:400f:803::200a', 443, 0, 0)>
2021-02-25 15:51:04.951076 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-25 15:51:05.735213 (Thread-1): finished collecting timing info
2021-02-25 15:51:05.736197 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4f0a4e-9bc3-43ed-b234-f2cbc90b7ee9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a83be0>]}
2021-02-25 15:51:05.737994 (Thread-1): 16:51:05 | 1 of 2 OK snapshotted enhetsregisteret.foretak....................... [MERGE (86.0k rows, 225.2 MB processed) in 35.29s]
2021-02-25 15:51:05.738192 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-25 15:51:05.738373 (Thread-1): Began running node snapshot.enhetsregisteret.virksomheter
2021-02-25 15:51:05.739524 (Thread-1): 16:51:05 | 2 of 2 START snapshot enhetsregisteret.virksomheter.................. [RUN]
2021-02-25 15:51:05.740019 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 15:51:05.740181 (Thread-1): Compiling snapshot.enhetsregisteret.virksomheter
2021-02-25 15:51:05.750756 (Thread-1): finished collecting timing info
2021-02-25 15:51:05.754021 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 15:51:06.223370 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:51:06.772958 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:51:06.997240 (Thread-1): On snapshot.enhetsregisteret.virksomheter: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`virksomheter__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_virksomheter_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`virksomheter`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-25 15:51:09.272912 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:51:09.494103 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:51:09.703205 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`virksomheter`".
2021-02-25 15:51:09.703473 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:51:10.410483 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:51:10.690301 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.virksomheter"
2021-02-25 15:51:10.694397 (Thread-1): On snapshot.enhetsregisteret.virksomheter: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */

      merge into `radjobads`.`enhetsregisteret`.`virksomheter` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`virksomheter__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-25 15:51:12.911796 (Thread-1): On snapshot.enhetsregisteret.virksomheter: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.virksomheter"} */
drop table if exists `radjobads`.`enhetsregisteret`.`virksomheter__dbt_tmp`
2021-02-25 15:51:13.651820 (Thread-1): finished collecting timing info
2021-02-25 15:51:13.652817 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce4f0a4e-9bc3-43ed-b234-f2cbc90b7ee9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a8aee0>]}
2021-02-25 15:51:13.654453 (Thread-1): 16:51:13 | 2 of 2 OK snapshotted enhetsregisteret.virksomheter.................. [MERGE (0.0 rows, 0.0 Bytes processed) in 7.91s]
2021-02-25 15:51:13.654634 (Thread-1): Finished running node snapshot.enhetsregisteret.virksomheter
2021-02-25 15:51:13.657012 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 15:51:13.657433 (MainThread): 16:51:13 | 
2021-02-25 15:51:13.657584 (MainThread): 16:51:13 | Finished running 2 snapshots in 45.69s.
2021-02-25 15:51:13.657707 (MainThread): Connection 'master' was properly closed.
2021-02-25 15:51:13.657799 (MainThread): Connection 'snapshot.enhetsregisteret.virksomheter' was properly closed.
2021-02-25 15:51:13.665869 (MainThread): 
2021-02-25 15:51:13.666038 (MainThread): Completed successfully
2021-02-25 15:51:13.666172 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2021-02-25 15:51:13.666418 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125da190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112bea0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112beadf0>]}
2021-02-25 15:51:13.666631 (MainThread): Flushing usage events
2021-02-25 15:55:09.823455 (MainThread): Running with dbt=0.18.1
2021-02-25 15:55:10.312278 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-25 15:55:10.314446 (MainThread): Tracking: tracking
2021-02-25 15:55:10.323953 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049aad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050f6eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050f6b50>]}
2021-02-25 15:55:10.347998 (MainThread): Partial parsing not enabled
2021-02-25 15:55:10.349884 (MainThread): Parsing macros/etc.sql
2021-02-25 15:55:10.351794 (MainThread): Parsing macros/catalog.sql
2021-02-25 15:55:10.359446 (MainThread): Parsing macros/adapters.sql
2021-02-25 15:55:10.381654 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 15:55:10.384803 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 15:55:10.388068 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 15:55:10.399806 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 15:55:10.405064 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 15:55:10.420422 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 15:55:10.425274 (MainThread): Parsing macros/core.sql
2021-02-25 15:55:10.429367 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 15:55:10.438885 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 15:55:10.441148 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 15:55:10.459529 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 15:55:10.491366 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 15:55:10.514937 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 15:55:10.517195 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 15:55:10.524642 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 15:55:10.540372 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 15:55:10.547952 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 15:55:10.555123 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 15:55:10.560825 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 15:55:10.562039 (MainThread): Parsing macros/etc/query.sql
2021-02-25 15:55:10.563446 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 15:55:10.565417 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 15:55:10.575380 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 15:55:10.577746 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 15:55:10.579908 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 15:55:10.626821 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 15:55:10.629214 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 15:55:10.630980 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 15:55:10.632953 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 15:55:10.641237 (MainThread): Partial parsing not enabled
2021-02-25 15:55:10.683024 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 15:55:10.704777 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 15:55:10.716903 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 15:55:10.727793 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 15:55:10.738701 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 15:55:10.749020 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 15:55:10.767315 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 15:55:10.805018 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 15:55:11.057506 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-25 15:55:11.119201 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 15:55:11.120159 (MainThread): 
2021-02-25 15:55:11.120434 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 15:55:11.122223 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 15:55:11.122408 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 15:55:12.298716 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 15:55:12.298988 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 15:55:12.795066 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:55:13.184557 (MainThread): 16:55:13 | Concurrency: 1 threads (target='dev')
2021-02-25 15:55:13.184737 (MainThread): 16:55:13 | 
2021-02-25 15:55:13.188860 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-25 15:55:13.190267 (Thread-1): 16:55:13 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-25 15:55:13.190585 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 15:55:13.190721 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-25 15:55:13.205040 (Thread-1): finished collecting timing info
2021-02-25 15:55:13.230123 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 15:55:13.787171 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:55:14.323156 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-25 15:55:16.453005 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:55:16.756236 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 15:55:14.837500+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 15:55:14.837500+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-25 15:55:14.837500+00:00"), TIMESTAMP("2021-02-25 15:55:14.837500+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-25 15:55:14.837500+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 15:55:14.837500+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 15:55:14.837500+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-25 15:55:14.837500+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-25 15:55:27.698738 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:55:27.913398 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:55:28.191549 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-25 15:55:28.191697 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:55:28.907983 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 15:55:29.219675 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-25 15:55:29.247222 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-25 15:55:41.633808 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 55096, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-25 15:55:41.641661 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 55095, 0, 0), raddr=('2a00:1450:400f:800::200a', 443, 0, 0)>
2021-02-25 15:55:41.642736 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-25 15:55:42.423605 (Thread-1): finished collecting timing info
2021-02-25 15:55:42.424242 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cca79c0-adbf-4e04-ad65-2532e1e9d665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105197670>]}
2021-02-25 15:55:42.425353 (Thread-1): 16:55:42 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (1.0m rows, 111.6 MB processed) in 29.23s]
2021-02-25 15:55:42.425485 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-25 15:55:42.426682 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 15:55:42.426932 (MainThread): 16:55:42 | 
2021-02-25 15:55:42.427036 (MainThread): 16:55:42 | Finished running 1 snapshot in 31.31s.
2021-02-25 15:55:42.427123 (MainThread): Connection 'master' was properly closed.
2021-02-25 15:55:42.427187 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-25 15:55:42.431343 (MainThread): 
2021-02-25 15:55:42.431468 (MainThread): Completed successfully
2021-02-25 15:55:42.431567 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 15:55:42.431742 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10510de20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052a2070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105273f70>]}
2021-02-25 15:55:42.431898 (MainThread): Flushing usage events
2021-02-25 17:45:22.860983 (MainThread): Running with dbt=0.18.1
2021-02-25 17:45:23.446725 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-25 17:45:23.448240 (MainThread): Tracking: tracking
2021-02-25 17:45:23.456517 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107463f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107babd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107baba00>]}
2021-02-25 17:45:23.479559 (MainThread): Partial parsing not enabled
2021-02-25 17:45:23.481344 (MainThread): Parsing macros/etc.sql
2021-02-25 17:45:23.483062 (MainThread): Parsing macros/catalog.sql
2021-02-25 17:45:23.489216 (MainThread): Parsing macros/adapters.sql
2021-02-25 17:45:23.507009 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 17:45:23.509910 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 17:45:23.512864 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 17:45:23.522515 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 17:45:23.526822 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 17:45:23.538838 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 17:45:23.542694 (MainThread): Parsing macros/core.sql
2021-02-25 17:45:23.546687 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 17:45:23.555259 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 17:45:23.557094 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 17:45:23.573415 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 17:45:23.601294 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 17:45:23.620952 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 17:45:23.624852 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 17:45:23.632033 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 17:45:23.646523 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 17:45:23.653148 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 17:45:23.659323 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 17:45:23.664121 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 17:45:23.665192 (MainThread): Parsing macros/etc/query.sql
2021-02-25 17:45:23.666514 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 17:45:23.668283 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 17:45:23.676717 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 17:45:23.678794 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 17:45:23.680623 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 17:45:23.720370 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 17:45:23.722913 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 17:45:23.725108 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 17:45:23.727260 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 17:45:23.735802 (MainThread): Partial parsing not enabled
2021-02-25 17:45:23.773854 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 17:45:23.794442 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 17:45:23.806145 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 17:45:23.818345 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 17:45:23.830600 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:45:23.840720 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 17:45:23.859308 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:45:23.893354 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 17:45:24.141475 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-25 17:45:24.198237 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 17:45:24.199166 (MainThread): 
2021-02-25 17:45:24.199431 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:45:24.200684 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 17:45:24.200805 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 17:45:25.536623 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 17:45:25.536920 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 17:45:25.983665 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:45:26.372225 (MainThread): 18:45:26 | Concurrency: 1 threads (target='dev')
2021-02-25 17:45:26.372457 (MainThread): 18:45:26 | 
2021-02-25 17:45:26.379414 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-25 17:45:26.380795 (Thread-1): 18:45:26 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-25 17:45:26.381164 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:45:26.381338 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-25 17:45:26.398413 (Thread-1): finished collecting timing info
2021-02-25 17:45:26.421885 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 17:45:26.857060 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:45:27.519217 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-25 17:45:29.947453 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:45:30.198106 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:45:28.103268+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:45:28.103268+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-25 17:45:28.103268+00:00"), TIMESTAMP("2021-02-25 17:45:28.103268+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-25 17:45:28.103268+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:45:28.103268+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:45:28.103268+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-25 17:45:28.103268+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-25 17:45:38.481602 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:45:38.744415 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:45:39.056886 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-25 17:45:39.057117 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:45:39.870578 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:45:40.082724 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 56801, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-25 17:45:40.083043 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 56802, 0, 0), raddr=('2a00:1450:400f:809::200a', 443, 0, 0)>
2021-02-25 17:45:40.083282 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 56805, 0, 0), raddr=('2a00:1450:400f:809::200a', 443, 0, 0)>
2021-02-25 17:45:40.083450 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 56804, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-25 17:45:40.088965 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-25 17:45:40.090258 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-25 17:45:53.245958 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-25 17:45:54.098824 (Thread-1): finished collecting timing info
2021-02-25 17:45:54.099816 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c67f136-f153-48e0-a3af-8dbd0b792058', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e67070>]}
2021-02-25 17:45:54.101566 (Thread-1): 18:45:54 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (87.2k rows, 113.7 MB processed) in 27.72s]
2021-02-25 17:45:54.101764 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-25 17:45:54.103041 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:45:54.103423 (MainThread): 18:45:54 | 
2021-02-25 17:45:54.103580 (MainThread): 18:45:54 | Finished running 1 snapshot in 29.90s.
2021-02-25 17:45:54.103717 (MainThread): Connection 'master' was properly closed.
2021-02-25 17:45:54.103817 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-25 17:45:54.108238 (MainThread): 
2021-02-25 17:45:54.108391 (MainThread): Completed successfully
2021-02-25 17:45:54.108528 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 17:45:54.108756 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074aa040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dc6340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dc65e0>]}
2021-02-25 17:45:54.108959 (MainThread): Flushing usage events
2021-02-25 17:50:30.456134 (MainThread): Running with dbt=0.18.1
2021-02-25 17:50:30.987647 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-25 17:50:30.988578 (MainThread): Tracking: tracking
2021-02-25 17:50:30.995815 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11360afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11361a6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11361a340>]}
2021-02-25 17:50:31.020820 (MainThread): Partial parsing not enabled
2021-02-25 17:50:31.022209 (MainThread): Parsing macros/etc.sql
2021-02-25 17:50:31.024115 (MainThread): Parsing macros/catalog.sql
2021-02-25 17:50:31.030149 (MainThread): Parsing macros/adapters.sql
2021-02-25 17:50:31.048590 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 17:50:31.051465 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 17:50:31.054389 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 17:50:31.064465 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 17:50:31.068984 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 17:50:31.081504 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 17:50:31.084709 (MainThread): Parsing macros/core.sql
2021-02-25 17:50:31.088716 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 17:50:31.098305 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 17:50:31.100274 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 17:50:31.118054 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 17:50:31.146554 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 17:50:31.168011 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 17:50:31.169994 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 17:50:31.176503 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 17:50:31.189712 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 17:50:31.196352 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 17:50:31.202691 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 17:50:31.207712 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 17:50:31.208754 (MainThread): Parsing macros/etc/query.sql
2021-02-25 17:50:31.209953 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 17:50:31.211754 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 17:50:31.220402 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 17:50:31.222452 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 17:50:31.224294 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 17:50:31.264756 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 17:50:31.267143 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 17:50:31.269341 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 17:50:31.271100 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 17:50:31.278649 (MainThread): Partial parsing not enabled
2021-02-25 17:50:31.313370 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 17:50:31.332408 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 17:50:31.343212 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 17:50:31.353439 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 17:50:31.363781 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:50:31.373079 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 17:50:31.388675 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:50:31.421712 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 17:50:31.661847 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-25 17:50:31.722773 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 17:50:31.723751 (MainThread): 
2021-02-25 17:50:31.724046 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:50:31.725461 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 17:50:31.725676 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 17:50:32.989324 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 17:50:32.989603 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 17:50:33.437555 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:50:33.943111 (MainThread): 18:50:33 | Concurrency: 1 threads (target='dev')
2021-02-25 17:50:33.943341 (MainThread): 18:50:33 | 
2021-02-25 17:50:33.948534 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-25 17:50:33.949748 (Thread-1): 18:50:33 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-25 17:50:33.950072 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:50:33.950237 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-25 17:50:33.966057 (Thread-1): finished collecting timing info
2021-02-25 17:50:33.989164 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 17:50:34.422438 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:50:34.966761 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-25 17:50:36.945747 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:50:37.191047 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:50:35.282298+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:50:35.282298+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-25 17:50:35.282298+00:00"), TIMESTAMP("2021-02-25 17:50:35.282298+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-25 17:50:35.282298+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:50:35.282298+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:50:35.282298+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-25 17:50:35.282298+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-25 17:50:44.528723 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:50:44.749550 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:50:44.984279 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-25 17:50:44.984488 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:50:45.670162 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:50:45.874666 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-25 17:50:45.875253 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-25 17:50:59.892837 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 56908, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-25 17:50:59.893067 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 56907, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-25 17:50:59.894216 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-25 17:51:00.904179 (Thread-1): finished collecting timing info
2021-02-25 17:51:00.905171 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9715846-b862-46d8-ae0a-bfaaef12af75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137c4310>]}
2021-02-25 17:51:00.906840 (Thread-1): 18:51:00 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (6.8k rows, 109.4 MB processed) in 26.95s]
2021-02-25 17:51:00.907022 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-25 17:51:00.908244 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:51:00.908582 (MainThread): 18:51:00 | 
2021-02-25 17:51:00.908721 (MainThread): 18:51:00 | Finished running 1 snapshot in 29.18s.
2021-02-25 17:51:00.908844 (MainThread): Connection 'master' was properly closed.
2021-02-25 17:51:00.908961 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-25 17:51:00.913130 (MainThread): 
2021-02-25 17:51:00.913273 (MainThread): Completed successfully
2021-02-25 17:51:00.913397 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 17:51:00.913606 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1136d3100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11387f0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11387f160>]}
2021-02-25 17:51:00.913792 (MainThread): Flushing usage events
2021-02-25 17:52:46.036976 (MainThread): Running with dbt=0.18.1
2021-02-25 17:52:46.558413 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-25 17:52:46.559414 (MainThread): Tracking: tracking
2021-02-25 17:52:46.565994 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ace7f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b437340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b437040>]}
2021-02-25 17:52:46.589538 (MainThread): Partial parsing not enabled
2021-02-25 17:52:46.590843 (MainThread): Parsing macros/etc.sql
2021-02-25 17:52:46.592594 (MainThread): Parsing macros/catalog.sql
2021-02-25 17:52:46.599058 (MainThread): Parsing macros/adapters.sql
2021-02-25 17:52:46.617636 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 17:52:46.620792 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 17:52:46.624404 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 17:52:46.635670 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 17:52:46.640603 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 17:52:46.653695 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 17:52:46.656824 (MainThread): Parsing macros/core.sql
2021-02-25 17:52:46.662054 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 17:52:46.671220 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 17:52:46.673105 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 17:52:46.690773 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 17:52:46.719128 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 17:52:46.739606 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 17:52:46.741936 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 17:52:46.748957 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 17:52:46.763407 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 17:52:46.770339 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 17:52:46.776946 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 17:52:46.782172 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 17:52:46.783230 (MainThread): Parsing macros/etc/query.sql
2021-02-25 17:52:46.784353 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 17:52:46.786084 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 17:52:46.794898 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 17:52:46.797503 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 17:52:46.799661 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 17:52:46.843077 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 17:52:46.846542 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 17:52:46.849426 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 17:52:46.852560 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 17:52:46.863506 (MainThread): Partial parsing not enabled
2021-02-25 17:52:46.899711 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 17:52:46.919801 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 17:52:46.931074 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 17:52:46.941195 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 17:52:46.952494 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:52:46.963494 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 17:52:46.981385 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:52:47.016540 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 17:52:47.251338 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-25 17:52:47.311066 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 17:52:47.311896 (MainThread): 
2021-02-25 17:52:47.312140 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:52:47.313406 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 17:52:47.313528 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 17:52:48.450260 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 17:52:48.450574 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 17:52:48.966998 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:52:49.490730 (MainThread): 18:52:49 | Concurrency: 1 threads (target='dev')
2021-02-25 17:52:49.490972 (MainThread): 18:52:49 | 
2021-02-25 17:52:49.495817 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-25 17:52:49.496908 (Thread-1): 18:52:49 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-25 17:52:49.497198 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:52:49.497340 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-25 17:52:49.510420 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-25 17:52:49.511122 (Thread-1): finished collecting timing info
2021-02-25 17:52:49.543994 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-25 17:52:49.544417 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 17:52:50.029885 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-25 17:52:51.376069 (Thread-1): finished collecting timing info
2021-02-25 17:52:51.376890 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3da3c70-f4bd-48af-ab6e-e507357829fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4a1ac0>]}
2021-02-25 17:52:51.378151 (Thread-1): 18:52:51 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.88s]
2021-02-25 17:52:51.378306 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-25 17:52:51.379509 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:52:51.379827 (MainThread): 18:52:51 | 
2021-02-25 17:52:51.379959 (MainThread): 18:52:51 | Finished running 1 view model in 4.07s.
2021-02-25 17:52:51.380070 (MainThread): Connection 'master' was properly closed.
2021-02-25 17:52:51.380154 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-25 17:52:51.383901 (MainThread): 
2021-02-25 17:52:51.384044 (MainThread): Completed successfully
2021-02-25 17:52:51.384154 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 17:52:51.384339 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acfb910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4372e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b437a30>]}
2021-02-25 17:52:51.384507 (MainThread): Flushing usage events
2021-02-25 17:53:52.064628 (MainThread): Running with dbt=0.18.1
2021-02-25 17:53:52.582911 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['wrk_foretak_020'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-02-25 17:53:52.583833 (MainThread): Tracking: tracking
2021-02-25 17:53:52.590572 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c66340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8dca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c8d940>]}
2021-02-25 17:53:52.615879 (MainThread): Partial parsing not enabled
2021-02-25 17:53:52.617331 (MainThread): Parsing macros/etc.sql
2021-02-25 17:53:52.619460 (MainThread): Parsing macros/catalog.sql
2021-02-25 17:53:52.626499 (MainThread): Parsing macros/adapters.sql
2021-02-25 17:53:52.647226 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 17:53:52.651028 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 17:53:52.654380 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 17:53:52.665341 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 17:53:52.670562 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 17:53:52.684416 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 17:53:52.687510 (MainThread): Parsing macros/core.sql
2021-02-25 17:53:52.691620 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 17:53:52.700482 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 17:53:52.702334 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 17:53:52.719403 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 17:53:52.751007 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 17:53:52.772013 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 17:53:52.774367 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 17:53:52.781665 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 17:53:52.796790 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 17:53:52.803667 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 17:53:52.810286 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 17:53:52.815220 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 17:53:52.816304 (MainThread): Parsing macros/etc/query.sql
2021-02-25 17:53:52.817567 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 17:53:52.819427 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 17:53:52.828621 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 17:53:52.830695 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 17:53:52.832473 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 17:53:52.876314 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 17:53:52.880282 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 17:53:52.883161 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 17:53:52.885757 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 17:53:52.894892 (MainThread): Partial parsing not enabled
2021-02-25 17:53:52.931490 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 17:53:52.951361 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 17:53:52.962774 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 17:53:52.973724 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 17:53:52.985319 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:53:52.994707 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 17:53:53.012244 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:53:53.045750 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 17:53:53.287511 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-25 17:53:53.343329 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 17:53:53.344280 (MainThread): 
2021-02-25 17:53:53.344528 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:53:53.345687 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 17:53:53.345803 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 17:53:54.458146 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 17:53:54.458466 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 17:53:54.926751 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:53:55.499550 (MainThread): 18:53:55 | Concurrency: 1 threads (target='dev')
2021-02-25 17:53:55.499792 (MainThread): 18:53:55 | 
2021-02-25 17:53:55.505220 (Thread-1): Began running node model.enhetsregisteret.wrk_foretak_020
2021-02-25 17:53:55.506460 (Thread-1): 18:53:55 | 1 of 1 START view model enhetsregisteret.wrk_foretak_020............. [RUN]
2021-02-25 17:53:55.506792 (Thread-1): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:53:55.506962 (Thread-1): Compiling model.enhetsregisteret.wrk_foretak_020
2021-02-25 17:53:55.521056 (Thread-1): Writing injected SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-25 17:53:55.521392 (Thread-1): finished collecting timing info
2021-02-25 17:53:55.553182 (Thread-1): Writing runtime SQL for node "model.enhetsregisteret.wrk_foretak_020"
2021-02-25 17:53:55.553584 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 17:53:55.993999 (Thread-1): On model.enhetsregisteret.wrk_foretak_020: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "model.enhetsregisteret.wrk_foretak_020"} */


  create or replace view `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  OPTIONS()
  as WITH foretak AS (
    SELECT 
    orgnr, 
    navn,
    nkode1,
    antall_ansatte,
    CAST(valid_date AS timestamp) AS updated_at
    FROM `radjobads`.`enhetsregisteret`.`wrk_foretak_010`
)
SELECT * FROM foretak;


2021-02-25 17:53:57.255107 (Thread-1): finished collecting timing info
2021-02-25 17:53:57.256005 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e44fee0-c092-41a9-bb27-3aff85485d7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e141c0>]}
2021-02-25 17:53:57.257355 (Thread-1): 18:53:57 | 1 of 1 OK created view model enhetsregisteret.wrk_foretak_020........ [CREATE VIEW in 1.75s]
2021-02-25 17:53:57.257547 (Thread-1): Finished running node model.enhetsregisteret.wrk_foretak_020
2021-02-25 17:53:57.258874 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:53:57.259209 (MainThread): 18:53:57 | 
2021-02-25 17:53:57.259353 (MainThread): 18:53:57 | Finished running 1 view model in 3.91s.
2021-02-25 17:53:57.259475 (MainThread): Connection 'master' was properly closed.
2021-02-25 17:53:57.259565 (MainThread): Connection 'model.enhetsregisteret.wrk_foretak_020' was properly closed.
2021-02-25 17:53:57.263625 (MainThread): 
2021-02-25 17:53:57.263777 (MainThread): Completed successfully
2021-02-25 17:53:57.263909 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 17:53:57.264126 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cc6bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e3c8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e3c9d0>]}
2021-02-25 17:53:57.264325 (MainThread): Flushing usage events
2021-02-25 17:54:22.313276 (MainThread): Running with dbt=0.18.1
2021-02-25 17:54:22.657046 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-25 17:54:22.657654 (MainThread): Tracking: tracking
2021-02-25 17:54:22.662410 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f6edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076b9d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076c3130>]}
2021-02-25 17:54:22.682900 (MainThread): Partial parsing not enabled
2021-02-25 17:54:22.683877 (MainThread): Parsing macros/etc.sql
2021-02-25 17:54:22.685296 (MainThread): Parsing macros/catalog.sql
2021-02-25 17:54:22.691253 (MainThread): Parsing macros/adapters.sql
2021-02-25 17:54:22.708981 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 17:54:22.711773 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 17:54:22.714547 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 17:54:22.724067 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 17:54:22.728285 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 17:54:22.741786 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 17:54:22.745128 (MainThread): Parsing macros/core.sql
2021-02-25 17:54:22.748824 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 17:54:22.757659 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 17:54:22.759653 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 17:54:22.777192 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 17:54:22.806048 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 17:54:22.826786 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 17:54:22.828832 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 17:54:22.834946 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 17:54:22.847897 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 17:54:22.854446 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 17:54:22.860562 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 17:54:22.865186 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 17:54:22.866117 (MainThread): Parsing macros/etc/query.sql
2021-02-25 17:54:22.867298 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 17:54:22.868852 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 17:54:22.877105 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 17:54:22.878992 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 17:54:22.880545 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 17:54:22.919642 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 17:54:22.921509 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 17:54:22.922926 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 17:54:22.924511 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 17:54:22.931671 (MainThread): Partial parsing not enabled
2021-02-25 17:54:22.965242 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 17:54:22.983647 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 17:54:22.993290 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 17:54:23.002219 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 17:54:23.011157 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:54:23.019382 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 17:54:23.035074 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:54:23.067525 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 17:54:23.293877 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-25 17:54:23.348147 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 17:54:23.348964 (MainThread): 
2021-02-25 17:54:23.349207 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:54:23.350330 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 17:54:23.350446 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 17:54:24.383279 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 17:54:24.384054 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 17:54:24.845298 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:54:25.398767 (MainThread): 18:54:25 | Concurrency: 1 threads (target='dev')
2021-02-25 17:54:25.398995 (MainThread): 18:54:25 | 
2021-02-25 17:54:25.404149 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-25 17:54:25.405454 (Thread-1): 18:54:25 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-25 17:54:25.405815 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:54:25.405985 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-25 17:54:25.421931 (Thread-1): finished collecting timing info
2021-02-25 17:54:25.445411 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 17:54:25.884755 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:54:26.346574 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-25 17:54:28.290969 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:54:28.566393 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:54:26.645396+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:54:26.645396+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-25 17:54:26.645396+00:00"), TIMESTAMP("2021-02-25 17:54:26.645396+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-25 17:54:26.645396+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:54:26.645396+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:54:26.645396+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-25 17:54:26.645396+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-25 17:54:35.646358 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:54:35.862125 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:54:36.083676 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-25 17:54:36.083907 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:54:36.754649 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:54:36.959263 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57000, 0, 0), raddr=('2a00:1450:400f:803::200a', 443, 0, 0)>
2021-02-25 17:54:36.959582 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57001, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-25 17:54:36.959805 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57004, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-25 17:54:36.960017 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57003, 0, 0), raddr=('2a00:1450:400f:803::200a', 443, 0, 0)>
2021-02-25 17:54:36.965784 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-25 17:54:36.966271 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-25 17:54:47.664190 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-25 17:54:48.383761 (Thread-1): finished collecting timing info
2021-02-25 17:54:48.384650 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d66fb50-6c02-489f-9455-b5ec66a79d32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10772d9a0>]}
2021-02-25 17:54:48.386205 (Thread-1): 18:54:48 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (5.8k rows, 109.8 MB processed) in 22.98s]
2021-02-25 17:54:48.386392 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-25 17:54:48.387571 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:54:48.387904 (MainThread): 18:54:48 | 
2021-02-25 17:54:48.388051 (MainThread): 18:54:48 | Finished running 1 snapshot in 25.04s.
2021-02-25 17:54:48.388181 (MainThread): Connection 'master' was properly closed.
2021-02-25 17:54:48.388276 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-25 17:54:48.392460 (MainThread): 
2021-02-25 17:54:48.392611 (MainThread): Completed successfully
2021-02-25 17:54:48.392744 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 17:54:48.392962 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10789ab20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076de070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076de160>]}
2021-02-25 17:54:48.393159 (MainThread): Flushing usage events
2021-02-25 17:55:28.682838 (MainThread): Running with dbt=0.18.1
2021-02-25 17:55:29.030637 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-25 17:55:29.031615 (MainThread): Tracking: tracking
2021-02-25 17:55:29.037728 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd11ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d464190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d464070>]}
2021-02-25 17:55:29.059207 (MainThread): Partial parsing not enabled
2021-02-25 17:55:29.060122 (MainThread): Parsing macros/etc.sql
2021-02-25 17:55:29.061517 (MainThread): Parsing macros/catalog.sql
2021-02-25 17:55:29.067256 (MainThread): Parsing macros/adapters.sql
2021-02-25 17:55:29.084970 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 17:55:29.087535 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 17:55:29.090318 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 17:55:29.099935 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 17:55:29.104025 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 17:55:29.115911 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 17:55:29.118713 (MainThread): Parsing macros/core.sql
2021-02-25 17:55:29.122138 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 17:55:29.130472 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 17:55:29.132312 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 17:55:29.148151 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 17:55:29.174919 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 17:55:29.194819 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 17:55:29.196523 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 17:55:29.202443 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 17:55:29.215333 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 17:55:29.221643 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 17:55:29.227526 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 17:55:29.232370 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 17:55:29.233289 (MainThread): Parsing macros/etc/query.sql
2021-02-25 17:55:29.234272 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 17:55:29.235821 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 17:55:29.244016 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 17:55:29.245852 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 17:55:29.247431 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 17:55:29.287007 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 17:55:29.288752 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 17:55:29.290177 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 17:55:29.291768 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 17:55:29.300286 (MainThread): Partial parsing not enabled
2021-02-25 17:55:29.334213 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 17:55:29.352401 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 17:55:29.361410 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 17:55:29.370622 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 17:55:29.379962 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:55:29.388494 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 17:55:29.403296 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:55:29.435567 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 17:55:29.656539 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-25 17:55:29.710791 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 17:55:29.711747 (MainThread): 
2021-02-25 17:55:29.712174 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:55:29.713503 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 17:55:29.713620 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 17:55:30.966295 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 17:55:30.966592 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 17:55:31.435275 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:55:32.066208 (MainThread): 18:55:32 | Concurrency: 1 threads (target='dev')
2021-02-25 17:55:32.066430 (MainThread): 18:55:32 | 
2021-02-25 17:55:32.072438 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-25 17:55:32.073781 (Thread-1): 18:55:32 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-25 17:55:32.074127 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:55:32.074293 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-25 17:55:32.090492 (Thread-1): finished collecting timing info
2021-02-25 17:55:32.113855 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 17:55:32.556288 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:55:33.104986 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-25 17:55:35.231999 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:55:35.483498 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:55:33.507308+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:55:33.507308+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-25 17:55:33.507308+00:00"), TIMESTAMP("2021-02-25 17:55:33.507308+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-25 17:55:33.507308+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:55:33.507308+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:55:33.507308+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-25 17:55:33.507308+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-25 17:55:42.833962 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:55:43.057387 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:55:43.283762 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-25 17:55:43.283986 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:55:43.926927 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:55:44.142990 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57029, 0, 0), raddr=('2a00:1450:400f:803::200a', 443, 0, 0)>
2021-02-25 17:55:44.143302 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57030, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-25 17:55:44.143534 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57034, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-25 17:55:44.143708 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57033, 0, 0), raddr=('2a00:1450:400f:803::200a', 443, 0, 0)>
2021-02-25 17:55:44.149425 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-25 17:55:44.149954 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-25 17:55:56.201572 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-25 17:55:56.929581 (Thread-1): finished collecting timing info
2021-02-25 17:55:56.930591 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6812364-86d5-4be9-bb25-cd546aae1d4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d715520>]}
2021-02-25 17:55:56.932340 (Thread-1): 18:55:56 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (4.4k rows, 110.0 MB processed) in 24.86s]
2021-02-25 17:55:56.932535 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-25 17:55:56.933856 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:55:56.934203 (MainThread): 18:55:56 | 
2021-02-25 17:55:56.934350 (MainThread): 18:55:56 | Finished running 1 snapshot in 27.22s.
2021-02-25 17:55:56.934479 (MainThread): Connection 'master' was properly closed.
2021-02-25 17:55:56.934574 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-25 17:55:56.938762 (MainThread): 
2021-02-25 17:55:56.938915 (MainThread): Completed successfully
2021-02-25 17:55:56.939049 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 17:55:56.939277 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d50a3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d425550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4255e0>]}
2021-02-25 17:55:56.939476 (MainThread): Flushing usage events
2021-02-25 17:56:24.419299 (MainThread): Running with dbt=0.18.1
2021-02-25 17:56:24.769674 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-25 17:56:24.770328 (MainThread): Tracking: tracking
2021-02-25 17:56:24.776205 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110683f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dd2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dd2bb0>]}
2021-02-25 17:56:24.796299 (MainThread): Partial parsing not enabled
2021-02-25 17:56:24.797215 (MainThread): Parsing macros/etc.sql
2021-02-25 17:56:24.800035 (MainThread): Parsing macros/catalog.sql
2021-02-25 17:56:24.805779 (MainThread): Parsing macros/adapters.sql
2021-02-25 17:56:24.824191 (MainThread): Parsing macros/materializations/seed.sql
2021-02-25 17:56:24.827578 (MainThread): Parsing macros/materializations/view.sql
2021-02-25 17:56:24.830940 (MainThread): Parsing macros/materializations/table.sql
2021-02-25 17:56:24.841659 (MainThread): Parsing macros/materializations/copy.sql
2021-02-25 17:56:24.846321 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-25 17:56:24.858856 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-25 17:56:24.862289 (MainThread): Parsing macros/core.sql
2021-02-25 17:56:24.866642 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-25 17:56:24.875542 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-25 17:56:24.877388 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-25 17:56:24.893553 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-25 17:56:24.921310 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-25 17:56:24.941322 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-25 17:56:24.943244 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-25 17:56:24.949185 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-25 17:56:24.962437 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-25 17:56:24.969452 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-25 17:56:24.975866 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-25 17:56:24.980804 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-25 17:56:24.981915 (MainThread): Parsing macros/etc/query.sql
2021-02-25 17:56:24.983118 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-25 17:56:24.984878 (MainThread): Parsing macros/etc/datetime.sql
2021-02-25 17:56:24.993414 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-25 17:56:24.995448 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-25 17:56:24.997266 (MainThread): Parsing macros/adapters/common.sql
2021-02-25 17:56:25.037673 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-25 17:56:25.039877 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-25 17:56:25.041556 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-25 17:56:25.043345 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-25 17:56:25.051248 (MainThread): Partial parsing not enabled
2021-02-25 17:56:25.087544 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-25 17:56:25.107245 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-25 17:56:25.118761 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-25 17:56:25.129097 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-25 17:56:25.139145 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-25 17:56:25.149016 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-25 17:56:25.167464 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:56:25.201549 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-25 17:56:25.433867 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-25 17:56:25.490341 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-25 17:56:25.491159 (MainThread): 
2021-02-25 17:56:25.491400 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:56:25.492538 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-25 17:56:25.492653 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-25 17:56:26.751090 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-25 17:56:26.751399 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-25 17:56:27.196101 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:56:27.769447 (MainThread): 18:56:27 | Concurrency: 1 threads (target='dev')
2021-02-25 17:56:27.769672 (MainThread): 18:56:27 | 
2021-02-25 17:56:27.776286 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-25 17:56:27.777610 (Thread-1): 18:56:27 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-25 17:56:27.777962 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-25 17:56:27.778130 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-25 17:56:27.793895 (Thread-1): finished collecting timing info
2021-02-25 17:56:27.816916 (Thread-1): Opening a new connection, currently in state closed
2021-02-25 17:56:28.255189 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:56:28.822828 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-25 17:56:30.645470 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:56:30.899936 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:56:29.122527+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:56:29.122527+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-25 17:56:29.122527+00:00"), TIMESTAMP("2021-02-25 17:56:29.122527+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-25 17:56:29.122527+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-25 17:56:29.122527+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-25 17:56:29.122527+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-25 17:56:29.122527+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-25 17:56:40.513345 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:56:40.746215 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:56:40.972075 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-25 17:56:40.972306 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:56:41.684780 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-25 17:56:41.997974 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-25 17:56:41.999971 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-25 17:56:54.127508 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57059, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-25 17:56:54.127728 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 57058, 0, 0), raddr=('2a00:1450:400f:803::200a', 443, 0, 0)>
2021-02-25 17:56:54.129829 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-25 17:56:54.904060 (Thread-1): finished collecting timing info
2021-02-25 17:56:54.905079 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9747779c-05f3-4871-af5b-10a48e52b50e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110df7e80>]}
2021-02-25 17:56:54.906838 (Thread-1): 18:56:54 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (93.5k rows, 120.4 MB processed) in 27.13s]
2021-02-25 17:56:54.907039 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-25 17:56:54.908328 (MainThread): Acquiring new bigquery connection "master".
2021-02-25 17:56:54.908708 (MainThread): 18:56:54 | 
2021-02-25 17:56:54.908856 (MainThread): 18:56:54 | Finished running 1 snapshot in 29.42s.
2021-02-25 17:56:54.908985 (MainThread): Connection 'master' was properly closed.
2021-02-25 17:56:54.909080 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-25 17:56:54.913386 (MainThread): 
2021-02-25 17:56:54.913536 (MainThread): Completed successfully
2021-02-25 17:56:54.913670 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-25 17:56:54.913905 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111057910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f74790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f9ee20>]}
2021-02-25 17:56:54.914104 (MainThread): Flushing usage events
2021-02-26 06:43:38.544077 (MainThread): Running with dbt=0.18.1
2021-02-26 06:43:39.131526 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 06:43:39.132627 (MainThread): Tracking: tracking
2021-02-26 06:43:39.142085 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11200e820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11201e970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11201e610>]}
2021-02-26 06:43:39.166059 (MainThread): Partial parsing not enabled
2021-02-26 06:43:39.167346 (MainThread): Parsing macros/etc.sql
2021-02-26 06:43:39.169188 (MainThread): Parsing macros/catalog.sql
2021-02-26 06:43:39.174948 (MainThread): Parsing macros/adapters.sql
2021-02-26 06:43:39.193516 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 06:43:39.196887 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 06:43:39.200487 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 06:43:39.213590 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 06:43:39.218564 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 06:43:39.232042 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 06:43:39.235488 (MainThread): Parsing macros/core.sql
2021-02-26 06:43:39.239512 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 06:43:39.248355 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 06:43:39.252115 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 06:43:39.271839 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 06:43:39.301604 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 06:43:39.321317 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 06:43:39.323296 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 06:43:39.329254 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 06:43:39.342470 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 06:43:39.350226 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 06:43:39.357242 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 06:43:39.362190 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 06:43:39.363236 (MainThread): Parsing macros/etc/query.sql
2021-02-26 06:43:39.364535 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 06:43:39.366508 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 06:43:39.375460 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 06:43:39.377522 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 06:43:39.379374 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 06:43:39.419498 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 06:43:39.421991 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 06:43:39.423762 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 06:43:39.425497 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 06:43:39.432708 (MainThread): Partial parsing not enabled
2021-02-26 06:43:39.467326 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 06:43:39.486603 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 06:43:39.496366 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 06:43:39.506264 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 06:43:39.517514 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 06:43:39.526807 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 06:43:39.541749 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 06:43:39.575009 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 06:43:39.818676 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 06:43:39.874962 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 06:43:39.875823 (MainThread): 
2021-02-26 06:43:39.876083 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 06:43:39.877256 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 06:43:39.877373 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 06:43:41.866965 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 06:43:41.867261 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 06:43:42.308010 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:43:42.753745 (MainThread): 07:43:42 | Concurrency: 1 threads (target='dev')
2021-02-26 06:43:42.753953 (MainThread): 07:43:42 | 
2021-02-26 06:43:42.758957 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 06:43:42.760101 (Thread-1): 07:43:42 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 06:43:42.760414 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 06:43:42.760562 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 06:43:42.775249 (Thread-1): finished collecting timing info
2021-02-26 06:43:42.798571 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 06:43:43.236645 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:43:43.939565 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 06:43:46.154787 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:43:46.427612 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 06:43:44.399288+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 06:43:44.399288+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 06:43:44.399288+00:00"), TIMESTAMP("2021-02-26 06:43:44.399288+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 06:43:44.399288+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 06:43:44.399288+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 06:43:44.399288+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 06:43:44.399288+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 06:43:55.058831 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:43:55.290039 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:43:55.572722 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 06:43:55.572954 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:43:56.343213 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:43:56.801097 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58095, 0, 0), raddr=('2a00:1450:400f:809::200a', 443, 0, 0)>
2021-02-26 06:43:56.801427 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58096, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 06:43:56.801657 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58100, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 06:43:56.801905 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58099, 0, 0), raddr=('2a00:1450:400f:809::200a', 443, 0, 0)>
2021-02-26 06:43:56.807806 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 06:43:56.808310 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 06:44:11.680722 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 06:44:12.539255 (Thread-1): finished collecting timing info
2021-02-26 06:44:12.540036 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3045a33f-a11d-46fe-a9d6-1bd2793c10b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121c55e0>]}
2021-02-26 06:44:12.541413 (Thread-1): 07:44:12 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (4.2k rows, 115.5 MB processed) in 29.78s]
2021-02-26 06:44:12.541613 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 06:44:12.542788 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 06:44:12.543119 (MainThread): 07:44:12 | 
2021-02-26 06:44:12.543248 (MainThread): 07:44:12 | Finished running 1 snapshot in 32.67s.
2021-02-26 06:44:12.543350 (MainThread): Connection 'master' was properly closed.
2021-02-26 06:44:12.543425 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 06:44:12.547686 (MainThread): 
2021-02-26 06:44:12.547892 (MainThread): Completed successfully
2021-02-26 06:44:12.548016 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 06:44:12.548263 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121e6550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120ddaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120dde20>]}
2021-02-26 06:44:12.548484 (MainThread): Flushing usage events
2021-02-26 06:45:28.594426 (MainThread): Running with dbt=0.18.1
2021-02-26 06:45:28.938785 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 06:45:28.939724 (MainThread): Tracking: tracking
2021-02-26 06:45:28.944588 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea44e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f194280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f194160>]}
2021-02-26 06:45:28.964165 (MainThread): Partial parsing not enabled
2021-02-26 06:45:28.965102 (MainThread): Parsing macros/etc.sql
2021-02-26 06:45:28.966522 (MainThread): Parsing macros/catalog.sql
2021-02-26 06:45:28.972187 (MainThread): Parsing macros/adapters.sql
2021-02-26 06:45:28.989968 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 06:45:28.992525 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 06:45:28.995241 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 06:45:29.005205 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 06:45:29.009277 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 06:45:29.023101 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 06:45:29.025813 (MainThread): Parsing macros/core.sql
2021-02-26 06:45:29.029232 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 06:45:29.037390 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 06:45:29.039016 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 06:45:29.055381 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 06:45:29.082758 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 06:45:29.101938 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 06:45:29.103680 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 06:45:29.109444 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 06:45:29.123009 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 06:45:29.129811 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 06:45:29.136308 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 06:45:29.142358 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 06:45:29.143284 (MainThread): Parsing macros/etc/query.sql
2021-02-26 06:45:29.144285 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 06:45:29.146282 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 06:45:29.156769 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 06:45:29.158874 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 06:45:29.160968 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 06:45:29.207582 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 06:45:29.209763 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 06:45:29.211628 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 06:45:29.213400 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 06:45:29.222291 (MainThread): Partial parsing not enabled
2021-02-26 06:45:29.263680 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 06:45:29.287490 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 06:45:29.299808 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 06:45:29.311309 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 06:45:29.323226 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 06:45:29.334560 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 06:45:29.354433 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 06:45:29.395503 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 06:45:29.678841 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 06:45:29.749743 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 06:45:29.750928 (MainThread): 
2021-02-26 06:45:29.751341 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 06:45:29.752967 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 06:45:29.753126 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 06:45:30.872508 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 06:45:30.872802 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 06:45:31.372166 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:45:32.046970 (MainThread): 07:45:32 | Concurrency: 1 threads (target='dev')
2021-02-26 06:45:32.047194 (MainThread): 07:45:32 | 
2021-02-26 06:45:32.050797 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 06:45:32.052024 (Thread-1): 07:45:32 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 06:45:32.052343 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 06:45:32.052507 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 06:45:32.067774 (Thread-1): finished collecting timing info
2021-02-26 06:45:32.091033 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 06:45:32.576176 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:45:33.147024 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 06:45:35.152701 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:45:35.408002 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 06:45:33.504463+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 06:45:33.504463+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 06:45:33.504463+00:00"), TIMESTAMP("2021-02-26 06:45:33.504463+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 06:45:33.504463+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 06:45:33.504463+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 06:45:33.504463+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 06:45:33.504463+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 06:45:43.966669 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:45:44.196270 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:45:44.525299 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 06:45:44.525523 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:45:45.561048 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:45:45.788324 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58121, 0, 0), raddr=('2a00:1450:400f:809::200a', 443, 0, 0)>
2021-02-26 06:45:45.788545 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58122, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 06:45:45.788702 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58125, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 06:45:45.788849 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58124, 0, 0), raddr=('2a00:1450:400f:809::200a', 443, 0, 0)>
2021-02-26 06:45:45.793678 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 06:45:45.794140 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 06:46:01.518699 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 06:46:02.379519 (Thread-1): finished collecting timing info
2021-02-26 06:46:02.380519 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b21a84d5-4127-4b5d-8fc0-cb359df10d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1fe340>]}
2021-02-26 06:46:02.382149 (Thread-1): 07:46:02 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (6.0k rows, 116.0 MB processed) in 30.33s]
2021-02-26 06:46:02.382325 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 06:46:02.383501 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 06:46:02.383815 (MainThread): 07:46:02 | 
2021-02-26 06:46:02.383954 (MainThread): 07:46:02 | Finished running 1 snapshot in 32.63s.
2021-02-26 06:46:02.384071 (MainThread): Connection 'master' was properly closed.
2021-02-26 06:46:02.384158 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 06:46:02.387791 (MainThread): 
2021-02-26 06:46:02.387913 (MainThread): Completed successfully
2021-02-26 06:46:02.388022 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 06:46:02.388208 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f35f730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f23cfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f23cf10>]}
2021-02-26 06:46:02.388370 (MainThread): Flushing usage events
2021-02-26 06:58:42.440030 (MainThread): Running with dbt=0.18.1
2021-02-26 06:58:43.019151 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 06:58:43.020228 (MainThread): Tracking: tracking
2021-02-26 06:58:43.027888 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9f0ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca24a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca24730>]}
2021-02-26 06:58:43.054744 (MainThread): Partial parsing not enabled
2021-02-26 06:58:43.056434 (MainThread): Parsing macros/etc.sql
2021-02-26 06:58:43.058414 (MainThread): Parsing macros/catalog.sql
2021-02-26 06:58:43.065812 (MainThread): Parsing macros/adapters.sql
2021-02-26 06:58:43.085718 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 06:58:43.088548 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 06:58:43.091377 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 06:58:43.102457 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 06:58:43.107122 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 06:58:43.122653 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 06:58:43.127483 (MainThread): Parsing macros/core.sql
2021-02-26 06:58:43.131985 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 06:58:43.143042 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 06:58:43.145574 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 06:58:43.166435 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 06:58:43.201444 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 06:58:43.226510 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 06:58:43.229316 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 06:58:43.236869 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 06:58:43.254172 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 06:58:43.262410 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 06:58:43.270698 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 06:58:43.276659 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 06:58:43.277851 (MainThread): Parsing macros/etc/query.sql
2021-02-26 06:58:43.279115 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 06:58:43.281020 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 06:58:43.292253 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 06:58:43.294700 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 06:58:43.296659 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 06:58:43.347368 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 06:58:43.350077 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 06:58:43.352752 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 06:58:43.355331 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 06:58:43.364557 (MainThread): Partial parsing not enabled
2021-02-26 06:58:43.412515 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 06:58:43.437564 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 06:58:43.450547 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 06:58:43.464171 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 06:58:43.476839 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 06:58:43.488878 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 06:58:43.508605 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 06:58:43.556289 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 06:58:43.852005 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 06:58:43.924202 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 06:58:43.925419 (MainThread): 
2021-02-26 06:58:43.925924 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 06:58:43.927841 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 06:58:43.928159 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 06:58:45.759445 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 06:58:45.759739 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 06:58:46.210756 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:58:46.761021 (MainThread): 07:58:46 | Concurrency: 1 threads (target='dev')
2021-02-26 06:58:46.761247 (MainThread): 07:58:46 | 
2021-02-26 06:58:46.767569 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 06:58:46.768873 (Thread-1): 07:58:46 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 06:58:46.769224 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 06:58:46.769391 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 06:58:46.785203 (Thread-1): finished collecting timing info
2021-02-26 06:58:46.808436 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 06:58:47.254239 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:58:47.809429 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 06:58:49.750232 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:58:50.172570 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 06:58:48.159188+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 06:58:48.159188+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 06:58:48.159188+00:00"), TIMESTAMP("2021-02-26 06:58:48.159188+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 06:58:48.159188+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 06:58:48.159188+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 06:58:48.159188+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 06:58:48.159188+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 06:58:58.164764 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:58:58.406207 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:58:58.649273 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 06:58:58.649504 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:58:59.563054 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 06:58:59.787079 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 06:58:59.788650 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 06:59:34.717733 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58282, 0, 0), raddr=('2a00:1450:400f:809::200a', 443, 0, 0)>
2021-02-26 06:59:34.717965 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58281, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-26 06:59:34.719347 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 06:59:35.619693 (Thread-1): finished collecting timing info
2021-02-26 06:59:35.620693 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ee66892-7687-4cc1-bd39-fdabc49a9eeb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbcefa0>]}
2021-02-26 06:59:35.622362 (Thread-1): 07:59:35 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (7.0k rows, 116.5 MB processed) in 48.85s]
2021-02-26 06:59:35.622540 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 06:59:35.623749 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 06:59:35.624106 (MainThread): 07:59:35 | 
2021-02-26 06:59:35.624254 (MainThread): 07:59:35 | Finished running 1 snapshot in 51.70s.
2021-02-26 06:59:35.624383 (MainThread): Connection 'master' was properly closed.
2021-02-26 06:59:35.624479 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 06:59:35.628651 (MainThread): 
2021-02-26 06:59:35.628800 (MainThread): Completed successfully
2021-02-26 06:59:35.628939 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 06:59:35.629160 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cab9dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cac40d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cac4430>]}
2021-02-26 06:59:35.629357 (MainThread): Flushing usage events
2021-02-26 07:00:05.321206 (MainThread): Running with dbt=0.18.1
2021-02-26 07:00:05.662702 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:00:05.663294 (MainThread): Tracking: tracking
2021-02-26 07:00:05.668143 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126f2e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e33220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e33100>]}
2021-02-26 07:00:05.689871 (MainThread): Partial parsing not enabled
2021-02-26 07:00:05.690847 (MainThread): Parsing macros/etc.sql
2021-02-26 07:00:05.692510 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:00:05.698158 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:00:05.716563 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:00:05.719125 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:00:05.721748 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:00:05.731059 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:00:05.735208 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:00:05.747849 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:00:05.750726 (MainThread): Parsing macros/core.sql
2021-02-26 07:00:05.754126 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:00:05.762635 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:00:05.764980 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:00:05.782049 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:00:05.810343 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:00:05.830676 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:00:05.832414 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:00:05.838324 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:00:05.851409 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:00:05.857915 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:00:05.863793 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:00:05.868411 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:00:05.869283 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:00:05.870359 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:00:05.871879 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:00:05.880049 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:00:05.881872 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:00:05.883430 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:00:05.923673 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:00:05.925467 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:00:05.926891 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:00:05.928467 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:00:05.935615 (MainThread): Partial parsing not enabled
2021-02-26 07:00:05.969642 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:00:05.987512 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:00:05.997010 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:00:06.005923 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:00:06.014913 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:00:06.023017 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:00:06.037735 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:00:06.070658 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:00:06.291938 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 07:00:06.346653 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:00:06.347483 (MainThread): 
2021-02-26 07:00:06.347725 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:00:06.348925 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:00:06.349040 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:00:07.679894 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:00:07.680203 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:00:08.254412 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:00:08.694727 (MainThread): 08:00:08 | Concurrency: 1 threads (target='dev')
2021-02-26 07:00:08.694917 (MainThread): 08:00:08 | 
2021-02-26 07:00:08.697870 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:00:08.698886 (Thread-1): 08:00:08 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:00:08.699163 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:00:08.699301 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:00:08.713650 (Thread-1): finished collecting timing info
2021-02-26 07:00:08.736607 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:00:09.202431 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:00:09.851757 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:00:12.412401 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:00:12.670665 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:00:10.343031+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:00:10.343031+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:00:10.343031+00:00"), TIMESTAMP("2021-02-26 07:00:10.343031+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:00:10.343031+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:00:10.343031+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:00:10.343031+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:00:10.343031+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:00:22.440610 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:00:22.718818 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:00:23.027832 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:00:23.028063 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:00:23.766105 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:00:24.032428 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:00:24.033037 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:00:41.613313 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58303, 0, 0), raddr=('2a00:1450:400f:809::200a', 443, 0, 0)>
2021-02-26 07:00:41.613538 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58302, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-26 07:00:41.614704 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:00:42.392577 (Thread-1): finished collecting timing info
2021-02-26 07:00:42.393443 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8c89d6a-7a05-455c-938e-337026ae2670', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112eb1610>]}
2021-02-26 07:00:42.394859 (Thread-1): 08:00:42 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (80.9k rows, 125.4 MB processed) in 33.69s]
2021-02-26 07:00:42.395078 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:00:42.396400 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:00:42.396714 (MainThread): 08:00:42 | 
2021-02-26 07:00:42.396840 (MainThread): 08:00:42 | Finished running 1 snapshot in 36.05s.
2021-02-26 07:00:42.396951 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:00:42.397031 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:00:42.401820 (MainThread): 
2021-02-26 07:00:42.402052 (MainThread): Completed successfully
2021-02-26 07:00:42.402183 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:00:42.402484 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112eaf370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112eafd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126f6760>]}
2021-02-26 07:00:42.402756 (MainThread): Flushing usage events
2021-02-26 07:04:58.823819 (MainThread): Running with dbt=0.18.1
2021-02-26 07:04:59.183814 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:04:59.184654 (MainThread): Tracking: tracking
2021-02-26 07:04:59.189702 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098a0340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098bb880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098bb520>]}
2021-02-26 07:04:59.210313 (MainThread): Partial parsing not enabled
2021-02-26 07:04:59.211263 (MainThread): Parsing macros/etc.sql
2021-02-26 07:04:59.212698 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:04:59.218408 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:04:59.236503 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:04:59.239092 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:04:59.241907 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:04:59.251582 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:04:59.255697 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:04:59.267752 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:04:59.270422 (MainThread): Parsing macros/core.sql
2021-02-26 07:04:59.273922 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:04:59.282109 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:04:59.283719 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:04:59.299738 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:04:59.327979 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:04:59.347730 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:04:59.349508 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:04:59.355662 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:04:59.368763 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:04:59.375178 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:04:59.381500 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:04:59.386228 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:04:59.387104 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:04:59.388091 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:04:59.389599 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:04:59.397891 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:04:59.399716 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:04:59.401273 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:04:59.440820 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:04:59.442665 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:04:59.444074 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:04:59.445640 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:04:59.453199 (MainThread): Partial parsing not enabled
2021-02-26 07:04:59.486762 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:04:59.506438 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:04:59.516580 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:04:59.526109 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:04:59.535643 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:04:59.544160 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:04:59.558884 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:04:59.592080 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:04:59.818927 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 07:04:59.873320 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:04:59.874156 (MainThread): 
2021-02-26 07:04:59.874409 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:04:59.875671 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:04:59.875786 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:05:00.952811 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:05:00.953096 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:05:01.479250 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:05:01.924698 (MainThread): 08:05:01 | Concurrency: 1 threads (target='dev')
2021-02-26 07:05:01.924908 (MainThread): 08:05:01 | 
2021-02-26 07:05:01.928829 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:05:01.930277 (Thread-1): 08:05:01 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:05:01.930753 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:05:01.930936 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:05:01.946125 (Thread-1): finished collecting timing info
2021-02-26 07:05:01.971958 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:05:02.466459 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:05:03.121932 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:05:05.139512 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:05:05.466861 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:05:03.499431+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:05:03.499431+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:05:03.499431+00:00"), TIMESTAMP("2021-02-26 07:05:03.499431+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:05:03.499431+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:05:03.499431+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:05:03.499431+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:05:03.499431+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:05:14.849753 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:05:15.071708 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:05:15.373317 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:05:15.373489 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:05:16.176857 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:05:16.503861 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:05:16.504484 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:05:33.098348 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58419, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:05:33.098581 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58418, 0, 0), raddr=('2a00:1450:400f:808::200a', 443, 0, 0)>
2021-02-26 07:05:33.100690 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:05:33.936505 (Thread-1): finished collecting timing info
2021-02-26 07:05:33.937495 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e611e390-3387-4fcf-8d6e-2ebd2d64cd1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109946a90>]}
2021-02-26 07:05:33.939148 (Thread-1): 08:05:33 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (7.2k rows, 121.6 MB processed) in 32.01s]
2021-02-26 07:05:33.939330 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:05:33.940531 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:05:33.940884 (MainThread): 08:05:33 | 
2021-02-26 07:05:33.941032 (MainThread): 08:05:33 | Finished running 1 snapshot in 34.07s.
2021-02-26 07:05:33.941161 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:05:33.941255 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:05:33.945460 (MainThread): 
2021-02-26 07:05:33.945614 (MainThread): Completed successfully
2021-02-26 07:05:33.945759 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:05:33.945982 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098df280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10990e1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10990ea30>]}
2021-02-26 07:05:33.946184 (MainThread): Flushing usage events
2021-02-26 07:05:58.274295 (MainThread): Running with dbt=0.18.1
2021-02-26 07:05:58.618710 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:05:58.619342 (MainThread): Tracking: tracking
2021-02-26 07:05:58.624312 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f691be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f6a08e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f6a0580>]}
2021-02-26 07:05:58.643782 (MainThread): Partial parsing not enabled
2021-02-26 07:05:58.644722 (MainThread): Parsing macros/etc.sql
2021-02-26 07:05:58.646138 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:05:58.652001 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:05:58.670077 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:05:58.672637 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:05:58.675279 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:05:58.684703 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:05:58.688962 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:05:58.701167 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:05:58.703833 (MainThread): Parsing macros/core.sql
2021-02-26 07:05:58.707235 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:05:58.715487 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:05:58.717200 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:05:58.733698 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:05:58.761677 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:05:58.781990 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:05:58.783809 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:05:58.789614 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:05:58.802709 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:05:58.809054 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:05:58.814901 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:05:58.820199 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:05:58.821147 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:05:58.822146 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:05:58.823671 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:05:58.831924 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:05:58.833919 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:05:58.835493 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:05:58.875089 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:05:58.876854 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:05:58.878294 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:05:58.879904 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:05:58.888658 (MainThread): Partial parsing not enabled
2021-02-26 07:05:58.923239 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:05:58.941355 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:05:58.950941 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:05:58.959970 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:05:58.969027 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:05:58.977179 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:05:58.993668 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:05:59.026627 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:05:59.253362 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 07:05:59.307779 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:05:59.308631 (MainThread): 
2021-02-26 07:05:59.308881 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:05:59.310046 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:05:59.310164 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:06:00.226862 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:06:00.227157 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:06:00.686912 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:06:01.163127 (MainThread): 08:06:01 | Concurrency: 1 threads (target='dev')
2021-02-26 07:06:01.163320 (MainThread): 08:06:01 | 
2021-02-26 07:06:01.166282 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:06:01.167289 (Thread-1): 08:06:01 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:06:01.167561 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:06:01.167698 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:06:01.182030 (Thread-1): finished collecting timing info
2021-02-26 07:06:01.205128 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:06:01.649395 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:06:02.112928 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:06:04.223403 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:06:04.503361 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:06:02.519711+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:06:02.519711+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:06:02.519711+00:00"), TIMESTAMP("2021-02-26 07:06:02.519711+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:06:02.519711+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:06:02.519711+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:06:02.519711+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:06:02.519711+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:06:13.659551 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:06:13.945660 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:06:14.201692 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:06:14.201926 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:06:14.896515 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:06:15.183746 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:06:15.185286 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:06:31.473090 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58442, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:06:31.474199 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58441, 0, 0), raddr=('2a00:1450:400f:808::200a', 443, 0, 0)>
2021-02-26 07:06:31.475552 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:06:32.262299 (Thread-1): finished collecting timing info
2021-02-26 07:06:32.263967 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e44150-54c9-4ade-9051-f965f4d976fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f761ca0>]}
2021-02-26 07:06:32.265549 (Thread-1): 08:06:32 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (14.4k rows, 122.9 MB processed) in 31.10s]
2021-02-26 07:06:32.265738 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:06:32.267004 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:06:32.267308 (MainThread): 08:06:32 | 
2021-02-26 07:06:32.267430 (MainThread): 08:06:32 | Finished running 1 snapshot in 32.96s.
2021-02-26 07:06:32.267534 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:06:32.267609 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:06:32.271061 (MainThread): 
2021-02-26 07:06:32.271187 (MainThread): Completed successfully
2021-02-26 07:06:32.271298 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:06:32.271498 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f74df40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f1325b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f6beac0>]}
2021-02-26 07:06:32.271672 (MainThread): Flushing usage events
2021-02-26 07:08:47.816160 (MainThread): Running with dbt=0.18.1
2021-02-26 07:08:48.349115 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:08:48.350226 (MainThread): Tracking: tracking
2021-02-26 07:08:48.356764 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe66df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe6f4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fe6f160>]}
2021-02-26 07:08:48.378902 (MainThread): Partial parsing not enabled
2021-02-26 07:08:48.380466 (MainThread): Parsing macros/etc.sql
2021-02-26 07:08:48.382220 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:08:48.388210 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:08:48.406870 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:08:48.409770 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:08:48.412689 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:08:48.422431 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:08:48.426936 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:08:48.439410 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:08:48.442614 (MainThread): Parsing macros/core.sql
2021-02-26 07:08:48.446769 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:08:48.455997 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:08:48.458009 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:08:48.475199 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:08:48.503543 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:08:48.523524 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:08:48.525511 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:08:48.532250 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:08:48.547429 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:08:48.554082 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:08:48.560652 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:08:48.565619 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:08:48.566700 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:08:48.567905 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:08:48.569705 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:08:48.578720 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:08:48.580783 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:08:48.582614 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:08:48.622927 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:08:48.625411 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:08:48.627623 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:08:48.629454 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:08:48.636711 (MainThread): Partial parsing not enabled
2021-02-26 07:08:48.677216 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:08:48.698032 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:08:48.709342 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:08:48.719148 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:08:48.729978 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:08:48.739332 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:08:48.757252 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:08:48.794870 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:08:49.033566 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 07:08:49.094624 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:08:49.095653 (MainThread): 
2021-02-26 07:08:49.096022 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:08:49.097388 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:08:49.097516 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:08:50.311476 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:08:50.311778 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:08:50.765967 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:08:51.257812 (MainThread): 08:08:51 | Concurrency: 1 threads (target='dev')
2021-02-26 07:08:51.258027 (MainThread): 08:08:51 | 
2021-02-26 07:08:51.263897 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:08:51.265215 (Thread-1): 08:08:51 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:08:51.265569 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:08:51.265740 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:08:51.281214 (Thread-1): finished collecting timing info
2021-02-26 07:08:51.304499 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:08:51.750406 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:08:52.211720 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:08:53.574914 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:08:53.859358 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:08:52.595043+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:08:52.595043+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:08:52.595043+00:00"), TIMESTAMP("2021-02-26 07:08:52.595043+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:08:52.595043+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:08:52.595043+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:08:52.595043+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:08:52.595043+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:09:04.470646 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:09:04.847879 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:09:05.158739 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:09:05.158915 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:09:05.872016 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:09:06.090841 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:09:06.091356 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:09:21.523267 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58486, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:09:21.524487 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58485, 0, 0), raddr=('2a00:1450:400f:808::200a', 443, 0, 0)>
2021-02-26 07:09:21.526903 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:09:22.307128 (Thread-1): finished collecting timing info
2021-02-26 07:09:22.308119 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '353ad6dd-07b7-4dbe-bdeb-e4fbd70f50f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff26f40>]}
2021-02-26 07:09:22.309842 (Thread-1): 08:09:22 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (9.4k rows, 123.3 MB processed) in 31.04s]
2021-02-26 07:09:22.310023 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:09:22.312410 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:09:22.312826 (MainThread): 08:09:22 | 
2021-02-26 07:09:22.312982 (MainThread): 08:09:22 | Finished running 1 snapshot in 33.22s.
2021-02-26 07:09:22.313110 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:09:22.313205 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:09:22.317454 (MainThread): 
2021-02-26 07:09:22.317608 (MainThread): Completed successfully
2021-02-26 07:09:22.317741 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:09:22.317973 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100eb4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110019e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110019f70>]}
2021-02-26 07:09:22.318182 (MainThread): Flushing usage events
2021-02-26 07:09:49.605777 (MainThread): Running with dbt=0.18.1
2021-02-26 07:09:50.130893 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:09:50.131968 (MainThread): Tracking: tracking
2021-02-26 07:09:50.138806 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e860eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10efa2dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10efa2a60>]}
2021-02-26 07:09:50.164073 (MainThread): Partial parsing not enabled
2021-02-26 07:09:50.165507 (MainThread): Parsing macros/etc.sql
2021-02-26 07:09:50.167471 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:09:50.173950 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:09:50.192519 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:09:50.195828 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:09:50.199298 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:09:50.212265 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:09:50.217399 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:09:50.235453 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:09:50.238926 (MainThread): Parsing macros/core.sql
2021-02-26 07:09:50.243194 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:09:50.254445 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:09:50.256759 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:09:50.274368 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:09:50.302094 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:09:50.322779 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:09:50.324809 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:09:50.331349 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:09:50.347722 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:09:50.354855 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:09:50.360964 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:09:50.367489 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:09:50.368833 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:09:50.370311 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:09:50.372410 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:09:50.381943 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:09:50.384048 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:09:50.385843 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:09:50.426257 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:09:50.429127 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:09:50.431401 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:09:50.433546 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:09:50.441970 (MainThread): Partial parsing not enabled
2021-02-26 07:09:50.477305 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:09:50.497217 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:09:50.509812 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:09:50.521583 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:09:50.532472 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:09:50.541964 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:09:50.558351 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:09:50.592000 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:09:50.824536 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 07:09:50.879532 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:09:50.880390 (MainThread): 
2021-02-26 07:09:50.880643 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:09:50.881902 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:09:50.882172 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:09:52.127032 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:09:52.127341 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:09:52.579681 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:09:53.093209 (MainThread): 08:09:53 | Concurrency: 1 threads (target='dev')
2021-02-26 07:09:53.093426 (MainThread): 08:09:53 | 
2021-02-26 07:09:53.099427 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:09:53.100714 (Thread-1): 08:09:53 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:09:53.101067 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:09:53.101228 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:09:53.117118 (Thread-1): finished collecting timing info
2021-02-26 07:09:53.140135 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:09:53.582602 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:09:54.000849 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:09:56.335124 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:09:56.600220 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:09:54.336659+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:09:54.336659+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:09:54.336659+00:00"), TIMESTAMP("2021-02-26 07:09:54.336659+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:09:54.336659+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:09:54.336659+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:09:54.336659+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:09:54.336659+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:10:06.912507 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:10:07.134702 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:10:07.420450 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:10:07.420672 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:10:08.336378 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:10:08.652927 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:10:08.653443 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:10:25.559379 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58511, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:10:25.559601 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58510, 0, 0), raddr=('2a00:1450:400f:80a::200a', 443, 0, 0)>
2021-02-26 07:10:25.560710 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:10:26.467665 (Thread-1): finished collecting timing info
2021-02-26 07:10:26.468669 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d7263bc-483b-4a58-9d2e-5aafc56f753b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f090160>]}
2021-02-26 07:10:26.470338 (Thread-1): 08:10:26 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (78.3k rows, 131.7 MB processed) in 33.37s]
2021-02-26 07:10:26.470519 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:10:26.471788 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:10:26.472136 (MainThread): 08:10:26 | 
2021-02-26 07:10:26.472280 (MainThread): 08:10:26 | Finished running 1 snapshot in 35.59s.
2021-02-26 07:10:26.472405 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:10:26.472498 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:10:26.476639 (MainThread): 
2021-02-26 07:10:26.476787 (MainThread): Completed successfully
2021-02-26 07:10:26.476919 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:10:26.477131 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e8650a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f21e970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f21e640>]}
2021-02-26 07:10:26.477323 (MainThread): Flushing usage events
2021-02-26 07:11:15.929575 (MainThread): Running with dbt=0.18.1
2021-02-26 07:11:16.279918 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:11:16.280673 (MainThread): Tracking: tracking
2021-02-26 07:11:16.285683 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108162a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10818cd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10818ca00>]}
2021-02-26 07:11:16.307093 (MainThread): Partial parsing not enabled
2021-02-26 07:11:16.308067 (MainThread): Parsing macros/etc.sql
2021-02-26 07:11:16.309521 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:11:16.315758 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:11:16.334070 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:11:16.337564 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:11:16.340188 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:11:16.350099 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:11:16.354196 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:11:16.366970 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:11:16.369827 (MainThread): Parsing macros/core.sql
2021-02-26 07:11:16.373185 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:11:16.382088 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:11:16.383829 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:11:16.400197 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:11:16.428559 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:11:16.450483 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:11:16.452368 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:11:16.458183 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:11:16.471765 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:11:16.478517 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:11:16.484435 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:11:16.489071 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:11:16.489944 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:11:16.490919 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:11:16.492461 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:11:16.501253 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:11:16.503296 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:11:16.504859 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:11:16.544709 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:11:16.546454 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:11:16.547871 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:11:16.549565 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:11:16.556673 (MainThread): Partial parsing not enabled
2021-02-26 07:11:16.591169 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:11:16.609352 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:11:16.619099 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:11:16.628147 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:11:16.637322 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:11:16.645716 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:11:16.660359 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:11:16.693507 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:11:16.913834 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 07:11:16.973253 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:11:16.974150 (MainThread): 
2021-02-26 07:11:16.974439 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:11:16.975822 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:11:16.976186 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:11:17.854935 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:11:17.855207 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:11:18.300664 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:11:18.841976 (MainThread): 08:11:18 | Concurrency: 1 threads (target='dev')
2021-02-26 07:11:18.842163 (MainThread): 08:11:18 | 
2021-02-26 07:11:18.845152 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:11:18.846125 (Thread-1): 08:11:18 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:11:18.846374 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:11:18.846501 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:11:18.859385 (Thread-1): finished collecting timing info
2021-02-26 07:11:18.879483 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:11:19.402239 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:11:19.851069 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:11:21.940630 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:11:22.209561 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:11:20.249742+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:11:20.249742+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:11:20.249742+00:00"), TIMESTAMP("2021-02-26 07:11:20.249742+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:11:20.249742+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:11:20.249742+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:11:20.249742+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:11:20.249742+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:11:30.360451 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:11:30.594794 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:11:30.828604 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:11:30.828835 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:11:31.541856 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:11:31.775054 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:11:31.775646 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:11:53.618004 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58543, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:11:53.619010 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58542, 0, 0), raddr=('2a00:1450:400f:80a::200a', 443, 0, 0)>
2021-02-26 07:11:53.620047 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:11:54.474483 (Thread-1): finished collecting timing info
2021-02-26 07:11:54.475289 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48d1c411-e395-45d8-afac-130f07e884b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081a42b0>]}
2021-02-26 07:11:54.476718 (Thread-1): 08:11:54 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (4.5k rows, 127.8 MB processed) in 35.63s]
2021-02-26 07:11:54.476923 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:11:54.478090 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:11:54.478413 (MainThread): 08:11:54 | 
2021-02-26 07:11:54.478540 (MainThread): 08:11:54 | Finished running 1 snapshot in 37.50s.
2021-02-26 07:11:54.478637 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:11:54.478710 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:11:54.482731 (MainThread): 
2021-02-26 07:11:54.482903 (MainThread): Completed successfully
2021-02-26 07:11:54.483012 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:11:54.483226 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a9eac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082210a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108322eb0>]}
2021-02-26 07:11:54.483408 (MainThread): Flushing usage events
2021-02-26 07:12:17.148092 (MainThread): Running with dbt=0.18.1
2021-02-26 07:12:17.674667 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:12:17.675671 (MainThread): Tracking: tracking
2021-02-26 07:12:17.683854 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be96eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5da220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5da100>]}
2021-02-26 07:12:17.708295 (MainThread): Partial parsing not enabled
2021-02-26 07:12:17.709570 (MainThread): Parsing macros/etc.sql
2021-02-26 07:12:17.711413 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:12:17.717839 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:12:17.737247 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:12:17.740068 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:12:17.743096 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:12:17.753158 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:12:17.757538 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:12:17.769608 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:12:17.773324 (MainThread): Parsing macros/core.sql
2021-02-26 07:12:17.778478 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:12:17.789296 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:12:17.791652 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:12:17.810178 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:12:17.839379 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:12:17.859830 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:12:17.861823 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:12:17.867944 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:12:17.881125 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:12:17.888018 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:12:17.894855 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:12:17.899810 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:12:17.901067 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:12:17.902332 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:12:17.904116 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:12:17.914073 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:12:17.916423 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:12:17.918410 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:12:17.960863 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:12:17.963705 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:12:17.965884 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:12:17.968067 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:12:17.976585 (MainThread): Partial parsing not enabled
2021-02-26 07:12:18.011545 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:12:18.031330 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:12:18.041619 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:12:18.051794 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:12:18.061814 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:12:18.070624 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:12:18.086229 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:12:18.119990 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:12:18.359601 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 07:12:18.416527 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:12:18.417368 (MainThread): 
2021-02-26 07:12:18.417612 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:12:18.418920 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:12:18.419104 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:12:19.753067 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:12:19.753356 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:12:20.196218 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:12:20.605655 (MainThread): 08:12:20 | Concurrency: 1 threads (target='dev')
2021-02-26 07:12:20.605948 (MainThread): 08:12:20 | 
2021-02-26 07:12:20.612160 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:12:20.613485 (Thread-1): 08:12:20 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:12:20.613839 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:12:20.614001 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:12:20.629663 (Thread-1): finished collecting timing info
2021-02-26 07:12:20.653115 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:12:21.120686 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:12:21.600162 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:12:23.101284 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:12:23.368713 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:12:21.967077+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:12:21.967077+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:12:21.967077+00:00"), TIMESTAMP("2021-02-26 07:12:21.967077+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:12:21.967077+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:12:21.967077+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:12:21.967077+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:12:21.967077+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:12:31.902865 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:12:32.138921 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:12:32.421453 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:12:32.421685 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:12:33.130185 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:12:33.440193 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58573, 0, 0), raddr=('2a00:1450:400f:80a::200a', 443, 0, 0)>
2021-02-26 07:12:33.440510 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58574, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:12:33.440735 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58577, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:12:33.440945 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58576, 0, 0), raddr=('2a00:1450:400f:80a::200a', 443, 0, 0)>
2021-02-26 07:12:33.446878 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:12:33.447366 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:12:48.935006 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:12:49.728407 (Thread-1): finished collecting timing info
2021-02-26 07:12:49.729407 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d26dcde-eb5d-4d6b-bb82-56b400f14469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c8204c0>]}
2021-02-26 07:12:49.731036 (Thread-1): 08:12:49 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (3.0k rows, 127.9 MB processed) in 29.12s]
2021-02-26 07:12:49.731208 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:12:49.732394 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:12:49.732724 (MainThread): 08:12:49 | 
2021-02-26 07:12:49.732863 (MainThread): 08:12:49 | Finished running 1 snapshot in 31.32s.
2021-02-26 07:12:49.732981 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:12:49.733068 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:12:49.737094 (MainThread): 
2021-02-26 07:12:49.737233 (MainThread): Completed successfully
2021-02-26 07:12:49.737360 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:12:49.737575 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c60c6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be88b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5f4580>]}
2021-02-26 07:12:49.737760 (MainThread): Flushing usage events
2021-02-26 07:14:06.211731 (MainThread): Running with dbt=0.18.1
2021-02-26 07:14:06.735820 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:14:06.737076 (MainThread): Tracking: tracking
2021-02-26 07:14:06.744263 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112044d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11278de80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11278db20>]}
2021-02-26 07:14:06.767475 (MainThread): Partial parsing not enabled
2021-02-26 07:14:06.768836 (MainThread): Parsing macros/etc.sql
2021-02-26 07:14:06.770703 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:14:06.776556 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:14:06.795114 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:14:06.798486 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:14:06.801845 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:14:06.812973 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:14:06.818184 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:14:06.831882 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:14:06.834999 (MainThread): Parsing macros/core.sql
2021-02-26 07:14:06.839065 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:14:06.849849 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:14:06.852225 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:14:06.869812 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:14:06.897288 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:14:06.917291 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:14:06.919246 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:14:06.925382 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:14:06.938702 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:14:06.945205 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:14:06.951333 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:14:06.956367 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:14:06.958041 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:14:06.960365 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:14:06.963266 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:14:06.975460 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:14:06.978918 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:14:06.981946 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:14:07.025276 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:14:07.029761 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:14:07.032935 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:14:07.036092 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:14:07.049868 (MainThread): Partial parsing not enabled
2021-02-26 07:14:07.091831 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:14:07.112548 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:14:07.125054 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:14:07.137706 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:14:07.149878 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:14:07.161863 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:14:07.181504 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:14:07.223629 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:14:07.509155 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 07:14:07.576621 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:14:07.577876 (MainThread): 
2021-02-26 07:14:07.578738 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:14:07.580574 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:14:07.580839 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:14:09.101685 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:14:09.101965 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:14:09.546334 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:14:10.014237 (MainThread): 08:14:10 | Concurrency: 1 threads (target='dev')
2021-02-26 07:14:10.014460 (MainThread): 08:14:10 | 
2021-02-26 07:14:10.020398 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:14:10.021707 (Thread-1): 08:14:10 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:14:10.022070 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:14:10.022241 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:14:10.038185 (Thread-1): finished collecting timing info
2021-02-26 07:14:10.061457 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:14:10.502455 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:14:10.942973 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:14:12.890597 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:14:13.142795 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:14:11.310741+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:14:11.310741+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:14:11.310741+00:00"), TIMESTAMP("2021-02-26 07:14:11.310741+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:14:11.310741+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:14:11.310741+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:14:11.310741+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:14:11.310741+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:14:21.800148 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:14:22.043524 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:14:22.271719 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:14:22.271952 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:14:23.052974 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:14:23.297793 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:14:23.300037 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:14:41.375402 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58606, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:14:41.375623 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58605, 0, 0), raddr=('2a00:1450:400f:80a::200a', 443, 0, 0)>
2021-02-26 07:14:41.378624 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:14:42.205692 (Thread-1): finished collecting timing info
2021-02-26 07:14:42.206457 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c4421f8-d2ad-4076-8f88-955826e3a097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112879160>]}
2021-02-26 07:14:42.207841 (Thread-1): 08:14:42 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (6.6k rows, 128.5 MB processed) in 32.18s]
2021-02-26 07:14:42.208040 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:14:42.209254 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:14:42.209606 (MainThread): 08:14:42 | 
2021-02-26 07:14:42.209737 (MainThread): 08:14:42 | Finished running 1 snapshot in 34.63s.
2021-02-26 07:14:42.209837 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:14:42.209912 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:14:42.213989 (MainThread): 
2021-02-26 07:14:42.214193 (MainThread): Completed successfully
2021-02-26 07:14:42.214328 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:14:42.214564 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11293bb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11293bbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11293be50>]}
2021-02-26 07:14:42.214788 (MainThread): Flushing usage events
2021-02-26 07:15:04.734409 (MainThread): Running with dbt=0.18.1
2021-02-26 07:15:05.082816 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:15:05.083484 (MainThread): Tracking: tracking
2021-02-26 07:15:05.088301 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107380dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ad2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ad2040>]}
2021-02-26 07:15:05.107934 (MainThread): Partial parsing not enabled
2021-02-26 07:15:05.108861 (MainThread): Parsing macros/etc.sql
2021-02-26 07:15:05.110262 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:15:05.116526 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:15:05.134416 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:15:05.136962 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:15:05.139673 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:15:05.149010 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:15:05.153185 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:15:05.165468 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:15:05.168215 (MainThread): Parsing macros/core.sql
2021-02-26 07:15:05.171577 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:15:05.180032 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:15:05.181638 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:15:05.199011 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:15:05.226310 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:15:05.245941 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:15:05.247726 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:15:05.253436 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:15:05.268649 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:15:05.275124 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:15:05.281076 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:15:05.285913 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:15:05.286786 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:15:05.287804 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:15:05.289312 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:15:05.297543 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:15:05.299360 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:15:05.300996 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:15:05.340613 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:15:05.342647 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:15:05.344342 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:15:05.346505 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:15:05.355116 (MainThread): Partial parsing not enabled
2021-02-26 07:15:05.391297 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:15:05.409674 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:15:05.418895 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:15:05.427782 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:15:05.436859 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:15:05.444908 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:15:05.459829 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:15:05.492266 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:15:05.714128 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 07:15:05.772322 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:15:05.773283 (MainThread): 
2021-02-26 07:15:05.773606 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:15:05.775295 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:15:05.775520 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:15:06.700361 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:15:06.700657 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:15:07.149584 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:15:07.711120 (MainThread): 08:15:07 | Concurrency: 1 threads (target='dev')
2021-02-26 07:15:07.711341 (MainThread): 08:15:07 | 
2021-02-26 07:15:07.714865 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:15:07.716017 (Thread-1): 08:15:07 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:15:07.716308 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:15:07.716460 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:15:07.731120 (Thread-1): finished collecting timing info
2021-02-26 07:15:07.754327 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:15:08.205706 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:15:08.639969 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:15:09.912963 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:15:10.171239 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:15:08.898559+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:15:08.898559+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:15:08.898559+00:00"), TIMESTAMP("2021-02-26 07:15:08.898559+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:15:08.898559+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:15:08.898559+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:15:08.898559+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:15:08.898559+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:15:20.453649 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:15:20.759784 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:15:21.004728 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:15:21.004953 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:15:21.705098 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58623, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-26 07:15:21.705425 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58624, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:15:21.705660 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58627, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:15:21.705862 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58626, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-26 07:15:21.706330 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:15:21.951709 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:15:21.952287 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:15:39.217846 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:15:40.019755 (Thread-1): finished collecting timing info
2021-02-26 07:15:40.020744 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f4739c2-5e49-40cb-8c8f-abe0ff450b23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ca9f70>]}
2021-02-26 07:15:40.022426 (Thread-1): 08:15:40 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (78.5k rows, 137.1 MB processed) in 32.30s]
2021-02-26 07:15:40.022607 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:15:40.023892 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:15:40.024221 (MainThread): 08:15:40 | 
2021-02-26 07:15:40.024365 (MainThread): 08:15:40 | Finished running 1 snapshot in 34.25s.
2021-02-26 07:15:40.024490 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:15:40.024582 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:15:40.028628 (MainThread): 
2021-02-26 07:15:40.028773 (MainThread): Completed successfully
2021-02-26 07:15:40.028904 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:15:40.029120 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cffd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b36760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b36f70>]}
2021-02-26 07:15:40.029310 (MainThread): Flushing usage events
2021-02-26 07:16:18.855775 (MainThread): Running with dbt=0.18.1
2021-02-26 07:16:19.217992 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:16:19.218595 (MainThread): Tracking: tracking
2021-02-26 07:16:19.224298 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2bbdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa05d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa0d0a0>]}
2021-02-26 07:16:19.245810 (MainThread): Partial parsing not enabled
2021-02-26 07:16:19.246748 (MainThread): Parsing macros/etc.sql
2021-02-26 07:16:19.248159 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:16:19.254245 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:16:19.272392 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:16:19.275081 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:16:19.277694 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:16:19.287057 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:16:19.291148 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:16:19.303162 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:16:19.305808 (MainThread): Parsing macros/core.sql
2021-02-26 07:16:19.309185 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:16:19.317509 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:16:19.319199 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:16:19.335344 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:16:19.365748 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:16:19.385111 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:16:19.386817 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:16:19.392909 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:16:19.405779 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:16:19.412063 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:16:19.418090 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:16:19.422710 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:16:19.423584 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:16:19.425046 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:16:19.426566 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:16:19.434935 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:16:19.436759 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:16:19.438310 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:16:19.478031 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:16:19.479815 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:16:19.481236 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:16:19.482820 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:16:19.490193 (MainThread): Partial parsing not enabled
2021-02-26 07:16:19.523885 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:16:19.541763 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:16:19.551592 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:16:19.560778 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:16:19.569798 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:16:19.578110 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:16:19.592547 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:16:19.625146 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:16:19.847687 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 07:16:19.905816 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:16:19.906698 (MainThread): 
2021-02-26 07:16:19.906953 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:16:19.908103 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:16:19.908220 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:16:20.844178 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:16:20.844484 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:16:21.468897 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:16:22.052097 (MainThread): 08:16:22 | Concurrency: 1 threads (target='dev')
2021-02-26 07:16:22.052319 (MainThread): 08:16:22 | 
2021-02-26 07:16:22.057541 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:16:22.058814 (Thread-1): 08:16:22 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:16:22.059174 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:16:22.059336 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:16:22.074380 (Thread-1): finished collecting timing info
2021-02-26 07:16:22.097432 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:16:22.558528 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:16:23.017955 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:16:25.079783 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:16:25.327712 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:16:23.336727+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:16:23.336727+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:16:23.336727+00:00"), TIMESTAMP("2021-02-26 07:16:23.336727+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:16:23.336727+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:16:23.336727+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:16:23.336727+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:16:23.336727+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:16:34.044539 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:16:34.268898 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:16:34.517237 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:16:34.517416 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:16:35.510643 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:16:35.738917 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:16:35.739474 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:16:53.177363 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58655, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:16:53.177621 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58654, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-26 07:16:53.180758 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:16:54.003000 (Thread-1): finished collecting timing info
2021-02-26 07:16:54.003992 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '438eb50b-ccf3-4780-a473-1773defeba02', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fab7f40>]}
2021-02-26 07:16:54.005673 (Thread-1): 08:16:54 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (7.4k rows, 133.4 MB processed) in 31.94s]
2021-02-26 07:16:54.005851 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:16:54.007043 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:16:54.007385 (MainThread): 08:16:54 | 
2021-02-26 07:16:54.007533 (MainThread): 08:16:54 | Finished running 1 snapshot in 34.10s.
2021-02-26 07:16:54.007658 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:16:54.007751 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:16:54.011937 (MainThread): 
2021-02-26 07:16:54.012082 (MainThread): Completed successfully
2021-02-26 07:16:54.012211 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:16:54.012440 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f2bb280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fbd2be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fbd2b80>]}
2021-02-26 07:16:54.012630 (MainThread): Flushing usage events
2021-02-26 07:17:46.526741 (MainThread): Running with dbt=0.18.1
2021-02-26 07:17:46.872012 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:17:46.872669 (MainThread): Tracking: tracking
2021-02-26 07:17:46.878358 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107285dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10728f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10728f130>]}
2021-02-26 07:17:46.899808 (MainThread): Partial parsing not enabled
2021-02-26 07:17:46.900729 (MainThread): Parsing macros/etc.sql
2021-02-26 07:17:46.902208 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:17:46.908318 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:17:46.925810 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:17:46.928320 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:17:46.930913 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:17:46.940216 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:17:46.944267 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:17:46.956219 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:17:46.958899 (MainThread): Parsing macros/core.sql
2021-02-26 07:17:46.962233 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:17:46.970419 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:17:46.972397 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:17:46.989141 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:17:47.016238 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:17:47.035743 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:17:47.037729 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:17:47.043554 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:17:47.056579 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:17:47.063632 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:17:47.069924 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:17:47.074874 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:17:47.075751 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:17:47.076728 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:17:47.078236 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:17:47.086632 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:17:47.088456 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:17:47.090010 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:17:47.129543 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:17:47.131278 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:17:47.132679 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:17:47.134289 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:17:47.141460 (MainThread): Partial parsing not enabled
2021-02-26 07:17:47.175219 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:17:47.193672 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:17:47.203614 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:17:47.212589 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:17:47.221630 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:17:47.229807 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:17:47.244341 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:17:47.276689 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:17:47.499416 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 07:17:47.555121 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:17:47.556090 (MainThread): 
2021-02-26 07:17:47.556416 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:17:47.557791 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:17:47.558051 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:17:48.556674 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:17:48.556977 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:17:49.000900 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:17:49.426158 (MainThread): 08:17:49 | Concurrency: 1 threads (target='dev')
2021-02-26 07:17:49.426381 (MainThread): 08:17:49 | 
2021-02-26 07:17:49.429947 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:17:49.431128 (Thread-1): 08:17:49 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:17:49.431442 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:17:49.431608 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:17:49.447209 (Thread-1): finished collecting timing info
2021-02-26 07:17:49.470081 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:17:49.915574 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:17:50.352509 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:17:52.278618 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:17:52.545747 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:17:50.663417+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:17:50.663417+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:17:50.663417+00:00"), TIMESTAMP("2021-02-26 07:17:50.663417+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:17:50.663417+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:17:50.663417+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:17:50.663417+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:17:50.663417+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:18:01.467664 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:01.700884 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:01.939694 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:18:01.939927 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:02.661873 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:02.881219 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:18:02.881762 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:18:22.103441 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58693, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:18:22.103651 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58692, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-26 07:18:22.104719 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:18:22.921194 (Thread-1): finished collecting timing info
2021-02-26 07:18:22.922188 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ba4b916-dece-4d26-9e02-814273daadc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10728fa60>]}
2021-02-26 07:18:22.923820 (Thread-1): 08:18:22 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (7.5k rows, 133.9 MB processed) in 33.49s]
2021-02-26 07:18:22.923997 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:18:22.925197 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:18:22.925528 (MainThread): 08:18:22 | 
2021-02-26 07:18:22.925669 (MainThread): 08:18:22 | Finished running 1 snapshot in 35.37s.
2021-02-26 07:18:22.925790 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:18:22.925880 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:18:22.929883 (MainThread): 
2021-02-26 07:18:22.930019 (MainThread): Completed successfully
2021-02-26 07:18:22.930142 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:18:22.930350 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10730cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107449310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107449a60>]}
2021-02-26 07:18:22.930527 (MainThread): Flushing usage events
2021-02-26 07:18:44.174362 (MainThread): Running with dbt=0.18.1
2021-02-26 07:18:44.522235 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:18:44.522955 (MainThread): Tracking: tracking
2021-02-26 07:18:44.529909 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067e28b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106810c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068108b0>]}
2021-02-26 07:18:44.550245 (MainThread): Partial parsing not enabled
2021-02-26 07:18:44.551175 (MainThread): Parsing macros/etc.sql
2021-02-26 07:18:44.553873 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:18:44.559605 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:18:44.577872 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:18:44.580405 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:18:44.583008 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:18:44.592741 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:18:44.596834 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:18:44.608906 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:18:44.611547 (MainThread): Parsing macros/core.sql
2021-02-26 07:18:44.614956 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:18:44.623631 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:18:44.625618 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:18:44.641307 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:18:44.669385 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:18:44.688999 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:18:44.690790 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:18:44.696798 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:18:44.709856 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:18:44.716277 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:18:44.722283 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:18:44.727132 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:18:44.728013 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:18:44.729002 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:18:44.730521 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:18:44.738860 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:18:44.740764 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:18:44.742326 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:18:44.782159 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:18:44.784098 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:18:44.785527 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:18:44.787115 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:18:44.794225 (MainThread): Partial parsing not enabled
2021-02-26 07:18:44.828465 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:18:44.846591 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:18:44.856135 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:18:44.865326 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:18:44.874277 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:18:44.882356 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:18:44.896741 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:18:44.930556 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:18:45.161141 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 07:18:45.217547 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:18:45.218389 (MainThread): 
2021-02-26 07:18:45.218640 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:18:45.219862 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:18:45.220003 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:18:46.177378 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:18:46.177644 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:18:46.650450 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:47.053700 (MainThread): 08:18:47 | Concurrency: 1 threads (target='dev')
2021-02-26 07:18:47.053923 (MainThread): 08:18:47 | 
2021-02-26 07:18:47.057503 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:18:47.058733 (Thread-1): 08:18:47 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:18:47.059057 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:18:47.059216 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:18:47.074691 (Thread-1): finished collecting timing info
2021-02-26 07:18:47.098008 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:18:47.661734 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:48.280147 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:18:49.869906 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:50.202361 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:18:48.636373+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:18:48.636373+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:18:48.636373+00:00"), TIMESTAMP("2021-02-26 07:18:48.636373+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:18:48.636373+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:18:48.636373+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:18:48.636373+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:18:48.636373+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:18:59.232485 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:59.459095 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:18:59.796542 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:18:59.796769 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:19:00.572307 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:19:00.926623 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:19:00.927256 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:19:17.538370 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58715, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:19:17.538592 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58714, 0, 0), raddr=('2a00:1450:400f:801::200a', 443, 0, 0)>
2021-02-26 07:19:17.539673 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:19:18.306339 (Thread-1): finished collecting timing info
2021-02-26 07:19:18.307155 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '786be5a9-7321-4fb8-8796-efe84ca2263e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068fe0a0>]}
2021-02-26 07:19:18.308625 (Thread-1): 08:19:18 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (7.8k rows, 134.4 MB processed) in 31.25s]
2021-02-26 07:19:18.308795 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:19:18.309947 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:19:18.310281 (MainThread): 08:19:18 | 
2021-02-26 07:19:18.310426 (MainThread): 08:19:18 | Finished running 1 snapshot in 33.09s.
2021-02-26 07:19:18.310548 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:19:18.310688 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:19:18.314730 (MainThread): 
2021-02-26 07:19:18.314874 (MainThread): Completed successfully
2021-02-26 07:19:18.315000 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:19:18.315212 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10688a670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106996fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106996dc0>]}
2021-02-26 07:19:18.315405 (MainThread): Flushing usage events
2021-02-26 07:19:55.537743 (MainThread): Running with dbt=0.18.1
2021-02-26 07:19:56.060234 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:19:56.061531 (MainThread): Tracking: tracking
2021-02-26 07:19:56.068046 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112269d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129b4dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129b4a60>]}
2021-02-26 07:19:56.092489 (MainThread): Partial parsing not enabled
2021-02-26 07:19:56.094168 (MainThread): Parsing macros/etc.sql
2021-02-26 07:19:56.095876 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:19:56.101751 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:19:56.119913 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:19:56.122694 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:19:56.125533 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:19:56.135402 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:19:56.139739 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:19:56.152570 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:19:56.155928 (MainThread): Parsing macros/core.sql
2021-02-26 07:19:56.160377 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:19:56.169430 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:19:56.171524 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:19:56.188105 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:19:56.218660 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:19:56.245401 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:19:56.247515 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:19:56.253640 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:19:56.266954 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:19:56.274795 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:19:56.281775 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:19:56.286737 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:19:56.287982 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:19:56.289936 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:19:56.292952 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:19:56.304371 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:19:56.306973 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:19:56.309077 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:19:56.350117 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:19:56.352474 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:19:56.354278 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:19:56.356095 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:19:56.363390 (MainThread): Partial parsing not enabled
2021-02-26 07:19:56.398425 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:19:56.417468 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:19:56.428640 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:19:56.439141 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:19:56.449742 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:19:56.458920 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:19:56.474916 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:19:56.508600 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:19:56.747115 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 07:19:56.809161 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:19:56.809985 (MainThread): 
2021-02-26 07:19:56.810331 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:19:56.811693 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:19:56.811813 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:19:58.176327 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:19:58.176676 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:19:58.622014 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:19:59.199366 (MainThread): 08:19:59 | Concurrency: 1 threads (target='dev')
2021-02-26 07:19:59.199587 (MainThread): 08:19:59 | 
2021-02-26 07:19:59.205530 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:19:59.206832 (Thread-1): 08:19:59 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:19:59.207180 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:19:59.207348 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:19:59.222792 (Thread-1): finished collecting timing info
2021-02-26 07:19:59.245946 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:19:59.699159 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:20:00.353880 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:20:02.317210 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:20:02.593589 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:20:00.607241+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:20:00.607241+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:20:00.607241+00:00"), TIMESTAMP("2021-02-26 07:20:00.607241+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:20:00.607241+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:20:00.607241+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:20:00.607241+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:20:00.607241+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:20:11.324241 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:20:11.547459 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:20:11.785313 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:20:11.785512 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:20:12.553547 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:20:12.795556 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:20:12.796093 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:20:33.728179 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58739, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:20:33.728396 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58738, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-26 07:20:33.729516 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:20:34.460088 (Thread-1): finished collecting timing info
2021-02-26 07:20:34.461069 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1473b5e4-e275-4041-93fa-1ee9218aa13f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129d92e0>]}
2021-02-26 07:20:34.462743 (Thread-1): 08:20:34 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (15.1k rows, 135.7 MB processed) in 35.25s]
2021-02-26 07:20:34.462921 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:20:34.464217 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:20:34.464556 (MainThread): 08:20:34 | 
2021-02-26 07:20:34.464694 (MainThread): 08:20:34 | Finished running 1 snapshot in 37.65s.
2021-02-26 07:20:34.464811 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:20:34.464898 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:20:34.468900 (MainThread): 
2021-02-26 07:20:34.469043 (MainThread): Completed successfully
2021-02-26 07:20:34.469171 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:20:34.469377 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a2acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b4ef40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b4e580>]}
2021-02-26 07:20:34.469563 (MainThread): Flushing usage events
2021-02-26 07:21:07.481393 (MainThread): Running with dbt=0.18.1
2021-02-26 07:21:07.915645 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 07:21:07.916571 (MainThread): Tracking: tracking
2021-02-26 07:21:07.923818 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f977d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100ca370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100ca070>]}
2021-02-26 07:21:07.951113 (MainThread): Partial parsing not enabled
2021-02-26 07:21:07.952379 (MainThread): Parsing macros/etc.sql
2021-02-26 07:21:07.954374 (MainThread): Parsing macros/catalog.sql
2021-02-26 07:21:07.961631 (MainThread): Parsing macros/adapters.sql
2021-02-26 07:21:07.983720 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 07:21:07.987071 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 07:21:07.991314 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 07:21:08.002871 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 07:21:08.008720 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 07:21:08.023442 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 07:21:08.027637 (MainThread): Parsing macros/core.sql
2021-02-26 07:21:08.031803 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 07:21:08.042254 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 07:21:08.044463 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 07:21:08.065551 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 07:21:08.099388 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 07:21:08.123494 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 07:21:08.125744 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 07:21:08.133586 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 07:21:08.150114 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 07:21:08.158402 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 07:21:08.165958 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 07:21:08.172484 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 07:21:08.173640 (MainThread): Parsing macros/etc/query.sql
2021-02-26 07:21:08.174801 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 07:21:08.176609 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 07:21:08.187421 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 07:21:08.189692 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 07:21:08.191571 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 07:21:08.234417 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 07:21:08.236202 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 07:21:08.237650 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 07:21:08.239258 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 07:21:08.246631 (MainThread): Partial parsing not enabled
2021-02-26 07:21:08.280786 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 07:21:08.299305 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 07:21:08.308759 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 07:21:08.317681 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 07:21:08.326663 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 07:21:08.334843 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 07:21:08.349331 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:21:08.381821 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 07:21:08.604604 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 07:21:08.662830 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 155 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 07:21:08.663689 (MainThread): 
2021-02-26 07:21:08.663941 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:21:08.665093 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 07:21:08.665209 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 07:21:09.591985 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 07:21:09.592817 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 07:21:10.064285 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:21:10.478787 (MainThread): 08:21:10 | Concurrency: 1 threads (target='dev')
2021-02-26 07:21:10.479009 (MainThread): 08:21:10 | 
2021-02-26 07:21:10.484383 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 07:21:10.485686 (Thread-1): 08:21:10 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 07:21:10.486031 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 07:21:10.486192 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 07:21:10.501311 (Thread-1): finished collecting timing info
2021-02-26 07:21:10.524291 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 07:21:10.969583 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:21:11.559935 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 07:21:13.723177 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:21:13.974461 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:21:11.937744+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:21:11.937744+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 07:21:11.937744+00:00"), TIMESTAMP("2021-02-26 07:21:11.937744+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(TIMESTAMP("2021-02-26 07:21:11.937744+00:00") as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 07:21:11.937744+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 07:21:11.937744+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 07:21:11.937744+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (snapshotted_data.navn is null) != (source_data.navn is null) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (snapshotted_data.nkode1 is null) != (source_data.nkode1 is null) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (snapshotted_data.antall_ansatte is null) != (source_data.antall_ansatte is null))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 07:21:23.387920 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:21:23.645358 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:21:24.078154 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 07:21:24.078387 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:21:24.772686 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58758, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-26 07:21:24.772952 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58759, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:21:24.773132 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58762, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 07:21:24.773297 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:813c:3016:3d6f:4b2f', 58761, 0, 0), raddr=('2a00:1450:400f:80c::200a', 443, 0, 0)>
2021-02-26 07:21:24.773772 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 07:21:25.065333 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 07:21:25.065910 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 07:21:46.103146 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 07:21:47.040927 (Thread-1): finished collecting timing info
2021-02-26 07:21:47.041930 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '745b760e-9d1f-4fb0-bd21-f19ecd5fbbda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110292730>]}
2021-02-26 07:21:47.043586 (Thread-1): 08:21:47 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (101.8k rows, 146.5 MB processed) in 36.56s]
2021-02-26 07:21:47.043768 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 07:21:47.045005 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 07:21:47.045348 (MainThread): 08:21:47 | 
2021-02-26 07:21:47.045494 (MainThread): 08:21:47 | Finished running 1 snapshot in 38.38s.
2021-02-26 07:21:47.045621 (MainThread): Connection 'master' was properly closed.
2021-02-26 07:21:47.045715 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 07:21:47.049946 (MainThread): 
2021-02-26 07:21:47.050099 (MainThread): Completed successfully
2021-02-26 07:21:47.050237 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 07:21:47.050456 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102921f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100caa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100caf70>]}
2021-02-26 07:21:47.050647 (MainThread): Flushing usage events
2021-02-26 18:14:30.951613 (MainThread): Running with dbt=0.18.1
2021-02-26 18:14:31.492927 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 18:14:31.493910 (MainThread): Tracking: tracking
2021-02-26 18:14:31.503144 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a798f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aeec280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aeec160>]}
2021-02-26 18:14:31.527877 (MainThread): Partial parsing not enabled
2021-02-26 18:14:31.528802 (MainThread): Parsing macros/custom_scd.sql
2021-02-26 18:14:31.536885 (MainThread): Parsing macros/etc.sql
2021-02-26 18:14:31.538447 (MainThread): Parsing macros/catalog.sql
2021-02-26 18:14:31.544383 (MainThread): Parsing macros/adapters.sql
2021-02-26 18:14:31.562972 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 18:14:31.567664 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 18:14:31.572033 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 18:14:31.583906 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 18:14:31.589020 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 18:14:31.602783 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 18:14:31.607094 (MainThread): Parsing macros/core.sql
2021-02-26 18:14:31.611303 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 18:14:31.621896 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 18:14:31.624227 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 18:14:31.642930 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 18:14:31.670841 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 18:14:31.691478 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 18:14:31.693459 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 18:14:31.699815 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 18:14:31.717678 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 18:14:31.725454 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 18:14:31.731993 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 18:14:31.736917 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 18:14:31.737979 (MainThread): Parsing macros/etc/query.sql
2021-02-26 18:14:31.739163 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 18:14:31.741155 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 18:14:31.749827 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 18:14:31.751831 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 18:14:31.753663 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 18:14:31.793877 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 18:14:31.796039 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 18:14:31.797749 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 18:14:31.799771 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 18:14:31.807324 (MainThread): Partial parsing not enabled
2021-02-26 18:14:31.842166 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 18:14:31.861660 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 18:14:31.872035 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 18:14:31.882161 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 18:14:31.893378 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 18:14:31.902746 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 18:14:31.918406 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:14:31.951775 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 18:14:32.185677 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 18:14:32.241597 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 156 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 18:14:32.242420 (MainThread): 
2021-02-26 18:14:32.242663 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:14:32.243806 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 18:14:32.244026 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 18:14:34.344419 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 18:14:34.344725 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 18:14:34.799908 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:14:35.334184 (MainThread): 19:14:35 | Concurrency: 1 threads (target='dev')
2021-02-26 18:14:35.334417 (MainThread): 19:14:35 | 
2021-02-26 18:14:35.339779 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 18:14:35.341042 (Thread-1): 19:14:35 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 18:14:35.341390 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:14:35.341557 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 18:14:35.357471 (Thread-1): finished collecting timing info
2021-02-26 18:14:35.381256 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 18:14:35.864917 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:14:36.318150 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

    select CURRENT_TIMESTAMP() as snapshot_start
  
2021-02-26 18:14:37.932832 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:14:38.264510 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_valid_from,
            nullif(TIMESTAMP("2021-02-26 18:14:36.837654+00:00"), TIMESTAMP("2021-02-26 18:14:36.837654+00:00")) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast( as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_updated_at,
            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_valid_from,
            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (
            ((snapshotted_data.navn is null) and not (source_data.navn is null))
            or
            ((not snapshotted_data.navn is null) and (source_data.navn is null))
        ) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (
            ((snapshotted_data.nkode1 is null) and not (source_data.nkode1 is null))
            or
            ((not snapshotted_data.nkode1 is null) and (source_data.nkode1 is null))
        ) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (
            ((snapshotted_data.antall_ansatte is null) and not (source_data.antall_ansatte is null))
            or
            ((not snapshotted_data.antall_ansatte is null) and (source_data.antall_ansatte is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (
            ((snapshotted_data.navn is null) and not (source_data.navn is null))
            or
            ((not snapshotted_data.navn is null) and (source_data.navn is null))
        ) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (
            ((snapshotted_data.nkode1 is null) and not (source_data.nkode1 is null))
            or
            ((not snapshotted_data.nkode1 is null) and (source_data.nkode1 is null))
        ) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (
            ((snapshotted_data.antall_ansatte is null) and not (source_data.antall_ansatte is null))
            or
            ((not snapshotted_data.antall_ansatte is null) and (source_data.antall_ansatte is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 18:14:38.604802 (Thread-1): Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword AS at [40:87]')
2021-02-26 18:14:39.665252 (Thread-1): finished collecting timing info
2021-02-26 18:14:39.666134 (Thread-1): Database Error in snapshot foretak (snapshots/dwh/foretak.sql)
  Syntax error: Unexpected keyword AS at [40:87]
Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 103, in exception_handler
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/retry.py", line 184, in retry_target
    return target()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 266, in fn
    return self._query_and_results(client, sql, conn, job_params)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 428, in _query_and_results
    iterator = query_job.result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 3207, in result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/cloud/bigquery/job.py", line 812, in result
    return super(_AsyncJob, self).result(timeout=timeout)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/google/api_core/future/polling.py", line 127, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Syntax error: Unexpected keyword AS at [40:87]

(job ID: d1235b20-2914-48b2-b604-e93018f2dbb7)

                                                              -----Query Job SQL Follows-----                                                               

    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |
   1:/* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
   2:
   3:        
   4:
   5:  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
   6:  
   7:  
   8:  OPTIONS(
   9:      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
  10:    )
  11:  as (
  12:    with snapshot_query as (
  13:
  14:        
  15:
  16:
  17:
  18:select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`
  19:
  20:
  21:    ),
  22:
  23:    snapshotted_data as (
  24:
  25:        select *,
  26:            orgnr as dbt_unique_key
  27:
  28:        from `radjobads`.`enhetsregisteret`.`foretak`
  29:
  30:    ),
  31:
  32:    insertions_source_data as (
  33:
  34:        select
  35:            *,
  36:            orgnr as dbt_unique_key,
  37:            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_updated_at,
  38:            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_valid_from,
  39:            nullif(TIMESTAMP("2021-02-26 18:14:36.837654+00:00"), TIMESTAMP("2021-02-26 18:14:36.837654+00:00")) as dbt_valid_to,
  40:            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast( as string), '')))) as dbt_scd_id
  41:
  42:        from snapshot_query
  43:    ),
  44:
  45:    updates_source_data as (
  46:
  47:        select
  48:            *,
  49:            orgnr as dbt_unique_key,
  50:            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_updated_at,
  51:            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_valid_from,
  52:            TIMESTAMP("2021-02-26 18:14:36.837654+00:00") as dbt_valid_to
  53:
  54:        from snapshot_query
  55:    ),
  56:
  57:    insertions as (
  58:
  59:        select
  60:            'insert' as dbt_change_type,
  61:            source_data.*
  62:
  63:        from insertions_source_data as source_data
  64:        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
  65:        where snapshotted_data.dbt_unique_key is null
  66:           or (
  67:                snapshotted_data.dbt_unique_key is not null
  68:            and snapshotted_data.dbt_valid_to is null
  69:            and (
  70:                (snapshotted_data.navn != source_data.navn
  71:        or
  72:        (
  73:            ((snapshotted_data.navn is null) and not (source_data.navn is null))
  74:            or
  75:            ((not snapshotted_data.navn is null) and (source_data.navn is null))
  76:        ) or snapshotted_data.nkode1 != source_data.nkode1
  77:        or
  78:        (
  79:            ((snapshotted_data.nkode1 is null) and not (source_data.nkode1 is null))
  80:            or
  81:            ((not snapshotted_data.nkode1 is null) and (source_data.nkode1 is null))
  82:        ) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
  83:        or
  84:        (
  85:            ((snapshotted_data.antall_ansatte is null) and not (source_data.antall_ansatte is null))
  86:            or
  87:            ((not snapshotted_data.antall_ansatte is null) and (source_data.antall_ansatte is null))
  88:        ))
  89:            )
  90:        )
  91:
  92:    ),
  93:
  94:    updates as (
  95:
  96:        select
  97:            'update' as dbt_change_type,
  98:            source_data.*,
  99:            snapshotted_data.dbt_scd_id
 100:
 101:        from updates_source_data as source_data
 102:        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
 103:        where snapshotted_data.dbt_valid_to is null
 104:        and (
 105:            (snapshotted_data.navn != source_data.navn
 106:        or
 107:        (
 108:            ((snapshotted_data.navn is null) and not (source_data.navn is null))
 109:            or
 110:            ((not snapshotted_data.navn is null) and (source_data.navn is null))
 111:        ) or snapshotted_data.nkode1 != source_data.nkode1
 112:        or
 113:        (
 114:            ((snapshotted_data.nkode1 is null) and not (source_data.nkode1 is null))
 115:            or
 116:            ((not snapshotted_data.nkode1 is null) and (source_data.nkode1 is null))
 117:        ) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
 118:        or
 119:        (
 120:            ((snapshotted_data.antall_ansatte is null) and not (source_data.antall_ansatte is null))
 121:            or
 122:            ((not snapshotted_data.antall_ansatte is null) and (source_data.antall_ansatte is null))
 123:        ))
 124:        )
 125:    )
 126:
 127:    select * from insertions
 128:    union all
 129:    select * from updates
 130:  );
 131:    
    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |    .    |

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 101, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 48, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 275, in execute
    query_job, iterator = self.raw_execute(sql, fetch=fetch)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 268, in raw_execute
    query_job, iterator = self._retry_and_handle(msg=sql, conn=conn, fn=fn)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 442, in _retry_and_handle
    return retry.retry_target(
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 107, in exception_handler
    self.handle_error(e, message)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/adapters/bigquery/connections.py", line 95, in handle_error
    raise DatabaseException(error_msg)
dbt.exceptions.DatabaseException: Database Error in snapshot foretak (snapshots/dwh/foretak.sql)
  Syntax error: Unexpected keyword AS at [40:87]
2021-02-26 18:14:39.683631 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '338d3b73-007f-4225-ac42-ab5115ae5440', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b165880>]}
2021-02-26 18:14:39.685650 (Thread-1): 19:14:39 | 1 of 1 ERROR snapshotting enhetsregisteret.foretak................... [ERROR in 4.34s]
2021-02-26 18:14:39.685873 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 18:14:39.687303 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:14:39.687652 (MainThread): 19:14:39 | 
2021-02-26 18:14:39.687799 (MainThread): 19:14:39 | Finished running 1 snapshot in 7.45s.
2021-02-26 18:14:39.687932 (MainThread): Connection 'master' was properly closed.
2021-02-26 18:14:39.688025 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 18:14:39.692013 (MainThread): 
2021-02-26 18:14:39.692160 (MainThread): Completed with 1 error and 0 warnings:
2021-02-26 18:14:39.692288 (MainThread): 
2021-02-26 18:14:39.692412 (MainThread): Database Error in snapshot foretak (snapshots/dwh/foretak.sql)
2021-02-26 18:14:39.692523 (MainThread):   Syntax error: Unexpected keyword AS at [40:87]
2021-02-26 18:14:39.692637 (MainThread): 
Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
2021-02-26 18:14:39.692843 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b12c340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa54220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aead3a0>]}
2021-02-26 18:14:39.693041 (MainThread): Flushing usage events
2021-02-26 18:20:58.723706 (MainThread): Running with dbt=0.18.1
2021-02-26 18:20:59.260777 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 18:20:59.261763 (MainThread): Tracking: tracking
2021-02-26 18:20:59.268726 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f84e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6cff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6cfbb0>]}
2021-02-26 18:20:59.291527 (MainThread): Partial parsing not enabled
2021-02-26 18:20:59.292471 (MainThread): Parsing macros/custom_scd.sql
2021-02-26 18:20:59.300962 (MainThread): Parsing macros/etc.sql
2021-02-26 18:20:59.302423 (MainThread): Parsing macros/catalog.sql
2021-02-26 18:20:59.308236 (MainThread): Parsing macros/adapters.sql
2021-02-26 18:20:59.326194 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 18:20:59.328919 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 18:20:59.331796 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 18:20:59.344640 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 18:20:59.349910 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 18:20:59.363910 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 18:20:59.367396 (MainThread): Parsing macros/core.sql
2021-02-26 18:20:59.371707 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 18:20:59.381076 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 18:20:59.382922 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 18:20:59.400663 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 18:20:59.430403 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 18:20:59.450550 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 18:20:59.452836 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 18:20:59.459929 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 18:20:59.474834 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 18:20:59.481501 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 18:20:59.487660 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 18:20:59.492412 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 18:20:59.493481 (MainThread): Parsing macros/etc/query.sql
2021-02-26 18:20:59.494663 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 18:20:59.496438 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 18:20:59.505717 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 18:20:59.507813 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 18:20:59.509633 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 18:20:59.552579 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 18:20:59.554631 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 18:20:59.556284 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 18:20:59.558098 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 18:20:59.567129 (MainThread): Partial parsing not enabled
2021-02-26 18:20:59.602459 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 18:20:59.621599 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 18:20:59.632477 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 18:20:59.644288 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 18:20:59.657060 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 18:20:59.668788 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 18:20:59.688058 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:20:59.721671 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 18:20:59.947291 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 18:21:00.003425 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 156 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 18:21:00.004250 (MainThread): 
2021-02-26 18:21:00.004547 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:21:00.005820 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 18:21:00.005985 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 18:21:01.422610 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 18:21:01.422911 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 18:21:01.873503 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:21:02.295072 (MainThread): 19:21:02 | Concurrency: 1 threads (target='dev')
2021-02-26 18:21:02.295305 (MainThread): 19:21:02 | 
2021-02-26 18:21:02.301122 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 18:21:02.302469 (Thread-1): 19:21:02 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 18:21:02.302830 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:21:02.303001 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 18:21:02.318943 (Thread-1): finished collecting timing info
2021-02-26 18:21:02.342556 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 18:21:02.792136 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:21:03.255328 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:21:03.542290 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 18:21:18.816783 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:21:19.124210 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:21:19.371780 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 18:21:19.372013 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:21:20.250140 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:21:20.564146 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 18:21:20.564777 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 18:21:37.866234 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 63932, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:21:37.866495 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 63933, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:21:37.866686 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 63936, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:21:37.866865 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 63935, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:21:37.878726 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 18:21:38.757262 (Thread-1): finished collecting timing info
2021-02-26 18:21:38.758270 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6422f939-1088-4270-b603-f5c22c8cba1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8c6be0>]}
2021-02-26 18:21:38.760054 (Thread-1): 19:21:38 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (1.0m rows, 111.6 MB processed) in 36.46s]
2021-02-26 18:21:38.760248 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 18:21:38.761641 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:21:38.762005 (MainThread): 19:21:38 | 
2021-02-26 18:21:38.762166 (MainThread): 19:21:38 | Finished running 1 snapshot in 38.76s.
2021-02-26 18:21:38.762304 (MainThread): Connection 'master' was properly closed.
2021-02-26 18:21:38.762407 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 18:21:38.766727 (MainThread): 
2021-02-26 18:21:38.766890 (MainThread): Completed successfully
2021-02-26 18:21:38.767031 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 18:21:38.767265 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a697d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a928430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a928af0>]}
2021-02-26 18:21:38.767467 (MainThread): Flushing usage events
2021-02-26 18:22:28.409663 (MainThread): Running with dbt=0.18.1
2021-02-26 18:22:28.751663 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 18:22:28.752452 (MainThread): Tracking: tracking
2021-02-26 18:22:28.757197 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ecc8d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ece2b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ece2820>]}
2021-02-26 18:22:28.778478 (MainThread): Partial parsing not enabled
2021-02-26 18:22:28.779118 (MainThread): Parsing macros/custom_scd.sql
2021-02-26 18:22:28.786431 (MainThread): Parsing macros/etc.sql
2021-02-26 18:22:28.787590 (MainThread): Parsing macros/catalog.sql
2021-02-26 18:22:28.793383 (MainThread): Parsing macros/adapters.sql
2021-02-26 18:22:28.811003 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 18:22:28.813529 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 18:22:28.816187 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 18:22:28.825857 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 18:22:28.830017 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 18:22:28.842262 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 18:22:28.844908 (MainThread): Parsing macros/core.sql
2021-02-26 18:22:28.848269 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 18:22:28.856725 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 18:22:28.858350 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 18:22:28.874078 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 18:22:28.901467 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 18:22:28.921332 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 18:22:28.923049 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 18:22:28.928804 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 18:22:28.942105 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 18:22:28.948407 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 18:22:28.954214 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 18:22:28.958955 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 18:22:28.959828 (MainThread): Parsing macros/etc/query.sql
2021-02-26 18:22:28.960803 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 18:22:28.962303 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 18:22:28.970470 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 18:22:28.972368 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 18:22:28.973997 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 18:22:29.013907 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 18:22:29.015646 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 18:22:29.017054 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 18:22:29.018814 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 18:22:29.026292 (MainThread): Partial parsing not enabled
2021-02-26 18:22:29.060336 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 18:22:29.078512 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 18:22:29.088259 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 18:22:29.097185 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 18:22:29.106376 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 18:22:29.114470 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 18:22:29.129480 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:22:29.161219 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 18:22:29.387015 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 18:22:29.443227 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 156 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 18:22:29.444090 (MainThread): 
2021-02-26 18:22:29.444328 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:22:29.445452 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 18:22:29.445565 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 18:22:30.412807 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 18:22:30.413115 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 18:22:30.862935 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:22:31.382204 (MainThread): 19:22:31 | Concurrency: 1 threads (target='dev')
2021-02-26 18:22:31.382397 (MainThread): 19:22:31 | 
2021-02-26 18:22:31.385418 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 18:22:31.386436 (Thread-1): 19:22:31 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 18:22:31.386708 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:22:31.386851 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 18:22:31.400971 (Thread-1): finished collecting timing info
2021-02-26 18:22:31.423387 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 18:22:31.869567 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:22:32.369951 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:22:32.650912 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 18:22:56.175648 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:22:56.416746 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:22:56.665175 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 18:22:56.665403 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:22:57.391112 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:22:57.625258 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 18:22:57.625855 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 18:23:32.505453 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 63960, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:23:32.506843 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 63961, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:23:32.507313 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 63964, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:23:32.507637 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 63963, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:23:32.520737 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 18:23:33.354853 (Thread-1): finished collecting timing info
2021-02-26 18:23:33.355843 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c17f39ac-8352-4b2a-8d6b-bc2c19744c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ed608b0>]}
2021-02-26 18:23:33.357488 (Thread-1): 19:23:33 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (2.0m rows, 334.7 MB processed) in 61.97s]
2021-02-26 18:23:33.357666 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 18:23:33.358883 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:23:33.359211 (MainThread): 19:23:33 | 
2021-02-26 18:23:33.359353 (MainThread): 19:23:33 | Finished running 1 snapshot in 63.91s.
2021-02-26 18:23:33.359473 (MainThread): Connection 'master' was properly closed.
2021-02-26 18:23:33.359563 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 18:23:33.363617 (MainThread): 
2021-02-26 18:23:33.363768 (MainThread): Completed successfully
2021-02-26 18:23:33.363895 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 18:23:33.364109 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eea3550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eea3940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10eea3fa0>]}
2021-02-26 18:23:33.364301 (MainThread): Flushing usage events
2021-02-26 18:29:19.300074 (MainThread): Running with dbt=0.18.1
2021-02-26 18:29:19.833219 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 18:29:19.834295 (MainThread): Tracking: tracking
2021-02-26 18:29:19.842945 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113361850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11337fc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11337f8b0>]}
2021-02-26 18:29:19.865793 (MainThread): Partial parsing not enabled
2021-02-26 18:29:19.866470 (MainThread): Parsing macros/custom_scd.sql
2021-02-26 18:29:19.878811 (MainThread): Parsing macros/etc.sql
2021-02-26 18:29:19.880267 (MainThread): Parsing macros/catalog.sql
2021-02-26 18:29:19.886033 (MainThread): Parsing macros/adapters.sql
2021-02-26 18:29:19.906635 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 18:29:19.909557 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 18:29:19.912591 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 18:29:19.922405 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 18:29:19.927118 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 18:29:19.939727 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 18:29:19.944103 (MainThread): Parsing macros/core.sql
2021-02-26 18:29:19.948628 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 18:29:19.958560 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 18:29:19.960480 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 18:29:19.978650 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 18:29:20.008330 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 18:29:20.028537 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 18:29:20.030461 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 18:29:20.036630 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 18:29:20.049822 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 18:29:20.056396 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 18:29:20.062556 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 18:29:20.067660 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 18:29:20.068737 (MainThread): Parsing macros/etc/query.sql
2021-02-26 18:29:20.069946 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 18:29:20.071752 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 18:29:20.080910 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 18:29:20.082964 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 18:29:20.084810 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 18:29:20.128013 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 18:29:20.130701 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 18:29:20.132934 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 18:29:20.135099 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 18:29:20.143761 (MainThread): Partial parsing not enabled
2021-02-26 18:29:20.179221 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 18:29:20.198912 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 18:29:20.208934 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 18:29:20.218786 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 18:29:20.229035 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 18:29:20.238665 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 18:29:20.254811 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:29:20.287169 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 18:29:20.520404 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 18:29:20.576660 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 157 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 18:29:20.577488 (MainThread): 
2021-02-26 18:29:20.577729 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:29:20.578858 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 18:29:20.578972 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 18:29:22.282303 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 18:29:22.282609 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 18:29:22.751907 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:29:23.274799 (MainThread): 19:29:23 | Concurrency: 1 threads (target='dev')
2021-02-26 18:29:23.275023 (MainThread): 19:29:23 | 
2021-02-26 18:29:23.281200 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 18:29:23.282507 (Thread-1): 19:29:23 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 18:29:23.282858 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:29:23.283033 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 18:29:23.298762 (Thread-1): finished collecting timing info
2021-02-26 18:29:23.322162 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 18:29:23.767331 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:29:24.342878 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:29:24.624773 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 18:29:50.476929 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:29:50.831107 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:29:51.143086 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 18:29:51.143315 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:29:51.957996 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:29:52.187931 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 18:29:52.189849 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 18:30:34.410270 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64031, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-26 18:30:34.410527 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64032, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:30:34.410706 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64035, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:30:34.410870 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64034, 0, 0), raddr=('2a00:1450:400f:804::200a', 443, 0, 0)>
2021-02-26 18:30:34.422221 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 18:30:35.250630 (Thread-1): finished collecting timing info
2021-02-26 18:30:35.252366 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36ede832-fd5f-4c03-aaa3-d64dce78fbf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135ae6d0>]}
2021-02-26 18:30:35.254368 (Thread-1): 19:30:35 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (2.0m rows, 446.5 MB processed) in 71.97s]
2021-02-26 18:30:35.254591 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 18:30:35.256262 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:30:35.256595 (MainThread): 19:30:35 | 
2021-02-26 18:30:35.256738 (MainThread): 19:30:35 | Finished running 1 snapshot in 74.68s.
2021-02-26 18:30:35.256855 (MainThread): Connection 'master' was properly closed.
2021-02-26 18:30:35.256941 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 18:30:35.261089 (MainThread): 
2021-02-26 18:30:35.261222 (MainThread): Completed successfully
2021-02-26 18:30:35.261334 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 18:30:35.261526 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11342cd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1136bdc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1136bda00>]}
2021-02-26 18:30:35.261693 (MainThread): Flushing usage events
2021-02-26 18:37:46.439381 (MainThread): Running with dbt=0.18.1
2021-02-26 18:37:46.972416 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 18:37:46.973402 (MainThread): Tracking: tracking
2021-02-26 18:37:46.979906 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dcaca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e01e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e01af0>]}
2021-02-26 18:37:47.005061 (MainThread): Partial parsing not enabled
2021-02-26 18:37:47.005792 (MainThread): Parsing macros/custom_scd.sql
2021-02-26 18:37:47.019016 (MainThread): Parsing macros/etc.sql
2021-02-26 18:37:47.020579 (MainThread): Parsing macros/catalog.sql
2021-02-26 18:37:47.026659 (MainThread): Parsing macros/adapters.sql
2021-02-26 18:37:47.045610 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 18:37:47.048477 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 18:37:47.051486 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 18:37:47.062365 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 18:37:47.067563 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 18:37:47.082187 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 18:37:47.085597 (MainThread): Parsing macros/core.sql
2021-02-26 18:37:47.089496 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 18:37:47.098049 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 18:37:47.099809 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 18:37:47.115915 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 18:37:47.143132 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 18:37:47.163319 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 18:37:47.165174 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 18:37:47.171585 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 18:37:47.187644 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 18:37:47.195285 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 18:37:47.201717 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 18:37:47.206555 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 18:37:47.207629 (MainThread): Parsing macros/etc/query.sql
2021-02-26 18:37:47.208889 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 18:37:47.210730 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 18:37:47.219866 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 18:37:47.221930 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 18:37:47.223691 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 18:37:47.264085 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 18:37:47.266481 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 18:37:47.268344 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 18:37:47.270176 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 18:37:47.278684 (MainThread): Partial parsing not enabled
2021-02-26 18:37:47.319639 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 18:37:47.340255 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 18:37:47.351050 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 18:37:47.364762 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 18:37:47.377572 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 18:37:47.387721 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 18:37:47.402903 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:37:47.406217 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e581f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10701a160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107015a90>]}
2021-02-26 18:37:47.406383 (MainThread): Flushing usage events
2021-02-26 18:37:47.983724 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 18:37:47.983958 (MainThread): Encountered an error:
2021-02-26 18:37:47.984172 (MainThread): Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 11
      invalidate_hard_deletes=True
2021-02-26 18:37:47.995098 (MainThread): Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 11, in template
jinja2.exceptions.TemplateSyntaxError: expected token ',', got 'invalidate_hard_deletes'
  line 11
    invalidate_hard_deletes=True

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 124, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 202, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/main.py", line 255, in run_from_args
    results = task.run()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 399, in run
    self._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 118, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 78, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/task/runnable.py", line 65, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 748, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 349, in load_all
    loader.load(macro_manifest=macro_manifest)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 204, in load
    self.parse_project(project, macro_manifest, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 177, in parse_project
    self.parse_with_cache(path, parser, old_results)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/manifest.py", line 133, in parse_with_cache
    parser.parse_file(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/snapshots.py", line 82, in parse_file
    self.parse_node(block)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/parser/base.py", line 288, in render_with_context
    get_rendered(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 570, in get_rendered
    template = get_template(
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/Cellar/python@3.8/3.8.6_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/Cellar/dbt/0.18.1_1/libexec/lib/python3.8/site-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in snapshot foretak (snapshots/dwh/foretak.sql)
  expected token ',', got 'invalidate_hard_deletes'
    line 11
      invalidate_hard_deletes=True

2021-02-26 18:38:02.874154 (MainThread): Running with dbt=0.18.1
2021-02-26 18:38:03.226602 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 18:38:03.227347 (MainThread): Tracking: tracking
2021-02-26 18:38:03.231962 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9957c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9a4910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f9a45b0>]}
2021-02-26 18:38:03.254457 (MainThread): Partial parsing not enabled
2021-02-26 18:38:03.255082 (MainThread): Parsing macros/custom_scd.sql
2021-02-26 18:38:03.268562 (MainThread): Parsing macros/etc.sql
2021-02-26 18:38:03.269802 (MainThread): Parsing macros/catalog.sql
2021-02-26 18:38:03.275434 (MainThread): Parsing macros/adapters.sql
2021-02-26 18:38:03.293512 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 18:38:03.296234 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 18:38:03.298853 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 18:38:03.308482 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 18:38:03.312573 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 18:38:03.325052 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 18:38:03.328091 (MainThread): Parsing macros/core.sql
2021-02-26 18:38:03.331555 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 18:38:03.340427 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 18:38:03.342116 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 18:38:03.361272 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 18:38:03.393997 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 18:38:03.417955 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 18:38:03.420107 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 18:38:03.427190 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 18:38:03.443017 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 18:38:03.450771 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 18:38:03.458021 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 18:38:03.463680 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 18:38:03.464732 (MainThread): Parsing macros/etc/query.sql
2021-02-26 18:38:03.465912 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 18:38:03.467729 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 18:38:03.477621 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 18:38:03.479834 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 18:38:03.481724 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 18:38:03.523998 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 18:38:03.525974 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 18:38:03.527451 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 18:38:03.529193 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 18:38:03.537802 (MainThread): Partial parsing not enabled
2021-02-26 18:38:03.572460 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 18:38:03.591102 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 18:38:03.600613 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 18:38:03.610083 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 18:38:03.619435 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 18:38:03.628719 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 18:38:03.644251 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:38:03.679007 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 18:38:03.913961 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.stg
- models.er.dwh

2021-02-26 18:38:03.971826 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 157 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 18:38:03.972748 (MainThread): 
2021-02-26 18:38:03.972990 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:38:03.974129 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 18:38:03.974243 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 18:38:05.281906 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 18:38:05.282179 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 18:38:05.730017 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:38:06.263675 (MainThread): 19:38:06 | Concurrency: 1 threads (target='dev')
2021-02-26 18:38:06.263904 (MainThread): 19:38:06 | 
2021-02-26 18:38:06.270171 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 18:38:06.271489 (Thread-1): 19:38:06 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 18:38:06.271864 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:38:06.272036 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 18:38:06.288734 (Thread-1): finished collecting timing info
2021-02-26 18:38:06.312380 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 18:38:06.808739 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:38:07.344665 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:38:07.724804 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (
            ((snapshotted_data.navn is null) and not (source_data.navn is null))
            or
            ((not snapshotted_data.navn is null) and (source_data.navn is null))
        ) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (
            ((snapshotted_data.nkode1 is null) and not (source_data.nkode1 is null))
            or
            ((not snapshotted_data.nkode1 is null) and (source_data.nkode1 is null))
        ) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (
            ((snapshotted_data.antall_ansatte is null) and not (source_data.antall_ansatte is null))
            or
            ((not snapshotted_data.antall_ansatte is null) and (source_data.antall_ansatte is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (
            ((snapshotted_data.navn is null) and not (source_data.navn is null))
            or
            ((not snapshotted_data.navn is null) and (source_data.navn is null))
        ) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (
            ((snapshotted_data.nkode1 is null) and not (source_data.nkode1 is null))
            or
            ((not snapshotted_data.nkode1 is null) and (source_data.nkode1 is null))
        ) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (
            ((snapshotted_data.antall_ansatte is null) and not (source_data.antall_ansatte is null))
            or
            ((not snapshotted_data.antall_ansatte is null) and (source_data.antall_ansatte is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 18:38:22.788952 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:38:23.024155 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:38:23.266356 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 18:38:23.266589 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:38:24.000994 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:38:24.260547 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 18:38:24.261130 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 18:38:41.173618 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64175, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-26 18:38:41.173879 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64176, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:38:41.174066 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64179, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:38:41.174236 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64178, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-26 18:38:41.186117 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 18:38:42.112877 (Thread-1): finished collecting timing info
2021-02-26 18:38:42.113873 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a4e3ecf-50e1-494f-81bf-a6143fac4650', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fce6f40>]}
2021-02-26 18:38:42.115476 (Thread-1): 19:38:42 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (1.0m rows, 111.6 MB processed) in 35.84s]
2021-02-26 18:38:42.115655 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 18:38:42.116826 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:38:42.117160 (MainThread): 19:38:42 | 
2021-02-26 18:38:42.117300 (MainThread): 19:38:42 | Finished running 1 snapshot in 38.14s.
2021-02-26 18:38:42.117420 (MainThread): Connection 'master' was properly closed.
2021-02-26 18:38:42.117510 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 18:38:42.121407 (MainThread): 
2021-02-26 18:38:42.121549 (MainThread): Completed successfully
2021-02-26 18:38:42.121685 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 18:38:42.121879 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fb944c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa10f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa10280>]}
2021-02-26 18:38:42.122053 (MainThread): Flushing usage events
2021-02-26 18:39:07.340505 (MainThread): Running with dbt=0.18.1
2021-02-26 18:39:07.686904 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.snapshot.SnapshotTask'>, debug=False, defer=None, exclude=None, log_cache_events=False, log_format='default', models=['foretak'], partial_parse=None, profile=None, profiles_dir='/Users/radbrt/.dbt', project_dir=None, record_timing_info=None, rpc_method='snapshot', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='snapshot', write_json=True)
2021-02-26 18:39:07.687530 (MainThread): Tracking: tracking
2021-02-26 18:39:07.693461 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112351fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112372d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123729d0>]}
2021-02-26 18:39:07.712997 (MainThread): Partial parsing not enabled
2021-02-26 18:39:07.713616 (MainThread): Parsing macros/custom_scd.sql
2021-02-26 18:39:07.726492 (MainThread): Parsing macros/etc.sql
2021-02-26 18:39:07.727643 (MainThread): Parsing macros/catalog.sql
2021-02-26 18:39:07.733214 (MainThread): Parsing macros/adapters.sql
2021-02-26 18:39:07.751498 (MainThread): Parsing macros/materializations/seed.sql
2021-02-26 18:39:07.754090 (MainThread): Parsing macros/materializations/view.sql
2021-02-26 18:39:07.756758 (MainThread): Parsing macros/materializations/table.sql
2021-02-26 18:39:07.766032 (MainThread): Parsing macros/materializations/copy.sql
2021-02-26 18:39:07.770123 (MainThread): Parsing macros/materializations/incremental.sql
2021-02-26 18:39:07.782232 (MainThread): Parsing macros/materializations/snapshot.sql
2021-02-26 18:39:07.784904 (MainThread): Parsing macros/core.sql
2021-02-26 18:39:07.788718 (MainThread): Parsing macros/materializations/helpers.sql
2021-02-26 18:39:07.797454 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-02-26 18:39:07.799164 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-02-26 18:39:07.815131 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-02-26 18:39:07.842017 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-02-26 18:39:07.861801 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-02-26 18:39:07.863510 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-02-26 18:39:07.869270 (MainThread): Parsing macros/materializations/common/merge.sql
2021-02-26 18:39:07.882216 (MainThread): Parsing macros/materializations/table/table.sql
2021-02-26 18:39:07.888508 (MainThread): Parsing macros/materializations/view/view.sql
2021-02-26 18:39:07.894531 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-02-26 18:39:07.899125 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-02-26 18:39:07.899995 (MainThread): Parsing macros/etc/query.sql
2021-02-26 18:39:07.900968 (MainThread): Parsing macros/etc/is_incremental.sql
2021-02-26 18:39:07.902483 (MainThread): Parsing macros/etc/datetime.sql
2021-02-26 18:39:07.910812 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-02-26 18:39:07.912628 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-02-26 18:39:07.914175 (MainThread): Parsing macros/adapters/common.sql
2021-02-26 18:39:07.954387 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-02-26 18:39:07.956137 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-02-26 18:39:07.957652 (MainThread): Parsing macros/schema_tests/unique.sql
2021-02-26 18:39:07.959242 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-02-26 18:39:07.966811 (MainThread): Partial parsing not enabled
2021-02-26 18:39:08.003708 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_010".
2021-02-26 18:39:08.023111 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_010".
2021-02-26 18:39:08.032481 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_virk_load_date".
2021-02-26 18:39:08.041372 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_max_load_date".
2021-02-26 18:39:08.050594 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_foretak_020".
2021-02-26 18:39:08.058803 (MainThread): Acquiring new bigquery connection "model.enhetsregisteret.wrk_virksomheter_020".
2021-02-26 18:39:08.073654 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:39:08.106500 (MainThread): Acquiring new bigquery connection "snapshot.enhetsregisteret.virksomheter".
2021-02-26 18:39:08.342373 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.er.dwh
- models.er.stg

2021-02-26 18:39:08.397993 (MainThread): Found 6 models, 4 tests, 2 snapshots, 0 analyses, 157 macros, 0 operations, 0 seed files, 2 sources
2021-02-26 18:39:08.398891 (MainThread): 
2021-02-26 18:39:08.399165 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:39:08.400355 (ThreadPoolExecutor-0_0): Acquiring new bigquery connection "list_radjobads".
2021-02-26 18:39:08.400477 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-02-26 18:39:09.395221 (ThreadPoolExecutor-1_0): Acquiring new bigquery connection "list_radjobads_enhetsregisteret".
2021-02-26 18:39:09.395529 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-02-26 18:39:09.847628 (ThreadPoolExecutor-1_0): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:39:10.264931 (MainThread): 19:39:10 | Concurrency: 1 threads (target='dev')
2021-02-26 18:39:10.265154 (MainThread): 19:39:10 | 
2021-02-26 18:39:10.268722 (Thread-1): Began running node snapshot.enhetsregisteret.foretak
2021-02-26 18:39:10.269936 (Thread-1): 19:39:10 | 1 of 1 START snapshot enhetsregisteret.foretak....................... [RUN]
2021-02-26 18:39:10.270259 (Thread-1): Acquiring new bigquery connection "snapshot.enhetsregisteret.foretak".
2021-02-26 18:39:10.270418 (Thread-1): Compiling snapshot.enhetsregisteret.foretak
2021-02-26 18:39:10.286111 (Thread-1): finished collecting timing info
2021-02-26 18:39:10.309191 (Thread-1): Opening a new connection, currently in state closed
2021-02-26 18:39:10.760436 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:39:11.403708 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:39:11.684381 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

        

  create or replace table `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
  
  
  OPTIONS(
      expiration_timestamp=TIMESTAMP_ADD(CURRENT_TIMESTAMP(), INTERVAL 12 hour)
    )
  as (
    with snapshot_query as (

        



select * from `radjobads`.`enhetsregisteret`.`wrk_foretak_020`


    ),

    snapshotted_data as (

        select *,
            orgnr as dbt_unique_key

        from `radjobads`.`enhetsregisteret`.`foretak`

    ),

    insertions_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            to_hex(md5(concat(coalesce(cast(orgnr as string), ''), '|',coalesce(cast(updated_at as string), '')))) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            orgnr as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and snapshotted_data.dbt_valid_to is null
            and (
                (snapshotted_data.navn != source_data.navn
        or
        (
            ((snapshotted_data.navn is null) and not (source_data.navn is null))
            or
            ((not snapshotted_data.navn is null) and (source_data.navn is null))
        ) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (
            ((snapshotted_data.nkode1 is null) and not (source_data.nkode1 is null))
            or
            ((not snapshotted_data.nkode1 is null) and (source_data.nkode1 is null))
        ) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (
            ((snapshotted_data.antall_ansatte is null) and not (source_data.antall_ansatte is null))
            or
            ((not snapshotted_data.antall_ansatte is null) and (source_data.antall_ansatte is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_valid_to is null
        and (
            (snapshotted_data.navn != source_data.navn
        or
        (
            ((snapshotted_data.navn is null) and not (source_data.navn is null))
            or
            ((not snapshotted_data.navn is null) and (source_data.navn is null))
        ) or snapshotted_data.nkode1 != source_data.nkode1
        or
        (
            ((snapshotted_data.nkode1 is null) and not (source_data.nkode1 is null))
            or
            ((not snapshotted_data.nkode1 is null) and (source_data.nkode1 is null))
        ) or snapshotted_data.antall_ansatte != source_data.antall_ansatte
        or
        (
            ((snapshotted_data.antall_ansatte is null) and not (source_data.antall_ansatte is null))
            or
            ((not snapshotted_data.antall_ansatte is null) and (source_data.antall_ansatte is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates
  );
    
2021-02-26 18:39:23.872495 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:39:24.179719 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:39:24.422788 (Thread-1): Adding columns ([]) to table `radjobads`.`enhetsregisteret`.`foretak`".
2021-02-26 18:39:24.423035 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:39:25.205014 (Thread-1): Client.dataset is deprecated and will be removed in a future version. Use a string like 'my_project.my_dataset' or a cloud.google.bigquery.DatasetReference object, instead.
2021-02-26 18:39:25.516541 (Thread-1): Writing runtime SQL for node "snapshot.enhetsregisteret.foretak"
2021-02-26 18:39:25.517177 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */

      merge into `radjobads`.`enhetsregisteret`.`foretak` as DBT_INTERNAL_DEST
    using `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp` as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
        values (`orgnr`, `navn`, `nkode1`, `antall_ansatte`, `updated_at`, `dbt_updated_at`, `dbt_valid_from`, `dbt_valid_to`, `dbt_scd_id`)
    ;

  
2021-02-26 18:39:42.000866 (Thread-1): unclosed <socket.socket fd=11, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64201, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-26 18:39:42.001128 (Thread-1): unclosed <socket.socket fd=12, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64202, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:39:42.001314 (Thread-1): unclosed <socket.socket fd=14, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64205, 0, 0), raddr=('2a00:1450:400f:807::200a', 443, 0, 0)>
2021-02-26 18:39:42.001483 (Thread-1): unclosed <socket.socket fd=13, family=AddressFamily.AF_INET6, type=SocketKind.SOCK_STREAM, proto=6, laddr=('2001:4651:5e78:0:15ec:9851:188d:32c3', 64204, 0, 0), raddr=('2a00:1450:400f:80b::200a', 443, 0, 0)>
2021-02-26 18:39:42.013857 (Thread-1): On snapshot.enhetsregisteret.foretak: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "enhetsregisteret", "target_name": "dev", "node_id": "snapshot.enhetsregisteret.foretak"} */
drop table if exists `radjobads`.`enhetsregisteret`.`foretak__dbt_tmp`
2021-02-26 18:39:42.895339 (Thread-1): finished collecting timing info
2021-02-26 18:39:42.896346 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cef6d3ae-afcf-45bc-b2ee-7ee814c0e18a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125a1760>]}
2021-02-26 18:39:42.898030 (Thread-1): 19:39:42 | 1 of 1 OK snapshotted enhetsregisteret.foretak....................... [MERGE (87.2k rows, 113.7 MB processed) in 32.63s]
2021-02-26 18:39:42.898214 (Thread-1): Finished running node snapshot.enhetsregisteret.foretak
2021-02-26 18:39:42.899499 (MainThread): Acquiring new bigquery connection "master".
2021-02-26 18:39:42.899844 (MainThread): 19:39:42 | 
2021-02-26 18:39:42.899993 (MainThread): 19:39:42 | Finished running 1 snapshot in 34.50s.
2021-02-26 18:39:42.900119 (MainThread): Connection 'master' was properly closed.
2021-02-26 18:39:42.900213 (MainThread): Connection 'snapshot.enhetsregisteret.foretak' was properly closed.
2021-02-26 18:39:42.904417 (MainThread): 
2021-02-26 18:39:42.904574 (MainThread): Completed successfully
2021-02-26 18:39:42.904711 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2021-02-26 18:39:42.904933 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112519430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112414820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112414730>]}
2021-02-26 18:39:42.905138 (MainThread): Flushing usage events
